import{parseFragment as p,registerTemplate as J,freezeTemplate as Q,registerComponent as z,registerDecorators as Y,LightningElement as K,parseSVGFragment as Rt}from"/1/bundle/esm/l/en-US/bi/0/module/mi/lwc%2Fv%2F8_12_7/s/sha256-A4k_e_1rs5Y4edfd78wU8iL0ESRybIXT4kbpYdnL__Y/bundle_lwc.js";import{load as ne}from"/1/bundle/esm/l/en-US/bi/0/module/mi/lwr%2FesmLoader%2Fv%2F0_16_11/s/sha256-XZ3-fTIQeMpr-t515p72MK4vr6gSnXsH3O_YELtRaFw/bundle_lwr_esmLoader.js";function Gi(n,e,s){var t=n?"["+n+"]":"",o=n?"["+n+"-host]":"";return(e?":host {":o+" {")+"display: block;overflow: hidden;position: relative;width: 100%;}section"+t+" {max-width: 1200px;margin: 0 auto;display: flex;margin-top: 2px;}article.container"+t+" {margin-bottom: 24px;}@media (max-width: 380px) {article.container"+t+" {margin-bottom: 34px;}}"}var Vs=[Gi];function Xi(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".app-container",t,` {height: 100vh;width: 100vw;overflow: hidden;font-family:\r
 'Inter',\r
 -apple-system,\r
 BlinkMacSystemFont,\r
 'Segoe UI',\r
 Roboto,\r
 Arial,\r
 sans-serif;background: #fafafa;}.main-layout`,t," {display: flex;height: 100vh;width: 100vw;}.content-area",t," {flex: 1;margin-left: 200px;background-attachment: fixed;overflow: hidden;position: relative;}.view-container",t," {height: 100vh;display: flex;flex-direction: column;background: rgba(255, 255, 255, 0.95);backdrop-filter: blur(20px);overflow: hidden;}.view-header",t,` {position: sticky;top: 0;z-index: 100;background: rgba(179, 173, 231, 0.349);backdrop-filter: blur(20px);border-bottom: 1px solid rgba(0, 0, 0, 0.06);padding: 24px 32px 0 32px;padding-top: calc(\r
 24px + env(safe-area-inset-top, 0px)\r
 );box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);}.header-content`,t," {display: flex;flex-direction: column;gap: 16px;}.header-title",t," {display: flex;align-items: center;justify-content: center;margin-top: 32px;}.view-header",t," h1",t," {margin: 0;font-size: 28px;font-weight: 700;color: #1a1a1a;letter-spacing: -0.5px;line-height: 1.2;text-align: center;}.header-subtitle",t," {font-size: 14px;color: #6b7280;margin-top: 4px;font-weight: 400;}.search-container",t," {position: relative;max-width: 480px;margin-bottom: 20px;display: flex;align-items: center;gap: 10px;}.search-wrapper",t," {position: relative;display: flex;align-items: center;flex: 1;}.qr-button-container",t," {display: flex;align-items: center;}.qr-button",t," {width: 48px;height: 48px;border-radius: 12px;background: #ffffff;border: 1.5px solid #e5e7eb;display: flex;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);}.qr-button:hover",t,` {border-color: #667eea;box-shadow:\r
 0 0 0 3px rgba(102, 126, 234, 0.1),\r
 0 4px 14px rgba(0, 0, 0, 0.08);transform: translateY(-1px);}.qr-icon`,t," {width: 24px;height: 24px;color: #6b7280;}.search-input",t," {width: 100%;height: 48px;padding: 12px 16px 12px 48px;border: 1.5px solid #e5e7eb;border-radius: 12px;font-size: 16px;font-weight: 400;color: #374151;background: #ffffff;transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);}.search-input:focus",t,` {outline: none;border-color: #667eea;box-shadow:\r
 0 0 0 3px rgba(102, 126, 234, 0.1),\r
 0 4px 14px rgba(0, 0, 0, 0.08);transform: translateY(-1px);}.search-input`,t,"::placeholder {color: #9ca3af;font-weight: 400;}.search-icon",t," {position: absolute;left: 16px;width: 18px;height: 18px;color: #6b7280;pointer-events: none;z-index: 1;}.content-scroll",t," {flex: 1;overflow-y: auto;padding: 0 32px 32px 32px;scroll-behavior: smooth;}.content-scroll",t,"::-webkit-scrollbar {width: 6px;}.content-scroll",t,"::-webkit-scrollbar-track {background: transparent;}.content-scroll",t,"::-webkit-scrollbar-thumb {background: rgba(0, 0, 0, 0.1);border-radius: 3px;}.content-scroll::-webkit-scrollbar-thumb:hover",t," {background: rgba(0, 0, 0, 0.15);}.fab",t,` {position: fixed;bottom: 24px;right: 24px;width: 56px;height: 56px;background: #42077c;border: none;border-radius: 50%;box-shadow:\r
 0 8px 24px rgba(66, 7, 124, 0.35),\r
 0 4px 12px rgba(0, 0, 0, 0.15);cursor: pointer;display: flex;align-items: center;justify-content: center;z-index: 1000;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);color: white;font-size: 24px;}.fab:hover`,t,` {transform: translateY(-2px) scale(1.05);box-shadow:\r
 0 12px 32px rgba(66, 7, 124, 0.45),\r
 0 8px 16px rgba(0, 0, 0, 0.2);}.fab:active`,t," {transform: translateY(0) scale(0.98);}.content-area.form-mode",t," {background: #f2f2f2;}.form-page",t," {padding: 0;height: 100%;overflow-y: auto;}.component-page",t," {padding: 0;height: 100%;margin-top: 50px;background: #ffffff;}.component-page",t," .page-header",t," {padding: 0.75rem 1rem;padding-top: 50px;display: flex;align-items: center;background-color: #f8f9fa;border-bottom: 1px solid #e2e8f0;min-height: 50px;}.back-button",t," {display: flex;align-items: center;justify-content: center;background-color: transparent;border: none;border-radius: 6px;padding: 0.5rem;cursor: pointer;margin-right: 1rem;transition: all 0.2s;width: 40px;height: 40px;}.back-button:hover",t," {background-color: #f3f4f6;}.back-icon",t," {width: 20px;height: 20px;color: #4b5563;}.page-title",t," {font-size: 1.25rem;font-weight: 600;color: #1f2937;margin: 0;}.component-content",t," {height: calc(100% - 60px);overflow-y: auto;padding: 0;}@media screen and (min-width: 769px) {.form-page",t," {padding: 0;height: 100%;}}@media screen and (max-width: 768px) {.main-layout",t," {flex-direction: column;}.content-area",t," {margin-left: 0;margin-top: 0;}.view-container",t," {margin-top: 0px;}.view-header",t," {padding: 20px 20px 0 20px;padding-top: calc(20px + env(safe-area-inset-top, 0px));}.view-header",t," h1",t," {font-size: 24px;padding-left: 0;text-align: center;}.header-title",t," {margin-top: 48px;}.header-content",t," {gap: 12px;}.search-container",t," {max-width: 100%;margin-top: 8px;}.search-input",t," {height: 44px;font-size: 16px;padding: 10px 14px 10px 44px;}.content-scroll",t," {padding: 0 20px 20px 20px;}.fab",t," {bottom: 20px;right: 20px;width: 52px;height: 52px;}}.modern-card",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);overflow: hidden;}.modern-card:hover",t," {box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.loading-spinner",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 40px;color: #6b7280;}.spinner",t," {width: 40px;height: 40px;border: 3px solid #f3f4f6;border-top: 3px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 16px;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text",t," {font-size: 14px;color: #6b7280;font-weight: 500;}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);display: flex;align-items: center;justify-content: center;z-index: 1100;backdrop-filter: blur(4px);}.modal-content",t," {width: 90%;max-width: 500px;background: white;border-radius: 16px;overflow: hidden;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);animation: modal-slide-in",o," 0.3s ease-out forwards;}.modal-header",t," {display: flex;align-items: center;justify-content: space-between;padding: 16px 20px;border-bottom: 1px solid #e5e7eb;}.modal-header",t," h2",t," {margin: 0;font-size: 18px;font-weight: 600;color: #1f2937;}.close-button",t," {background: transparent;border: none;width: 32px;height: 32px;border-radius: 50%;display: flex;align-items: center;justify-content: center;cursor: pointer;color: #6b7280;transition: all 0.2s;}.close-button:hover",t," {background-color: #f3f4f6;color: #1f2937;}.close-button",t," svg",t," {width: 20px;height: 20px;}.modal-body",t," {padding: 20px;}@keyframes modal-slide-in",o," {from {opacity: 0;transform: translateY(20px);}to {opacity: 1;transform: translateY(0);}}.error-message",t," {display: flex;align-items: center;padding: 16px 20px;background: #fef2f2;border: 1px solid #fecaca;border-radius: 12px;margin: 16px 0;color: #dc2626;}.error-icon",t," {margin-right: 12px;font-size: 18px;}.error-text",t," {font-size: 14px;font-weight: 500;}@media (max-width: 768px) {.component-page",t," .page-header",t," {padding: 0.75rem 1rem;padding-top: 8px;min-height: 50px;}.page-title",t," {font-size: 1.25rem;}.back-button",t," {padding: 0.375rem;width: 36px;height: 36px;}.notification-modal",t," {width: 90%;max-width: none;}}.notification-overlay",t," {backdrop-filter: blur(5px);background-color: rgba(0, 0, 0, 0.5);}.notification-modal",t," {max-width: 400px;border-radius: 12px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);}.notification-header",t," {border-bottom: 1px solid #edf2f7;padding: 16px 24px;}.notification-body",t," {display: flex;flex-direction: column;align-items: center;padding: 32px 24px;text-align: center;}.notification-icon",t," {width: 64px;height: 64px;border-radius: 50%;display: flex;align-items: center;justify-content: center;margin-bottom: 16px;}.notification-icon",t," svg",t," {width: 40px;height: 40px;}.success-icon",t," {background-color: #ebf8f2;color: #38a169;}.error-icon",t," {background-color: #fef2f2;color: #e53e3e;}.notification-message",t," {font-size: 1rem;line-height: 1.5;color: #4a5568;margin: 0;}.notification-footer",t," {display: flex;justify-content: center;padding: 16px 24px;border-top: 1px solid #edf2f7;}.notification-button",t," {min-width: 100px;background-color: #3182ce;color: white;border: none;border-radius: 6px;padding: 10px 16px;font-weight: 500;cursor: pointer;transition: background-color 0.2s;}.notification-button:hover",t," {background-color: #2b6cb0;}"].join("")}var qs=[Xi];function Zi(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return".login-container"+t+" {display: flex;justify-content: center;align-items: center;min-height: 100vh;padding: 20px;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);}.login-form"+t+" {background: white;padding: 2.5rem;border-radius: 12px;box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);width: 100%;max-width: 420px;margin-right: 15px;}h2"+t+" {color: #2c3e50;margin-bottom: 2rem;text-align: center;font-size: 1.75rem;font-weight: 600;}.loading-container"+t+" {text-align: center;padding: 2rem 0;}.spinner"+t+" {width: 40px;height: 40px;border: 4px solid #f3f3f3;border-top: 4px solid #667eea;border-radius: 50%;animation: spin"+o+" 1s linear infinite;margin: 0 auto 1rem;}@keyframes spin"+o+" {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.oauth-login-section"+t+" {margin-bottom: 2rem;}.oauth-login-button"+t+" {width: 100%;padding: 1rem;background: #551a8b;color: white;border: none;border-radius: 8px;font-size: 1.1rem;font-weight: 600;cursor: pointer;transition: all 0.3s ease;display: flex;align-items: center;justify-content: center;gap: 12px;}.oauth-login-button:hover"+t+" {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);}.oauth-login-button:active"+t+" {transform: translateY(0);}.salesforce-icon"+t+" {fill: currentColor;}.oauth-description"+t+" {margin-top: 0.5rem;font-size: 0.875rem;color: #666;text-align: center;}.login-divider"+t+" {position: relative;text-align: center;margin: 1.5rem 0;}.login-divider"+t+"::before {content: '';position: absolute;top: 50%;left: 0;right: 0;height: 1px;background: #e0e0e0;}.login-divider"+t+" span"+t+" {background: white;padding: 0 1rem;color: #666;font-size: 0.875rem;}.legacy-login-section"+t+" {margin-top: 1rem;}.toggle-legacy-button"+t+" {width: 100%;padding: 0.75rem;background: transparent;color: #667eea;border: 2px solid #667eea;border-radius: 8px;font-size: 0.9rem;font-weight: 500;cursor: pointer;transition: all 0.3s ease;}.toggle-legacy-button:hover"+t+" {background: #667eea;color: white;}.legacy-form"+t+" {margin-top: 1.5rem;padding-top: 1.5rem;border-top: 1px solid #e0e0e0;}.form-group"+t+" {margin-bottom: 1rem;}label"+t+" {display: block;margin-bottom: 0.5rem;color: #444;font-weight: 500;}.form-control"+t+" {width: 100%;padding: 0.75rem;border: 2px solid #e0e0e0;border-radius: 8px;font-size: 1rem;transition: all 0.3s ease;}.form-control:focus"+t+" {outline: none;border-color: #667eea;box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);}.legacy-login-button"+t+" {width: 100%;padding: 0.75rem;background-color: #2c3e50;color: white;border: none;border-radius: 8px;font-size: 1rem;font-weight: 500;cursor: pointer;transition: all 0.3s ease;}.legacy-login-button:hover"+t+" {background-color: #34495e;transform: translateY(-1px);}.legacy-login-button:disabled"+t+" {background-color: #c9c9c9;cursor: not-allowed;transform: none;}.password-hint"+t+" {margin-top: 0.25rem;font-size: 0.75rem;color: #706e6b;font-style: italic;}.error-message"+t+" {background-color: #fef1f1;border: 1px solid #ff6b6b;color: #e74c3c;padding: 1rem;border-radius: 8px;margin-bottom: 1.5rem;font-size: 0.875rem;border-left: 4px solid #e74c3c;}.success-container"+t+" {display: flex;justify-content: center;align-items: center;min-height: 100vh;padding: 20px;}.success-message"+t+" {text-align: center;background: white;padding: 3rem 2rem;border-radius: 12px;box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);}.success-message"+t+" h2"+t+" {color: #27ae60;margin-bottom: 1rem;font-size: 2rem;}.success-message"+t+" p"+t+" {color: #666;font-size: 1.1rem;}.help-section"+t+" {margin-top: 2rem;text-align: center;}.help-text"+t+" {font-size: 0.875rem;color: #666;}@media (max-width: 480px) {.login-container"+t+" {padding: 10px;}.login-form"+t+" {padding: 1.5rem;}h2"+t+" {font-size: 1.5rem;}.oauth-login-button"+t+" {font-size: 1rem;padding: 0.875rem;}}"}var zs=[Zi];const ea=p`<h2${3}>Rhythm Mobile Login</h2>`,ta=p`<div class="error-message${0}"${2}>${"t1"}</div>`,sa=p`<div class="loading-container${0}"${2}><div class="spinner${0}"${2}></div><p${3}>Connecting to Salesforce...</p></div>`,oa=p`<div class="oauth-login-section${0}"${2}><button class="oauth-login-button${0}"${2}><svg class="salesforce-icon${0}" width="20" height="20" viewBox="0 0 24 24"${2}><path fill="currentColor" d="M8.5 2C5.5 2 3 4.5 3 7.5c0 1.4.5 2.7 1.4 3.7C2.9 12.2 2 14 2 16c0 3.3 2.7 6 6 6h8c2.8 0 5-2.2 5-5 0-1.9-1.1-3.6-2.7-4.4.2-.5.3-1 .3-1.6 0-2.8-2.2-5-5-5-.8 0-1.5.2-2.2.5C10.6 3.7 9.6 2 8.5 2z"${3}/></svg>Log in with Salesforce</button><p class="oauth-description${0}"${2}>Secure login using your Salesforce credentials</p></div>`,ia=p`<div class="success-container${0}"${2}><div class="success-message${0}"${2}><h2${3}>✓ Login Successful</h2><p${3}>Redirecting to the application...</p></div></div>`,aa={classMap:{"login-container":!0},key:0},na={classMap:{"login-form":!0},key:1};function Me(n,e,s,t){const{st:o,d:i,sp:a,b:r,h:l}=n,{_m0:c}=t;return[e.isLoggedIn?null:l("div",aa,[l("div",na,[o(ea,3),e.errorMessage?o(ta,5,[a(1,null,i(e.errorMessage))]):null,e.isLoading?o(sa,7):null,e.isLoading?null:o(oa,9,[a(1,{on:c||(t._m0={click:r(e.handleOAuthLogin)})},null)])])]),e.isLoggedIn?o(ia,11):null]}var ra=J(Me);Me.stylesheets=[],Me.stylesheetToken="lwc-491qprf958e",Me.legacyStylesheetToken="c-login_login",zs&&Me.stylesheets.push.apply(Me.stylesheets,zs),Q(Me);var la=void 0;class ca{constructor(){this.clientId=this.getEnvironmentVariable("SF_CLIENT_ID"),this.clientSecret=this.getEnvironmentVariable("SF_CLIENT_SECRET"),this.redirectUri=this.getEnvironmentVariable("SF_REDIRECT_URI"),this.loginUrl=this.getEnvironmentVariable("SF_LOGIN_URL"),this.scope=this.getEnvironmentVariable("SF_SCOPE"),this.ACCESS_TOKEN_KEY="sf_access_token",this.REFRESH_TOKEN_KEY="sf_refresh_token",this.INSTANCE_URL_KEY="sf_instance_url",this.USER_ID_KEY="sf_user_id",console.log("Client ID:",this.clientId),console.log("Client Secret:",this.clientSecret),console.log("Redirect URI:",this.redirectUri),console.log("Login URL:",this.loginUrl),console.log("Scope:",this.scope),console.log("OAuthService initialized")}isLoggedIn(){const e=this.getStoredAccessToken(),s=this.getStoredRefreshToken(),t=this.getStoredInstanceUrl();return console.log("Checking login status:",{hasAccessToken:!!e,hasRefreshToken:!!s,hasInstanceUrl:!!t}),!!(e||s)&&!!t}getStoredAccessToken(){return sessionStorage.getItem(this.ACCESS_TOKEN_KEY)||localStorage.getItem(this.ACCESS_TOKEN_KEY)}getStoredRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)}getStoredInstanceUrl(){return sessionStorage.getItem(this.INSTANCE_URL_KEY)||localStorage.getItem(this.INSTANCE_URL_KEY)}async startOAuthFlow(){try{console.log("Starting OAuth flow...");const e=await this.buildAuthorizationUrl();if(console.log("OAuth URL:",e),window.Capacitor){console.log("Capacitor detected, attempting to open browser...");try{const{Browser:s}=await ne("@capacitor/browser/v/7_0_2");console.log("Using Capacitor Browser plugin"),await s.open({url:e,windowName:"_blank",toolbarColor:"#667eea",presentationStyle:"fullscreen"}),console.log("Browser opened successfully with Capacitor plugin")}catch(s){console.log("Capacitor Browser not available, trying alternative methods..."),console.error("Browser plugin error:",s),window.open?(console.log("Trying window.open with _blank target"),window.open(e,"_blank","location=yes,toolbar=yes")||(console.log("Popup blocked, trying _system target"),window.open(e,"_system"))):(console.log("window.open not available, using location.href"),window.location.href=e)}}else console.log("Not in Capacitor, using direct redirect"),window.location.href=e}catch(e){throw console.error("Error starting OAuth flow:",e),new Error("Failed to start OAuth authorization: "+e.message)}}async buildAuthorizationUrl(){const e=this.generateState();console.log("Generated OAuth state:",e);const s=this.generateCodeVerifier(),t=await this.generateCodeChallenge(s);sessionStorage.setItem("oauth_code_verifier",s);const o=new URLSearchParams({response_type:"code",client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope,state:e,code_challenge:t,code_challenge_method:"S256",display:"touch",prompt:"login"}),i=`${this.loginUrl}/services/oauth2/authorize?${o.toString()}`;return console.log("=== SALESFORCE OAUTH CONFIGURATION ==="),console.log("Login URL:",this.loginUrl),console.log("Client ID:",this.clientId),console.log("Redirect URI:",this.redirectUri),console.log("Scope:",this.scope),console.log("State:",e),console.log("Code Challenge:",t),console.log("Full Authorization URL:",i),console.log("========================================="),i}generateCodeVerifier(){const e=new Uint8Array(32);return window.crypto.getRandomValues(e),this.base64URLEncode(e)}async generateCodeChallenge(e){const t=new TextEncoder().encode(e),o=await window.crypto.subtle.digest("SHA-256",t);return this.base64URLEncode(new Uint8Array(o))}base64URLEncode(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async handleOAuthCallback(e,s){try{console.log("Handling OAuth callback:",{authorizationCode:e,state:s});const t=sessionStorage.getItem("oauth_state");if(console.log("Stored state:",t,"Received state:",s),s!==t)throw new Error("Invalid state parameter - possible CSRF attack");console.log("Exchanging code for tokens...");const o=await this.exchangeCodeForTokens(e);console.log("Token exchange successful:",{hasAccessToken:!!o.access_token,hasRefreshToken:!!o.refresh_token,instanceUrl:o.instance_url}),this.storeTokens(o);const i=await this.initializeConnection();return{success:!0,connection:i,userInfo:o}}catch(t){throw console.error("OAuth callback error:",t),t}finally{sessionStorage.removeItem("oauth_state")}}async exchangeCodeForTokens(e){const s=`${this.loginUrl}/services/oauth2/token`,t=sessionStorage.getItem("oauth_code_verifier"),o={grant_type:"authorization_code",client_id:this.clientId,client_secret:this.clientSecret,redirect_uri:this.redirectUri,code:e,code_verifier:t},i={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:new URLSearchParams(o)};console.log("Making token exchange request to:",s),console.log("Token request data:",{grant_type:o.grant_type,client_id:o.client_id,redirect_uri:o.redirect_uri,code:e?"present":"missing",code_verifier:t?"present":"missing"});try{const a=await fetch(s,i);if(console.log("Token response status:",a.status),!a.ok){const r=await a.text();throw console.error("Token exchange failed on primary host:",r),new Error(r||"Primary token exchange failed")}return sessionStorage.removeItem("oauth_code_verifier"),a.json()}catch(a){if(this.loginUrl.includes(".my.site.com")){const l=`${this.loginUrl.replace(".my.site.com",".my.salesforce.com")}/services/oauth2/token`;console.log("Retrying token exchange via My Domain host:",l);try{const c=await fetch(l,i);if(console.log("Fallback token response status:",c.status),!c.ok){const d=await c.text();throw console.error("Fallback token exchange failed:",d),new Error(d||"Fallback token exchange failed")}return sessionStorage.removeItem("oauth_code_verifier"),c.json()}catch(c){throw console.error("Token exchange failed after fallback:",c),new Error(`Token exchange failed on both hosts: ${c.message||c}`)}}throw new Error(a.message||"Token exchange failed")}}storeTokens(e){if(console.log("\u{1F510} Storing tokens..."),console.log("\u{1F510} Token response structure:",{has_access_token:!!e.access_token,has_refresh_token:!!e.refresh_token,has_instance_url:!!e.instance_url,has_id:!!e.id}),sessionStorage.setItem(this.ACCESS_TOKEN_KEY,e.access_token),sessionStorage.setItem(this.INSTANCE_URL_KEY,e.instance_url),e.refresh_token?(localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refresh_token),console.log("\u{1F510} Refresh token stored in localStorage")):console.warn("\u26A0\uFE0F No refresh token in response - this might cause issues on app restart"),localStorage.setItem(this.INSTANCE_URL_KEY,e.instance_url),e.id){const s=e.id.match(/\/([a-zA-Z0-9]{15,18})$/);if(s){const t=s[1];sessionStorage.setItem(this.USER_ID_KEY,t),localStorage.setItem(this.USER_ID_KEY,t),console.log("\u{1F510} Stored user ID:",t)}}console.log("\u2705 Tokens stored successfully")}async initializeConnection(){console.log("Initializing JSForce connection...");const e=this.getStoredAccessToken(),s=this.getStoredRefreshToken(),t=this.getStoredInstanceUrl();if(!t)throw new Error("No instance URL found");const o=window.jsforce;if(!o)throw new Error("JSForce library not loaded");const i=new o.Connection({oauth2:{clientId:this.clientId,clientSecret:this.clientSecret,redirectUri:this.redirectUri},instanceUrl:t,accessToken:e,refreshToken:s,version:"60.0"});return i.on("refresh",a=>{console.log("Access token refreshed automatically"),sessionStorage.setItem(this.ACCESS_TOKEN_KEY,a)}),!e&&s&&(console.log("No access token, refreshing using refresh token..."),await this.refreshAccessToken(i)),console.log("JSForce connection initialized successfully"),i}async refreshAccessToken(e=null){try{console.log("\u{1F504} Refreshing access token...");const s=this.getStoredRefreshToken(),t=this.getStoredInstanceUrl();if(!s)throw new Error("No refresh token available");if(!t)throw new Error("No instance URL available");console.log("\u{1F504} Using refresh token to get new access token..."),console.log("\u{1F504} Instance URL:",t);const o=`${t}/services/oauth2/token`,i={grant_type:"refresh_token",refresh_token:s,client_id:this.clientId};this.clientSecret?(i.client_secret=this.clientSecret,console.log("\u{1F504} Using client secret for token refresh")):console.log("\u{1F504} No client secret - using public client flow");const a=new URLSearchParams(i),r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:a.toString()});if(!r.ok){const c=await r.text();throw console.error("\u{1F504} Token refresh HTTP error:",r.status,c),new Error(`Token refresh failed: ${r.status} ${c}`)}const l=await r.json();return console.log("\u{1F504} Token refresh successful:",{access_token:l.access_token?"present":"missing",instance_url:l.instance_url||"not returned",refresh_token:l.refresh_token?"new refresh token received":"no new refresh token"}),sessionStorage.setItem(this.ACCESS_TOKEN_KEY,l.access_token),l.instance_url&&(sessionStorage.setItem(this.INSTANCE_URL_KEY,l.instance_url),localStorage.setItem(this.INSTANCE_URL_KEY,l.instance_url)),l.refresh_token&&(localStorage.setItem(this.REFRESH_TOKEN_KEY,l.refresh_token),console.log("\u{1F504} New refresh token stored")),console.log("\u2705 Access token refreshed successfully"),l.access_token}catch(s){if(console.error("\u274C Token refresh failed:",s),s.message&&s.message.includes("400"))try{const t=s.message;if(console.error("\u{1F504} Detailed error:",t),t.includes("invalid_grant"))throw console.log("\u{1F504} Invalid grant error - refresh token might be revoked or expired"),this.clearTokens(),document.dispatchEvent(new CustomEvent("auth-logout",{detail:{reason:"refresh_token_expired",error:t}})),new Error("Your session has expired. Please log in again.")}catch(t){console.warn("Could not parse error details:",t)}throw s.message.includes("invalid_grant")||s.message.includes("expired")||s.message.includes("invalid_client")?(console.log("\u{1F504} Authentication error detected, clearing tokens"),this.clearTokens(),document.dispatchEvent(new CustomEvent("auth-logout",{detail:{reason:"auth_error",error:s.message}})),new Error("Session expired. Please log in again.")):new Error(`Token refresh failed: ${s.message}`)}}async getValidConnection(){try{if(console.log("Getting valid connection..."),!this.isLoggedIn())throw new Error("User not logged in");const e=await this.initializeConnection();return console.log("JSForce connection initialized, returning to AuthUtils for testing"),e}catch(e){throw console.error("Failed to get valid connection:",e),e}}clearTokens(){console.log("Clearing all tokens..."),sessionStorage.removeItem(this.ACCESS_TOKEN_KEY),sessionStorage.removeItem(this.INSTANCE_URL_KEY),sessionStorage.removeItem(this.USER_ID_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.INSTANCE_URL_KEY),localStorage.removeItem(this.USER_ID_KEY),console.log("All tokens cleared")}getEnvironmentVariable(e){if(window.Capacitor)try{if(window.Capacitor.getPlatform()==="android")try{if(window.AndroidConfig&&typeof window.AndroidConfig.getConfigValue=="function"){const t=window.AndroidConfig.getConfigValue(e);if(t)return t}}catch(t){console.error("Error accessing Android config:",t)}}catch(s){console.error("Error accessing environment variable:",s)}return console.error(`Environment variable ${e} not found`),null}generateState(){const e=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return sessionStorage.setItem("oauth_state",e),e}async logout(){try{console.log("Logging out user...");const e=this.getStoredAccessToken();if(e){const s=`${this.getStoredInstanceUrl()}/services/oauth2/revoke`;await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`token=${e}`}),console.log("Tokens revoked on server")}}catch(e){console.error("Error revoking token:",e)}finally{this.clearTokens(),console.log("Logout completed")}}}const Ws=z(ca,{tmpl:la,sel:"c-oauth-service",apiVersion:63});class Bs extends K{constructor(...e){super(...e);this.errorMessage="",this.isLoading=!1,this.isLoggedIn=!1,this.oauthService=new Ws}connectedCallback(){if(this.clearPotentiallyInvalidTokens(),window.__rhythmHandleOAuthCallback=({code:e,state:s,error:t,error_description:o})=>{try{if(console.log("Received native OAuth callback",{codePresent:!!e,state:s,error:t}),t){this.errorMessage=`OAuth Error: ${o||t}`;return}e&&s&&this.handleOAuthCallback(e,s)}catch(i){console.error("Error handling native OAuth callback:",i),this.errorMessage=i.message||"Failed to process OAuth callback."}},window.__rhythmPendingOAuth){console.log("Processing pending native OAuth data");try{window.__rhythmHandleOAuthCallback(window.__rhythmPendingOAuth)}finally{window.__rhythmPendingOAuth=null}}this.handleOAuthCallbackFromUrl(),this.hasOAuthCallback()||this.checkExistingLogin()}clearPotentiallyInvalidTokens(){localStorage.getItem("force_clear_tokens")==="1"&&(console.log("Force-clearing tokens due to debug flag"),this.oauthService.clearTokens(),localStorage.removeItem("force_clear_tokens"))}hasOAuthCallback(){const e=new URLSearchParams(window.location.search);return!!(e.get("code")||e.get("error"))}async checkExistingLogin(){console.log("Checking existing login...");try{const e=this.oauthService.isLoggedIn();if(console.log("OAuth service says logged in:",e),e){this.isLoading=!0,console.log("Found existing tokens, testing connection...");const s=await this.oauthService.getValidConnection();console.log("Testing connection with metadata query...");let t=[];try{const o=await s.query("SELECT Id,Rhythm__Field_Api_Name__c FROM Rhythm__Field_Level_Configuration__mdt LIMIT 10");console.log("Auto-login metadata result:",o),t=o.records||[]}catch(o){console.warn("Metadata test failed; proceeding with login:",o)}this.handleSuccessfulLogin(s,t)}else console.log("No existing valid tokens found, showing login screen"),this.isLoggedIn=!1}catch(e){console.error("Auto-login failed:",e),this.oauthService.clearTokens(),this.isLoggedIn=!1,this.errorMessage="Previous session expired. Please log in again."}finally{this.isLoading=!1}}handleOAuthCallbackFromUrl(){const e=new URLSearchParams(window.location.search),s=e.get("code"),t=e.get("state"),o=e.get("error");if(o){this.errorMessage=`OAuth Error: ${e.get("error_description")||o}`;return}s&&t&&(this.handleOAuthCallback(s,t),window.history.replaceState({},document.title,window.location.pathname))}async handleOAuthLogin(){this.isLoading=!0,this.errorMessage="";try{console.log("handleOAuthLogin called - starting OAuth flow..."),await this.oauthService.startOAuthFlow(),console.log("OAuth flow started successfully")}catch(e){console.error("OAuth login error:",e),this.errorMessage=e.message||"Failed to start login process. Please try again."}finally{this.isLoading=!1}}async testDirectUrl(){try{console.log("Testing direct URL opening...");const e=await this.oauthService.buildAuthorizationUrl();console.log("Generated URL:",e),window.open?(console.log("Attempting window.open..."),window.open(e,"_blank")):(console.log("window.open not available"),alert("window.open not available. URL logged to console."))}catch(e){console.error("Direct URL test error:",e),alert("Error: "+e.message)}}async handleOAuthCallback(e,s){this.isLoading=!0,this.errorMessage="";try{const t=await this.oauthService.handleOAuthCallback(e,s);t.success&&this.handleSuccessfulLogin(t.connection)}catch(t){console.error("OAuth callback error:",t),this.errorMessage=t.message||"Login failed. Please try again."}finally{this.isLoading=!1}}handleSuccessfulLogin(e){this.isLoggedIn=!0,this.dispatchEvent(new CustomEvent("login",{detail:{userId:this.oauthService.getStoredAccessToken()?sessionStorage.getItem("sf_user_id"):null,success:!0,connection:e},bubbles:!0,composed:!0,cancelable:!0}))}disconnectedCallback(){this.username="",this.password=""}}Y(Bs,{track:{errorMessage:1,isLoading:1,isLoggedIn:1},fields:["oauthService"]});const da=z(Bs,{tmpl:ra,sel:"c-login",apiVersion:63});function ha(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".toast-container",t," {position: fixed;top: 50px;right: 20px;z-index: 10000;max-width: 400px;min-width: 280px;border-radius: 12px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);backdrop-filter: blur(10px);transform: translateX(100%);transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);opacity: 0;}.toast-visible",t," {transform: translateX(0);opacity: 1;}.toast-hidden",t," {transform: translateX(100%);opacity: 0;}.toast-content",t," {display: flex;align-items: center;padding: 16px 20px;background: rgba(255, 255, 255, 0.95);border-radius: 12px;border: 1px solid rgba(255, 255, 255, 0.2);}.toast-icon",t," {font-size: 18px;margin-right: 12px;flex-shrink: 0;}.toast-message",t," {flex: 1;font-size: 14px;font-weight: 500;color: #374151;line-height: 1.4;}.toast-close",t," {background: none;border: none;font-size: 20px;color: #6b7280;cursor: pointer;margin-left: 12px;padding: 0;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;border-radius: 4px;transition: all 0.2s ease;}.toast-close:hover",t," {background: rgba(0, 0, 0, 0.05);color: #374151;}.toast-success",t," .toast-content",t," {background: rgba(16, 185, 129, 0.95);border-color: rgba(16, 185, 129, 0.3);}.toast-success",t," .toast-message",t," {color: white;}.toast-success",t," .toast-close",t," {color: rgba(255, 255, 255, 0.8);}.toast-success",t," .toast-close:hover",t," {background: rgba(255, 255, 255, 0.2);color: white;}.toast-error",t," .toast-content",t," {background: rgba(239, 68, 68, 0.95);border-color: rgba(239, 68, 68, 0.3);}.toast-error",t," .toast-message",t," {color: white;}.toast-error",t," .toast-close",t," {color: rgba(255, 255, 255, 0.8);}.toast-error",t," .toast-close:hover",t," {background: rgba(255, 255, 255, 0.2);color: white;}.toast-info",t," .toast-content",t," {background: rgba(59, 130, 246, 0.95);border-color: rgba(59, 130, 246, 0.3);}.toast-info",t," .toast-message",t," {color: white;}.toast-info",t," .toast-close",t," {color: rgba(255, 255, 255, 0.8);}.toast-info",t," .toast-close:hover",t," {background: rgba(255, 255, 255, 0.2);color: white;}.refresh-loading",t," {position: fixed;top: 50px;left: 50%;transform: translateX(-50%);z-index: 10001;background: rgba(255, 255, 255, 0.95);border-radius: 25px;box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);backdrop-filter: blur(10px);border: 1px solid rgba(0, 0, 0, 0.1);animation: slideInFromTop",o," 0.3s ease-out;max-width: 90%;min-width: 200px;}.loading-content",t," {display: flex;align-items: center;justify-content: center;padding: 12px 20px;color: #374151;}.loading-spinner",t," {width: 18px;height: 18px;border: 2px solid #e5e7eb;border-top: 2px solid #667eea;border-radius: 50%;margin-right: 12px;animation: spin",o," 0.8s linear infinite;}.loading-text",t," {font-size: 14px;font-weight: 500;color: #374151;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}@keyframes slideInFromTop",o," {from {transform: translateY(-100%);}to {transform: translateY(0);}}@media (max-width: 640px) {.toast-container",t," {top: 50px;right: 10px;left: 10px;max-width: none;min-width: auto;transform: translateY(-100%);transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.toast-visible",t," {transform: translateY(0);opacity: 1;}.toast-hidden",t," {transform: translateY(-100%);opacity: 0;}.toast-content",t," {padding: 14px 16px;}.toast-message",t," {font-size: 13px;}.refresh-loading",t," {top: 50px;left: 10px;right: 10px;transform: none;max-width: none;min-width: auto;}.loading-content",t," {padding: 10px 16px;}.loading-text",t," {font-size: 13px;}}@media (prefers-reduced-motion: reduce) {.toast-container",t,",\r .loading-spinner",t,",\r .refresh-loading",t," {animation: none;transition: none;}.loading-spinner",t," {animation: none;border-top-color: white;}}@media (prefers-contrast: high) {.toast-content",t," {border-width: 2px;background: white;}.toast-message",t," {color: black;}.toast-close",t," {color: black;}.refresh-loading",t," {background: #000;}}"].join("")}var Hs=[ha];const ua=p`<div${"c0"}${2}><div class="toast-content${0}"${2}><span class="toast-icon${0}"${2}>${"t3"}</span><span class="toast-message${0}"${2}>${"t5"}</span><button class="toast-close${0}" aria-label="Close notification"${2}>×</button></div></div>`,pa=p`<div class="refresh-loading${0}"${2}><div class="loading-content${0}"${2}><div class="loading-spinner${0}"${2}></div><span class="loading-text${0}"${2}>Refreshing metadata...</span></div></div>`;function Pe(n,e,s,t){const{ncls:o,d:i,b:a,sp:r,st:l}=n,{_m0:c}=t;return[e.showToast?l(ua,1,[r(0,{className:o(e.toastClasses)},null),r(3,null,i(e.toastIcon)),r(5,null,i(e.toastMessage)),r(6,{on:c||(t._m0={click:a(e.handleToastClose)})},null)]):null,e.isRefreshing?l(pa,3):null]}var fa=J(Pe);Pe.stylesheets=[],Pe.stylesheetToken="lwc-21pq8joh9rf",Pe.legacyStylesheetToken="c-scrollMetadataRefresh_scrollMetadataRefresh",Hs&&Pe.stylesheets.push.apply(Pe.stylesheets,Hs),Q(Pe);var Js=Object.defineProperty,ma=n=>Js(n,"__esModule",{value:!0}),ga=(n,e)=>()=>(e||(e={exports:{}},n(e.exports,e)),e.exports),_a=(n,e)=>{for(var s in e)Js(n,s,{get:e[s],enumerable:!0})},ba=ga(n=>{ma(n),_a(n,{Network:()=>t,NetworkWeb:()=>s});function e(){const o=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;let i="unknown";const a=o?o.type||o.effectiveType:null;if(a&&typeof a=="string")switch(a){case"bluetooth":case"cellular":i="cellular";break;case"none":i="none";break;case"ethernet":case"wifi":case"wimax":i="wifi";break;case"other":case"unknown":i="unknown";break;case"slow-2g":case"2g":case"3g":i="cellular";break;case"4g":i="wifi";break}return i}var s=class extends Kt{constructor(){super();this.handleOnline=()=>{const o=e(),i={connected:!0,connectionType:o};this.notifyListeners("networkStatusChange",i)},this.handleOffline=()=>{const o={connected:!1,connectionType:"none"};this.notifyListeners("networkStatusChange",o)},typeof window!="undefined"&&(window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline))}async getStatus(){if(!window.navigator)throw this.unavailable("Browser does not support the Network Information API");const o=window.navigator.onLine,i=e();return{connected:o,connectionType:o?i:"none"}}},t=new s});/*! Capacitor: https://capacitorjs.com/ - MIT License */var bt;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(bt||(bt={}));var Jt=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},ya=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},va=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:ya(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new Jt(`"${h}" plugin is not implemented on ${g}`,bt.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new Jt(`"${h}.${v}()" is not implemented on ${g}`,bt.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=Jt,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},wa=n=>n.Capacitor=va(n),Qt=wa(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),Yt=Qt.registerPlugin,Kt=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new Qt.Exception(n,bt.Unimplemented)}unavailable(n="not available"){return new Qt.Exception(n,bt.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},Qs=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Ys=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),xa=class extends Kt{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=Ys(t).trim(),o=Ys(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=Qs(n.key),s=Qs(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};Yt("CapacitorCookies",{web:()=>new xa});var ka=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),$a=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},Ca=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,Sa=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=$a(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},Ea=class extends Kt{async request(n){const e=Sa(n,n.webFetchExtra),s=Ca(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await ka(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};Yt("CapacitorHttp",{web:()=>new Ea});var X=Yt("Network",{web:()=>Promise.resolve().then(()=>ba()).then(n=>new n.NetworkWeb)}),Ks=Object.defineProperty,Ra=n=>Ks(n,"__esModule",{value:!0}),Aa=(n,e)=>()=>(e||(e={exports:{}},n(e.exports,e)),e.exports),Ia=(n,e)=>{for(var s in e)Ks(n,s,{get:e[s],enumerable:!0})},Fa=Aa(n=>{Ra(n),Ia(n,{FilesystemWeb:()=>t});function e(o){const i=o.split("/").filter(r=>r!=="."),a=[];return i.forEach(r=>{r===".."&&a.length>0&&a[a.length-1]!==".."?a.pop():a.push(r)}),a.join("/")}function s(o,i){o=e(o),i=e(i);const a=o.split("/"),r=i.split("/");return o!==i&&a.every((l,c)=>l===r[c])}var t=class extends es{constructor(){super(...arguments);this.DB_VERSION=1,this.DB_NAME="Disc",this._writeCmds=["add","put","delete"],this.downloadFile=async o=>{var i,a;const r=Zs(o,o.webFetchExtra),l=await fetch(o.url,r);let c;if(!o.progress)c=await l.blob();else if(!(l==null?void 0:l.body))c=new Blob;else{const h=l.body.getReader();let u=0;const f=[],g=l.headers.get("content-type"),_=parseInt(l.headers.get("content-length")||"0",10);for(;;){const{done:k,value:$}=await h.read();if(k)break;f.push($),u+=($==null?void 0:$.length)||0;const S={url:o.url,bytes:u,contentLength:_};this.notifyListeners("progress",S)}const m=new Uint8Array(u);let x=0;for(const k of f)typeof k!="undefined"&&(m.set(k,x),x+=k.length);c=new Blob([m.buffer],{type:g||void 0})}return{path:(await this.writeFile({path:o.path,directory:(i=o.directory)!==null&&i!==void 0?i:void 0,recursive:(a=o.recursive)!==null&&a!==void 0?a:!1,data:c})).uri,blob:c}}}readFileInChunks(o,i){throw this.unavailable("Method not implemented.")}async initDb(){if(this._db!==void 0)return this._db;if(!("indexedDB"in window))throw this.unavailable("This browser doesn't support IndexedDB");return new Promise((o,i)=>{const a=indexedDB.open(this.DB_NAME,this.DB_VERSION);a.onupgradeneeded=t.doUpgrade,a.onsuccess=()=>{this._db=a.result,o(a.result)},a.onerror=()=>i(a.error),a.onblocked=()=>{console.warn("db blocked")}})}static doUpgrade(o){const a=o.target.result;switch(o.oldVersion){case 0:case 1:default:a.objectStoreNames.contains("FileStorage")&&a.deleteObjectStore("FileStorage"),a.createObjectStore("FileStorage",{keyPath:"path"}).createIndex("by_folder","folder")}}async dbRequest(o,i){const a=this._writeCmds.indexOf(o)!==-1?"readwrite":"readonly";return this.initDb().then(r=>new Promise((l,c)=>{const u=r.transaction(["FileStorage"],a).objectStore("FileStorage")[o](...i);u.onsuccess=()=>l(u.result),u.onerror=()=>c(u.error)}))}async dbIndexRequest(o,i,a){const r=this._writeCmds.indexOf(i)!==-1?"readwrite":"readonly";return this.initDb().then(l=>new Promise((c,d)=>{const g=l.transaction(["FileStorage"],r).objectStore("FileStorage").index(o)[i](...a);g.onsuccess=()=>c(g.result),g.onerror=()=>d(g.error)}))}getPath(o,i){const a=i!==void 0?i.replace(/^[/]+|[/]+$/g,""):"";let r="";return o!==void 0&&(r+="/"+o),i!==""&&(r+="/"+a),r}async clear(){(await this.initDb()).transaction(["FileStorage"],"readwrite").objectStore("FileStorage").clear()}async readFile(o){const i=this.getPath(o.directory,o.path),a=await this.dbRequest("get",[i]);if(a===void 0)throw Error("File does not exist.");return{data:a.content?a.content:""}}async writeFile(o){const i=this.getPath(o.directory,o.path);let a=o.data;const r=o.encoding,l=o.recursive,c=await this.dbRequest("get",[i]);if(c&&c.type==="directory")throw Error("The supplied path is a directory.");const d=i.substr(0,i.lastIndexOf("/"));if(await this.dbRequest("get",[d])===void 0){const g=d.indexOf("/",1);if(g!==-1){const _=d.substr(g);await this.mkdir({path:_,directory:o.directory,recursive:l})}}if(!r&&!(a instanceof Blob)&&(a=a.indexOf(",")>=0?a.split(",")[1]:a,!this.isBase64String(a)))throw Error("The supplied data is not valid base64 content.");const u=Date.now(),f={path:i,folder:d,type:"file",size:a instanceof Blob?a.size:a.length,ctime:u,mtime:u,content:a};return await this.dbRequest("put",[f]),{uri:f.path}}async appendFile(o){const i=this.getPath(o.directory,o.path);let a=o.data;const r=o.encoding,l=i.substr(0,i.lastIndexOf("/")),c=Date.now();let d=c;const h=await this.dbRequest("get",[i]);if(h&&h.type==="directory")throw Error("The supplied path is a directory.");if(await this.dbRequest("get",[l])===void 0){const g=l.indexOf("/",1);if(g!==-1){const _=l.substr(g);await this.mkdir({path:_,directory:o.directory,recursive:!0})}}if(!r&&!this.isBase64String(a))throw Error("The supplied data is not valid base64 content.");if(h!==void 0){if(h.content instanceof Blob)throw Error("The occupied entry contains a Blob object which cannot be appended to.");h.content!==void 0&&!r?a=btoa(atob(h.content)+atob(a)):a=h.content+a,d=h.ctime}const f={path:i,folder:l,type:"file",size:a.length,ctime:d,mtime:c,content:a};await this.dbRequest("put",[f])}async deleteFile(o){const i=this.getPath(o.directory,o.path);if(await this.dbRequest("get",[i])===void 0)throw Error("File does not exist.");if((await this.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(i)])).length!==0)throw Error("Folder is not empty.");await this.dbRequest("delete",[i])}async mkdir(o){const i=this.getPath(o.directory,o.path),a=o.recursive,r=i.substr(0,i.lastIndexOf("/")),l=(i.match(/\//g)||[]).length,c=await this.dbRequest("get",[r]),d=await this.dbRequest("get",[i]);if(l===1)throw Error("Cannot create Root directory");if(d!==void 0)throw Error("Current directory does already exist.");if(!a&&l!==2&&c===void 0)throw Error("Parent directory must exist");if(a&&l!==2&&c===void 0){const f=r.substr(r.indexOf("/",1));await this.mkdir({path:f,directory:o.directory,recursive:a})}const h=Date.now(),u={path:i,folder:r,type:"directory",size:0,ctime:h,mtime:h};await this.dbRequest("put",[u])}async rmdir(o){const{path:i,directory:a,recursive:r}=o,l=this.getPath(a,i),c=await this.dbRequest("get",[l]);if(c===void 0)throw Error("Folder does not exist.");if(c.type!=="directory")throw Error("Requested path is not a directory");const d=await this.readdir({path:i,directory:a});if(d.files.length!==0&&!r)throw Error("Folder is not empty");for(const h of d.files){const u=`${i}/${h.name}`;(await this.stat({path:u,directory:a})).type==="file"?await this.deleteFile({path:u,directory:a}):await this.rmdir({path:u,directory:a,recursive:r})}await this.dbRequest("delete",[l])}async readdir(o){const i=this.getPath(o.directory,o.path),a=await this.dbRequest("get",[i]);if(o.path!==""&&a===void 0)throw Error("Folder does not exist.");const r=await this.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(i)]);return{files:await Promise.all(r.map(async c=>{let d=await this.dbRequest("get",[c]);return d===void 0&&(d=await this.dbRequest("get",[c+"/"])),{name:c.substring(i.length+1),type:d.type,size:d.size,ctime:d.ctime,mtime:d.mtime,uri:d.path}}))}}async getUri(o){const i=this.getPath(o.directory,o.path);let a=await this.dbRequest("get",[i]);return a===void 0&&(a=await this.dbRequest("get",[i+"/"])),{uri:(a==null?void 0:a.path)||i}}async stat(o){const i=this.getPath(o.directory,o.path);let a=await this.dbRequest("get",[i]);if(a===void 0&&(a=await this.dbRequest("get",[i+"/"])),a===void 0)throw Error("Entry does not exist.");return{name:a.path.substring(i.length+1),type:a.type,size:a.size,ctime:a.ctime,mtime:a.mtime,uri:a.path}}async rename(o){await this._copy(o,!0)}async copy(o){return this._copy(o,!1)}async requestPermissions(){return{publicStorage:"granted"}}async checkPermissions(){return{publicStorage:"granted"}}async _copy(o,i=!1){let{toDirectory:a}=o;const{to:r,from:l,directory:c}=o;if(!r||!l)throw Error("Both to and from must be provided");a||(a=c);const d=this.getPath(c,l),h=this.getPath(a,r);if(d===h)return{uri:h};if(s(d,h))throw Error("To path cannot contain the from path");let u;try{u=await this.stat({path:r,directory:a})}catch(m){const x=r.split("/");x.pop();const k=x.join("/");if(x.length>0&&(await this.stat({path:k,directory:a})).type!=="directory")throw new Error("Parent directory of the to path is a file")}if(u&&u.type==="directory")throw new Error("Cannot overwrite a directory with a file");const f=await this.stat({path:l,directory:c}),g=async(m,x,k)=>{const $=this.getPath(a,m),S=await this.dbRequest("get",[$]);S.ctime=x,S.mtime=k,await this.dbRequest("put",[S])},_=f.ctime?f.ctime:Date.now();switch(f.type){case"file":{const m=await this.readFile({path:l,directory:c});i&&await this.deleteFile({path:l,directory:c});let x;!(m.data instanceof Blob)&&!this.isBase64String(m.data)&&(x=ts.UTF8);const k=await this.writeFile({path:r,directory:a,data:m.data,encoding:x});return i&&await g(r,_,f.mtime),k}case"directory":{if(u)throw Error("Cannot move a directory over an existing object");try{await this.mkdir({path:r,directory:a,recursive:!1}),i&&await g(r,_,f.mtime)}catch(x){}const m=(await this.readdir({path:l,directory:c})).files;for(const x of m)await this._copy({from:`${l}/${x.name}`,to:`${r}/${x.name}`,directory:c,toDirectory:a},i);i&&await this.rmdir({path:l,directory:c})}}return{uri:h}}isBase64String(o){try{return btoa(atob(o))==o}catch(i){return!1}}};t._debug=!0});/*! Capacitor: https://capacitorjs.com/ - MIT License */var yt;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(yt||(yt={}));var Gt=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},Da=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},Ta=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:Da(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new Gt(`"${h}" plugin is not implemented on ${g}`,yt.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new Gt(`"${h}.${v}()" is not implemented on ${g}`,yt.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=Gt,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},Oa=n=>n.Capacitor=Ta(n),Xt=Oa(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),Zt=Xt.registerPlugin,es=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new Xt.Exception(n,yt.Unimplemented)}unavailable(n="not available"){return new Xt.Exception(n,yt.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},Gs=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Xs=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),La=class extends es{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=Xs(t).trim(),o=Xs(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=Gs(n.key),s=Gs(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};Zt("CapacitorCookies",{web:()=>new La});var Na=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),Ma=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},Pa=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,Zs=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=Ma(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},ja=class extends es{async request(n){const e=Zs(n,n.webFetchExtra),s=Pa(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await Na(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};Zt("CapacitorHttp",{web:()=>new ja});function Ua(n){n.CapacitorUtils.Synapse=new Proxy({},{get(e,s){return new Proxy({},{get(t,o){return(i,a,r)=>{const l=n.Capacitor.Plugins[s];if(l===void 0){r(new Error(`Capacitor plugin ${s} not found`));return}if(typeof l[o]!="function"){r(new Error(`Method ${o} not found in Capacitor plugin ${s}`));return}(async()=>{try{const c=await l[o](i);a(c)}catch(c){r(c)}})()}}})}})}function Va(n){n.CapacitorUtils.Synapse=new Proxy({},{get(e,s){return n.cordova.plugins[s]}})}function qa(n=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!n?Ua(window):window.cordova!==void 0&&Va(window))}var eo;(function(n){n.Documents="DOCUMENTS",n.Data="DATA",n.Library="LIBRARY",n.Cache="CACHE",n.External="EXTERNAL",n.ExternalStorage="EXTERNAL_STORAGE",n.ExternalCache="EXTERNAL_CACHE",n.LibraryNoCloud="LIBRARY_NO_CLOUD",n.Temporary="TEMPORARY"})(eo||(eo={}));var ts;(function(n){n.UTF8="utf8",n.ASCII="ascii",n.UTF16="utf16"})(ts||(ts={}));var za=Zt("Filesystem",{web:()=>Promise.resolve().then(()=>Fa()).then(n=>new n.FilesystemWeb)});qa();var Wa=void 0;class Ba{constructor(){this.oauthService=new Ws,this._connectionPromise=null,this._lastConnectionTime=0,this._connectionCacheDuration=2*60*1e3}async getValidConnection(){const e=Date.now();if(this._connectionPromise&&e-this._lastConnectionTime<this._connectionCacheDuration)try{return await this._connectionPromise}catch(s){console.warn("Cached connection expired, creating new one:",s.message)}return this._connectionPromise=this._createValidConnection(),this._lastConnectionTime=e,this._connectionPromise}async _createValidConnection(){try{if(console.log("\u{1F510} AuthUtils: Creating valid connection..."),!this.hasAnyTokens())throw new Error("No authentication tokens found. Please login first.");const e=await this.oauthService.getValidConnection();try{return await e.query("SELECT Id FROM User LIMIT 1"),console.log("\u2705 AuthUtils: Connection test successful"),e}catch(s){if(console.warn("\u26A0\uFE0F AuthUtils: Connection test failed, attempting refresh...",s.message),s.errorCode==="INVALID_SESSION_ID"||s.message.includes("Session expired")||s.message.includes("expired access/refresh token")){console.log("\u{1F504} AuthUtils: Attempting token refresh due to session error"),this._connectionPromise=null,await this.oauthService.refreshAccessToken();const t=await this.oauthService.getValidConnection();return await t.query("SELECT Id FROM User LIMIT 1"),console.log("\u2705 AuthUtils: New connection after refresh successful"),t}throw s}}catch(e){throw console.error("\u274C AuthUtils: Failed to create valid connection:",e),this.isTokenExpiredError(e)?(console.log("\u{1F504} AuthUtils: Tokens expired, clearing stored tokens"),this.oauthService.clearTokens(),this.dispatchLogoutEvent(),new Error("Session expired. Please log in again.")):e}}hasAnyTokens(){const e=sessionStorage.getItem("sf_access_token")||localStorage.getItem("sf_access_token"),s=localStorage.getItem("sf_refresh_token"),t=sessionStorage.getItem("sf_instance_url")||localStorage.getItem("sf_instance_url");return!!(e||s)&&!!t}isTokenExpiredError(e){const s=e.message?.toLowerCase()||"",t=e.errorCode?.toLowerCase()||"";return s.includes("invalid_grant")||s.includes("expired")||s.includes("session expired")||t==="invalid_session_id"||t==="invalid_grant"}dispatchLogoutEvent(){try{const e=new CustomEvent("auth-logout",{bubbles:!0,composed:!0,detail:{reason:"token_expired"}});typeof document!="undefined"&&document.dispatchEvent(e)}catch(e){console.warn("Failed to dispatch logout event:",e)}}async ensureAuthenticated(){try{return await this.getValidConnection(),!0}catch(e){return console.error("Authentication check failed:",e),!1}}async getConnectionForComponent(){try{return await this.getValidConnection()}catch(e){throw new Error(`Not authenticated. ${e.message}`)}}clearConnectionCache(){this._connectionPromise=null,this._lastConnectionTime=0,console.log("\u{1F504} AuthUtils: Connection cache cleared")}forceLogout(){console.log("\u{1F510} AuthUtils: Force logout - clearing all caches and tokens"),this.clearConnectionCache(),this.oauthService.clearTokens()}isLoggedIn(){return this.oauthService.isLoggedIn()}getTokenInfo(){return{hasAccessToken:!!sessionStorage.getItem("sf_access_token"),hasRefreshToken:!!localStorage.getItem("sf_refresh_token"),hasInstanceUrl:!!sessionStorage.getItem("sf_instance_url"),instanceUrl:sessionStorage.getItem("sf_instance_url")}}}const Ha=new Ba,se=z(Ha,{tmpl:Wa,sel:"c-auth-utils",apiVersion:63});async function B(){return await se.getConnectionForComponent()}const le=async n=>(await(await B()).query(n)).records,ss=async(n,e,s)=>{if(await V())try{const t=await B();let o="";s?o=`SELECT Id, Rhythm__Object_Name__c, Label, Rhythm__Default_Fields__c, Rhythm__Field_Label__c, Rhythm__Field_Name__c,Rhythm__Fields_Limit__c,Rhythm__Related_To_Api_Name__c,
                        Rhythm__NewRequired__c 
                        FROM Rhythm__List_View_For_Customers__mdt 
                        WHERE Rhythm__Object_Name__c = '${n}' AND Rhythm__isMobile__c = true AND Rhythm__Related_To_Api_Name__c != null`:e?Array.isArray(n)&&(o=`SELECT Id, Rhythm__Object_Name__c, Rhythm__Default_Fields__c, Rhythm__Field_Label__c, Rhythm__Field_Name__c, Rhythm__Fields_Limit__c, Rhythm__Related_To_Api_Name__c 
                                FROM Rhythm__List_View_For_Customers__mdt 
                                WHERE Rhythm__Object_Name__c IN (${n.map(r=>`'${r}'`).join(", ")}) AND Rhythm__isMobile__c = true LIMIT 100`):o=`SELECT Id, Rhythm__Object_Name__c, Rhythm__Default_Fields__c, Rhythm__Field_Label__c, Rhythm__Field_Name__c, Rhythm__Fields_Limit__c, Rhythm__Related_To_Api_Name__c 
                            FROM Rhythm__List_View_For_Customers__mdt 
                            WHERE Rhythm__Object_Name__c = '${n}' AND Rhythm__isMobile__c = true`,console.log("Executing query:",o);const i=await t.query(o);return console.log("result",JSON.stringify(i)),i.records}catch(t){return console.error("Error executing online field query:",t),to(n)}return console.log(`\u{1F4F1} Device is offline, retrieving cached fields for ${n}`),to(n)};async function to(n){try{const e=Array.isArray(n)?"field_config_multiple":`field_config_${n}`,t=(await de(Z.FIELDS_CONFIG)).find(o=>o.id===e);return t&&t.fieldConfigs?(console.log(`\u{1F4F1} Retrieved cached field configurations for ${n}`),t.fieldConfigs):(console.log(`\u{1F4F1} No cached field configurations found for ${n}`),[])}catch(e){return console.error("Error getting offline field configurations:",e),[]}}const Ja=async(n,e)=>await(await B()).sobject(n).retrieve(e),$e=async(n,e)=>await(await B()).sobject(n).create(e),oe=async(n,e)=>await(await B()).sobject(n).update(e),At=async(n,e)=>{try{const s=await B();console.log(`Getting customer and supplier info for record ID: ${e}`);const t={customerName:null,supplierName:null,accountType:null,accountId:null,objectLabel:null},o="_Personal_Files";console.log("conn",s);let i=sessionStorage.getItem("sf_user_id");i||(i=localStorage.getItem("sf_user_id")),console.log("userId",i);const a=await s.sobject(n).describe();t.objectLabel=a.label.replace(/ /g,"_"),console.log("result.objectLabel",t.objectLabel);const r=`
            SELECT Id, ContactId, Email, Rhythm__Default_Location__c
            FROM User
            WHERE Id = '${i}'
            LIMIT 1
        `,l=await s.query(r);if(console.log("userRecords",JSON.stringify(l)),l.records.length>0&&l.records[0].ContactId&&l.records[0].Rhythm__Default_Location__c){const c=`
                SELECT Id
                FROM Rhythm__Location__c
                WHERE Id = '${l.records[0].Rhythm__Default_Location__c}'
            `,d=await s.query(c);console.log("locationRecords",JSON.stringify(d)),d.records.length>0&&(t.accountId=d.records[0].Id,t.accountType="Location Lite User")}if(t.accountType||(t.accountType="Admin"),console.log("result",JSON.stringify(t)),t.accountType==="Admin"||t.accountType==="Location Lite User"){let c="",d="";const h=`
                SELECT Id, Rhythm__Supplier_Id__c  
                FROM Rhythm__Supplier_Objects__mdt
                WHERE Rhythm__Object_Api_Name__c = '${n}' AND Rhythm__Is_Supplier_Contact__c = false
                LIMIT 1
            `,u=await s.query(h);console.log("metadataRecords",JSON.stringify(u)),u.records.length>0&&(c=u.records[0].Rhythm__Supplier_Id__c);const f=`SELECT Id, ${c} FROM ${n} WHERE Id = '${e}'`,g=await s.query(f);console.log("queryRecords",JSON.stringify(g)),g.records.length>0&&(d=g.records[0][c]);const _=`SELECT Id, Name FROM Rhythm__Location__c WHERE Id = '${d}'`,m=await s.query(_);if(console.log("locationRecords",JSON.stringify(m)),m.records.length>0){const x=m.records[0].Name;t.customerName=x.replace(/ /g,"_"),t.supplierName=`${t.customerName}${o}`}}return console.log("\u2705 Customer and supplier info response:",t),t}catch(s){throw console.error("Error getting customer and supplier info:",s),s}},Ae=async(n,e)=>{const s={folderName:n,type:e},o=await(await B()).apex.post("/AWSFiles/",s);return console.log("result",JSON.stringify(o)),o},Qa=async n=>{const e=await B(),s=`
        SELECT Id, MasterLabel, DeveloperName, 
               Rhythm__Object_Api_Name__c, Rhythm__Field_Api_Name__c,
               Rhythm__Required__c, Rhythm__IsActive__c,
               Rhythm__Section_Name__c, Rhythm__Order__c,
               Rhythm__Lookup_Filter_Label__c,
               Rhythm__is_New__c, Rhythm__is_Mobile__c
        FROM Rhythm__Fields_Level_Configuration__mdt 
        WHERE Rhythm__Object_API_Name__c = '${n}'
        AND Rhythm__is_Mobile__c = true
        ORDER BY Rhythm__Section_Name__c, Rhythm__Order__c
    `;return(await e.query(s)).records},Ya=async n=>{const e=await B(),s=`
        SELECT Id, MasterLabel, DeveloperName, Label,
               Rhythm__Value__c,
               Rhythm__Fields_Level_Configuration__r.Id,
               Rhythm__Fields_Level_Configuration__r.DeveloperName,
               Rhythm__Fields_Level_Configuration__r.MasterLabel,
               Rhythm__Fields_Level_Configuration__r.Rhythm__Field_Api_Name__c
        FROM Rhythm__Controlling_Field__mdt
        WHERE Rhythm__Fields_Level_Configuration__r.Rhythm__Object_API_Name__c = '${n}'
    `;return(await e.query(s)).records},os=async n=>{const e=await B();let s;return n==="Rhythm__Location__c"?s=`SELECT Id, Name FROM ${n} WHERE IsDeleted = false AND Rhythm__Status__c = 'Active' ORDER BY Name LIMIT 1000`:n==="User"?s=`SELECT Id, Name FROM ${n} WHERE IsActive = true ORDER BY Name LIMIT 1000`:n==="Rhythm__CustomAsset__c"?s=`SELECT Id,Rhythm__Asset_Name__c FROM ${n} WHERE IsDeleted = false ORDER BY Rhythm__Asset_Name__c LIMIT 1000`:s=`SELECT Id, Name FROM ${n} WHERE IsDeleted = false ORDER BY Name LIMIT 1000`,(await e.query(s)).records.map(o=>{let i;return n==="Rhythm__CustomAsset__c"?i=o.Rhythm__Asset_Name__c:i=o.Name,{label:o.Name,value:o.Id,displayValue:i}})},Ka=async n=>{const e=await B(),s=`
        SELECT 
            Id, 
            Rhythm__Tab_Name__c,
            Rhythm__Object_Api_Name__c,
            Rhythm__Order__c,
            Rhythm__LWC_Name__c,
            Rhythm__Input_Parameters__c,
            Rhythm__IsActive__c,
            Rhythm__is_Attachment__c,
            Rhythm__List_View_Object__c
        FROM Rhythm__Detail_Layout_Configuration__mdt
        WHERE Rhythm__Object_Api_Name__c = '${n}'
        AND Rhythm__is_Mobile__c = true
        ORDER BY Rhythm__Order__c
    `,t=await e.query(s);return console.log("result in line 350",JSON.stringify(t)),t.records},Ga=async(n,e)=>{const s=await B();let t;return n==="Task"?t=`SELECT Id,Rhythm__Title__c FROM ${n} WHERE Id = '${e}' LIMIT 1`:t=`SELECT Id, Name FROM ${n} WHERE Id = '${e}' LIMIT 1`,(await s.query(t)).records},is=async(n,e,s)=>{const t=await B(),o=await t.sobject(n).describe(),i=new Set,a={};o.fields.forEach(u=>{a[u.name]=u,u.type==="reference"&&i.add(u.name)});const r=new Set,l=Array.isArray(s)?s:[s];l.includes("Id")||r.add("Id"),l.forEach(u=>{if(!u)return;const f=as(u);if(r.add(f),i.has(u)){const g=a[u];if(g&&g.relationshipName){const _=`${as(g.relationshipName)}.Name`;r.add(_),console.log(`\u{1F517} Added relationship Name field: ${_} for ${u}`)}}});const d=`SELECT ${Array.from(r).join(",")} FROM ${as(n)} WHERE Id='${Xa(e)}' LIMIT 1`;return console.log(`\u{1F50D} Enhanced query with reference Name fields: ${d}`),(await t.query(d)).records};function as(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)&&!n.includes("__"),n}function Xa(n){return n.replace(/'/g,"\\'")}const ns=async n=>{const e=await B(),s=`
        SELECT Id, MasterLabel, DeveloperName, 
               Rhythm__Object_Api_Name__c, Rhythm__Field_Api_Name__c,
               Rhythm__Required__c, Rhythm__IsActive__c,
               Rhythm__Section_Name__c, Rhythm__Order__c,
               Rhythm__Lookup_Filter_Label__c,
               Rhythm__is_New__c, Rhythm__is_Mobile__c
        FROM Rhythm__Fields_Level_Configuration__mdt 
        WHERE Rhythm__Object_API_Name__c = '${n}'
        AND Rhythm__is_Mobile__c = true
        ORDER BY Rhythm__Section_Name__c, Rhythm__Order__c
    `,t=await e.query(s);return console.log("result in line 455",JSON.stringify(t)),t.records},Za=async n=>{const e=await B(),s=`
        SELECT Id, MasterLabel, DeveloperName, Label,
               Rhythm__Value__c,
               Rhythm__Fields_Level_Configuration__r.Id,
               Rhythm__Fields_Level_Configuration__r.DeveloperName,
               Rhythm__Fields_Level_Configuration__r.MasterLabel,
               Rhythm__Fields_Level_Configuration__r.Rhythm__Field_Api_Name__c
        FROM Rhythm__Controlling_Field__mdt
        WHERE Rhythm__Fields_Level_Configuration__r.Rhythm__Object_API_Name__c = '${n}'
    `;return(await e.query(s)).records},en=async()=>{const n=await B(),e=`
        SELECT Id, Label, Rhythm__Header__c, Rhythm__object_api_name__c, Rhythm__menuIcon__c ,Rhythm__parentMenu__c,Rhythm__menuDataId__c
        FROM Rhythm__Left_Menu__mdt 
        WHERE Rhythm__For_Mobile__c = true AND Rhythm__IsActive__c = true
    `;return(await n.query(e)).records},tn=async n=>{const e=await B(),s=`
        SELECT Id, Label, Rhythm__Header__c, Rhythm__object_api_name__c 
        FROM Rhythm__Left_Menu__mdt 
        WHERE Rhythm__For_Mobile__c = true AND Rhythm__IsActive__c = true 
        AND Rhythm__object_api_name__c = '${n}'
    `;return(await e.query(s)).records},vt=async n=>(await B()).sobject(n).describe();async function sn(){const n=await B(),e=`
        SELECT Id, Name FROM Network LIMIT 1
    `,s=await n.query(e);return s.records.length>0?s.records[0]:null}async function Mt(){try{const n=await B(),e=`
            SELECT Id, DeveloperName,
                   Rhythm__customValue__c
            FROM Rhythm__S3Configuration__mdt
            WHERE DeveloperName = 'type'
            LIMIT 1
        `,s=await n.query(e);return s.records.length>0?s.records[0]:null}catch(n){return console.error("Error getting S3 configuration:",n),null}}async function rs(n){try{const e=await B();let s=[];const t=`
        SELECT Id, LinkedEntityId, ContentDocumentId FROM ContentDocumentLink WHERE LinkedEntityId='${n}' ORDER BY ContentDocument.CreatedDate DESC
        `,o=await e.query(t);if(console.log("ContentDocumentLink query result:",JSON.stringify(o)),o.records.length>0){const a=`SELECT Id, ContentDocumentId, Title, FileExtension, VersionDataUrl, Description FROM ContentVersion WHERE ContentDocumentId IN ('${o.records.map(l=>l.ContentDocumentId).join("','")}') ORDER BY CreatedDate DESC`,r=await e.query(a);console.log("\u{1F4C4} ContentDocument query result:",JSON.stringify(r)),s=r.records.map(l=>{const c=l.FileExtension?.toLowerCase();let d="doctype:unknown",h=!1,u="";["jpg","jpeg","png","gif"].includes(c)?(d="doctype:image",h=!0):c==="pdf"?(d="doctype:pdf",h=!0):["doc","docx"].includes(c)?d="doctype:word":["xls","xlsx","csv"].includes(c)&&(d="doctype:excel");let f=l.Title;return u=`${e.instanceUrl}/sfc/servlet.shepherd/document/download/${l.ContentDocumentId}`,{contentVersion:l.Id,key:l.ContentDocumentId,value:f,originalTitle:l.Title,type:c,preview:h,icon:d,isSalesforceFile:!0,url:u,description:l.Description||""}})}return s}catch(e){return console.error("Error getting Salesforce files:",e),[]}}async function so(n){try{const s=await(await B()).sobject("ContentDocument").delete(n);return s.success?(console.log("Salesforce file deleted successfully:",n),!0):(console.error("Error deleting Salesforce file:",s),!1)}catch(e){return console.error("Error deleting Salesforce file:",e),!1}}async function on(n){const e=await B(),s=`SELECT Id,IsDeleted,Name,Rhythm__Account__c,Rhythm__Assessment__c,Rhythm__Assessment__r.Name,Rhythm__PdfConvertor__c,
                                                                    Rhythm__Assessment__r.Rhythm__Status__c,Rhythm__Assessment__r.Rhythm__Customer_Review__c,CreatedDate,Rhythm__Account__r.Name,
                                                                    Rhythm__Assessment__r.Rhythm__Number_of_Questions__c,Rhythm__Start_Date__c,Rhythm__End_Date__c,Rhythm__Status__c,
                                                                    Rhythm__Assessment__r.Rhythm__Additional_Requests__c,Rhythm__Number_of_Questions__c,Rhythm__Assessment__r.CreatedDate,
                                                                    Rhythm__Assessment__r.Rhythm__Template__c,Rhythm__Number_of_Responses__c,Rhythm__Assessment__r.CreatedBy.Name,
                                                                    Rhythm__Assessment__r.Rhythm__CreatedUser__c,CreatedBy.Name,Rhythm__Score__c,Rhythm__maxPossibleScore__c,Rhythm__countAttributes__c,
                                                                    Rhythm__Location__c, Rhythm__Assessment__r.Rhythm__Scope__c, Rhythm__Location__r.Name, Rhythm__Assets__r.Rhythm__Asset_Name__c, Rhythm__Assets__c
                                                                    FROM Rhythm__AccountAssessmentRelation__c
                                                                    WHERE Id='${n}' LIMIT 1`,t=await e.query(s);return console.log("result in line 681",JSON.stringify(t)),t.records}async function oo(n){const e=await B(),s=`SELECT Rhythm__Object_Field_Name__c,Rhythm__Object_Field_Value__c,
                                            Rhythm__Object_Name__c,Rhythm__object_Record_Id__c,Rhythm__ActivityUserId__c,Rhythm__Activity_User__c,CreatedDate
                                            FROM Rhythm__FieldHistoryTracking__c
                                            WHERE Rhythm__object_Record_Id__c='${n}'
                                            AND Rhythm__Object_Name__c = 'AccountAssessmentRelation__c'
                                            AND Rhythm__Object_Field_Name__c='Rhythm__Status__c'
                                            ORDER BY CreatedDate DESC`,t=await e.query(s);return console.log("result in line 695",JSON.stringify(t)),t.records}async function an(n){const e=await B(),s=`SELECT Id,Name,Rhythm__Section__c,Rhythm__Question_Type__c,
                                            Rhythm__Required__c,Rhythm__Default_Value__c,Rhythm__Conditional_Response__c,
                                            Rhythm__OptionValueSet__c,Rhythm__Question_Sequence_Number__c,Rhythm__Question__c,Rhythm__Requires_File_Upload__c,
                                            Rhythm__Parent_Question__c,Rhythm__HelpText__c,Rhythm__Section__r.Rhythm__Section_Sequence_Number__c,
                                            Rhythm__Section__r.Name,Rhythm__Section__r.Id,Rhythm__Assessment_Template__c, Rhythm__Section__r.Rhythm__Internal_Use_Only__c
                                            FROM Rhythm__Question__c
                                            WHERE Rhythm__Assessment_Template__c = '${n}'
                                            ORDER BY  Rhythm__Section__r.Rhythm__Section_Sequence_Number__c,Rhythm__Question_Sequence_Number__c`,t=await e.query(s);return console.log("result in line 710",JSON.stringify(t)),t.records}async function nn(n){const e=await B(),s=`SELECT Id,Rhythm__Question__c,Rhythm__Assessment__c,Rhythm__Question__r.Rhythm__Question_Type__c, Rhythm__AccountAssessmentRelation__c,
                                                Rhythm__Assessment__r.Name,Rhythm__Files__c,Rhythm__Response__c,Rhythm__Reject__c,Rhythm__preferred_Non_preferred__c, Rhythm__Score__c,
                                                CreatedDate,Rhythm__Flag__c,Rhythm__Conversation_History__c,LastModifiedDate,LastModifiedById,Rhythm__Emails__c
                                                FROM Rhythm__Response__c
                                                WHERE Rhythm__AccountAssessmentRelation__c= '${n}'
                                                AND Rhythm__Is_Latest_Response__c= true ORDER BY CreatedDate DESC
                                                `;console.log("query in line 724",s);const t=await e.query(s);return console.log("result in line 724",JSON.stringify(t)),t.records}async function rn(n){const e=await B(),s=`SELECT Id,Name,Rhythm__Response_value__c,Rhythm__QuestionId__c,Rhythm__preferred_Not_preferred__c,Rhythm__Score__c,
                                                        Rhythm__Upload_Required__c,Rhythm__Weight__c
                                                        FROM Rhythm__Response_Attribute__c
                                                        WHERE Rhythm__QuestionId__c IN ('${n.join("','")}')
                                                        `,t=await e.query(s);return console.log("result in line 736",JSON.stringify(t)),t.records}async function ln(n,e){const s=await B(),t=`SELECT Id,Name,Rhythm__Finding_Type__c,Rhythm__Finding_Description__c,Rhythm__Root_Cause__c,Rhythm__Repeat_Finding__c,Rhythm__Resolution_Time_Frame__c,Rhythm__Assessment_Area__c,Rhythm__Status__c, Rhythm__Supplier_Response__c, Rhythm__Assessment_Question__c FROM Rhythm__Assessment_Finding__c WHERE Rhythm__Assessment_Question__c IN ('${n.join("','")}') AND Rhythm__AccountAssessmentRelation__c = '${e}' `,o=await s.query(t);return console.log("result in line 749",JSON.stringify(o)),o.records}async function cn(n,e,s,t){try{const o=await B();if(console.log("listIds",s),!s||Array.isArray(s)&&s.length===0)return console.log("No listIds provided, returning empty result"),JSON.stringify({records:[]});const i={type:"listRecords",objectApiName:n,fields:e,listIds:s,relatedToApiName:t};try{const a=await o.apex.post("/AWSFiles/",i);return console.log("result in getListRecords",JSON.stringify(a)),a}catch(a){if(a.message&&a.message.includes("match for URL")){console.error("URL matching error detected:",a.message),console.log("Falling back to direct SOQL query");const r=`SELECT ${e} FROM ${n} WHERE ${t} IN ('${s.join("','")}')`;try{const l=await o.query(r);return JSON.stringify({records:l.records})}catch(l){throw console.error("Fallback query failed:",l),l}}else throw a}}catch(o){return console.error("Error in getListRecords:",o),JSON.stringify({records:[]})}}async function dn(n,e,s){const t={type:"genericListView",objectApiName:n,fields:e,userId:s};return await(await B()).apex.post("/AWSFiles/",t)}async function ls(n,e,s,t){const o={type:"recordListView",objectApiName:n,fields:e,recordId:s,relatedToApiName:t},a=await(await B()).apex.post("/AWSFiles/",o);return console.log("result in line 780",JSON.stringify(a)),a}async function hn(n){const e=await B(),s=`SELECT Id, Name, Rhythm__User__c, Rhythm__Job_Title__c FROM Contact WHERE Rhythm__Loc__c = '${n}'`;return(await e.query(s)).records}async function un(n,e){try{try{if(!(await X.getStatus())?.connected)return{success:!1,reason:"offline",error:"Device is offline (Capacitor Network)"}}catch($){if(!V())return{success:!1,reason:"offline",error:"Device is offline"}}console.log("\u{1F680} Starting uploadFileToSalesforce with fileRecord:",JSON.stringify(n));const s=new FileReader,t=new Promise(($,S)=>{s.onloadend=()=>{const O=s.result.split(",")[1];$(O)},s.onerror=()=>S(new Error("Failed to read file as base64"))});s.readAsDataURL(e);const o=await t;console.log("\u{1F4C4} Converted file to base64, length:",o.length);const i=await se.getConnectionForComponent();let a=n.name,r=a.lastIndexOf("."),l=r!==-1?a.slice(0,r):a,c=r!==-1?a.slice(r):"";l=l.replace(/[^a-zA-Z0-9]+/g,"_"),l=l.replace(/^_+|_+$/g,"");const d=l+c,h=new Date().toISOString().replace(/[-:]/g,"").split(".")[0],u=`${n.recordId}_${h}_${d}`;console.log("\u{1F4C4} Creating ContentVersion record with filename:",u);const f=await sn();console.log("\u{1F4E4} Using JSForce to create ContentVersion"),console.log("Using direct base64 upload approach");const g={Title:u,PathOnClient:u,VersionData:o,FirstPublishLocationId:n.recordId,Description:n.description||"",NetworkId:f?.Id,ContentLocation:"S"};console.log("Creating ContentVersion with base64 data"),console.log("Base64 data length:",o.length);const _=await i.sobject("ContentVersion").create(g);if(!_.success)throw console.error("\u274C Failed to create ContentVersion:",_),new Error(`Failed to create ContentVersion: ${_.errors?.join(", ")}`);console.log("\u2705 ContentVersion created successfully with direct base64 upload, ID:",_.id);const m=_.id,k=(await i.query(`SELECT Id, ContentDocumentId FROM ContentVersion WHERE Id = '${m}'`)).records[0]?.ContentDocumentId;return console.log("\u2705 ContentDocument ID:",k),{success:!0,fileSize:e.size,fileName:u,contentVersionId:m,contentDocumentId:k,uploadType:"salesforce"}}catch(s){return console.error("\u274C uploadFileToSalesforce error:",s),{success:!1,error:s.message||s,uploadType:"salesforce"}}}async function It(n){try{try{if(!(await X.getStatus())?.connected)return{success:!1,reason:"offline",error:"Device is offline (Capacitor Network)"}}catch(m){if(!V())return{success:!1,reason:"offline",error:"Device is offline"}}const e=await Mt();if(console.log("\u{1F50D} S3 Configuration:",e),e&&e.Rhythm__customValue__c==="salesforce"?console.log("\u{1F4C1} Using Salesforce standard file upload method"):console.log("\u{1F4C1} Using S3 file upload method"),console.log("\u{1F680} Starting uploadFileToS3 with fileRecord:",n),!n||!n.webPath)throw new Error("\u274C No webPath in fileRecord");let s=n.name;const t=n.type||"image/jpeg";let o=s.lastIndexOf("."),i=o!==-1?s.slice(0,o):s,a=o!==-1?s.slice(o):"";i=i.replace(/[^a-zA-Z0-9]+/g,"_"),i=i.replace(/^_+|_+$/g,"");const r=i+a,l=new Date().toISOString().replace(/[-:]/g,"").split(".")[0];console.log("fileRecord in line 59",JSON.stringify(n));let c="";if(n.recordId&&n.formType)try{console.log("Getting customer and supplier info for folder path");const m=await At(n.formType,n.recordId);console.log("customerAndSupplierInfo",m),m&&m.supplierName&&m.supplierName.includes("_Personal_Files")&&(c=`${m.customerName}/${m.objectLabel}/${m.supplierName}`,console.log("folderName",c))}catch(m){console.error("Error getting customer and supplier info:",m)}const d=`${n.recordId}_${l}_${r}`;console.log("\u{1F50D} Getting presigned URL with fileName:",d),console.log("\u{1F4C2} FileRecord details:",{name:n.name,webPath:n.webPath,type:n.type,folderPath:c}),console.log("folderPath",c);try{if(!(await X.getStatus())?.connected)return{success:!1,reason:"offline",error:"Device is offline (Capacitor Network)"}}catch(m){if(!V())return{success:!1,reason:"offline",error:"Device is offline"}}let h;if(!e||e.Rhythm__customValue__c!=="salesforce"){const m=await fetch("https://i3keec7y9j.execute-api.ap-south-1.amazonaws.com/default/preSignedUrl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:`${c}/${d}`,type:"upload"})});if(console.log("\u{1F4E5} Presigned URL response status:",JSON.stringify(m)),!m.ok)throw new Error(`\u274C Failed to get presigned URL: ${m.status}`);const x=await m.json();if(console.log("\u{1F4DD} Raw Lambda response:",x),typeof x=="string")h=x,console.log("\u{1F517} Lambda returned URL directly as string");else if(x.url)h=x.url,console.log("\u{1F517} Lambda returned URL in object.url property");else if(x.uploadURL)h=x.uploadURL,console.log("\u{1F517} Lambda returned URL in object.uploadURL property");else throw console.error("\u274C Could not find URL in response:",x),new Error("\u274C No valid presigned URL found in Lambda response");console.log("\u{1F517} Using presigned URL:",h)}let u;if(n.webPath.startsWith("data:")){console.log("\u{1F4C4} Processing data URL...");const m=n.webPath.split(",");if(m.length===2){const x=m[1];console.log("\u{1F4C4} Extracted base64 from data URL, length:",x.length);const k=atob(x),$=new Uint8Array(k.length);for(let S=0;S<k.length;S++)$[S]=k.charCodeAt(S);u=new Blob([$],{type:t}),console.log("\u{1F4C4} Created blob from base64, size:",u.size,"bytes")}else throw new Error("\u274C Invalid data URL format")}else{console.log("\u{1F4C2} Processing file path..."),console.log("\u{1F4C2} Original webPath:",n.webPath);let m;n.webPath.startsWith("file://")?(m=n.webPath.replace("file://",""),console.log("\u{1F4C2} Extracted file:// path:",m)):n.webPath.startsWith("http")?(m=new URL(n.webPath).pathname.replace("/_capacitor_file_/",""),console.log("\u{1F4C2} Extracted webPath:",m)):(m=n.webPath,console.log("\u{1F4C2} Using direct path:",m)),console.log("\u{1F4D6} Reading file using Filesystem API...");const x=await za.readFile({path:m}),k=x.data.includes(",")?x.data.split(",")[1]:x.data;console.log("\u{1F4C4} Base64 data length:",k.length),console.log("\u{1F4C4} Base64 starts with:",k.slice(0,20));const $=atob(k),S=new Uint8Array($.length);for(let O=0;O<$.length;O++)S[O]=$.charCodeAt(O);u=new Blob([S],{type:t}),console.log("\u{1F4C4} Created blob from file data, size:",u.size,"bytes")}if(console.log("\u{1F4E6} Final blob details:"),console.log("\u{1F4E6} Blob size:",u.size,"bytes"),console.log("\u{1F4E6} Blob type:",u.type),u.size===0)throw new Error("\u{1F6AB} Blob size is zero \u2014 image data corrupted");try{const m=await u.arrayBuffer(),x=new Uint8Array(m);console.log("\u{1F50D} Blob content verification:"),console.log("\u{1F50D} First 10 bytes (should start with FFD8 for JPEG):",Array.from(x.slice(0,10))),console.log("\u{1F50D} Last 10 bytes:",Array.from(x.slice(-10))),x[0]===255&&x[1]===216?console.log("\u2705 Blob contains valid JPEG signature"):console.warn("\u26A0\uFE0F Blob does not contain JPEG signature, got:",x[0],x[1]);const k=URL.createObjectURL(u),$=new Image;$.onload=()=>{console.log("\u2705 Blob creates loadable image"),URL.revokeObjectURL(k)},$.onerror=()=>{console.error("\u274C Blob does not create loadable image"),URL.revokeObjectURL(k)},$.src=k}catch(m){console.error("\u274C Failed to test blob content:",m)}console.log("\u{1F4E6} Creating File object...");const f=new File([u],d,{type:t});console.log("\u{1F4E6} File object created:"),console.log("\u{1F4E6} File object size:",f.size,"bytes"),console.log("\u{1F4E6} File object type:",f.type),console.log("\u{1F4E6} File object name:",f.name);try{const m=await f.arrayBuffer(),x=new Uint8Array(m,0,Math.min(10,m.byteLength));console.log("\u{1F4E6} File object first 10 bytes:",Array.from(x))}catch(m){console.error("\u274C Could not test File object content:",m)}if(e&&e.Rhythm__customValue__c==="salesforce")return await un(n,u);try{if(!(await X.getStatus())?.connected)return{success:!1,reason:"offline",error:"Device is offline (Capacitor Network)"}}catch(m){if(!V())return{success:!1,reason:"offline",error:"Device is offline"}}const g=await fetch(h,{method:"PUT",body:f});if(console.log("\u{1F4E4} File object upload completed!"),console.log("\u{1F4E4} Response status:",g.status),console.log("\u{1F4E4} Response statusText:",g.statusText),console.log("\u{1F4E4} Response headers:",Object.fromEntries(g.headers.entries())),!g.ok){const m=await g.text();throw console.error("\u274C File object upload failed response body:",m),new Error(`\u274C File object upload failed with status ${g.status}: ${m}`)}const _=h.split("?")[0];return console.log("\u2705 SUCCESS! File object uploaded to S3"),console.log("\u2705 S3 URL:",_),console.log("\u2705 File size uploaded:",f.size,"bytes"),console.log(`\u{1F50D} Look for this exact file in AWS S3: ${c}/${d}`),{success:!0,fileSize:f.size,fileName:d,s3Url:_,s3Key:`${c}/${d}`}}catch(e){console.error("\u274C uploadFileToS3 error:",e);try{if(!(await X.getStatus())?.connected)return{success:!1,reason:"offline",error:"Device is offline (Capacitor Network)"}}catch(s){if(!V())return{success:!1,reason:"offline",error:"Device is offline"}}return{success:!1,error:e.message||e}}}var io=Object.defineProperty,pn=n=>io(n,"__esModule",{value:!0}),fn=(n,e)=>()=>(e||(e={exports:{}},n(e.exports,e)),e.exports),mn=(n,e)=>{for(var s in e)io(n,s,{get:e[s],enumerable:!0})},gn=fn(n=>{pn(n),mn(n,{CapacitorSQLiteWeb:()=>e});var e=class extends us{constructor(){super(...arguments);this.jeepSqliteElement=null,this.isWebStoreOpen=!1}async initWebStore(){await customElements.whenDefined("jeep-sqlite"),this.jeepSqliteElement=document.querySelector("jeep-sqlite"),this.ensureJeepSqliteIsAvailable(),this.jeepSqliteElement.addEventListener("jeepSqliteImportProgress",s=>{this.notifyListeners("sqliteImportProgressEvent",s.detail)}),this.jeepSqliteElement.addEventListener("jeepSqliteExportProgress",s=>{this.notifyListeners("sqliteExportProgressEvent",s.detail)}),this.jeepSqliteElement.addEventListener("jeepSqliteHTTPRequestEnded",s=>{this.notifyListeners("sqliteHTTPRequestEndedEvent",s.detail)}),this.jeepSqliteElement.addEventListener("jeepSqlitePickDatabaseEnded",s=>{this.notifyListeners("sqlitePickDatabaseEndedEvent",s.detail)}),this.jeepSqliteElement.addEventListener("jeepSqliteSaveDatabaseToDisk",s=>{this.notifyListeners("sqliteSaveDatabaseToDiskEvent",s.detail)}),this.isWebStoreOpen||(this.isWebStoreOpen=await this.jeepSqliteElement.isStoreOpen())}async saveToStore(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.saveToStore(s);return}catch(t){throw new Error(`${t}`)}}async getFromLocalDiskToStore(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.getFromLocalDiskToStore(s);return}catch(t){throw new Error(`${t}`)}}async saveToLocalDisk(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.saveToLocalDisk(s);return}catch(t){throw new Error(`${t}`)}}async echo(s){return this.ensureJeepSqliteIsAvailable(),await this.jeepSqliteElement.echo(s)}async createConnection(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.createConnection(s);return}catch(t){throw new Error(`${t}`)}}async open(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.open(s);return}catch(t){throw new Error(`${t}`)}}async closeConnection(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.closeConnection(s);return}catch(t){throw new Error(`${t}`)}}async getVersion(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getVersion(s)}catch(t){throw new Error(`${t}`)}}async checkConnectionsConsistency(s){this.ensureJeepSqliteIsAvailable();try{return await this.jeepSqliteElement.checkConnectionsConsistency(s)}catch(t){throw new Error(`${t}`)}}async close(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.close(s);return}catch(t){throw new Error(`${t}`)}}async beginTransaction(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.beginTransaction(s)}catch(t){throw new Error(`${t}`)}}async commitTransaction(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.commitTransaction(s)}catch(t){throw new Error(`${t}`)}}async rollbackTransaction(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.rollbackTransaction(s)}catch(t){throw new Error(`${t}`)}}async isTransactionActive(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isTransactionActive(s)}catch(t){throw new Error(`${t}`)}}async getTableList(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getTableList(s)}catch(t){throw new Error(`${t}`)}}async execute(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.execute(s)}catch(t){throw new Error(`${t}`)}}async executeSet(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.executeSet(s)}catch(t){throw new Error(`${t}`)}}async run(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.run(s)}catch(t){throw new Error(`${t}`)}}async query(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.query(s)}catch(t){throw new Error(`${t}`)}}async isDBExists(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isDBExists(s)}catch(t){throw new Error(`${t}`)}}async isDBOpen(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isDBOpen(s)}catch(t){throw new Error(`${t}`)}}async isDatabase(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isDatabase(s)}catch(t){throw new Error(`${t}`)}}async isTableExists(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isTableExists(s)}catch(t){throw new Error(`${t}`)}}async deleteDatabase(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.deleteDatabase(s);return}catch(t){throw new Error(`${t}`)}}async isJsonValid(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isJsonValid(s)}catch(t){throw new Error(`${t}`)}}async importFromJson(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.importFromJson(s)}catch(t){throw new Error(`${t}`)}}async exportToJson(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.exportToJson(s)}catch(t){throw new Error(`${t}`)}}async createSyncTable(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.createSyncTable(s)}catch(t){throw new Error(`${t}`)}}async setSyncDate(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.setSyncDate(s);return}catch(t){throw new Error(`${t}`)}}async getSyncDate(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getSyncDate(s)}catch(t){throw new Error(`${t}`)}}async deleteExportedRows(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.deleteExportedRows(s);return}catch(t){throw new Error(`${t}`)}}async addUpgradeStatement(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.addUpgradeStatement(s);return}catch(t){throw new Error(`${t}`)}}async copyFromAssets(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.copyFromAssets(s);return}catch(t){throw new Error(`${t}`)}}async getFromHTTPRequest(s){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.getFromHTTPRequest(s);return}catch(t){throw new Error(`${t}`)}}async getDatabaseList(){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getDatabaseList()}catch(s){throw new Error(`${s}`)}}ensureJeepSqliteIsAvailable(){if(this.jeepSqliteElement===null)throw new Error("The jeep-sqlite element is not present in the DOM! Please check the @capacitor-community/sqlite documentation for instructions regarding the web platform.")}ensureWebstoreIsOpen(){if(!this.isWebStoreOpen)throw new Error('WebStore is not open yet. You have to call "initWebStore()" first.')}async getUrl(){throw this.unimplemented("Not implemented on web.")}async getMigratableDbList(s){throw console.log("getMigratableDbList",s),this.unimplemented("Not implemented on web.")}async addSQLiteSuffix(s){throw console.log("addSQLiteSuffix",s),this.unimplemented("Not implemented on web.")}async deleteOldDatabases(s){throw console.log("deleteOldDatabases",s),this.unimplemented("Not implemented on web.")}async moveDatabasesAndAddSuffix(s){throw console.log("moveDatabasesAndAddSuffix",s),this.unimplemented("Not implemented on web.")}async isSecretStored(){throw this.unimplemented("Not implemented on web.")}async setEncryptionSecret(s){throw console.log("setEncryptionSecret",s),this.unimplemented("Not implemented on web.")}async changeEncryptionSecret(s){throw console.log("changeEncryptionSecret",s),this.unimplemented("Not implemented on web.")}async clearEncryptionSecret(){throw console.log("clearEncryptionSecret"),this.unimplemented("Not implemented on web.")}async checkEncryptionSecret(s){throw console.log("checkEncryptionPassPhrase",s),this.unimplemented("Not implemented on web.")}async getNCDatabasePath(s){throw console.log("getNCDatabasePath",s),this.unimplemented("Not implemented on web.")}async createNCConnection(s){throw console.log("createNCConnection",s),this.unimplemented("Not implemented on web.")}async closeNCConnection(s){throw console.log("closeNCConnection",s),this.unimplemented("Not implemented on web.")}async isNCDatabase(s){throw console.log("isNCDatabase",s),this.unimplemented("Not implemented on web.")}async isDatabaseEncrypted(s){throw console.log("isDatabaseEncrypted",s),this.unimplemented("Not implemented on web.")}async isInConfigEncryption(){throw this.unimplemented("Not implemented on web.")}async isInConfigBiometricAuth(){throw this.unimplemented("Not implemented on web.")}async loadExtension(s){throw console.log("loadExtension",s),this.unimplemented("Not implemented on web.")}async enableLoadExtension(s){throw console.log("enableLoadExtension",s),this.unimplemented("Not implemented on web.")}}});/*! Capacitor: https://capacitorjs.com/ - MIT License */var wt;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(wt||(wt={}));var cs=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},_n=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},bn=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:_n(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new cs(`"${h}" plugin is not implemented on ${g}`,wt.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new cs(`"${h}.${v}()" is not implemented on ${g}`,wt.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=cs,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},yn=n=>n.Capacitor=bn(n),ds=yn(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),hs=ds.registerPlugin,us=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new ds.Exception(n,wt.Unimplemented)}unavailable(n="not available"){return new ds.Exception(n,wt.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},ao=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),no=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),vn=class extends us{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=no(t).trim(),o=no(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=ao(n.key),s=ao(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};hs("CapacitorCookies",{web:()=>new vn});var wn=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),xn=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},kn=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,$n=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=xn(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},Cn=class extends us{async request(n){const e=$n(n,n.webFetchExtra),s=kn(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await wn(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};hs("CapacitorHttp",{web:()=>new Cn});var Sn=class{constructor(n){this.sqlite=n,this._connectionDict=new Map}async initWebStore(){try{return await this.sqlite.initWebStore(),Promise.resolve()}catch(n){return Promise.reject(n)}}async saveToStore(n){try{return await this.sqlite.saveToStore({database:n}),Promise.resolve()}catch(e){return Promise.reject(e)}}async saveToLocalDisk(n){try{return await this.sqlite.saveToLocalDisk({database:n}),Promise.resolve()}catch(e){return Promise.reject(e)}}async getFromLocalDiskToStore(n){const e=n??!0;try{return await this.sqlite.getFromLocalDiskToStore({overwrite:e}),Promise.resolve()}catch(s){return Promise.reject(s)}}async echo(n){try{const e=await this.sqlite.echo({value:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async isSecretStored(){try{const n=await this.sqlite.isSecretStored();return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async setEncryptionSecret(n){try{return await this.sqlite.setEncryptionSecret({passphrase:n}),Promise.resolve()}catch(e){return Promise.reject(e)}}async changeEncryptionSecret(n,e){try{return await this.sqlite.changeEncryptionSecret({passphrase:n,oldpassphrase:e}),Promise.resolve()}catch(s){return Promise.reject(s)}}async clearEncryptionSecret(){try{return await this.sqlite.clearEncryptionSecret(),Promise.resolve()}catch(n){return Promise.reject(n)}}async checkEncryptionSecret(n){try{const e=await this.sqlite.checkEncryptionSecret({passphrase:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async addUpgradeStatement(n,e){try{return n.endsWith(".db")&&(n=n.slice(0,-3)),await this.sqlite.addUpgradeStatement({database:n,upgrade:e}),Promise.resolve()}catch(s){return Promise.reject(s)}}async createConnection(n,e,s,t,o){try{n.endsWith(".db")&&(n=n.slice(0,-3)),await this.sqlite.createConnection({database:n,encrypted:e,mode:s,version:t,readonly:o});const i=new ro(n,o,this.sqlite),a=o?`RO_${n}`:`RW_${n}`;return this._connectionDict.set(a,i),Promise.resolve(i)}catch(i){return Promise.reject(i)}}async closeConnection(n,e){try{n.endsWith(".db")&&(n=n.slice(0,-3)),await this.sqlite.closeConnection({database:n,readonly:e});const s=e?`RO_${n}`:`RW_${n}`;return this._connectionDict.delete(s),Promise.resolve()}catch(s){return Promise.reject(s)}}async isConnection(n,e){const s={};n.endsWith(".db")&&(n=n.slice(0,-3));const t=e?`RO_${n}`:`RW_${n}`;return s.result=this._connectionDict.has(t),Promise.resolve(s)}async retrieveConnection(n,e){n.endsWith(".db")&&(n=n.slice(0,-3));const s=e?`RO_${n}`:`RW_${n}`;if(this._connectionDict.has(s)){const t=this._connectionDict.get(s);return typeof t!="undefined"?Promise.resolve(t):Promise.reject(`Connection ${n} is undefined`)}else return Promise.reject(`Connection ${n} does not exist`)}async getNCDatabasePath(n,e){try{const s=await this.sqlite.getNCDatabasePath({path:n,database:e});return Promise.resolve(s)}catch(s){return Promise.reject(s)}}async createNCConnection(n,e){try{await this.sqlite.createNCConnection({databasePath:n,version:e});const s=new ro(n,!0,this.sqlite),t=`RO_${n})`;return this._connectionDict.set(t,s),Promise.resolve(s)}catch(s){return Promise.reject(s)}}async closeNCConnection(n){try{await this.sqlite.closeNCConnection({databasePath:n});const e=`RO_${n})`;return this._connectionDict.delete(e),Promise.resolve()}catch(e){return Promise.reject(e)}}async isNCConnection(n){const e={},s=`RO_${n})`;return e.result=this._connectionDict.has(s),Promise.resolve(e)}async retrieveNCConnection(n){if(this._connectionDict.has(n)){const e=`RO_${n})`,s=this._connectionDict.get(e);return typeof s!="undefined"?Promise.resolve(s):Promise.reject(`Connection ${n} is undefined`)}else return Promise.reject(`Connection ${n} does not exist`)}async isNCDatabase(n){try{const e=await this.sqlite.isNCDatabase({databasePath:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async retrieveAllConnections(){return this._connectionDict}async closeAllConnections(){const n=new Map;try{for(const e of this._connectionDict.keys()){const s=e.substring(3),t=e.substring(0,3)==="RO_";await this.sqlite.closeConnection({database:s,readonly:t}),n.set(e,null)}for(const e of n.keys())this._connectionDict.delete(e);return Promise.resolve()}catch(e){return Promise.reject(e)}}async checkConnectionsConsistency(){try{const n=[...this._connectionDict.keys()],e=[],s=[];for(const o of n)e.push(o.substring(0,2)),s.push(o.substring(3));const t=await this.sqlite.checkConnectionsConsistency({dbNames:s,openModes:e});return t.result||(this._connectionDict=new Map),Promise.resolve(t)}catch(n){return this._connectionDict=new Map,Promise.reject(n)}}async importFromJson(n){try{const e=await this.sqlite.importFromJson({jsonstring:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async isJsonValid(n){try{const e=await this.sqlite.isJsonValid({jsonstring:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async copyFromAssets(n){const e=n??!0;try{return await this.sqlite.copyFromAssets({overwrite:e}),Promise.resolve()}catch(s){return Promise.reject(s)}}async getFromHTTPRequest(n,e){const s=e??!0;try{return await this.sqlite.getFromHTTPRequest({url:n,overwrite:s}),Promise.resolve()}catch(t){return Promise.reject(t)}}async isDatabaseEncrypted(n){n.endsWith(".db")&&(n=n.slice(0,-3));try{const e=await this.sqlite.isDatabaseEncrypted({database:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async isInConfigEncryption(){try{const n=await this.sqlite.isInConfigEncryption();return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async isInConfigBiometricAuth(){try{const n=await this.sqlite.isInConfigBiometricAuth();return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async isDatabase(n){n.endsWith(".db")&&(n=n.slice(0,-3));try{const e=await this.sqlite.isDatabase({database:n});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async getDatabaseList(){try{const e=(await this.sqlite.getDatabaseList()).values;e.sort();const s={values:e};return Promise.resolve(s)}catch(n){return Promise.reject(n)}}async getMigratableDbList(n){const e=n||"default";try{const s=await this.sqlite.getMigratableDbList({folderPath:e});return Promise.resolve(s)}catch(s){return Promise.reject(s)}}async addSQLiteSuffix(n,e){const s=n||"default",t=e||[];try{const o=await this.sqlite.addSQLiteSuffix({folderPath:s,dbNameList:t});return Promise.resolve(o)}catch(o){return Promise.reject(o)}}async deleteOldDatabases(n,e){const s=n||"default",t=e||[];try{const o=await this.sqlite.deleteOldDatabases({folderPath:s,dbNameList:t});return Promise.resolve(o)}catch(o){return Promise.reject(o)}}async moveDatabasesAndAddSuffix(n,e){const s=n||"default",t=e||[];return this.sqlite.moveDatabasesAndAddSuffix({folderPath:s,dbNameList:t})}},ro=class{constructor(n,e,s){this.dbName=n,this.readonly=e,this.sqlite=s}getConnectionDBName(){return this.dbName}getConnectionReadOnly(){return this.readonly}async open(){try{return await this.sqlite.open({database:this.dbName,readonly:this.readonly}),Promise.resolve()}catch(n){return Promise.reject(n)}}async close(){try{return await this.sqlite.close({database:this.dbName,readonly:this.readonly}),Promise.resolve()}catch(n){return Promise.reject(n)}}async beginTransaction(){try{const n=await this.sqlite.beginTransaction({database:this.dbName});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async commitTransaction(){try{const n=await this.sqlite.commitTransaction({database:this.dbName});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async rollbackTransaction(){try{const n=await this.sqlite.rollbackTransaction({database:this.dbName});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async isTransactionActive(){try{const n=await this.sqlite.isTransactionActive({database:this.dbName});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async loadExtension(n){try{return await this.sqlite.loadExtension({database:this.dbName,path:n,readonly:this.readonly}),Promise.resolve()}catch(e){return Promise.reject(e)}}async enableLoadExtension(n){try{return await this.sqlite.enableLoadExtension({database:this.dbName,toggle:n,readonly:this.readonly}),Promise.resolve()}catch(e){return Promise.reject(e)}}async getUrl(){try{const n=await this.sqlite.getUrl({database:this.dbName,readonly:this.readonly});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async getVersion(){try{const n=await this.sqlite.getVersion({database:this.dbName,readonly:this.readonly});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async getTableList(){try{const n=await this.sqlite.getTableList({database:this.dbName,readonly:this.readonly});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async execute(n,e=!0,s=!0){try{if(this.readonly)return Promise.reject("not allowed in read-only mode");{const t=await this.sqlite.execute({database:this.dbName,statements:n,transaction:e,readonly:!1,isSQL92:s});return Promise.resolve(t)}}catch(t){return Promise.reject(t)}}async query(n,e,s=!0){let t;try{return e&&e.length>0?t=await this.sqlite.query({database:this.dbName,statement:n,values:e,readonly:this.readonly,isSQL92:!0}):t=await this.sqlite.query({database:this.dbName,statement:n,values:[],readonly:this.readonly,isSQL92:s}),t=await this.reorderRows(t),Promise.resolve(t)}catch(o){return Promise.reject(o)}}async run(n,e,s=!0,t="no",o=!0){let i;try{return this.readonly?Promise.reject("not allowed in read-only mode"):(e&&e.length>0?i=await this.sqlite.run({database:this.dbName,statement:n,values:e,transaction:s,readonly:!1,returnMode:t,isSQL92:!0}):i=await this.sqlite.run({database:this.dbName,statement:n,values:[],transaction:s,readonly:!1,returnMode:t,isSQL92:o}),i.changes=await this.reorderRows(i.changes),Promise.resolve(i))}catch(a){return Promise.reject(a)}}async executeSet(n,e=!0,s="no",t=!0){let o;try{return this.readonly?Promise.reject("not allowed in read-only mode"):(o=await this.sqlite.executeSet({database:this.dbName,set:n,transaction:e,readonly:!1,returnMode:s,isSQL92:t}),o.changes=await this.reorderRows(o.changes),Promise.resolve(o))}catch(i){return Promise.reject(i)}}async isExists(){try{const n=await this.sqlite.isDBExists({database:this.dbName,readonly:this.readonly});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async isTable(n){try{const e=await this.sqlite.isTableExists({database:this.dbName,table:n,readonly:this.readonly});return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async isDBOpen(){try{const n=await this.sqlite.isDBOpen({database:this.dbName,readonly:this.readonly});return Promise.resolve(n)}catch(n){return Promise.reject(n)}}async delete(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(await this.sqlite.deleteDatabase({database:this.dbName,readonly:!1}),Promise.resolve())}catch(n){return Promise.reject(n)}}async createSyncTable(){try{if(this.readonly)return Promise.reject("not allowed in read-only mode");{const n=await this.sqlite.createSyncTable({database:this.dbName,readonly:!1});return Promise.resolve(n)}}catch(n){return Promise.reject(n)}}async setSyncDate(n){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(await this.sqlite.setSyncDate({database:this.dbName,syncdate:n,readonly:!1}),Promise.resolve())}catch(e){return Promise.reject(e)}}async getSyncDate(){try{const n=await this.sqlite.getSyncDate({database:this.dbName,readonly:this.readonly});let e="";return n.syncDate>0&&(e=new Date(n.syncDate*1e3).toISOString()),Promise.resolve(e)}catch(n){return Promise.reject(n)}}async exportToJson(n,e=!1){try{const s=await this.sqlite.exportToJson({database:this.dbName,jsonexportmode:n,readonly:this.readonly,encrypted:e});return Promise.resolve(s)}catch(s){return Promise.reject(s)}}async deleteExportedRows(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(await this.sqlite.deleteExportedRows({database:this.dbName,readonly:!1}),Promise.resolve())}catch(n){return Promise.reject(n)}}async executeTransaction(n,e=!0){let s=0,t=!1;if(this.readonly)return Promise.reject("not allowed in read-only mode");if(await this.sqlite.beginTransaction({database:this.dbName}),t=await this.sqlite.isTransactionActive({database:this.dbName}),!t)return Promise.reject("After Begin Transaction, no transaction active");try{for(const a of n){if(typeof a!="object"||!("statement"in a))throw new Error("Error a task.statement must be provided");if("values"in a&&a.values&&a.values.length>0){const r=a.statement.toUpperCase().includes("RETURNING")?"all":"no",l=await this.sqlite.run({database:this.dbName,statement:a.statement,values:a.values,transaction:!1,readonly:!1,returnMode:r,isSQL92:e});if(l.changes.changes<0)throw new Error("Error in transaction method run ");s+=l.changes.changes}else{const r=await this.sqlite.execute({database:this.dbName,statements:a.statement,transaction:!1,readonly:!1});if(r.changes.changes<0)throw new Error("Error in transaction method execute ");s+=r.changes.changes}}s+=(await this.sqlite.commitTransaction({database:this.dbName})).changes.changes;const i={changes:{changes:s}};return Promise.resolve(i)}catch(o){const i=o.message?o.message:o;return await this.sqlite.rollbackTransaction({database:this.dbName}),Promise.reject(i)}}async reorderRows(n){const e=n;if(n?.values&&typeof n.values[0]=="object"&&Object.keys(n.values[0]).includes("ios_columns")){const s=n.values[0].ios_columns,t=[];for(let o=1;o<n.values.length;o++){const i=n.values[o],a={};for(const r of s)a[r]=i[r];t.push(a)}e.values=t}return Promise.resolve(e)}},En=hs("CapacitorSQLite",{web:()=>Promise.resolve().then(()=>gn()).then(n=>new n.CapacitorSQLiteWeb),electron:()=>window.CapacitorCustomPlatform.plugins.CapacitorSQLite});class Rn{constructor(){this.sqlite=new Sn(En),this.dbConnection=null,this.DB_NAME="salesforceOfflineDB",this.DB_VERSION=1,this.isInitialized=!1,this.initPromise=null}getTableSchemas(){return{metadata_cache:`
                CREATE TABLE IF NOT EXISTS metadata_cache (
                    id TEXT PRIMARY KEY,
                    object_api_name TEXT NOT NULL,
                    encrypted_data TEXT,
                    cached_at TEXT,
                    user_cache_id TEXT,
                    record_count INTEGER DEFAULT 0,
                    has_enhanced_schema INTEGER DEFAULT 0,
                    mobile_simple INTEGER DEFAULT 0,
                    mobile_complete INTEGER DEFAULT 0,
                    lookup_options TEXT,
                    picklist_options TEXT,
                    field_types TEXT,
                    field_records TEXT,
                    controlling_records TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,tabs:`
                CREATE TABLE IF NOT EXISTS tabs (
                    id TEXT PRIMARY KEY,
                    objectApiName TEXT NOT NULL,
                    label TEXT NOT NULL,
                    sortOrder INTEGER NOT NULL,
                    component TEXT NOT NULL,
                    parentId TEXT NULL,
                    propsJson TEXT NULL,
                    isActive INTEGER NOT NULL DEFAULT 1,
                    iconName TEXT NULL,
                    keepAlive INTEGER NULL DEFAULT 0,
                    prefetch INTEGER NULL DEFAULT 0,
                    isAttachment INTEGER NULL DEFAULT 0,
                    listViewObject TEXT NULL,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,metadata_version:`
                CREATE TABLE IF NOT EXISTS metadata_version (
                    name TEXT PRIMARY KEY,
                    version INTEGER NOT NULL,
                    last_updated DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,safety_events:`
                CREATE TABLE IF NOT EXISTS safety_events (
                    id TEXT PRIMARY KEY,
                    object_type TEXT NOT NULL,
                    encrypted_data TEXT,
                    sync_status TEXT DEFAULT 'pending',
                    created_at TEXT,
                    attempts INTEGER DEFAULT 0,
                    last_attempt TEXT,
                    last_error TEXT,
                    created_offline INTEGER DEFAULT 1,
                    created_date DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,pending_operations:`
                CREATE TABLE IF NOT EXISTS pending_operations (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    operation_id TEXT UNIQUE,
                    type TEXT NOT NULL,
                    object_type TEXT,
                    timestamp INTEGER,
                    data TEXT,
                    attempts INTEGER DEFAULT 0,
                    last_attempt TEXT,
                    status TEXT DEFAULT 'pending',
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,file_uploads:`
                CREATE TABLE IF NOT EXISTS file_uploads (
                    id TEXT PRIMARY KEY,
                    form_type TEXT,
                    record_id TEXT,
                    form_temp_id TEXT,
                    file_name TEXT,
                    file_path TEXT,
                    file_size INTEGER,
                    mime_type TEXT,
                    upload_status TEXT DEFAULT 'pending',
                    folder_path TEXT,
                    s3_key TEXT,
                    s3_url TEXT,
                    retry_attempts INTEGER DEFAULT 0,
                    last_error TEXT,
                    related_record_id TEXT,
                    description TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,lookup_values:`
                CREATE TABLE IF NOT EXISTS lookup_values (
                    id TEXT PRIMARY KEY,
                    object_api_name TEXT NOT NULL,
                    field_api_name TEXT NOT NULL,
                    lookup_options TEXT,
                    cached_at TEXT,
                    user_cache_id TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,left_menu:`
                CREATE TABLE IF NOT EXISTS left_menu (
                    id TEXT PRIMARY KEY,
                    menu_items TEXT,
                    cached_at TEXT,
                    user_cache_id TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,fields_config:`
                CREATE TABLE IF NOT EXISTS fields_config (
                    id TEXT PRIMARY KEY,
                    object_api_name TEXT NOT NULL,
                    field_configs TEXT,
                    cached_at TEXT,
                    user_cache_id TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,list_view_records:`
                CREATE TABLE IF NOT EXISTS list_view_records (
                    id TEXT PRIMARY KEY,
                    object_api_name TEXT NOT NULL,
                    records TEXT,
                    cached_at TEXT,
                    user_cache_id TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,aws_s3_list:`
                CREATE TABLE IF NOT EXISTS aws_s3_list (
                    id TEXT PRIMARY KEY,
                    object_api_name TEXT NOT NULL,
                    records TEXT,
                    cached_at TEXT,
                    user_cache_id TEXT,
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,accounts:`
                CREATE TABLE IF NOT EXISTS accounts (
                    id TEXT PRIMARY KEY,
                    name TEXT,
                    data TEXT,
                    sync_status TEXT DEFAULT 'synced',
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `,contacts:`
                CREATE TABLE IF NOT EXISTS contacts (
                    id TEXT PRIMARY KEY,
                    name TEXT,
                    email TEXT,
                    data TEXT,
                    sync_status TEXT DEFAULT 'synced',
                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
                );
            `}}async init(){return this.isInitialized?this.dbConnection:this.initPromise?this.initPromise:(this.initPromise=this._performInit(),this.initPromise)}async _performInit(){try{console.log("\u{1F527} Initializing SQLite database...");const e=this.getPlatform();return console.log("\u{1F4F1} Platform detected:",e),e==="web"&&(console.log("\u{1F310} Initializing web SQLite store..."),await this.sqlite.initWebStore()),(await this.sqlite.checkConnectionsConsistency()).result?this.dbConnection=await this.sqlite.retrieveConnection(this.DB_NAME,!1):this.dbConnection=await this.sqlite.createConnection(this.DB_NAME,!1,"no-encryption",this.DB_VERSION,!1),await this.dbConnection.open(),console.log("\u2705 SQLite database opened successfully"),await this.createTables(),this.isInitialized=!0,console.log("\u2705 SQLite service initialized successfully"),this.dbConnection}catch(e){throw console.error("\u274C Failed to initialize SQLite:",e),this.isInitialized=!1,this.initPromise=null,e}}async createTables(){try{console.log("\u{1F4CB} Creating SQLite tables...");const e=this.getTableSchemas();for(const[s,t]of Object.entries(e))await this.dbConnection.execute(t),console.log(`\u2705 Table created: ${s}`);await this.createIndexes(),console.log("\u2705 All tables and indexes created successfully")}catch(e){throw console.error("\u274C Failed to create tables:",e),e}}async createIndexes(){try{console.log("\u{1F4CB} Creating SQLite indexes...");const e=["CREATE INDEX IF NOT EXISTS idx_lookup_object_field ON lookup_values (object_api_name, field_api_name)","CREATE INDEX IF NOT EXISTS idx_metadata_object ON metadata_cache (object_api_name)","CREATE INDEX IF NOT EXISTS idx_safety_events_sync ON safety_events (sync_status)","CREATE INDEX IF NOT EXISTS idx_pending_operations_status ON pending_operations (status, type)","CREATE INDEX IF NOT EXISTS idx_fields_config_object ON fields_config (object_api_name)","CREATE INDEX IF NOT EXISTS idx_list_view_records_object ON list_view_records (object_api_name)","CREATE INDEX IF NOT EXISTS idx_aws_s3_list_object ON aws_s3_list (object_api_name)","CREATE INDEX IF NOT EXISTS idx_tabs_object ON tabs (objectApiName)","CREATE INDEX IF NOT EXISTS idx_tabs_parent ON tabs (parentId)","CREATE INDEX IF NOT EXISTS idx_tabs_active ON tabs (isActive)"];for(const s of e)await this.dbConnection.execute(s),console.log(`\u2705 Index created: ${s.split(" ")[5]}`);console.log("\u2705 All indexes created successfully")}catch(e){console.error("\u274C Failed to create indexes:",e)}}getPlatform(){return window.Capacitor?window.Capacitor.getPlatform():"web"}async saveItem(e,s){try{await this.init();const o=this.getTableMapping()[e]||e.toLowerCase();return o==="metadata_cache"?this.saveMetadataItem(s):o==="safety_events"?this.saveSafetyEventItem(s):o==="pending_operations"?this.savePendingOperationItem(s):o==="file_uploads"?this.saveFileUploadItem(s):o==="lookup_values"?this.saveLookupValueItem(s):o==="left_menu"?this.saveLeftMenuItem(s):o==="fields_config"?this.saveFieldsConfigItem(s):o==="list_view_records"?this.saveListViewRecordsItem(s):o==="aws_s3_list"?this.saveAwsS3ListItem(s):this.saveGenericItem(o,s)}catch(t){throw console.error(`\u274C Failed to save item to ${e}:`,t),t}}async saveMetadataItem(e){const s=`
            INSERT OR REPLACE INTO metadata_cache (
                id, object_api_name, encrypted_data, cached_at, user_cache_id,
                record_count, has_enhanced_schema, mobile_simple, mobile_complete,
                lookup_options, picklist_options, field_types, field_records,
                controlling_records, updated_at
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
        `,t=[e.id,e.objectApiName||"",JSON.stringify(e.encryptedData||""),e.cachedAt||new Date().toISOString(),e.userCacheId||"",e.recordCount||0,e.hasEnhancedSchema?1:0,e.mobile_simple?1:0,e.mobile_complete?1:0,JSON.stringify(e.lookupOptions||{}),JSON.stringify(e.picklistOptions||{}),JSON.stringify(e.fieldTypes||{}),JSON.stringify(e.fieldRecords||[]),JSON.stringify(e.controllingRecords||[])];return await this.dbConnection.run(s,t),console.log(`\u{1F4E6} Saved metadata item: ${e.id}`),e}async saveSafetyEventItem(e){const s=`
            INSERT OR REPLACE INTO safety_events (
                id, object_type, encrypted_data, sync_status, created_at,
                attempts, last_attempt, last_error, created_offline
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
        `,t=[e.id,e.objectType||"",JSON.stringify(e.encryptedData||""),e.syncStatus||"pending",e.createdAt||new Date().toISOString(),e.attempts||0,e.lastAttempt||null,e.lastError||null,1];return await this.dbConnection.run(s,t),console.log(`\u{1F4BE} Saved safety event: ${e.id}`),e}async savePendingOperationItem(e){const s=`
            INSERT OR REPLACE INTO pending_operations (
                operation_id, type, object_type, timestamp, data,
                attempts, last_attempt, status
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        `,t=[e.id||e.operation_id,e.type,e.objectType||"",e.timestamp||Date.now(),JSON.stringify(e.data||{}),e.attempts||0,e.lastAttempt||null,e.status||"pending"],o=await this.dbConnection.run(s,t);return console.log(`\u{1F4CB} Saved pending operation: ${e.id||e.operation_id}`),{...e,dbId:o.changes?.lastId||null}}async saveFileUploadItem(e){console.log("\u{1F4C1} Saving file upload item:",JSON.stringify(e));const s=`
            INSERT OR REPLACE INTO file_uploads (
                id, form_type, record_id, form_temp_id, file_name,
                file_path, file_size, mime_type, upload_status,
                folder_path, s3_key, s3_url, retry_attempts, last_error, related_record_id, description, updated_at
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
        `,t=[e.id,e.formType||"",e.recordId||"",e.formTempId||"",e.fileName||"",e.filePath||"",e.fileSize||0,e.mimeType||"",e.uploadStatus||"pending",e.folderPath||"",e.s3Key||"",e.s3Url||"",e.retryAttempts||0,e.lastError||"",e.relatedRecordId||"",e.description||""];return await this.dbConnection.run(s,t),console.log(`\u{1F4C1} Saved file upload: ${e.id}`,{fileName:e.fileName,formType:e.formType,recordId:e.recordId,formTempId:e.formTempId,uploadStatus:e.uploadStatus,filePath:e.filePath}),e}async saveFileWithPath(e){console.log("\u{1F4C1} Saving file with enhanced path management:",JSON.stringify(e));const s={id:e.id||this.generateId(),formType:e.formType||"general",recordId:e.recordId||null,formTempId:e.formTempId||null,fileName:e.name||e.fileName,filePath:e.webPath||e.path||e.filePath,fileSize:e.size||0,mimeType:e.type||e.mimeType||"application/octet-stream",uploadStatus:"pending",folderPath:e.folderPath||(e.formType?`${e.formType}/${e.recordId||"temp"}`:"general"),s3Key:null,description:e.description||""};console.log("\u{1F4C1} Saving file with enhanced path management:",JSON.stringify(s));const t=await this.saveFileUploadItem(s);return console.log("\u{1F4C1} File saved successfully to SQLite:",t.id),t}async getPendingFileUploads(){const e=`
            SELECT * FROM file_uploads 
            WHERE upload_status = 'pending'
            ORDER BY created_at ASC
        `,s=await this.dbConnection.query(e);if(console.log(`\u{1F4C1} Found ${s.values?.length||0} pending file uploads`),s.values&&s.values.length>0)console.log("\u{1F4C1} Pending files details:",s.values.map(t=>({id:t.id,fileName:t.file_name,formType:t.form_type,recordId:t.record_id,formTempId:t.form_temp_id,uploadStatus:t.upload_status,filePath:t.file_path,description:t.description})));else{const t="SELECT COUNT(*) as total FROM file_uploads",o=await this.dbConnection.query(t);console.log("\u{1F4C1} Total files in database:",o.values?.[0]?.total||0);const i="SELECT upload_status, COUNT(*) as count FROM file_uploads GROUP BY upload_status",a=await this.dbConnection.query(i);console.log("\u{1F4C1} Files by status:",a.values)}return s.values||[]}async getFileUploadsByStatus(e){const s=`
            SELECT * FROM file_uploads 
            WHERE upload_status = ? 
            ORDER BY created_at DESC
        `;return(await this.dbConnection.query(s,[e])).values||[]}async getFileUploadsByRecord(e,s){const t=`
            SELECT * FROM file_uploads 
            WHERE form_type = ? AND record_id = ? AND upload_status != 'deleted'
            ORDER BY created_at DESC
        `;return(await this.dbConnection.query(t,[e,s])).values||[]}async updateFileUploadStatus(e,s,t=null,o=null,i=null,a=null){const r=`
            UPDATE file_uploads 
            SET upload_status = ?, s3_key = ?, s3_url = ?, 
                retry_attempts = COALESCE(?, retry_attempts),
                last_error = COALESCE(?, last_error),
                updated_at = CURRENT_TIMESTAMP
            WHERE id = ?
        `,l=[s,t,o,i,a,e];return await this.dbConnection.run(r,l),console.log(`\u{1F4C1} Updated file upload status: ${e} -> ${s}`),this.getFileUploadById(e)}async getFileUploadById(e){const s="SELECT * FROM file_uploads WHERE id = ?";return(await this.dbConnection.query(s,[e])).values?.[0]||null}async updateFileRecordId(e,s,t){const o=`
            UPDATE file_uploads 
            SET record_id = ?, folder_path = ?, updated_at = CURRENT_TIMESTAMP
            WHERE form_type = ? AND form_temp_id = ?
        `,i=`${e}/${t}`,a=[t,i,e,s],r=await this.dbConnection.run(o,a);return console.log(`\u{1F4C1} Updated file record IDs for ${e}/${s} -> ${t}`),r}async cleanupOldFiles(e=30){const s=new Date;s.setDate(s.getDate()-e);const t=`
            DELETE FROM file_uploads 
            WHERE upload_status = 'uploaded' 
            AND updated_at < ?
        `,o=await this.dbConnection.run(t,[s.toISOString()]);return console.log(`\u{1F4C1} Cleaned up old uploaded files older than ${e} days`),o}async getFileUploadStats(){const e=`
            SELECT 
                upload_status,
                COUNT(*) as count,
                SUM(file_size) as total_size
            FROM file_uploads 
            GROUP BY upload_status
        `,s=await this.dbConnection.query(e),t={};return(s.values||[]).forEach(o=>{t[o.upload_status]={count:o.count,totalSize:o.total_size||0}}),t}generateId(){return"file_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async getAllFileUploads(){const e="SELECT * FROM file_uploads ORDER BY created_at DESC";return(await this.dbConnection.query(e)).values||[]}async saveLookupValueItem(e){const s=`
            INSERT OR REPLACE INTO lookup_values (
                id, object_api_name, field_api_name, lookup_options,
                cached_at, user_cache_id
            ) VALUES (?, ?, ?, ?, ?, ?)
        `,t=[e.id,e.objectApiName||"",e.fieldApiName||"",JSON.stringify(e.lookupOptions||[]),e.cachedAt||new Date().toISOString(),e.userCacheId||""];return await this.dbConnection.run(s,t),console.log(`\u{1F517} Saved lookup values: ${e.id}`),e}async saveLeftMenuItem(e){const s=`
            INSERT OR REPLACE INTO left_menu (
                id, menu_items, cached_at, user_cache_id, updated_at
            ) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP)
        `,t=[e.id,JSON.stringify(e.menuItems||[]),e.cachedAt||new Date().toISOString(),e.userCacheId||""];return await this.dbConnection.run(s,t),console.log(`\u{1F4CB} Saved left menu item: ${e.id}`),e}async saveFieldsConfigItem(e){const s=`
            INSERT OR REPLACE INTO fields_config (
                id, object_api_name, field_configs, cached_at, user_cache_id, updated_at
            ) VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
        `,t=[e.id,e.objectApiName||"",JSON.stringify(e.fieldConfigs||[]),e.cachedAt||new Date().toISOString(),e.userCacheId||""];return await this.dbConnection.run(s,t),console.log(`\u{1F4CB} Saved fields config: ${e.id} for ${e.objectApiName}`),e}async saveListViewRecordsItem(e){const s=`
            INSERT OR REPLACE INTO list_view_records (
                id, object_api_name, records, cached_at, user_cache_id, updated_at
            ) VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
        `,t=[e.id,e.objectApiName||"",JSON.stringify(e.records||[]),e.cachedAt||new Date().toISOString(),e.userCacheId||""];return await this.dbConnection.run(s,t),console.log(`\u{1F4CB} Saved list view records: ${e.id} for ${e.objectApiName}`),e}async saveAwsS3ListItem(e){const s=`
            INSERT OR REPLACE INTO aws_s3_list (
                id, object_api_name, records, cached_at, user_cache_id, updated_at
            ) VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
        `,t=[e.id,e.objectApiName||"",JSON.stringify(e.records||[]),e.cachedAt||new Date().toISOString(),e.userCacheId||""];return await this.dbConnection.run(s,t),console.log(`\u{1F4CB} Saved AWS S3 list: ${e.id} for ${e.objectApiName}`),e}async saveGenericItem(e,s){const t=`
            INSERT OR REPLACE INTO ${e} (
                id, name, data, sync_status
            ) VALUES (?, ?, ?, ?)
        `,o=[s.id,s.name||s.title||s.description||"",JSON.stringify(s),s.syncStatus||"pending"];return await this.dbConnection.run(t,o),console.log(`\u{1F4BE} Saved generic item to ${e}: ${s.id}`),s}async getAllItems(e){try{await this.init();const t=this.getTableMapping()[e]||e.toLowerCase(),o=`SELECT * FROM ${t} ORDER BY created_at DESC`,i=await this.dbConnection.query(o);return i.values?i.values.map(a=>this.transformRowToObject(t,a)):[]}catch(s){return console.error(`\u274C Failed to get all items from ${e}:`,s),[]}}async getById(e,s){try{await this.init();const o=this.getTableMapping()[e]||e.toLowerCase(),i=`SELECT * FROM ${o} WHERE id = ?`,a=await this.dbConnection.query(i,[s]);if(!a.values||a.values.length===0)throw new Error(`Item with id ${s} not found in ${e}`);return this.transformRowToObject(o,a.values[0])}catch(t){throw console.error(`\u274C Failed to get item ${s} from ${e}:`,t),t}}async deleteItem(e,s){try{await this.init();const i=`DELETE FROM ${this.getTableMapping()[e]||e.toLowerCase()} WHERE id = ?`;return await this.dbConnection.run(i,[s]),console.log(`\u{1F5D1}\uFE0F Deleted item ${s} from ${e}`),{success:!0,id:s}}catch(t){throw console.error(`\u274C Failed to delete item ${s} from ${e}:`,t),t}}async saveItems(e,s){try{await this.init();const t=[];for(const o of s){const i=await this.saveItem(e,o);t.push(i)}return console.log(`\u{1F4E6} Saved ${s.length} items to ${e}`),t}catch(t){throw console.error(`\u274C Failed to save items to ${e}:`,t),t}}async getPendingOperations(){try{await this.init();const e="SELECT * FROM pending_operations WHERE status = 'pending' ORDER BY timestamp ASC",s=await this.dbConnection.query(e);return s.values?s.values.map(t=>({id:t.operation_id,dbId:t.id,type:t.type,objectType:t.object_type,timestamp:t.timestamp,data:JSON.parse(t.data||"{}"),attempts:t.attempts||0,lastAttempt:t.last_attempt,status:t.status})):[]}catch(e){return console.error("\u274C Failed to get pending operations:",e),[]}}async deletePendingOperation(e){try{await this.init();const s="DELETE FROM pending_operations WHERE operation_id = ?";return await this.dbConnection.run(s,[e]),console.log(`\u{1F5D1}\uFE0F Deleted pending operation: ${e}`),{success:!0,id:e}}catch(s){throw console.error(`\u274C Failed to delete pending operation ${e}:`,s),s}}async addPendingOperation(e){const s={...e,timestamp:e.timestamp||Date.now(),status:"pending"};return this.savePendingOperationItem(s)}async clearPendingOperations(){try{await this.init();const e="DELETE FROM pending_operations";await this.dbConnection.run(e),console.log("\u{1F5D1}\uFE0F Cleared all pending operations")}catch(e){throw console.error("\u274C Failed to clear pending operations:",e),e}}transformRowToObject(e,s){try{if(e==="metadata_cache")return{id:s.id,objectApiName:s.object_api_name,encryptedData:JSON.parse(s.encrypted_data||'""'),cachedAt:s.cached_at,userCacheId:s.user_cache_id,recordCount:s.record_count,hasEnhancedSchema:s.has_enhanced_schema===1,mobile_simple:s.mobile_simple===1,mobile_complete:s.mobile_complete===1,lookupOptions:JSON.parse(s.lookup_options||"{}"),picklistOptions:JSON.parse(s.picklist_options||"{}"),fieldTypes:JSON.parse(s.field_types||"{}"),fieldRecords:JSON.parse(s.field_records||"[]"),controllingRecords:JSON.parse(s.controlling_records||"[]")};if(e==="safety_events")return{id:s.id,objectType:s.object_type,encryptedData:JSON.parse(s.encrypted_data||'""'),syncStatus:s.sync_status,createdAt:s.created_at,attempts:s.attempts,lastAttempt:s.last_attempt,lastError:s.last_error};if(e==="file_uploads")return{id:s.id,formType:s.form_type,recordId:s.record_id,formTempId:s.form_temp_id,fileName:s.file_name,filePath:s.file_path,fileSize:s.file_size,mimeType:s.mime_type,uploadStatus:s.upload_status,folderPath:s.folder_path,s3Key:s.s3_key,s3_url:s.s3_url,relatedRecordId:s.related_record_id,description:s.description};if(e==="lookup_values")return{id:s.id,objectApiName:s.object_api_name,fieldApiName:s.field_api_name,lookupOptions:JSON.parse(s.lookup_options||"[]"),cachedAt:s.cached_at,userCacheId:s.user_cache_id};if(e==="left_menu")return{id:s.id,menuItems:JSON.parse(s.menu_items||"[]"),cachedAt:s.cached_at,userCacheId:s.user_cache_id};if(e==="fields_config")return{id:s.id,objectApiName:s.object_api_name,fieldConfigs:JSON.parse(s.field_configs||"[]"),cachedAt:s.cached_at,userCacheId:s.user_cache_id};if(e==="list_view_records")return{id:s.id,objectApiName:s.object_api_name,records:JSON.parse(s.records||"[]"),cachedAt:s.cached_at,userCacheId:s.user_cache_id};if(e==="aws_s3_list")return{id:s.id,objectApiName:s.object_api_name,records:JSON.parse(s.records||"[]"),cachedAt:s.cached_at,userCacheId:s.user_cache_id};if(e==="tabs")return{id:s.id,objectApiName:s.objectApiName,label:s.label,sortOrder:s.sortOrder,component:s.component,parentId:s.parentId,propsJson:s.propsJson?JSON.parse(s.propsJson):null,isActive:s.isActive===1,iconName:s.iconName,keepAlive:s.keepAlive===1,prefetch:s.prefetch===1};if(e==="metadata_version")return{name:s.name,version:s.version,lastUpdated:s.last_updated};{const t=JSON.parse(s.data||"{}");return{id:s.id,name:s.name,syncStatus:s.sync_status,...t}}}catch(t){return console.error("\u274C Failed to transform row:",t),s}}getTableMapping(){return{METADATA_CACHE:"metadata_cache",accounts:"accounts",contacts:"contacts",LOOKUP_VALUES:"lookup_values",pendingOperations:"pending_operations",fileUploads:"file_uploads",safetyEvents:"safety_events",LEFT_MENU:"left_menu",FIELDS_CONFIG:"fields_config",LIST_VIEW_RECORDS:"list_view_records",AWS_S3_LIST:"aws_s3_list",tabs:"tabs",TABS:"tabs",metadata_version:"metadata_version",METADATA_VERSION:"metadata_version"}}async close(){try{this.dbConnection&&(await this.dbConnection.close(),this.dbConnection=null,this.isInitialized=!1,console.log("\u2705 SQLite database closed"))}catch(e){console.error("\u274C Failed to close SQLite database:",e)}}async getStats(){try{await this.init();const e=Object.keys(this.getTableMapping()),s={};for(const t of e)try{const i=`SELECT COUNT(*) as count FROM ${this.getTableMapping()[t]||t.toLowerCase()}`,a=await this.dbConnection.query(i);s[t]=a.values[0]?.count||0}catch(o){s[t]=0}return s}catch(e){return console.error("\u274C Failed to get database stats:",e),{}}}}const U=new Rn,ps={ACCOUNTS:"accounts",CONTACTS:"contacts",LOOKUP_VALUES:"LOOKUP_VALUES",PENDING_OPERATIONS:"pendingOperations",FILE_UPLOADS:"fileUploads",SAFETY_EVENTS:"safetyEvents",METADATA_CACHE:"METADATA_CACHE",LEFT_MENU:"LEFT_MENU",FIELDS_CONFIG:"FIELDS_CONFIG",LIST_VIEW_RECORDS:"LIST_VIEW_RECORDS",TABS:"tabs",METADATA_VERSION:"metadata_version",AWS_S3_LIST:"aws_s3_list"},lo=3;class An{constructor(){this.isSyncing=!1,this.syncQueue=[],this.retryQueue=[]}initAutoSync(){console.log("\u{1F680} Initializing enhanced file upload auto-sync..."),typeof window!="undefined"&&window.addEventListener("online",()=>{console.log("\u{1F310} Device came online - triggering file sync"),this.syncPendingFiles().catch(e=>{console.error("\u274C Online sync error:",e)})}),console.log("\u2705 Enhanced file upload auto-sync initialized")}stopAutoSync(){console.log("\u{1F6D1} File upload auto-sync stopped")}async syncPendingFiles(){try{if(!(await X.getStatus())?.connected)return console.log("\u{1F4F4} Capacitor reports offline, aborting file upload sync"),{success:!1,reason:"offline"}}catch(e){if(!V())return console.log("\u{1F4F4} Offline (fallback), aborting file upload sync"),{success:!1,reason:"offline"}}if(!V())return console.log("\u{1F4F4} Offline, skipping file upload sync"),{success:!1,reason:"offline"};if(this.isSyncing)return console.log("\u{1F504} File sync already in progress, skipping"),{success:!1,reason:"already_syncing"};this.isSyncing=!0,console.log("\u{1F680} Starting enhanced file upload sync...");try{const e=await U.getPendingFileUploads();if(e.length===0)return console.log("\u2705 No pending file uploads found"),{success:!0,uploaded:0};console.log(`\u{1F4C1} Found ${e.length} pending file uploads`);let s=0,t=0;const o=[];for(const a of e)try{console.log(`\u{1F4E4} Processing file upload: ${a.file_name}`),console.log("fileRecord",JSON.stringify(a)),await U.updateFileUploadStatus(a.id,"uploading"),this.dispatchFileUploadEvent("fileUploadProgress",{fileId:a.id,fileName:a.file_name,status:"uploading"});const r={id:a.id,name:a.file_name,webPath:a.file_path,type:a.mime_type,size:a.file_size,formType:a.form_type,recordId:a.record_id,folderPath:a.folder_path,description:a.description},l=await this.uploadWithRetry(r);l.success?(await U.updateFileUploadStatus(a.id,"uploaded",l.s3Key,l.s3Url),await this.removePendingOperation(a.id),s++,console.log(`\u2705 Successfully uploaded: ${a.file_name} -> ${l.s3Key}`),this.dispatchFileUploadEvent("fileUploadSuccess",{fileId:a.id,fileName:a.file_name,s3Key:l.s3Key,s3Url:l.s3Url}),o.push({fileId:a.id,fileName:a.file_name,status:"success",s3Key:l.s3Key,s3Url:l.s3Url})):l.reason==="offline"?(await U.updateFileUploadStatus(a.id,"pending",null,null,null,"Deferred while offline"),console.log(`\u23F8\uFE0F Deferred upload while offline: ${a.file_name}`),o.push({fileId:a.id,fileName:a.file_name,status:"deferred",reason:"offline"})):(await U.updateFileUploadStatus(a.id,"failed",null,null,null,l.error),t++,console.error(`\u274C Failed to upload: ${a.file_name} - ${l.error}`),this.dispatchFileUploadEvent("fileUploadError",{fileId:a.id,fileName:a.file_name,error:l.error}),o.push({fileId:a.id,fileName:a.file_name,status:"failed",error:l.error}))}catch(r){console.error(`\u274C Error processing file ${a.file_name}:`,r),await U.updateFileUploadStatus(a.id,"failed",null,null,null,r.message),t++,this.dispatchFileUploadEvent("fileUploadError",{fileId:a.id,fileName:a.file_name,error:r.message}),o.push({fileId:a.id,fileName:a.file_name,status:"failed",error:r.message})}const i={success:!0,total:e.length,uploaded:s,failed:t,results:o};return console.log("\u{1F3AF} File sync completed:",i),this.dispatchFileUploadEvent("fileUploadSyncComplete",i),i}catch(e){return console.error("\u274C Fatal error during file sync:",e),this.dispatchFileUploadEvent("fileUploadSyncError",{error:e.message}),{success:!1,error:e.message}}finally{this.isSyncing=!1}}async uploadWithRetry(e,s=1){try{console.log(`\u{1F4E4} Upload attempt ${s} for: ${e.webPath}`),console.log("fileRecord in line 294",JSON.stringify(e));const t=await It(e);if(t.success)return console.log(`\u2705 Successfully uploaded: ${e.name}`),console.log(`\u{1F517} S3 URL: ${t.s3Url}`),{success:!0,s3Key:t.s3Key,s3Url:t.s3Url};if(t.reason==="offline")return{success:!1,reason:"offline"};throw new Error(t.error||"Unknown upload error")}catch(t){return console.warn(`\u26A0\uFE0F Upload attempt ${s} failed for ${e.name}:`,t.message),s<lo&&V()?(console.log(`\u23F3 Retrying upload for ${e.name} (attempt ${s+1})`),this.uploadWithRetry(e,s+1)):V()?(console.error(`\u274C Max retry attempts reached for: ${e.name}`),{success:!1,error:`Upload failed after ${lo} attempts: ${t.message}`}):{success:!1,reason:"offline"}}}async removePendingOperation(e){try{const t=(await jt()).find(o=>o.id===e&&o.type==="UPLOAD_FILE");t&&(await Ut(t.id),console.log(`\u{1F4DD} Removed pending operation for file: ${e}`))}catch(s){console.warn(`\u26A0\uFE0F Failed to remove pending operation for ${e}:`,s)}}async getPendingFileUploads(){try{return(await U.getPendingFileUploads()).map(s=>({id:s.id,fileName:s.file_name,fileSize:s.file_size,fileType:s.mime_type,formType:s.form_type,uploadStatus:s.upload_status,recordId:s.record_id,s3Key:s.s3_key,createdDate:s.created_at,updatedDate:s.updated_at}))}catch(e){return console.error("\u274C Error getting pending file uploads:",e),[]}}async getUploadStats(){try{return await U.getFileUploadStats()}catch(e){return console.error("\u274C Error getting upload stats:",e),{}}}async triggerManualSync(){return console.log("\u{1F504} Manual file upload sync triggered"),this.syncPendingFiles()}async syncFilesForRecord(e){if(!e)return console.error("\u274C Cannot sync files: No record ID provided"),{success:!1,error:"No record ID provided"};console.log(`\u{1F504} Syncing files for record ID: ${e}`);try{const s=await U.getPendingFileUploads();if(s.length===0)return console.log("\u2705 No pending file uploads found for sync"),{success:!0,uploaded:0};console.log(`\u{1F4C1} Found ${s.length} pending files to check for record ID`);let t=0;for(const o of s)if(!o.record_id||o.record_id===""){const i=o.form_type||"general",a={id:o.id,formType:i,recordId:e,fileName:o.file_name,filePath:o.file_path,fileSize:o.file_size,mimeType:o.mime_type,uploadStatus:o.upload_status,folderPath:`${i}/${e}`,s3Key:o.s3_key,s3Url:o.s3_url,retryAttempts:o.retry_attempts,lastError:o.last_error,description:o.description};await U.saveFileUploadItem(a),t++,console.log(`\u{1F4C1} Updated file ${o.id} with record ID: ${e}`)}return console.log(`\u{1F4C1} Updated ${t} files with record ID: ${e}`),t>0?this.syncPendingFiles():{success:!0,updated:t,uploaded:0}}catch(s){return console.error("\u274C Error syncing files for record:",s),{success:!1,error:s.message}}}isSyncInProgress(){return this.isSyncing}async cleanupOldFiles(e=30){try{console.log(`\u{1F9F9} Cleaning up uploaded files older than ${e} days`);const s=await U.cleanupOldFiles(e);return console.log("\u2705 Cleanup completed:",s),s}catch(s){return console.error("\u274C Error during cleanup:",s),null}}dispatchFileUploadEvent(e,s){try{const t=new CustomEvent(e,{detail:s,bubbles:!0,composed:!0});typeof window!="undefined"&&window.dispatchEvent&&window.dispatchEvent(t),console.log(`\u{1F4E1} Dispatched event: ${e}`,s)}catch(t){console.warn("\u26A0\uFE0F Failed to dispatch file upload event:",t)}}}const G=new An;typeof window!="undefined"&&(window.fileUploadSync=G,G.initAutoSync());function Pt(){return Date.now().toString()+Math.random().toString(36).substring(2,9)}const Z=ps;async function de(n){try{console.log(`\u{1F4F1} SQLite: Getting all items from ${n}`);const e=await U.getAllItems(n);return console.log(`\u{1F4F1} SQLite: Retrieved ${e.length} items from ${n}`),e}catch(e){return console.error(`\u274C SQLite: Failed to get all items from ${n}:`,e),[]}}async function re(n,e){try{console.log(`\u{1F4F1} SQLite: Saving item to ${n}:`,e.id);const s=await U.saveItem(n,e);return console.log(`\u{1F4F1} SQLite: Saved item to ${n}:`,s.id),s}catch(s){throw console.error(`\u274C SQLite: Failed to save item to ${n}:`,s),s}}async function fs(n,e){try{console.log(`\u{1F4F1} SQLite: Deleting item ${e} from ${n}`);const s=await U.deleteItem(n,e);return console.log(`\u{1F4F1} SQLite: Deleted item ${e} from ${n}`),s}catch(s){throw console.error(`\u274C SQLite: Failed to delete item ${e} from ${n}:`,s),s}}async function me(n){return de(n)}async function Ft(n){try{const e={...n,timestamp:n.timestamp||Date.now(),status:"pending"};console.log("\u{1F4F1} SQLite: Adding pending operation:",e.type);const s=await U.addPendingOperation(e);return console.log("\u{1F4F1} SQLite: Added pending operation:",e.type),s}catch(e){throw console.error("\u274C SQLite: Failed to add pending operation:",e),e}}async function jt(){try{console.log("\u{1F4F1} SQLite: Getting pending operations");const n=await U.getPendingOperations();return console.log(`\u{1F4F1} SQLite: Retrieved ${n.length} pending operations`),n}catch(n){return console.error("\u274C SQLite: Failed to get pending operations:",n),[]}}async function Ut(n){try{console.log(`\u{1F4F1} SQLite: Deleting pending operation: ${n}`);const e=await U.deletePendingOperation(n);return console.log(`\u{1F4F1} SQLite: Deleted pending operation: ${n}`),e}catch(e){throw console.error(`\u274C SQLite: Failed to delete pending operation ${n}:`,e),e}}X.getStatus().then(n=>n.connected);const co={ONLINE:"app_online",OFFLINE:"app_offline",STATUS_CHANGE:"connectivity_status_change"};async function V(){return(await X.getStatus()).connected}function ho(n){document.body.addEventListener(co.STATUS_CHANGE,e=>{n(e.detail.isOnline)})}function uo(n){document.body.removeEventListener(co.STATUS_CHANGE,n),window.offlineUtils={getPendingOperations:jt,deletePendingOperation:Ut,isOnline:V}}(async()=>{try{console.log("\u{1F680} Initializing SQLite service..."),await U.init(),console.log("\u2705 SQLite service initialized successfully")}catch(n){console.error("\u274C Failed to initialize SQLite service:",n)}})(),typeof window!="undefined"&&(window.fileUploadSync=G,console.log("\u{1F4C1} File upload sync service made globally available from utils"));const ie="METADATA_CACHE";class In{constructor(){this.CACHE_VERSION=1,this.LOOKUP_CACHE_VERSION=1}getUserSession(){const e=sessionStorage.getItem("sf_user_id"),s=sessionStorage.getItem("sf_instance_url");return!e||!s?null:btoa(`${e}:${s.replace(/[^a-zA-Z0-9]/g,"")}`)}async getDeviceFingerprint(){try{const e=document.createElement("canvas"),s=e.getContext("2d");s.textBaseline="top",s.font="14px Arial",s.fillText("Salesforce LWC Security",2,2);const t=[navigator.userAgent,navigator.language,window.screen.width+"x"+window.screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");return btoa(t).substring(0,64)}catch(e){return console.warn("\u26A0\uFE0F Device fingerprinting failed, using fallback"),btoa(navigator.userAgent+Date.now()).substring(0,64)}}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||!!window.Capacitor}async cacheCompleteMetadataForMobile(e,s,t,o){try{console.log(`\u{1F4F1} Mobile fallback: Caching complete metadata for ${e}`);const i={},a={},r={};o.forEach(d=>{const h=d.Rhythm__Field_Api_Name__c,u=d.Rhythm__is_New__c===!0||d.Rhythm__is_New__c==="true",f=d.Rhythm__is_Mobile__c===!0||d.Rhythm__is_Mobile__c==="true";if(!f){console.log(`\u{1F6AB} Skipping field ${h} - is_New: ${u}, is_Mobile: ${f}`);return}d._fieldType&&(r[h]={type:d._fieldType,required:d._required,label:d._label||d.MasterLabel}),d._lookupOptions&&d._lookupOptions.length>0&&(i[h]=d._lookupOptions,console.log(`\u{1F4F1} Cached ${d._lookupOptions.length} lookup options for ${h}`)),d._picklistOptions&&d._picklistOptions.length>0&&(a[h]=d._picklistOptions,console.log(`\u{1F4F1} Cached ${d._picklistOptions.length} picklist options for ${h}`))});const c={id:`mobile_complete_${e}`,objectApiName:e,fieldRecords:s||[],controllingRecords:t||[],lookupOptions:i,picklistOptions:a,fieldTypes:r,cachedAt:new Date().toISOString(),mobile_simple:!0,mobile_complete:!0};await re(ie,c),console.log(`\u{1F4F1} Mobile: Cached complete metadata with ${Object.keys(i).length} lookup fields, ${Object.keys(a).length} picklist fields`)}catch(i){console.error(`\u274C Mobile: Failed to cache complete metadata for ${e}:`,i)}}async getMobileCompleteMetadata(e){try{const s=`mobile_complete_${e}`,o=(await me(ie)).find(i=>i.id===s);return o&&o.mobile_complete?{fieldMetadata:o.fieldRecords.map(a=>{const r=a.Rhythm__Field_Api_Name__c,l=o.fieldTypes[r],c=o.lookupOptions[r]||[],d=o.picklistOptions[r]||[];return{...a,_fieldType:l?.type,_required:l?.required,_label:l?.label,_lookupOptions:c,_picklistOptions:d,_enhanced:!0,_mobile_enhanced:!0}}),controllingFields:o.controllingRecords||[],fromCache:!0,fromMobileCache:!0,cachedAt:o.cachedAt}:null}catch(s){return console.error(`\u274C Mobile: Failed to get complete metadata for ${e}:`,s),null}}async getMobileLookupOptions(e){try{const s=await this.getMobileCompleteMetadata(e);if(s){const a={};return s.fieldMetadata.forEach(r=>{r._lookupOptions&&r._lookupOptions.length>0&&(a[r.Rhythm__Field_Api_Name__c]=r._lookupOptions)}),a}const t=`mobile_lookup_${e}`,i=(await me(ie)).find(a=>a.id===t);return i&&i.mobile_simple?(console.log(`\u{1F4F1} Found mobile lookup cache for ${e}`),i.lookupOptions||{}):{}}catch(s){return console.error(`\u274C Mobile: Failed to get lookup options for ${e}:`,s),{}}}sanitizeMetadata(e){if(typeof e!="object"||e===null)throw new Error("Invalid metadata format");const s=JSON.parse(JSON.stringify(e)),t=o=>{if(typeof o=="string")return o.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim();if(Array.isArray(o))return o.map(t);if(typeof o=="object"&&o!==null){const i={};for(const[a,r]of Object.entries(o)){const l=a.replace(/[<>"/]/g,"");i[l]=t(r)}return i}return o};return t(s)}getMetadataCacheKey(e){return`metadata_${e}`}getControllingFieldsCacheKey(e){return`controlling_${e}`}getLookupCacheKey(e,s){return`lookup_${e}_${s}`}getUserCacheId(){try{return localStorage.getItem("device_cache_id")||(()=>{const s=`device_${Math.random().toString(36).slice(2)}`;return localStorage.setItem("device_cache_id",s),s})()}catch(e){return"device_default"}}async cacheFieldMetadata(e,s,t=null,o=null){try{console.log(`\u{1F4BE} Caching field metadata for ${e}:`,s.length,"records");const i={objectApiName:e,records:s,hasEnhancedSchema:!1,cachedAt:new Date().toISOString(),cacheVersion:this.CACHE_VERSION,userCacheId:this.getUserCacheId()},a={id:this.getMetadataCacheKey(e),objectApiName:e,encryptedData:"",cachedAt:i.cachedAt,userCacheId:i.userCacheId,recordCount:s.length,hasEnhancedSchema:!1,fieldRecords:s,fieldTypes:t||{},lookupOptions:o||{}};await re(ie,a),await re(ie,{id:this.getMetadataCacheKey(e)+"_bykey",key:this.getMetadataCacheKey(e),...a}),console.log(`\u2705 Cached ${s.length} field metadata records for ${e}`),this.isMobile()&&await this.cacheCompleteMetadataForMobile(e,s,[],s)}catch(i){console.error(`\u274C Failed to cache enhanced field metadata for ${e}:`,i)}}async enhanceMetadataWithSchema(e,s){const t=[];for(const o of e){const i=o.Rhythm__Field_Api_Name__c,a=s[i],r={...o,_enhanced:!!a,_enhancedAt:new Date().toISOString()};if(a){if(r._fieldType=a.type,r._required=a.nillable===!1,r._length=a.length,r._precision=a.precision,r._scale=a.scale,r._defaultValue=a.defaultValue,r._updateable=a.updateable,r._createable=a.createable,r._label=a.label,r._inlineHelpText=a.inlineHelpText||a.InlineHelpText,a.type==="reference"&&(r._referenceTo=a.referenceTo,r._relationshipName=a.relationshipName,a.referenceTo&&a.referenceTo.length>0)){const l=a.referenceTo[0];try{const c=await this.queryLookupOptions(l);r._lookupOptions=c}catch(c){r._lookupOptions=[]}}(a.type==="picklist"||a.type==="multipicklist")&&(r._picklistOptions=a.picklistValues.map(l=>({label:l.label,value:l.value,active:l.active,defaultValue:l.defaultValue})))}else r._error="Field not found in object schema";t.push(r)}return t}async queryLookupOptions(e){return os(e)}async cacheControllingFields(e,s){try{const t={objectApiName:e,records:s,cachedAt:new Date().toISOString(),cacheVersion:this.CACHE_VERSION,userCacheId:this.getUserCacheId()},o={id:this.getControllingFieldsCacheKey(e),objectApiName:e,encryptedData:"",cachedAt:t.cachedAt,userCacheId:t.userCacheId,recordCount:s.length,controllingRecords:s};await re(ie,o),await re(ie,{id:this.getControllingFieldsCacheKey(e)+"_bykey",key:this.getControllingFieldsCacheKey(e),...o})}catch(t){console.error(`\u274C Failed to cache controlling fields for ${e}:`,t)}}async getCachedFieldMetadata(e){try{const s=await me(ie),t=this.getMetadataCacheKey(e),o=s.find(a=>a.id===t);return o?{records:o.fieldRecords||[],cachedAt:o.cachedAt,cacheVersion:this.CACHE_VERSION}:null}catch(s){return null}}async getCachedControllingFields(e){try{const s=await me(ie),t=this.getControllingFieldsCacheKey(e),o=s.find(a=>a.id===t);return o?{records:o.controllingRecords||[],cachedAt:o.cachedAt,cacheVersion:this.CACHE_VERSION}:null}catch(s){return null}}async getCachedObjectSchema(e){try{const s=await me(ie),t=this.getMetadataCacheKey(e),o=s.find(i=>i.id===t);return o&&o.fieldTypes?o.fieldTypes:null}catch(s){return null}}async getCachedLookupOptions(e){try{const s=await me(ie),t=this.getMetadataCacheKey(e),o=s.find(i=>i.id===t);return o&&o.lookupOptions?o.lookupOptions:{}}catch(s){return{}}}async cacheObjectSchema(e,s){try{const t=`objectSchema_${e}`;await re(ie,{id:t,key:t,objectApiName:e,schemaData:JSON.stringify(s),cachedAt:new Date().toISOString(),userCacheId:this.getUserCacheId()}),await re(ie,{id:t+"_bykey",key:t,objectApiName:e,schemaData:JSON.stringify(s),cachedAt:new Date().toISOString(),userCacheId:this.getUserCacheId()})}catch(t){console.error(`\u274C Failed to cache object schema for ${e}:`,t)}}async cacheLookupOptions(e,s){try{const t=`lookupOptions_${e}`;await re(ie,{id:t,key:t,objectApiName:e,lookupData:JSON.stringify(s),cachedAt:new Date().toISOString(),userCacheId:this.getUserCacheId()}),await re(ie,{id:t+"_bykey",key:t,objectApiName:e,lookupData:JSON.stringify(s),cachedAt:new Date().toISOString(),userCacheId:this.getUserCacheId()})}catch(t){console.error(`\u274C Failed to cache lookup options for ${e}:`,t)}}async refreshMetadataCache(e){try{console.log(`\u{1F504} Refreshing metadata cache for ${e}`),console.log(`\u{1F50D} Executing field metadata query for ${e}`);const[s,t]=await Promise.all([Qa(e),Ya(e)]);console.log(`\u{1F4CA} Retrieved ${s.length} field metadata records`),console.log(`\u{1F4CA} Retrieved ${t.length} controlling field records`);const o=await vt(e),i={};o.fields.forEach(r=>{i[r.name]={type:r.type,label:r.label,nillable:r.nillable,defaultedOnCreate:r.defaultedOnCreate,length:r.length,precision:r.precision,scale:r.scale,referenceTo:r.referenceTo,relationshipName:r.relationshipName,picklistValues:(r.picklistValues||[]).map(l=>({label:l.label,value:l.value,active:l.active,defaultValue:l.defaultValue}))}}),console.log("schemaSnapshot in line 755",JSON.stringify(i));const a={};for(const r of o.fields)if(console.log("f in line 759",JSON.stringify(r)),r.type==="reference"&&r.referenceTo&&r.referenceTo.length>0){let l=r.referenceTo[0];e==="Task"&&(l=r.referenceTo[1]);try{const c=await os(l);console.log("lookupOptions in line 769",JSON.stringify(c)),a[r.name]=c}catch(c){}}return console.log("lookupOptionsMap in line 776",JSON.stringify(a)),console.log("schemaSnapshot in line 777",JSON.stringify(i)),console.log("fieldRecords in line 778",JSON.stringify(s)),console.log("objectApiName in line 779",JSON.stringify(e)),await Promise.all([this.cacheFieldMetadata(e,s,i,a),this.cacheControllingFields(e,t),this.cacheObjectSchema(e,i),this.cacheLookupOptions(e,a)]),{fieldMetadata:s,controllingFields:t}}catch(s){throw console.error(`\u274C Failed to refresh metadata cache for ${e}:`,s),s}}async getMetadata(e,s=!1){try{if(!s){if(this.isMobile()){const l=await this.getMobileCompleteMetadata(e);if(l)return l}const[o,i,a,r]=await Promise.all([this.getCachedFieldMetadata(e),this.getCachedControllingFields(e),this.getCachedObjectSchema(e),this.getCachedLookupOptions(e)]);if(o&&i)return{fieldMetadata:o.records,controllingFields:i.records,objectSchema:a||{},lookupOptionsMap:r||{},fromCache:!0,cachedAt:o.cachedAt};if(this.isMobile()){const l=await this.getMobileCompleteMetadata(e);if(l)return l}}const t=await this.refreshMetadataCache(e);return{fieldMetadata:t.fieldMetadata,controllingFields:t.controllingFields,fromCache:!1,cachedAt:new Date().toISOString()}}catch(t){const[o,i]=await Promise.all([this.getCachedFieldMetadata(e),this.getCachedControllingFields(e)]);if(o&&i)return{fieldMetadata:o.records,controllingFields:i.records,fromCache:!0,isStale:!0,cachedAt:o.cachedAt};throw t}}async updateCacheOnLogin(e=["Rhythm__Incident_Injury__c","Rhythm__Hazard__c"]){console.log("\u{1F504} Updating metadata cache on login for objects:",e);const s=[];for(const t of e)try{console.log(`\u{1F504} Updating cache for ${t}`);const o=await this.refreshMetadataCache(t);s.push({objectApiName:t,success:!0,fieldCount:o.fieldMetadata.length,controllingFieldCount:o.controllingFields.length})}catch(o){console.error(`\u274C Failed to update cache for ${t}:`,o),s.push({objectApiName:t,success:!1,error:o.message})}return console.log("\u2705 Metadata cache update completed:",s),s}async clearUserCache(){try{const e=this.getUserCacheId(),t=(await me(ie)).filter(o=>o.userCacheId===e);for(const o of t)await fs(ie,o.id);console.log(`\u{1F5D1}\uFE0F Cleared ${t.length} metadata cache records for current user`)}catch(e){console.error("\u274C Failed to clear user metadata cache:",e)}}async getCacheStats(){try{const e=await me(ie),s=this.getUserCacheId(),t=e.filter(i=>i.userCacheId===s),o={totalRecords:t.length,objects:{},oldestCache:null,newestCache:null};return t.forEach(i=>{const a=i.objectApiName;o.objects[a]||(o.objects[a]={fieldMetadata:!1,controllingFields:!1,cachedAt:null}),i.id.startsWith("metadata_")?(o.objects[a].fieldMetadata=!0,o.objects[a].cachedAt=i.cachedAt):i.id.startsWith("controlling_")&&(o.objects[a].controllingFields=!0),(!o.oldestCache||i.cachedAt<o.oldestCache)&&(o.oldestCache=i.cachedAt),(!o.newestCache||i.cachedAt>o.newestCache)&&(o.newestCache=i.cachedAt)}),o}catch(e){return console.error("\u274C Failed to get cache stats:",e),null}}}const H=new In;class Fn{constructor(){this.TABS_STORE=ps.TABS,this.VERSION_STORE=ps.METADATA_VERSION,this.VERSION_KEY="Tabs"}async getTabsForObject(e){return this.getRootTabs(e)}async getRootTabs(e){try{await U.init();const s=`
                SELECT * FROM tabs 
                WHERE objectApiName = ? 
                AND parentId IS NULL 
                ORDER BY sortOrder
            `,t=await U.dbConnection.query(s,[e]);return!t.values||t.values.length===0?(console.log(`No root tabs found for ${e}`),[]):t.values.map(o=>this._transformTabRow(o))}catch(s){return console.error(`Error getting root tabs for ${e}:`,s),[]}}async getChildTabs(e){try{await U.init();const s=`
                SELECT * FROM tabs 
                WHERE parentId = ? 
                ORDER BY sortOrder
            `,t=await U.dbConnection.query(s,[e]);return!t.values||t.values.length===0?(console.log(`No child tabs found for parent ${e}`),[]):t.values.map(o=>this._transformTabRow(o))}catch(s){return console.error(`Error getting child tabs for parent ${e}:`,s),[]}}async getTabById(e){try{await U.init();const s="SELECT * FROM tabs WHERE id = ?",t=await U.dbConnection.query(s,[e]);return!t.values||t.values.length===0?(console.log(`Tab with ID ${e} not found`),null):this._transformTabRow(t.values[0])}catch(s){return console.error(`Error getting tab with ID ${e}:`,s),null}}async upsertTabs(e){if(!e||!e.length)return console.warn("No tabs provided for upsert operation"),!1;try{await U.init(),console.log("tabs in line 135",JSON.stringify(e)),await U.dbConnection.execute("BEGIN TRANSACTION");const s=`
                INSERT OR REPLACE INTO tabs (
                    id, objectApiName, label, sortOrder, component, 
                    parentId, propsJson, isActive, iconName, keepAlive, prefetch, isAttachment, listViewObject, updated_at
                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
            `,t=e.map(o=>{const i=[o.id,o.objectApiName,o.label,o.sortOrder,o.component,o.parentId||null,o.propsJson?JSON.stringify(o.propsJson):null,o.isActive?1:0,o.iconName||null,o.keepAlive?1:0,o.prefetch?1:0,o.isAttachment?1:0,o.listViewObject];return{sql:s,values:i}});return await Promise.all(t.map(o=>U.dbConnection.run(o.sql,o.values))),await U.dbConnection.execute("COMMIT"),console.log(`\u2705 Successfully upserted ${e.length} tabs`),!0}catch(s){try{await U.dbConnection.execute("ROLLBACK")}catch(t){console.error("Error during rollback:",t)}return console.error("Error upserting tabs:",s),!1}}async getMetadataVersion(e=this.VERSION_KEY){try{await U.init();const s="SELECT version FROM metadata_version WHERE name = ?",t=await U.dbConnection.query(s,[e]);return!t.values||t.values.length===0?0:t.values[0].version}catch(s){return console.error(`Error getting metadata version for ${e}:`,s),0}}async setMetadataVersion(e=this.VERSION_KEY,s){try{await U.init();const t=`
                INSERT OR REPLACE INTO metadata_version (name, version, last_updated)
                VALUES (?, ?, CURRENT_TIMESTAMP)
            `;return await U.dbConnection.run(t,[e,s]),console.log(`\u2705 Updated metadata version for ${e} to ${s}`),!0}catch(t){return console.error(`Error setting metadata version for ${e}:`,t),!1}}async deleteTabsByObject(e){try{await U.init();const s="DELETE FROM tabs WHERE objectApiName = ?";return await U.dbConnection.run(s,[e]),console.log(`\u2705 Deleted all tabs for ${e}`),!0}catch(s){return console.error(`Error deleting tabs for ${e}:`,s),!1}}async deleteAllTabs(){try{await U.init();const e="DELETE FROM tabs";return await U.dbConnection.run(e),console.log("\u2705 Deleted all tabs"),!0}catch(e){return console.error("Error deleting all tabs:",e),!1}}_transformTabRow(e){return{id:e.id,objectApiName:e.objectApiName,label:e.label,sortOrder:e.sortOrder,component:e.component,parentId:e.parentId,propsJson:e.propsJson?JSON.parse(e.propsJson):null,isActive:e.isActive===1,iconName:e.iconName,keepAlive:e.keepAlive===1,prefetch:e.prefetch===1,isAttachment:e.isAttachment===1,listViewObject:e.listViewObject}}}const Ie=new Fn;class Dn{constructor(){this.refreshInterval=30*60*1e3,this.refreshTimer=null,this.isRefreshing=!1,this.lastRefresh=null,this.supportedObjectTypes=["Rhythm__Incident_Injury__c","Rhythm__Hazard__c","Task","Rhythm__Waste_Management__c","Rhythm__Water_Usage_Transaction__c","Rhythm__Fuel__c","Rhythm__HFE_Session__c","Rhythm__Alert_Relation__c","Rhythm__AccountAssessmentRelation__c","Rhythm__Safe_Work_Permit__c"]}async init(){console.log("\u{1F504} Initializing TabsService");try{const e=await Ie.getMetadataVersion();e===0?(console.log("\u{1F504} No tabs metadata found, performing initial sync"),await this.refreshAllMetadata()):(console.log(`\u{1F504} Found existing tabs metadata (version ${e})`),this._scheduleRefresh())}catch(e){console.error("\u274C Error initializing TabsService:",e)}}async refreshAllMetadata(e=!1){if(this.isRefreshing&&!e)return console.log("\u{1F504} Refresh already in progress, skipping"),!1;try{this.isRefreshing=!0,console.log("\u{1F504} Starting metadata refresh for all objects");const t=await Ie.getMetadataVersion()+1;let o=!0;return(await Promise.all(this.supportedObjectTypes.map(a=>this.refreshMetadataForObject(a)))).includes(!1)&&(o=!1),o&&(await Ie.setMetadataVersion("Tabs",t),this.lastRefresh=new Date,console.log(`\u2705 Metadata refresh completed successfully (new version: ${t})`)),this._scheduleRefresh(),o}catch(s){return console.error("\u274C Error refreshing all metadata:",s),!1}finally{this.isRefreshing=!1}}async refreshMetadataForObject(e){try{console.log(`\u{1F504} Refreshing tabs metadata for ${e}`),console.log(`\u{1F50D} Executing query for ${e} tabs metadata`);const s=await Ka(e);if(!s||s.length===0)return console.log(`\u26A0\uFE0F No tabs metadata found for ${e}`),!0;console.log(`\u{1F4CA} Retrieved ${s.length} tabs for ${e}`);const t=s.map(i=>this._transformRecord(i)),o=await Ie.upsertTabs(t);return o?console.log(`\u2705 Successfully upserted ${t.length} tabs for ${e}`):console.error(`\u274C Failed to upsert tabs for ${e}`),o}catch(s){return console.error(`\u274C Error refreshing metadata for ${e}:`,s),!1}}async getTabsForObject(e,s){try{console.log(`\u{1F50D} Getting tabs for ${e}:${s}`);const t=await Ie.getTabsForObject(e);if((!t||t.length===0)&&(console.log(`\u26A0\uFE0F No tabs found for ${e}, attempting refresh`),await this.refreshMetadataForObject(e))){const i=await Ie.getTabsForObject(e);return await this._processTabsForRecord(i,s)}return console.log("tabs",JSON.stringify(t)),await this._processTabsForRecord(t,s)}catch(t){throw console.error(`\u274C Error getting tabs for ${e}:`,t),t}}async _processTabsForRecord(e,s){let t=null;if(e.length>0){const o=e[0].objectApiName,i=this._getFieldsForConditionalLogic(o);if(i.length>0)try{const a=await is(o,s,i);t=a&&a.length>0?a[0]:null,console.log(`\u{1F4C4} Record data for ${o}:`,JSON.stringify(t))}catch(a){console.warn(`\u26A0\uFE0F Could not fetch record data for conditional tab visibility (${o}):`,a)}}return e.map(o=>({...o,props:{...o.propsJson||{},recordId:s,objectApiName:o.objectApiName}})).filter(o=>this._shouldShowTab(o,t))}_getFieldsForConditionalLogic(e){return{Rhythm__Alert_Relation__c:["Id","Name","Rhythm__Status__c"],Rhythm__Incident_Injury__c:["Id","Name","Rhythm__Incident_Type__c","Rhythm__High_Potential_Near_Miss__c"],Rhythm__HFE_Session__c:["Id","Name","Rhythm__Type_of_Training_m__c","Rhythm__Training_Category__c","Rhythm__Type_of_Training__c"],Rhythm__Safe_Work_Permit__c:["Id","Name","Rhythm__Status__c","Rhythm__Approve_Permit__c"]}[e]||[]}_shouldShowTab(e,s){if(!s)return!0;const t=s.attributes?.type||e.objectApiName;if(t==="Rhythm__Alert_Relation__c"&&e.isAttachment&&s.Rhythm__Status__c)return s.Rhythm__Status__c==="Completed";if(t==="Rhythm__Incident_Injury__c"&&(e.label==="Investigation"||e.componentName==="c-tab-investigation")){const o=s.Rhythm__Incident_Type__c,i=s.Rhythm__High_Potential_Near_Miss__c;if(console.log("\u{1F50D} Investigation tab visibility check:",{incidentType:o,isHighPotential:i,shouldShow:!(o==="Near-Miss"&&!i)}),o==="Near-Miss"&&!i)return!1}if(t==="Rhythm__HFE_Session__c"&&(console.log("\u{1F50D} Tab check for HFE Session - Tab:",JSON.stringify({tabLabel:e.label,tabComponent:e.componentName,tabId:e.id})),e.label==="Mockdrill Report"||e.componentName==="c-mock-drill-report")){const o=s.Rhythm__Training_Category__c,i=s.Rhythm__Type_of_Training_m__c,a=s.Rhythm__Type_of_Training__c;if(console.log("\u{1F50D} Mockdrill tab visibility check:",JSON.stringify({scheduleType:o,trainingTypeM:i,trainingType:a,tabLabel:e.label,tabComponent:e.componentName})),o==="Scheduled"){const r=i==="HFE MockDrill";if(console.log(`\u{1F50D} Scheduled training: Should show tab? ${r} (trainingTypeM === 'HFE MockDrill')`),!r)return!1}else{const r=a==="Special MockDrill";if(console.log(`\u{1F50D} Non-Scheduled training: Should show tab? ${r} (trainingType === 'Special MockDrill')`),!r)return!1}}if(t==="Rhythm__Safe_Work_Permit__c"){const o=s.Rhythm__Status__c,i=s.Rhythm__Approve_Permit__c;if(console.log("\u{1F50D} Safe Work Permit tab visibility check:",{status:o,approvePermit:i,tabLabel:e.label}),(e.label==="Permit Preparation"||e.label==="Permit Authorization")&&o!=="Requested/Initiated"||(e.label==="Permit Extension Log"||e.label==="Permit Suspension"||e.label==="Status"||e.label==="Permit Closure")&&!(o==="Requested/Initiated"&&i==="Approve"))return!1}return!0}stopRefreshTimer(){this.refreshTimer&&(cancelAnimationFrame(this.refreshTimer),this.refreshTimer=null,console.log("\u{1F6D1} Stopped refresh timer"))}_transformRecord(e){let s=null;try{e.Rhythm__Input_Parameters__c&&(s=JSON.parse(e.Rhythm__Input_Parameters__c))}catch(t){console.warn(`\u26A0\uFE0F Invalid JSON in props for tab ${e.Id}:`,t)}return console.log("record in line 305",JSON.stringify(e)),{id:e.Id,objectApiName:e.Rhythm__Object_Api_Name__c,label:e.Rhythm__Tab_Name__c,sortOrder:e.Rhythm__Order__c||0,component:e.Rhythm__LWC_Name__c,parentId:e.Rhythm__Parent_Id__c||null,propsJson:s,isActive:e.Rhythm__IsActive__c||!1,isAttachment:e.Rhythm__is_Attachment__c||!1,listViewObject:e.Rhythm__List_View_Object__c||null}}_scheduleRefresh(){this.stopRefreshTimer(),this.refreshTimer=requestAnimationFrame(()=>{(s=>new Promise(t=>{setTimeout(t,s)}))(this.refreshInterval).then(()=>{console.log("\u{1F504} Executing scheduled metadata refresh"),this.refreshAllMetadata()})}),console.log(`\u{1F552} Scheduled next metadata refresh in ${this.refreshInterval/6e4} minutes`)}async getRecordName(e,s){try{if(console.log(`\u{1F50D} Getting record name for ${e}:${s}`),await V()){console.log("\u{1F310} Online mode: Attempting to fetch record name from Salesforce");try{console.log(`\u{1F50D} Executing query for record name: ${e}:${s}`);const t=await Ga(e,s);if(!t||t.length===0)return console.log(`\u26A0\uFE0F No record found for ${e}:${s}`),await this.getRecordNameFromCache(e,s);const o=t[0];return console.log(`\u{1F4CA} Retrieved record name from Salesforce: ${o.Name}`),o}catch(t){return console.warn("\u274C Online fetch failed, trying offline cache:",t),await this.getRecordNameFromCache(e,s)}}else return console.log("\u{1F4F1} Offline mode: Using cached data for record name"),await this.getRecordNameFromCache(e,s)}catch(t){return console.error(`\u274C Error getting record name for ${e}:${s}:`,t),null}}async getRecordNameFromCache(e,s){try{console.log(`\u{1F50D} Searching cache for ${e}:${s}`);const t=await de(Z.LIST_VIEW_RECORDS),o=`records_${e}`,i=t.find(a=>a.id===o);if(i){const a=i.records||i.data;if(a&&Array.isArray(a)){const r=a.find(l=>l.Id===s);if(r)return console.log(`\u2705 Found record name in leftMenu cache: ${r.Name}`),{Id:r.Id,Name:r.Name}}}for(const a of t){if(a.id===o)continue;const r=a.records||a.data;if(Array.isArray(r)){const l=r.find(c=>c.Id===s);if(l)return console.log(`\u2705 Found record name in cache ${a.id}: ${l.Name}`),{Id:l.Id,Name:l.Name}}else if(r&&r.Id===s)return console.log(`\u2705 Found record name as single record: ${r.Name}`),{Id:r.Id,Name:r.Name}}return console.log(`\u274C No cached record name found for ${e}:${s}`),null}catch(t){return console.error("\u274C Error searching cache for record name:",t),null}}async clearAllMetadata(){try{return this.stopRefreshTimer(),await Ie.deleteAllTabs(),await Ie.setMetadataVersion("Tabs",0),console.log("\u{1F5D1}\uFE0F Cleared all tabs metadata"),!0}catch(e){return console.error("\u274C Error clearing tabs metadata:",e),!1}}}const Fe=new Dn;class Tn{constructor(){this.instance=null,this.config={scrollThreshold:100,debounceDelay:300,refreshCooldown:2e4,supportedObjects:["Rhythm__Incident_Injury__c","Rhythm__Near_Miss__c","Rhythm__Hazard__c","Rhythm__HFE_Session__c","Rhythm__Water_Usage_Transaction__c","Rhythm__Waste_Management__c","Rhythm__Fuel__c","Task"]},this.lastRefreshTime=0,this.isRefreshing=!1}setInstance(e){this.instance=e,console.log("\u{1F4DC} Scroll refresh service instance set")}updateConfig(e){this.config={...this.config,...e},console.log("\u2699\uFE0F Scroll refresh config updated:",this.config)}canRefresh(){const e=Date.now();return!this.isRefreshing&&e-this.lastRefreshTime>=this.config.refreshCooldown}async triggerRefresh(e="manual"){return this.canRefresh()?(console.log(`\u{1F504} Manual refresh triggered from ${e}`),this.instance&&typeof this.instance.performMetadataRefresh=="function"?(await this.instance.performMetadataRefresh(),!0):(console.warn("\u26A0\uFE0F No scroll refresh instance available for manual refresh"),!1)):(console.log("\u{1F550} Refresh not allowed due to cooldown or in progress"),!1)}addSupportedObject(e){this.config.supportedObjects.includes(e)||(this.config.supportedObjects.push(e),console.log(`\u2795 Added ${e} to supported objects`))}removeSupportedObject(e){const s=this.config.supportedObjects.indexOf(e);s>-1&&(this.config.supportedObjects.splice(s,1),console.log(`\u2796 Removed ${e} from supported objects`))}getStatus(){return{isRefreshing:this.isRefreshing,lastRefreshTime:this.lastRefreshTime,canRefresh:this.canRefresh(),supportedObjectsCount:this.config.supportedObjects.length,config:this.config}}showToast(e,s="info"){this.instance&&typeof this.instance.showToastMessage=="function"?this.instance.showToastMessage(e,s):console.log(`\u{1F4E2} Toast [${s.toUpperCase()}]: ${e}`)}async checkOnlineAndNotify(){const e=await V();return e||this.showToast("You are offline - metadata cannot be refreshed","info"),e}async refreshObjectMetadata(e){try{return console.log(`\u{1F504} Refreshing metadata for ${e}`),await H.refreshMetadataCache(e),Fe&&typeof Fe.refreshMetadataForObject=="function"&&await Fe.refreshMetadataForObject(e),!0}catch(s){return console.error(`\u274C Failed to refresh metadata for ${e}:`,s),!1}}async refreshAllMetadata(){console.log("\u{1F504} Starting batch metadata refresh...");const e=this.config.supportedObjects.map(i=>this.refreshObjectMetadata(i)),s=await Promise.allSettled(e),t=s.filter(i=>i.status==="fulfilled"&&i.value===!0).length,o=s.length-t;return console.log(`\u2705 Batch refresh completed: ${t} successful, ${o} failed`),{successful:t,failed:o,total:s.length,success:t>0}}setEnabled(e){this.instance&&(e?(this.instance.initializeScrollListener(),console.log("\u2705 Scroll refresh enabled")):(this.instance.removeScrollListener(),console.log("\u274C Scroll refresh disabled")))}getMetrics(){const s=Date.now()-this.lastRefreshTime;return{lastRefreshAgo:s,nextRefreshIn:Math.max(0,this.config.refreshCooldown-s),isOnCooldown:s<this.config.refreshCooldown,isRefreshing:this.isRefreshing,config:this.config}}debug(){console.log("\u{1F4CA} Scroll Refresh Service Debug:",{hasInstance:!!this.instance,status:this.getStatus(),metrics:this.getMetrics()})}}const Dt=new Tn;class po extends K{constructor(...e){super(...e);this.isRefreshing=!1,this.showToast=!1,this.toastMessage="",this.toastType="info",this.SCROLL_THRESHOLD=20,this.DEBOUNCE_DELAY=300,this.REFRESH_COOLDOWN=2e4,this.PULL_DISTANCE_THRESHOLD=30,this.lastRefreshTime=0,this.scrollDebounceTimer=null,this.scrollEventListener=null,this.isInitialized=!1,this.isPulling=!1,this.pullStartTime=0,this.maxPullDistance=0,this.lastScrollPosition=0,this.isAtBottom=!1,this.bottomHoldStartTime=0,this.SUPPORTED_OBJECTS=["Rhythm__Incident_Injury__c","Rhythm__Near_Miss__c","Rhythm__Hazard__c","Rhythm__HFE_Session__c","Rhythm__Water_Usage_Transaction__c","Rhythm__Waste_Management__c","Rhythm__Fuel__c","Task","Rhythm__Safe_Work_Permit__c"]}connectedCallback(){Dt.setInstance(this),this.initializeScrollListener();const e=Dt.config;this.SCROLL_THRESHOLD=e.scrollThreshold,this.DEBOUNCE_DELAY=e.debounceDelay,this.REFRESH_COOLDOWN=e.refreshCooldown,this.SUPPORTED_OBJECTS=e.supportedObjects}disconnectedCallback(){this.removeScrollListener()}initializeScrollListener(){this.isInitialized||(console.log("\u{1F4DC} Initializing global scroll metadata refresh listener"),this.scrollEventListener=this.handleScroll.bind(this),document.addEventListener("scroll",this.scrollEventListener,{passive:!0}),window.addEventListener("scroll",this.scrollEventListener,{passive:!0}),this.attachScrollListenersToContainers(),this.isInitialized=!0,console.log("\u2705 Scroll metadata refresh initialized"))}attachScrollListenersToContainers(){new MutationObserver(s=>{s.forEach(t=>{t.addedNodes.forEach(o=>{o.nodeType===Node.ELEMENT_NODE&&this.attachToScrollableElements(o)})})}).observe(document.body,{childList:!0,subtree:!0}),this.attachToScrollableElements(document.body)}attachToScrollableElements(e){[".content-scroll",".modal-content",".list-content",".detail-page-container",".component-content",'[data-scrollable="true"]'].forEach(t=>{e.querySelectorAll(t).forEach(i=>{i.hasAttribute("data-scroll-refresh-attached")||(i.addEventListener("scroll",this.scrollEventListener,{passive:!0}),i.setAttribute("data-scroll-refresh-attached","true"))})})}removeScrollListener(){this.scrollEventListener&&(document.removeEventListener("scroll",this.scrollEventListener),window.removeEventListener("scroll",this.scrollEventListener),this.template&&typeof this.template.querySelectorAll=="function"&&this.template.querySelectorAll("[data-scroll-refresh-attached]").forEach(s=>{s.removeEventListener("scroll",this.scrollEventListener),s.removeAttribute("data-scroll-refresh-attached")})),this.scrollDebounceTimer&&(this.shouldCancelDebounce=!0,this.scrollDebounceTimer=null),this.isInitialized=!1,console.log("\u{1F5D1}\uFE0F Scroll metadata refresh listeners removed")}handleScroll(e){this.scrollDebounceTimer&&(this.shouldCancelDebounce=!0),this.scrollDebounceTimer=Promise.resolve().then(()=>new Promise(s=>{requestAnimationFrame(()=>{this.shouldCancelDebounce||this.checkScrollPosition(e),this.shouldCancelDebounce=!1,s()})}))}checkScrollPosition(e){const s=e.target===document?document.documentElement:e.target;if(!s||s===window){const t=window.pageYOffset||document.documentElement.scrollTop,o=window.innerHeight;document.documentElement.scrollHeight-(t+o)<=this.SCROLL_THRESHOLD?(this.trackPullGesture(t),this.trackBottomHold()):(this.resetPullGesture(),this.resetBottomHold())}else{const t=s.scrollTop,o=s.clientHeight,i=s.scrollHeight;if(i<=o)return;i-(t+o)<=this.SCROLL_THRESHOLD?(this.trackPullGesture(t),this.trackBottomHold()):(this.resetPullGesture(),this.resetBottomHold())}}trackPullGesture(e){const s=Date.now();if(!this.isPulling){this.isPulling=!0,this.pullStartTime=s,this.maxPullDistance=0,this.lastScrollPosition=e,console.log("\u{1F4DC} Started tracking pull gesture");return}const t=Math.abs(e-this.lastScrollPosition);this.maxPullDistance=Math.max(this.maxPullDistance,t);const o=s-this.pullStartTime;console.log(`\u{1F4DC} Pull gesture - Distance: ${this.maxPullDistance}px, Duration: ${o}ms`);const i=300;this.maxPullDistance>=this.PULL_DISTANCE_THRESHOLD&&o>=i&&(console.log("\u{1F4DC} Intentional pull gesture detected - triggering refresh"),this.triggerMetadataRefresh("pull-gesture"),this.resetPullGesture())}resetPullGesture(){this.isPulling&&console.log("\u{1F4DC} Reset pull gesture tracking"),this.isPulling=!1,this.pullStartTime=0,this.maxPullDistance=0,this.lastScrollPosition=0}trackBottomHold(){const e=Date.now();if(!this.isAtBottom){this.isAtBottom=!0,this.bottomHoldStartTime=e,console.log("\u{1F4DC} Started tracking bottom hold");return}e-this.bottomHoldStartTime>=800&&(console.log("\u{1F4DC} Bottom hold detected - triggering refresh"),this.triggerMetadataRefresh("bottom-hold"),this.resetBottomHold())}resetBottomHold(){this.isAtBottom&&console.log("\u{1F4DC} Reset bottom hold tracking"),this.isAtBottom=!1,this.bottomHoldStartTime=0}async triggerMetadataRefresh(e){const s=Date.now();if(s-this.lastRefreshTime<this.REFRESH_COOLDOWN){console.log("\u{1F550} Metadata refresh on cooldown, skipping");return}if(this.isRefreshing){console.log("\u{1F504} Metadata refresh already in progress, skipping");return}console.log(`\u{1F4DC} Scroll triggered metadata refresh from ${e}`),this.lastRefreshTime=s,await this.performMetadataRefresh()}async performMetadataRefresh(){this.isRefreshing=!0,this.showLoadingIndicator();try{if(!await V()){this.showToastMessage("You are offline - data not updated","info");return}console.log("\u{1F504} Starting scroll-triggered metadata refresh..."),this.refreshAssessmentDetails();const s=await Dt.refreshAllMetadata(),{successful:t,failed:o}=s;t>0?(this.showToastMessage("Data updated successfully","success"),console.log(`\u2705 Metadata refresh completed: ${t} successful, ${o} failed`)):(this.showToastMessage("Data update failed","error"),console.log("\u274C All metadata refresh attempts failed"))}catch(e){console.error("\u274C Error during scroll metadata refresh:",e),this.showToastMessage("Data update failed","error")}finally{this.isRefreshing=!1,this.hideLoadingIndicator()}}async refreshObjectMetadata(e){return Dt.refreshObjectMetadata(e)}showLoadingIndicator(){console.log("\u{1F4CA} Showing metadata refresh loading indicator"),this.dispatchEvent(new CustomEvent("refreshstart",{bubbles:!0,composed:!0,detail:{message:"Refreshing metadata..."}}))}hideLoadingIndicator(){console.log("\u{1F4CA} Hiding metadata refresh loading indicator"),this.dispatchEvent(new CustomEvent("refreshend",{bubbles:!0,composed:!0}))}showToastMessage(e,s="info"){this.toastMessage=e,this.toastType=s,this.showToast=!0,console.log(`\u{1F4E2} Toast: [${s.toUpperCase()}] ${e}`),Promise.resolve().then(()=>{requestAnimationFrame(()=>{let t=0;const o=()=>{t++,t>=150?this.hideToast():requestAnimationFrame(o)};o()})}),this.dispatchEvent(new CustomEvent("toast",{bubbles:!0,composed:!0,detail:{message:e,type:s}}))}hideToast(){this.showToast=!1}handleToastClose(){this.hideToast()}get toastClasses(){const e="toast-container",s=`toast-${this.toastType}`,t=this.showToast?"toast-visible":"toast-hidden";return`${e} ${s} ${t}`}get toastIcon(){switch(this.toastType){case"success":return"\u2705";case"error":return"\u274C";case"info":default:return"\u2139\uFE0F"}}async manualRefresh(){console.log("\u{1F504} Manual metadata refresh triggered"),await this.performMetadataRefresh()}canRefresh(){return Dt.canRefresh()}refreshAssessmentDetails(){console.log("\u{1F504} Triggering assessment detail refresh...");const e=new CustomEvent("apprefreshassessmentdetail",{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),source:"scrollMetadataRefresh"}});console.log("\u{1F504} Dispatching app-level assessment refresh event"),this.dispatchEvent(e),this.dispatchRefreshEvent()}dispatchRefreshEvent(){console.log("\u{1F504} Dispatching global assessment refresh event");const e=new CustomEvent("assessmentdetailrefresh",{bubbles:!0,composed:!0,detail:{timestamp:Date.now()}});this.dispatchEvent(e)}}Y(po,{track:{isRefreshing:1,showToast:1,toastMessage:1,toastType:1},fields:["SCROLL_THRESHOLD","DEBOUNCE_DELAY","REFRESH_COOLDOWN","PULL_DISTANCE_THRESHOLD","lastRefreshTime","scrollDebounceTimer","scrollEventListener","isInitialized","isPulling","pullStartTime","maxPullDistance","lastScrollPosition","isAtBottom","bottomHoldStartTime","SUPPORTED_OBJECTS"]});const On=z(po,{tmpl:fa,sel:"c-scroll-metadata-refresh",apiVersion:63});function Ln(n,e,s){var t=n?"["+n+"]":"";return".sidebar"+t+" {width: 200px;background-color: #551a8b;color: white;height: 100vh;left: 0;top: 0;position: fixed;z-index: 1000;transition: all 0.3s ease;padding-top: 20px;}.menu-list"+t+" {list-style: none;padding: 0;margin: 0;padding-top: 20px;}.menu-item"+t+" {padding: 15px 20px;cursor: pointer;display: flex;align-items: center;color: white;font-size: 14px;transition: all 0.3s ease;border-bottom: 1px solid rgba(255, 255, 255, 0.1);position: relative;}.menu-item"+t+" i"+t+" {margin-right: 10px;font-size: 18px;width: 20px;text-align: center;}.menu-item:hover"+t+" {background-color: rgba(255, 255, 255, 0.1);transform: translateX(3px);}.menu-item.active"+t+" {background-color: #6a1b9a;border-left: 4px solid #9c27b0;}.menu-item"+t+" span"+t+" {font-weight: 500;}.menu-group"+t+" {list-style: none;}.menu-label"+t+" {flex: 1;font-weight: 500;margin-left: 8px;}.expand-icon"+t+" {width: 16px;height: 16px;color: rgba(255, 255, 255, 0.7);transition: all 0.3s ease;transform: rotate(0deg);flex-shrink: 0;margin-right: 10px;}.expand-icon.expanded"+t+" {transform: rotate(90deg);color: rgba(255, 255, 255, 0.9);}.expand-icon:hover"+t+" {color: white;}.submenu-list"+t+" {list-style: none;padding: 0;margin: 0 0 0 10px;background-color: rgba(0, 0, 0, 0.3);border-left: 3px solid rgba(156, 39, 176, 0.6);box-shadow: inset 2px 0 5px rgba(0, 0, 0, 0.2);}.submenu-item"+t+" {padding: 12px 20px 12px 35px;cursor: pointer;display: flex;align-items: center;color: rgba(255, 255, 255, 0.85);font-size: 13px;transition: all 0.3s ease;border-bottom: 1px solid rgba(255, 255, 255, 0.05);position: relative;}.submenu-item:hover"+t+" {background-color: rgba(156, 39, 176, 0.2);color: white;transform: translateX(3px);}.submenu-item.active"+t+" {background-color: rgba(156, 39, 176, 0.3);color: white;border-left: 3px solid #9c27b0;}.submenu-icon"+t+" {margin-right: 10px;font-size: 14px;width: 16px;text-align: center;opacity: 0.7;}.submenu-icon"+t+":before {content: '\u2022';}.submenu-label"+t+" {font-weight: 400;}.logout-item"+t+" {margin-top: auto;border-top: 2px solid rgba(255, 255, 255, 0.2);background-color: rgba(220, 53, 69, 0.1);}.logout-item:hover"+t+" {background-color: #dc3545 !important;}.mobile-menu-toggle"+t+" {display: none;position: fixed;top: calc(env(safe-area-inset-top, 0px) + 28px);left: 16px;z-index: 1102;background: #551a8b;color: white;border: none;padding: 12px;border-radius: 8px;cursor: pointer;font-size: 20px;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);width: 44px;height: 44px;align-items: center;justify-content: center;transition: all 0.3s ease;}.mobile-menu-toggle:hover"+t+" {background: #4a148c;transform: scale(1.05);}.mobile-menu-toggle:active"+t+" {transform: scale(0.95);}@media screen and (max-width: 768px) {.sidebar"+t+" {height: 100vh !important;position: fixed !important;left: 0 !important;top: 0 !important;transform: translateX(-100%) !important;transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;z-index: 1101 !important;box-shadow: 4px 0 20px rgba(0, 0, 0, 0.4) !important;padding-top: env(safe-area-inset-top, 25px) !important;border-radius: 0;}.sidebar.mobile-open"+t+" {transform: translateX(0) !important;visibility: visible !important;opacity: 1 !important;}.mobile-menu-toggle"+t+" {display: flex;visibility: visible !important;opacity: 1 !important;transition: opacity 0.3s ease;}.sidebar.mobile-open"+t+" ~ .mobile-menu-toggle"+t+",\r .mobile-menu-toggle.hidden"+t+" {opacity: 0 !important;visibility: hidden !important;}.menu-item"+t+" {padding: 18px 20px;font-size: 16px;border-bottom: 1px solid rgba(255, 255, 255, 0.15);white-space: nowrap;min-height: 20px;}.menu-item"+t+" i"+t+" {font-size: 20px;margin-right: 15px;width: 24px;}.menu-item"+t+" span"+t+" {flex: 1;overflow: hidden;text-overflow: ellipsis;font-weight: 500;}.logout-item"+t+" {border-top: 2px solid rgba(255, 255, 255, 0.3);background-color: rgba(220, 53, 69, 0.2);}.menu-item"+t+" {padding: 18px 20px;font-size: 16px;}.submenu-item"+t+" {padding: 15px 20px 15px 40px;font-size: 14px;border-bottom: 1px solid rgba(255, 255, 255, 0.08);}.submenu-icon"+t+" {font-size: 16px;width: 18px;margin-right: 12px;}.expand-icon"+t+" {width: 18px;height: 18px;margin-right: 15px;}.menu-label"+t+" {margin-left: 8px;}}@media screen and (max-width: 768px) {.mobile-menu-toggle"+t+" {background: #6a1b9a !important;border: 2px solid #fff !important;}.sidebar.mobile-open"+t+" {background: rgb(107, 56, 136) !important;}}"}var fo=[Ln];const Nn=p`<button class="mobile-menu-toggle${0}"${2}>☰</button>`,Mn=p`<svg${"c0"} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${2}><path d="m9 18 6-6-6-6"${3}/></svg>`,Pn=p`<i class="menu-icon${0}"${2}></i>`,jn=p`<span class="menu-label${0}"${2}>${"t1"}</span>`,Un=p`<li${"c0"}${"a0:data-id"} data-isparent="false" data-ischild="true"${2}><i class="submenu-icon${0}"${2}></i><span class="submenu-label${0}"${2}>${"t3"}</span></li>`,Vn=p`<li class="menu-group${0}"${2}><div${"c1"} data-id="logout"${2}><i class="las la-sign-out-alt${0}"${2}></i><span class="menu-label${0}"${2}>Logout</span></div></li>`,qn={classMap:{"menu-list":!0},key:3},zn={"menu-group":!0},Wn={classMap:{"submenu-list":!0},key:12};function je(n,e,s,t){const{b:o,sp:i,st:a,ncls:r,k:l,d:c,h:d,i:h,f:u}=n,{_m0:f,_m1:g,_m2:_,_m3:m,_m4:x,_m5:k}=t;return[e.hideToggle?null:a(Nn,1,[i(0,{on:g||(t._m1={click:o(e.handleMobileToggle)})},null)]),d("div",{className:r(e.sidebarClass),key:2},[d("ul",qn,u([h(e.hierarchicalMenuItemsWithClasses,function($){return d("li",{classMap:zn,key:l(4,$.Id)},[d("div",{className:r($.menuItemClass),attrs:{"data-id":$.Id,"data-isparent":$.isParent,"data-ischild":"false"},key:5,on:_||(t._m2={click:o(e.handleMenuClick)})},[$.isParent?a(Mn,7,[i(0,{className:r($.expandIconClass)},null)]):null,$.isParent?null:a(Pn,9),a(jn,11,[i(1,null,c($.Rhythm__Header__c))])]),$.isParent&&$.isExpanded?d("ul",Wn,h($.children,function(S){return a(Un,l(14,S.Id),[i(0,{on:x||(t._m4={click:o(e.handleMenuClick)}),className:r(S.submenuItemClass),attrs:{"data-id":S.Id}},null),i(3,null,c(S.Rhythm__Header__c))])})):null])}),a(Vn,16,[i(1,{on:k||(t._m5={click:o(e.handleMenuClick)}),className:r(e.logoutClass)},null)])]))])]}var Bn=J(je);je.stylesheets=[],je.stylesheetToken="lwc-63rok43n70c",je.legacyStylesheetToken="c-leftMenu_leftMenu",fo&&je.stylesheets.push.apply(je.stylesheets,fo),Q(je);class mo extends K{constructor(...e){super(...e);this.hideToggle=!1,this.selected="incident",this.isMobileMenuOpen=!1,this.menuItems=[],this.hierarchicalMenuItems=[],this.expandedMenus=new Set,this.isLoading=!1}get incidentClass(){return`menu-item ${this.selected==="incident"?"active":""}`}get hazardClass(){return`menu-item ${this.selected==="hazard"?"active":""}`}get logoutClass(){return"menu-item"}get hierarchicalMenuItemsWithClasses(){return this.hierarchicalMenuItems.map(e=>({...e,menuItemClass:e.Id===this.selected?"menu-item active":"menu-item",expandIconClass:e.isExpanded?"expand-icon expanded":"expand-icon",children:e.children?e.children.map(s=>({...s,submenuItemClass:s.Id===this.selected?"submenu-item active":"submenu-item"})):[]}))}get sidebarClass(){const e="sidebar",s=this.isMobileMenuOpen?"mobile-open":"",t=s?`${e} ${s}`:e;return console.log("Sidebar class:",t),t}handleMenuClick(e){const s=e.currentTarget.dataset.id,t=e.currentTarget.dataset.ischild==="true",o=e.currentTarget.dataset.isparent==="true";if(console.log("Menu clicked:",{selectedId:s,isChild:t,isParent:o}),s==="logout"){this.handleLogout();return}const i=this.menuItems.find(a=>a.Id===s);if(!i){console.error("Selected menu item not found:",s);return}if(o&&!i.Rhythm__object_api_name__c){this.handleParentMenuToggle(e);return}if(i.Rhythm__object_api_name__c){if(this.selected=s,t&&i.Rhythm__parentMenu__c){const r=i.Rhythm__parentMenu__c;this.expandedMenus.add(r),this.hierarchicalMenuItems=this.hierarchicalMenuItems.map(l=>l.Rhythm__menuDataId__c===r?{...l,isExpanded:!0}:l)}this.isMobileMenuOpen=!1,this.dispatchEvent(new CustomEvent("menuchange",{detail:{selectedId:s,objectApiName:i.Rhythm__object_api_name__c,selectedItem:i}}));const a=this.template.querySelector(".mobile-menu-toggle");a&&a.classList.remove("hidden")}}handleMobileToggle(e){console.log("Mobile toggle clicked!"),e.preventDefault(),e.stopPropagation(),this.isMobileMenuOpen=!this.isMobileMenuOpen,console.log("Mobile menu toggled:",this.isMobileMenuOpen),this.template.host.style.setProperty("--mobile-open",this.isMobileMenuOpen?"1":"0");const s=this.template.querySelector(".sidebar"),t=this.template.querySelector(".mobile-menu-toggle");t&&(this.isMobileMenuOpen?t.classList.add("hidden"):t.classList.remove("hidden")),s&&console.log("Sidebar classes:",s.className)}handleLogout(){sessionStorage.removeItem("sf_access_token"),sessionStorage.removeItem("sf_instance_url"),sessionStorage.removeItem("sf_user_id"),this.isMobileMenuOpen=!1,this.dispatchEvent(new CustomEvent("logout"))}connectedCallback(){this.documentClickListener=this.handleDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener),this.getLeftMenu(),console.log("LeftMenu component connected")}disconnectedCallback(){document.removeEventListener("click",this.documentClickListener)}handleDocumentClick(e){if(this.isMobileMenuOpen){const s=this.template.querySelector(".sidebar"),t=this.template.querySelector(".mobile-menu-toggle");s&&t&&!s.contains(e.target)&&!t.contains(e.target)&&(console.log("Clicking outside, closing mobile menu"),this.isMobileMenuOpen=!1,t&&t.classList.remove("hidden"))}}async getLeftMenu(){this.isLoading=!0;try{const e=await V(),s="left_menu_items";if(e)try{const t=await en();console.log("Menu items response:",t),this.menuItems=t,this.processHierarchicalMenu(t),t&&t.length>0&&(await re(Z.LEFT_MENU,{id:s,menuItems:t,cachedAt:new Date().toISOString()}),console.log(`\u{1F4F1} Stored ${t.length} menu items for offline use`),await this.getFieldsForObject(t))}catch(t){console.error("Error fetching menu items online:",t),await this.loadOfflineMenuItems()}else console.log("\u{1F4F1} Device is offline, retrieving cached menu items"),await this.loadOfflineMenuItems()}catch(e){console.error("Error in getLeftMenu:",e),this.error=e.message}}async loadOfflineMenuItems(){try{const e=await this.getLocalMenuItems();e&&e.menuItems&&e.menuItems.length>0?(this.menuItems=e.menuItems,this.processHierarchicalMenu(e.menuItems),console.log(`\u{1F4F1} Retrieved ${this.menuItems.length} cached menu items`)):(console.log("\u{1F4F1} No cached menu items found"),this.error="No cached menu items found")}catch(e){console.error("Error retrieving cached menu items:",e),this.error="Failed to load menu items"}}async getLocalMenuItems(){try{const e="left_menu_items";return(await de(Z.LEFT_MENU)).find(t=>t.id===e)}catch(e){return console.error("Error getting local menu items:",e),null}}processHierarchicalMenu(e){if(!e||e.length===0)return;console.log("Processing hierarchical menu with items:",e);const s=new Map;e.forEach(o=>{o.Rhythm__menuDataId__c&&s.set(o.Rhythm__menuDataId__c,{...o,children:[],isExpanded:!1,isParent:!1})}),e.forEach(o=>{if(o.Rhythm__parentMenu__c){const i=o.Rhythm__parentMenu__c;if(s.has(i)){const a=s.get(i);a.children.push({...o,isChild:!0}),a.isParent=!0,s.set(i,a)}}});const t=[];e.forEach(o=>{if(!o.Rhythm__parentMenu__c){const i=s.get(o.Rhythm__menuDataId__c)||{...o,children:[],isExpanded:!1,isParent:!1};t.push(i)}}),this.hierarchicalMenuItems=t,console.log("Processed hierarchical menu items:",this.hierarchicalMenuItems)}handleParentMenuToggle(e){e.stopPropagation();const s=e.currentTarget.dataset.id;console.log("Toggling parent menu:",s);const t=this.menuItems.find(i=>i.Id===s),o=t?t.Rhythm__menuDataId__c:s;this.expandedMenus.has(o)?this.expandedMenus.delete(o):this.expandedMenus.add(o),this.hierarchicalMenuItems=this.hierarchicalMenuItems.map(i=>i.Rhythm__menuDataId__c===o||i.Id===s?{...i,isExpanded:this.expandedMenus.has(o)}:i),console.log("Updated expanded menus:",Array.from(this.expandedMenus))}async getFieldsForObject(e){let s=e.filter(o=>o.Rhythm__object_api_name__c&&o.Rhythm__object_api_name__c.trim()!=="").map(o=>o.Rhythm__object_api_name__c);if(console.log("Object api names (filtered):",s),s.length===0){console.log("No object API names found, skipping field configuration fetch");return}const t=await ss(s,!0,!1);if(console.log("Field configs:",t),t&&t.length>0){const o=t.map(r=>{const l=r.Rhythm__Object_Name__c;return re(Z.FIELDS_CONFIG,{id:`field_config_${l}`,objectApiName:l,fieldConfigs:[r],cachedAt:new Date().toISOString()}).then(()=>(console.log(`\u{1F4F1} Stored field configuration for ${l}`),{objectApiName:l,config:r}))}),i=await Promise.all(o);console.log("All field configurations stored successfully");const a=i.map(({objectApiName:r,config:l})=>this.fetchAndStoreRecords(r,l));await Promise.all(a),console.log("All records stored successfully")}}async fetchAndStoreRecords(e,s){try{if(!e||!s)return;const t=s.Rhythm__Field_Name__c||"";if(!t){console.log(`No default fields defined for ${e}`);return}const i=`SELECT Id, ${t.split(",").map(r=>r.trim()).join(", ")} FROM ${e} ORDER BY CreatedDate DESC`;console.log(`Fetching records for ${e} with query: ${i}`);const a=await le(i);console.log(`Fetched ${a?a.length:0} records for ${e}`),a&&a.length>0&&(await re(Z.LIST_VIEW_RECORDS,{id:`records_${e}`,objectApiName:e,records:a,cachedAt:new Date().toISOString()}),console.log(`\u{1F4F1} Stored ${a.length} records for ${e}`),await this.fetchAwsS3FilesList(e,a[0].Id))}catch(t){console.error(`Error fetching records for ${e}:`,t)}}async fetchAwsS3FilesList(e,s){let t="";const o=await At(e,s);o&&o.supplierName&&o.supplierName.includes("_Personal_Files")&&(t=`${o.customerName}/${o.objectLabel}/${o.supplierName}`);const i=await Ae(t,"list");console.log("AwsS3FilesList:",i),await re(Z.AWS_S3_LIST,{id:`aws_s3_list_${e}`,objectApiName:e,records:i,cachedAt:new Date().toISOString()})}}Y(mo,{publicProps:{hideToggle:{config:0}},track:{selected:1,isMobileMenuOpen:1,menuItems:1,hierarchicalMenuItems:1,expandedMenus:1,isLoading:1}});const Hn=z(mo,{tmpl:Bn,sel:"c-left-menu",apiVersion:63});function Jn(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".generic-list-container",t,` {font-family:\r
 'Inter',\r
 -apple-system,\r
 BlinkMacSystemFont,\r
 'Segoe UI',\r
 Roboto,\r
 Arial,\r
 sans-serif;color: #1f2937;width: 100%;padding: 0;margin: 10px 0px 10px 0px;}.record-name-link`,t," {text-decoration: none;color: #667eea;font-weight: 600;transition: color 0.2s ease;}.record-name-link:hover",t," {color: #5a67d8;}.desktop-view",t," {display: block;}.records-table",t," {width: 100%;border-collapse: collapse;background: #ffffff;border-radius: 16px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);overflow: hidden;border: 1px solid rgba(0, 0, 0, 0.06);}.records-table",t," thead",t," {background: #f8fafc;}.records-table",t," th",t," {padding: 20px 24px;text-align: left;font-weight: 600;font-size: 14px;color: #374151;border-bottom: 1px solid #e5e7eb;letter-spacing: 0.025em;}.records-table",t," td",t," {padding: 20px 24px;font-size: 14px;border-bottom: 1px solid #f3f4f6;vertical-align: middle;color: #6b7280;}.records-table",t," tr:last-child",t," td",t," {border-bottom: none;}.records-table",t," tr:hover",t," {background: #f9fafb;}.mobile-view",t," {display: none;}.record-card",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);margin: 12px 2px;overflow: hidden;padding: 16px;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.record-card:hover",t," {box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.status-pill",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 9999px;font-size: 12px;font-weight: 700;letter-spacing: 0.025em;}.status-pill--open",t," {background: rgba(16, 185, 129, 0.15);color: #065f46;}.status-pill--closed",t," {background: rgba(124, 58, 237, 0.15);color: #4c1d95;}.card-content",t," {display: flex;align-items: flex-start;margin-bottom: 16px;}.card-icon",t," {background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);border-radius: 12px;width: 48px;height: 48px;display: flex;align-items: center;justify-content: center;margin-right: 16px;flex-shrink: 0;}.record-icon",t," {width: 24px;height: 24px;fill: #3b82f6;}.card-details",t," {flex: 1;}.card-title",t," {margin: 0 0 8px 0;font-size: 18px;font-weight: 600;color: #111827;line-height: 1.3;}.card-metadata",t," {display: flex;flex-direction: column;gap: 8px;}.card-field",t," {font-size: 14px;color: #6b7280;line-height: 1.5;}.card-footer",t," {display: flex;justify-content: space-between;align-items: center;margin-top: 16px;padding-top: 16px;border-top: 1px solid #f3f4f6;}.card-menu",t," {display: flex;align-items: center;position: relative;}.dropdown",t," {position: relative;display: inline-block;}.three-dots",t," {font-size: 20px;color: #9ca3af;cursor: pointer;padding: 8px;user-select: none;display: inline-flex;align-items: center;justify-content: center;border-radius: 8px;transition: all 0.2s ease;}.three-dots:hover",t," {color: #6b7280;background: #f3f4f6;}.dropdown-content",t," {display: none;position: absolute;right: 0;top: 100%;min-width: 140px;background: #ffffff;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);border-radius: 12px;z-index: 100;overflow: hidden;margin-top: 8px;border: 1px solid rgba(0, 0, 0, 0.06);}.dropdown-content.show",t," {display: block;}.dropdown-item",t," {padding: 12px 16px;font-size: 14px;color: #374151;cursor: pointer;transition: background-color 0.2s ease;font-weight: 500;}.dropdown-item:not(:last-child)",t," {border-bottom: 1px solid #f3f4f6;}.dropdown-item:hover",t," {background: #f9fafb;color: #111827;}.loading-spinner",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 60px 40px;color: #6b7280;}.spinner",t," {width: 48px;height: 48px;border: 4px solid #f3f4f6;border-top: 4px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 20px;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;}.error-message",t," {display: flex;align-items: center;padding: 20px 24px;background: #fef2f2;border: 1px solid #fecaca;border-radius: 16px;margin: 20px 0;color: #dc2626;}.error-icon",t," {margin-right: 16px;font-size: 20px;}.error-text",t," {font-size: 14px;font-weight: 500;line-height: 1.5;}.no-data",t," {padding: 40px 24px;text-align: center;color: #9ca3af;background: #f9fafb;border-radius: 16px;font-size: 16px;margin-top: 20px;font-weight: 500;}@media screen and (max-width: 768px) {.desktop-view",t," {display: none;}.mobile-view",t," {display: block;}.record-card",t," {margin-bottom: 12px;padding: 16px;}.card-icon",t," {width: 40px;height: 40px;margin-right: 12px;}.card-title",t," {font-size: 16px;}.card-metadata",t," {gap: 6px;}}.view-more-container",t," {display: flex;justify-content: center;margin: 24px 0;}.view-more-button",t," {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: #ffffff;border: none;border-radius: 12px;padding: 12px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);}.view-more-button:hover",t," {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);}"].join("")}var go=[Jn];const Qn=p`<div class="loading-spinner${0}"${2}><div class="spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading records...</div></div>`,Yn=p`<div class="error-message${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-text${0}"${2}>${"t4"}</div></div>`,Kn=p`<th${3}>${"t1"}</th>`,Gn=p`<th${3}>Actions</th>`,Xn=p`<td${3}>${"t1"}</td>`,Zn=p`<td${3}><div class="dropdown${0}"${2}><div class="three-dots${0}"${"a2:data-id"}${2}>⋮</div><div class="dropdown-content${0}"${"a4:data-id"}${2}><div class="dropdown-item${0}" data-action="view"${"a5:data-id"}${2}>View</div><div class="dropdown-item${0}" data-action="edit"${"a7:data-id"}${2}>Edit</div><div class="dropdown-item${0}" data-action="delete"${"a9:data-id"}${2}>Delete</div></div></div></td>`,er=p`<div class="no-data${0}"${2}>No records found</div>`,tr=p`<div class="card-icon${0}"${2}><svg class="record-icon${0}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"${2}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"${3}/></svg></div>`,sr=p`<h3 class="card-title${0}"${2}><a href="#" class="record-name-link${0}"${"a1:data-id"}${2}>${"t2"}</a></h3>`,or=p`<div class="card-field${0}"${2}><strong${3}>${"t2"}</strong>${"t3"}</div>`,ir=p`<div class="no-data${0}"${2}>No records found</div>`,ar=p`<div class="view-more-container${0}"${2}><button class="view-more-button${0}"${2}>View More</button></div>`,nr={classMap:{"generic-list-container":!0},key:0},rr={classMap:{"desktop-view":!0},key:5},lr={classMap:{"records-table":!0},key:6},cr={key:7},dr={key:8},hr={key:13},ur={classMap:{"mobile-view":!0},key:21},pr={"record-card":!0},fr={classMap:{"card-content":!0},key:23},mr={classMap:{"card-details":!0},key:26},gr={classMap:{"card-metadata":!0},key:29},_o=[];function Ue(n,e,s,t){const{st:o,d:i,sp:a,k:r,i:l,f:c,h:d,b:h}=n,{_m0:u,_m1:f,_m2:g,_m3:_,_m4:m,_m5:x}=t;return[d("div",nr,[e.isLoading?o(Qn,2):null,e.error?o(Yn,4,[a(4,null,i(e.error))]):null,d("div",rr,[e.isLoading?null:e.filteredRecords.length?d("table",lr,[d("thead",cr,[d("tr",dr,c([l(e.columns,function(k){return o(Kn,r(10,k.fieldName),[a(1,null,i(k.label))])}),o(Gn,12)]))]),d("tbody",hr,l(e.visibleItems,function(k){return d("tr",{key:r(14,k.id)},c([l(k.fields,function($){return o(Xn,r(16,$.name),[a(1,null,i($.value))])}),o(Zn,18,[a(2,{on:u||(t._m0={click:h(e.toggleDropdown)}),attrs:{"data-id":k.id}},null),a(4,{attrs:{"data-id":k.id}},null),a(5,{on:f||(t._m1={click:h(e.handleAction)}),attrs:{"data-id":k.id}},null),a(7,{on:g||(t._m2={click:h(e.handleAction)}),attrs:{"data-id":k.id}},null),a(9,{on:_||(t._m3={click:h(e.handleAction)}),attrs:{"data-id":k.id}},null)])]))}))]):null,e.isLoading||e.filteredRecords.length?null:o(er,20)]),d("div",ur,e.isLoading?_o:c([e.filteredRecords.length?l(e.visibleItems,function(k){return d("div",{classMap:pr,key:r(22,k.id)},[d("div",fr,[o(tr,25),d("div",mr,[o(sr,28,[a(1,{on:m||(t._m4={click:h(e.handleRecordClick)}),attrs:{"data-id":k.id}},null),a(2,null,i(k.title))]),d("div",gr,l(k.displayFields,function($){return o(or,r(31,$.name),[a(2,null,i($.label)+": "),a(3,null,i($.value))])}))])])])}):_o,e.filteredRecords.length?null:o(ir,33)])),e.showViewMoreButton?o(ar,35,[a(1,{on:x||(t._m5={click:h(e.handleViewMore)})},null)]):null])]}var _r=J(Ue);Ue.stylesheets=[],Ue.stylesheetToken="lwc-3u019o1v0um",Ue.legacyStylesheetToken="c-genericListView_genericListView",go&&Ue.stylesheets.push.apply(Ue.stylesheets,go),Q(Ue);class bo extends K{constructor(...e){super(...e);this.recordId=void 0,this.records=[],this.processedRecords=[],this.filteredRecords=[],this.columns=[],this.isLoading=!1,this.error=null,this.viewConfig={},this.defaultFields=[],this.searchTerm="",this.visibleItemCount=5,this.isDeviceOnline=!0,this._objectApiName=""}get objectApiName(){return this._objectApiName}set objectApiName(e){this._objectApiName=e,e&&this.loadViewConfig()}connectedCallback(){this.documentClickListener=this.handleDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener),this.searchListener=this.handleSearch.bind(this),this.addEventListener("search",this.searchListener),this.urlChangeListener=this.checkUrlForObjectApiName.bind(this),window.addEventListener("popstate",this.urlChangeListener),X.addListener("networkStatusChange",e=>{this.isDeviceOnline=e.connected,this.isDeviceOnline||this.checkUrlForObjectApiName()}),this.checkUrlForObjectApiName()}renderedCallback(){X.addListener("networkStatusChange",e=>{this.isDeviceOnline=e.connected,this.isDeviceOnline||this.checkUrlForObjectApiName()})}async checkUrlForObjectApiName(){const e=await X.getStatus();console.log("Network status:",JSON.stringify(e)),this.isDeviceOnline=e.connected;const s=new URLSearchParams(window.location.search);this.objectApiName=s.get("navigate"),this.objectApiName&&(console.log("Found objectApiName in URL:",this.objectApiName),this.loadViewConfig())}disconnectedCallback(){document.removeEventListener("click",this.documentClickListener),this.removeEventListener("search",this.searchListener),window.removeEventListener("popstate",this.urlChangeListener)}refresh(){this.checkUrlForObjectApiName()}async loadViewConfig(){try{this.isLoading=!0,this.error=null,this.viewConfig={objectApiName:this.objectApiName},await this.loadFieldsConfig()}catch(e){console.error("Error loading view config:",e),this.error=e.message,this.isLoading=!1}}async loadFieldsConfig(){if(!(!this.viewConfig||!this.viewConfig.objectApiName))try{console.log("isDeviceOnline",this.isDeviceOnline);let e;if(this.isDeviceOnline)try{e=await ss(this.viewConfig.objectApiName,!1,!1)}catch(s){console.error("Error fetching field configs online:",s),e=await this.getLocalFieldConfigs(this.viewConfig.objectApiName)}else console.log("\u{1F4F1} Device is offline, retrieving cached field configurations"),e=await this.getLocalFieldConfigs(this.viewConfig.objectApiName),console.log("fieldConfigs",e);if(e&&e.length>0){const s=e[0];this.viewConfig.relatedToApiName=s.Rhythm__Related_To_Api_Name__c,s.Rhythm__Default_Fields__c&&(this.defaultFields=s.Rhythm__Default_Fields__c.split(",").map(o=>o.trim()));let t=0;if(s.Rhythm__Fields_Limit__c&&(t=s.Rhythm__Fields_Limit__c,this.defaultFields&&this.defaultFields.length>t&&(this.defaultFields=this.defaultFields.slice(0,t))),s.Rhythm__Field_Label__c&&s.Rhythm__Field_Name__c){const o=s.Rhythm__Field_Label__c.split(",").map(a=>a.trim());let i=s.Rhythm__Field_Name__c.split(",").map(a=>a.trim());i&&i.length>t&&(i=i.slice(0,t)),this.columns=i.map((a,r)=>{const l=a.includes(".");let c={fieldName:a,label:o[r]||this.formatFieldLabel(a),isRelationship:l};if(l){const d=a.split(".");c.relationshipField=d[0],c.relationshipAttribute=d[1]}return c}),this.viewConfig.fields=this.defaultFields}this.loadRecords()}else this.error=`No field configuration found for ${this.viewConfig.objectApiName}`,this.isLoading=!1}catch(e){console.error("Error loading field configurations:",e),this.error=e.message,this.isLoading=!1}}async getLocalFieldConfigs(e){try{const s=`field_config_${e}`,o=(await de(Z.FIELDS_CONFIG)).find(i=>i.id===s);return o&&o.fieldConfigs?(console.log(`\u{1F4F1} Retrieved cached field configuration for ${e}`),console.log("cachedConfig fieldConfigs",o.fieldConfigs),o.fieldConfigs):(console.log(`\u{1F4F1} No cached field configuration found for ${e}`),[])}catch(s){return console.error(`Error getting local field configs for ${e}:`,s),[]}}async loadRecords(){if(!this.viewConfig||!this.viewConfig.objectApiName||!this.viewConfig.fields||this.viewConfig.fields.length===0){this.error="Invalid configuration",this.isLoading=!1;return}try{this.isLoading=!0;let e;if(this.isDeviceOnline)try{let s=localStorage.getItem("sf_user_id");s||(s=sessionStorage.getItem("sf_user_id"));const t=this.viewConfig.fields.join(", ");let o="";if(this.viewConfig.objectApiName==="Task"){let a=await dn(this.viewConfig.objectApiName,t);try{a=a.replace(/\\"/g,'"')}catch(l){console.error("Error cleaning JSON:",l)}const r=JSON.parse(a);console.log("parsedData",r),e=r.records,console.log("records",e)}else o=`SELECT Id, ${t} FROM ${this.viewConfig.objectApiName} ORDER BY CreatedDate DESC`,e=await le(o)}catch(s){console.error("Error fetching records online:",s),e=await this.getLocalRecords(this.viewConfig.objectApiName)}else console.log("\u{1F4F1} Device is offline, retrieving cached records"),e=await this.getLocalRecords(this.viewConfig.objectApiName),console.log("records",e);e&&e.length>0?(this.records=e,this.processRecords()):(this.records=[],this.processedRecords=[],this.filteredRecords=[])}catch(e){console.error("Error loading records:",e),this.error=e.message,this.records=[],this.processedRecords=[],this.filteredRecords=[]}finally{this.isLoading=!1}}async getLocalRecords(e){try{const s=`records_${e}`,o=(await de(Z.LIST_VIEW_RECORDS)).find(i=>i.id===s);return o&&o.records?(console.log(`\u{1F4F1} Retrieved ${o.records.length} cached records for ${e}`),console.log("cachedData records",o.records),o.records):(console.log(`\u{1F4F1} No cached records found for ${e}`),[])}catch(s){return console.error(`Error getting local records for ${e}:`,s),[]}}processRecords(){this.processedRecords=this.records.map(e=>{const s={id:e.Id,fields:[]};return this.columns.forEach(t=>{let o="";if(t.isRelationship){const i=e[t.relationshipField];i&&(o=i[t.relationshipAttribute]||"")}else o=e[t.fieldName]||"";if(typeof o=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\+\d{4}$/.test(o)){const i=new Date(o);if(!isNaN(i.getTime())){const a=i.getDate().toString().padStart(2,"0"),r=(i.getMonth()+1).toString().padStart(2,"0"),l=i.getFullYear();let c=i.getHours();const d=c>=12?"pm":"am";c=c%12,c=c||12;const h=i.getMinutes().toString().padStart(2,"0");o=`${a}/${r}/${l}, ${c}:${h} ${d}`}}s.fields.push({name:t.fieldName,label:t.label,value:o})}),s.title=s.fields.length>0?s.fields[0].value:"Untitled",s.displayFields=s.fields.slice(1).map(t=>({name:t.name,label:t.label||this.formatFieldLabel(t.name),value:t.value})),s}),this.filteredRecords=[...this.processedRecords]}formatFieldLabel(e){let s=e.replace("__c","");return s.includes("__r.")&&(s=s.replace("__r."," ")),s.replace(/_/g," ").split(" ").map(o=>this.capitalizeFirstLetter(o)).join(" ")}capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}handleSearch(e){e&&e.detail&&(this.searchTerm=e.detail.searchTerm||"",console.log("GenericListView received search term:",this.searchTerm)),this.applySearch()}applySearch(){if(!this.searchTerm||this.searchTerm.trim()==="")this.filteredRecords=[...this.processedRecords];else{const e=this.searchTerm.toLowerCase();this.filteredRecords=this.processedRecords.filter(s=>s.fields.some(t=>t.value&&t.value.toString().toLowerCase().includes(e)))}this.visibleItemCount=5}get visibleItems(){return this.filteredRecords.slice(0,this.visibleItemCount)}get showViewMoreButton(){return this.filteredRecords.length>this.visibleItemCount}handleViewMore(){this.visibleItemCount+=5}toggleDropdown(e){e.stopPropagation();const s=e.currentTarget.dataset.id,t=this.template.querySelector(`.dropdown-content[data-id="${s}"]`);this.template.querySelectorAll(".dropdown-content.show").forEach(o=>{o!==t&&o.classList.remove("show")}),t&&t.classList.toggle("show")}handleDocumentClick(e){this.template.contains(e.target)||this.template.querySelectorAll(".dropdown-content.show").forEach(s=>{s.classList.remove("show")})}handleRecordClick(e){e.preventDefault();const s=e.currentTarget.dataset.id;console.log(`Record clicked: ${s}, navigating to detail view`);const t=new CustomEvent("navigate",{detail:{type:"detail",objectApiName:this.objectApiName,recordId:s},bubbles:!0,composed:!0});this.dispatchEvent(t),console.log("Navigation event dispatched:",{type:"detail",objectApiName:this.objectApiName,recordId:s}),this.dispatchEvent(new CustomEvent("recordselect",{detail:{recordId:s}}))}handleAction(e){e.stopPropagation();const s=e.currentTarget.dataset.action,t=e.currentTarget.dataset.id;s==="view"&&(console.log(`View action clicked for record: ${t}, navigating to detail view`),this.dispatchEvent(new CustomEvent("navigate",{detail:{type:"detail",objectApiName:this.objectApiName,recordId:t},bubbles:!0,composed:!0}))),this.dispatchEvent(new CustomEvent("recordaction",{detail:{action:s,recordId:t}})),this.template.querySelectorAll(".dropdown-content.show").forEach(o=>{o.classList.remove("show")})}}Y(bo,{publicProps:{recordId:{config:0},objectApiName:{config:3}},publicMethods:["refresh"],track:{records:1,processedRecords:1,filteredRecords:1,columns:1,isLoading:1,error:1,viewConfig:1,defaultFields:1,searchTerm:1,visibleItemCount:1,isDeviceOnline:1},fields:["_objectApiName"]});const ms=z(bo,{tmpl:_r,sel:"c-generic-list-view",apiVersion:63});function br(n,e,s){var t=n?"["+n+"]":"",o=n?"["+n+"-host]":"",i=n?"-"+n:"";return(e?":host {":o+" {")+"display: block;width: 100%;height: 100%;background-color: #f8f9fa;}.tabs-shell"+t+" {display: flex;flex-direction: column;width: 100%;height: 100%;overflow: hidden;background-color: #f8f9fa;}.loading-container"+t+",\r.error-container"+t+",\r.no-tabs-container"+t+" {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 2rem;text-align: center;height: 200px;}.loading-spinner"+t+" {width: 32px;height: 32px;border: 3px solid #e2e8f0;border-top: 3px solid #3182ce;border-radius: 50%;animation: spin"+i+" 1s linear infinite;margin-bottom: 1rem;}@keyframes spin"+i+" {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text"+t+",\r.error-message"+t+",\r.no-tabs-message"+t+" {font-size: 1rem;color: #4a5568;margin-bottom: 1rem;}.error-icon"+t+",\r.no-tabs-icon"+t+" {font-size: 2rem;margin-bottom: 1rem;}.retry-button"+t+" {padding: 0.5rem 1rem;background-color: #3182ce;color: white;border: none;border-radius: 6px;cursor: pointer;font-size: 0.875rem;transition: background-color 0.2s;}.retry-button:hover"+t+" {background-color: #2c5aa0;}.page-header"+t+" {display: flex;align-items: center;padding: 0.75rem 1rem;padding-top: 50px;background-color: #f8f9fa;border-bottom: 1px solid #e2e8f0;min-height: 50px;}.back-button"+t+" {display: flex;align-items: center;justify-content: center;background-color: transparent;border: none;border-radius: 6px;padding: 0.5rem;cursor: pointer;margin-right: 1rem;transition: all 0.2s;width: 40px;height: 40px;}.back-button:hover"+t+" {background-color: #f3f4f6;}.back-icon"+t+" {width: 20px;height: 20px;color: #4b5563;}.page-title"+t+" {font-size: 1.25rem;font-weight: 600;color: #1f2937;margin: 0;}.tabs-page"+t+" {display: flex;flex-direction: column;width: 100%;height: 100%;background-color: #f8f9fa;}.tabs-list"+t+" {flex: 1;padding: 1rem;margin: 0 auto;width: 100%;max-width: 350px;overflow-y: auto;background-color: #f8f9fa;}.tab-item"+t+" {display: flex;align-items: center;justify-content: space-between;width: auto;background-color: #ffffff;border-radius: 8px;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);cursor: pointer;transition: all 0.2s;user-select: none;padding: 16px 20px;min-height: 20px;margin-bottom: 8px;}.tab-item:last-child"+t+" {margin-bottom: 0;}.tab-item:hover"+t+" {background-color: #f9fafb;}.tab-item:active"+t+" {background-color: #f3f4f6;}.tab-label"+t+" {font-size: 1.1rem;font-weight: 500;color: #1f2937;flex: 1;}.tab-arrow"+t+" {width: 16px;height: 16px;color: #9ca3af;margin-left: 1rem;flex-shrink: 0;}.tab-item:first-child"+t+" {border-top: none;}.tab-item:last-child"+t+" {border-bottom: none;}.component-page"+t+" {display: flex;flex-direction: column;width: 100%;height: 100%;background-color: #ffffff;}.component-content"+t+" {flex: 1;padding: 1.5rem;overflow-y: auto;background-color: #ffffff;}@media (max-width: 768px) {.page-header"+t+" {padding: 0.75rem 1rem;padding-top: 50px;min-height: 50px;}.page-title"+t+" {font-size: 1.25rem;}.back-button"+t+" {padding: 0.375rem;width: 36px;height: 36px;}.back-icon"+t+" {width: 18px;height: 18px;}.tab-item"+t+" {padding: 16px;min-height: 30px;}.tab-label"+t+" {font-size: 0.9rem;}.component-content"+t+" {padding: 1rem;}}.back-button:focus"+t+",\r.tab-item:focus"+t+",\r.retry-button:focus"+t+" {outline: 2px solid #3182ce;outline-offset: 2px;}@media (prefers-contrast: high) {.tab-item"+t+" {border-color: #000000;}.page-header"+t+" {border-color: #000000;}.back-button"+t+" {border-color: #000000;}}"}var yo=[br];const yr=p`<div class="loading-container${0}"${2}><div class="loading-spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading tabs...</div></div>`,vr=p`<div class="error-container${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-message${0}"${2}>${"t4"}</div><button class="retry-button${0}"${2}>Retry</button></div>`,wr=p`<div class="no-tabs-container${0}"${2}><div class="no-tabs-icon${0}"${2}>ℹ️</div><div class="no-tabs-message${0}"${2}>No tabs available for this record.</div></div>`,xr=p`<div class="page-header${0}"${2}><button class="back-button${0}" aria-label="Go back to list"${2}><svg class="back-icon${0}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${2}><path d="M19 12H5"${3}/><path d="M12 19l-7-7 7-7"${3}/></svg></button><h1 class="page-title${0}"${2}>${"t6"}</h1></div>`,kr=p`<div class="tab-item${0}"${"a0:data-tab-id"}${2}><span class="tab-label${0}"${2}>${"t2"}</span><svg class="tab-arrow${0}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${2}><path d="M9 18l6-6-6-6"${3}/></svg></div>`,$r={classMap:{"tabs-shell":!0},key:0},Cr={classMap:{"tabs-page":!0},key:7},Sr={classMap:{"tabs-list":!0},key:10};function Ve(n,e,s,t){const{st:o,d:i,b:a,sp:r,k:l,i:c,h:d}=n,{_m0:h,_m1:u,_m2:f,_m3:g}=t;return[d("div",$r,[e.isLoading?o(yr,2):null,e.hasError?o(vr,4,[r(4,null,i(e.errorMessage)),r(5,{on:h||(t._m0={click:a(e.handleRetry)})},null)]):null,e.showNoTabsMessage?o(wr,6):null,e.showTabsView?d("div",Cr,[o(xr,9,[r(1,{on:u||(t._m1={click:a(e.handleBackToList)})},null),r(6,null,i(e.recordTitle))]),d("div",Sr,c(e.availableTabs,function(_){return o(kr,l(12,_.id),[r(0,{on:g||(t._m3={click:a(e.handleTabClick)}),attrs:{"data-tab-id":_.id}},null),r(2,null,i(_.label))])}))]):null])]}var Er=J(Ve);Ve.stylesheets=[],Ve.stylesheetToken="lwc-omaf4u6jqk",Ve.legacyStylesheetToken="c-tabsShell_tabsShell",yo&&Ve.stylesheets.push.apply(Ve.stylesheets,yo),Q(Ve);class vo extends K{constructor(...e){super(...e);this.objectApiName=void 0,this.recordId=void 0,this.isLoading=!0,this.hasError=!1,this.errorMessage="",this.availableTabs=[],this.recordTitle=""}connectedCallback(){this.loadRootTabs(),this.loadRecordName()}async loadRecordName(){if(!this.recordId||!this.objectApiName){this.recordTitle=this.getDefaultTitle();return}try{console.log(`\u{1F50D} Loading record name for ${this.objectApiName}:${this.recordId}`);const e=await Fe.getRecordName(this.objectApiName,this.recordId);if(console.log("recordData",JSON.stringify(e)),e&&e.Name)this.recordTitle=e.Name,console.log(`\u2705 Loaded record name: ${this.recordTitle}`);else{const s=this.objectApiName.replace(/^.*__/,"").replace(/__c$/,"").replace(/_/g," ");this.recordTitle=`${s}`,console.log(`\u2139\uFE0F Using fallback record title: ${this.recordTitle}`)}}catch(e){console.error("\u274C Error loading record name:",e),this.recordTitle=this.getDefaultTitle()}}getDefaultTitle(){return this.recordId?"Record Details":this.objectApiName==="Task"?"New Task":`New ${this.objectApiName?.replace(/^.*__/,"")?.replace(/__c$/,"")?.replace(/_/g," ")||"Record"}`}refresh(){this.loadRootTabs()}get isLoadingOrError(){return this.isLoading||this.hasError}get showNoTabsMessage(){return!this.isLoadingOrError&&!this.availableTabs.length}get canGoBack(){return!0}get showTabsView(){return!this.isLoadingOrError&&this.availableTabs.length>0}async loadRootTabs(){if(!this.objectApiName){this.setError("No object API name provided");return}try{this.isLoading=!0,this.hasError=!1,this.errorMessage="",console.log(`\u{1F504} Loading tabs for ${this.objectApiName}:${this.recordId}`);const e=await Fe.getTabsForObject(this.objectApiName,this.recordId);if(!e||e.length===0){console.log("\u2139\uFE0F No tabs found for this object"),this.availableTabs=[];return}console.log("tabs",JSON.stringify(e)),this.availableTabs=e.map(s=>({id:s.id||s.tabId,label:s.label||s.tabLabel||"Unknown Tab",component:s.component||s.componentName,props:s.props||{},iconName:s.iconName||"\u{1F4C4}",isAttachment:s.isAttachment,listViewObject:s.listViewObject})),console.log("this.availableTabs",JSON.stringify(this.availableTabs)),console.log(`\u2705 Loaded ${this.availableTabs.length} tabs:`,this.availableTabs)}catch(e){console.error("\u274C Error loading tabs:",e),this.setError(`Failed to load tabs: ${e.message}`)}finally{this.isLoading=!1}}handleTabClick(e){const s=e.currentTarget.dataset.tabId,t=this.availableTabs.find(o=>o.id===s);if(!t){console.error("\u274C Tab not found:",s);return}console.log(`\u{1F504} Opening tab: ${t.label} (${t.component})`),console.log("selectedTab in line 181",JSON.stringify(t)),this.dispatchEvent(new CustomEvent("navigate",{detail:{type:"component",component:t.component,props:t.props||{},tabLabel:t.label,tabId:t.id,isAttachment:t.isAttachment,listViewObject:t.listViewObject}}))}handleBackToList(){console.log("\u{1F504} Navigating back to list"),this.dispatchEvent(new CustomEvent("navigate",{detail:{type:"back",objectApiName:this.objectApiName,recordId:this.recordId},bubbles:!0,composed:!0}))}handleRetry(){console.log("\u{1F504} Retrying tab load"),this.loadRootTabs()}setError(e){this.hasError=!0,this.errorMessage=String(e||"Unknown error"),this.isLoading=!1,console.error("\u274C TabsShell Error:",e),this.dispatchEvent(new CustomEvent("error",{detail:{message:this.errorMessage,component:"TabsShell"}}))}handleComponentError(e){const s=e.detail;console.error("\u274C Component Error:",s),this.setError(`Component error: ${s.message}`)}}Y(vo,{publicProps:{objectApiName:{config:0},recordId:{config:0}},publicMethods:["refresh"],track:{isLoading:1,hasError:1,errorMessage:1,availableTabs:1,recordTitle:1}});const Rr=z(vo,{tmpl:Er,sel:"c-tabs-shell",apiVersion:63});function Ar(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0, 0, 0, 0.6);backdrop-filter: blur(8px);display: flex;align-items: center;justify-content: center;z-index: 1200;padding: 20px;animation: fadeIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.modal-container",t," {background: #ffffff;border-radius: 0;box-shadow: none;width: 100%;max-width: 100%;max-height: none;display: flex;flex-direction: column;overflow: hidden;animation: none;border: none;}.page-wrapper",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;z-index: 1200;background: #ffffff;display: flex;flex-direction: column;}.modal-header",t,` {display: flex;justify-content: center;align-items: center;padding-top: 50px;padding: 24px 32px;border-bottom: 1px solid rgba(0, 0, 0, 0.08);background: linear-gradient(\r
 135deg,\r
 rgba(102, 126, 234, 0.1) 0%,\r
 rgba(118, 75, 162, 0.1) 100%\r
 );}.modal-title`,t," {margin: 0;font-size: 24px;padding-top: 50px;font-weight: 700;color: #1a1a1a;letter-spacing: -0.5px;text-align: center;}.close-button",t," {display: none;}.modal-content",t," {flex: 1;overflow-y: auto;padding: 0 32px;scroll-behavior: smooth;}.modal-content",t,"::-webkit-scrollbar {width: 6px;}.modal-content",t,"::-webkit-scrollbar-track {background: transparent;}.modal-content",t,"::-webkit-scrollbar-thumb {background: rgba(0, 0, 0, 0.1);border-radius: 3px;}.required-note",t," {text-align: right;margin: 20px 0 16px 0;font-size: 13px;color: #6b7280;font-style: italic;}.asterisk",t," {color: #ef4444;font-weight: 600;}.form-section",t," {margin-bottom: 32px;}.section-title",t," {font-size: 18px;font-weight: 600;color: #111827;margin: 0 0 20px 0;padding: 12px 20px;background: #f3ebff;border-radius: 12px;}.fields-grid",t," {display: grid;grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));gap: 20px;}.field-container",t," {width: 100%;}.form-group",t," {display: flex;flex-direction: column;}.field-label",t," {font-size: 14px;font-weight: 600;color: #374151;margin-bottom: 8px;display: flex;align-items: center;gap: 4px;}.form-input",t,",\r.form-textarea",t,",\r.form-select",t," {width: 100%;padding: 12px 16px;border: 2px solid #e5e7eb;border-radius: 12px;font-size: 16px;font-family: inherit;background: #ffffff;transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);color: #374151;box-sizing: border-box;}.form-input:focus",t,",\r.form-textarea:focus",t,",\r.form-select:focus",t," {outline: none;border-color: #667eea;box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);transform: translateY(-1px);}.form-select",t,` {cursor: pointer;-webkit-appearance: none;-moz-appearance: none;appearance: none;background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position: right 12px center;background-repeat: no-repeat;background-size: 16px;padding-right: 40px;}.form-select`,t,"::-ms-expand {display: none;}.form-select",t," option",t," {padding: 8px 12px;color: #374151;background: #ffffff;}.form-textarea",t," {resize: vertical;min-height: 80px;font-family: inherit;}.checkbox-group",t," {flex-direction: row;align-items: flex-start;margin-top: 8px;}.force-update",t," {animation: force-repaint",o," 0.01s;}@keyframes force-repaint",o," {0% {opacity: 0.99;}100% {opacity: 1;}}.checkbox-label",t," {display: flex;align-items: flex-start;cursor: pointer;gap: 12px;font-size: 14px;line-height: 1.5;}.form-checkbox",t," {width: 20px;height: 20px;margin: 0;cursor: pointer;accent-color: #7c3aed;border-radius: 4px;flex-shrink: 0;margin-top: 2px;-webkit-appearance: checkbox;-moz-appearance: checkbox;appearance: checkbox;opacity: 1;visibility: visible;}.checkbox-text",t," {color: #374151;font-weight: 500;}.file-upload-container",t," {margin-top: 16px;}.file-upload-label",t," {display: block;cursor: pointer;}.file-input",t," {display: none;}.file-upload-area",t," {border: 2px dashed #d1d5db;border-radius: 16px;padding: 32px 24px;text-align: center;background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);transition: all 0.3s ease;display: flex;flex-direction: column;align-items: center;gap: 12px;}.file-upload-area:hover",t," {border-color: #667eea;background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);transform: translateY(-2px);}.upload-icon",t," {color: #6b7280;transition: color 0.2s ease;}.file-upload-area:hover",t," .upload-icon",t," {color: #667eea;}.upload-text",t," {font-size: 16px;font-weight: 600;color: #374151;}.upload-hint",t," {font-size: 13px;color: #9ca3af;}.uploaded-files",t," {margin-top: 16px;padding: 16px;background: #f9fafb;border-radius: 12px;border: 1px solid #e5e7eb;}.files-title",t," {margin: 0 0 12px 0;font-size: 14px;font-weight: 600;color: #059669;}.files-list",t," {list-style: none;margin: 0;padding: 0;display: flex;flex-direction: column;gap: 8px;}.file-item",t," {display: flex;align-items: center;gap: 8px;font-size: 14px;color: #374151;padding: 8px 12px;background: #ffffff;border-radius: 8px;border: 1px solid #e5e7eb;}.file-icon",t," {color: #6b7280;flex-shrink: 0;}.modal-footer",t," {display: flex;justify-content: flex-end;gap: 12px;padding: 24px 32px;border-top: 1px solid rgba(0, 0, 0, 0.08);background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);}.button",t," {padding: 12px 24px;border-radius: 12px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);display: flex;align-items: center;justify-content: center;gap: 8px;border: none;min-width: 100px;}.button:disabled",t," {cursor: not-allowed;opacity: 0.6;}.button-secondary",t," {background: #ffffff;color: #551a8b;border: 2px solid #e5e7eb;}.button-secondary:hover:not(:disabled)",t," {background: #f9fafb;border-color: #d1d5db;transform: translateY(-1px);}.button-primary",t," {background: #551a8b;color: #ffffff;box-shadow: 0 4px 12px rgba(75, 20, 126, 0.3);}.button-primary:hover:not(:disabled)",t," {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);}.button-spinner",t," {width: 16px;height: 16px;border: 2px solid rgba(255, 255, 255, 0.3);border-top: 2px solid #ffffff;border-radius: 50%;animation: spin",o," 1s linear infinite;}.loading-container",t,",\r.error-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 60px 40px;text-align: center;}.spinner",t," {width: 48px;height: 48px;border: 4px solid #f3f4f6;border-top: 4px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 20px;}.loading-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;margin: 0;}.error-container",t," {color: #dc2626;background-color: #fff5f5;border: 1px solid #ff8080;border-radius: 4px;padding: 16px;margin-bottom: 16px;display: flex;align-items: flex-start;justify-content: space-between;flex-direction: row;text-align: left;}.error-content",t," {display: flex;align-items: flex-start;flex: 1;}.error-icon",t," {font-size: 24px;margin-right: 12px;margin-bottom: 0;flex-shrink: 0;}.error-text",t," {font-size: 16px;font-weight: 500;margin: 0;line-height: 1.5;flex: 1;word-break: break-word;}.error-dismiss",t," {background: none;border: none;color: #dc2626;font-size: 24px;font-weight: bold;cursor: pointer;padding: 0 0 0 12px;margin-left: 12px;line-height: 1;align-self: flex-start;flex-shrink: 0;}.error-dismiss:hover",t," {color: #b91c1c;}@keyframes fadeIn",o," {from {opacity: 0;}to {opacity: 1;}}@keyframes slideUp",o," {from {transform: translateY(40px);opacity: 0;}to {transform: translateY(0);opacity: 1;}}@keyframes spin",o," {from {transform: rotate(0deg);}to {transform: rotate(360deg);}}@media screen and (max-width: 768px) {.modal-overlay",t," {padding: 0;align-items: flex-start;}.modal-container",t," {max-width: 100%;max-height: none;border-radius: 0;}.modal-header",t," {padding: 20px 24px;justify-content: center;}.modal-title",t," {font-size: 20px;text-align: center;}.modal-content",t," {padding: 0 24px;}.modal-footer",t," {padding: 20px 24px;flex-direction: column;}.button",t," {width: 100%;justify-content: center;}.fields-grid",t," {grid-template-columns: 1fr;gap: 16px;}.form-input",t,",\r .form-textarea",t,",\r .form-select",t," {font-size: 16px;}.file-upload-area",t," {padding: 24px 16px;}.section-title",t," {font-size: 16px;padding: 10px 16px;}}@media screen and (max-width: 480px) {.modal-overlay",t," {padding: 0;}.modal-container",t," {border-radius: 0;max-height: none;}.modal-header",t," {padding: 16px 20px;justify-content: center;}.modal-content",t," {padding: 0 20px;}.modal-footer",t," {padding: 16px 20px;}.fields-grid",t," {gap: 12px;}}.immediate-correction-field",t," .input-with-buttons",t," {display: flex;align-items: center;gap: 8px;}.immediate-correction-field",t," .form-input",t," {flex: 1;}.field-buttons",t," {display: flex;gap: 4px;}.icon-button",t," {background: none;border: 1px solid #d0d7de;border-radius: 4px;padding: 4px 8px;cursor: pointer;font-size: 14px;line-height: 1;transition: all 0.2s ease;min-width: 32px;height: 32px;display: flex;align-items: center;justify-content: center;}.icon-button:hover",t," {background-color: #f6f8fa;border-color: #1f2328;}.icon-button:active",t," {background-color: #eaeef2;}.plus-button",t," {color: #1f883d;border-color: #1f883d;}.plus-button:hover",t," {background-color: #f6f8fa;border-color: #1a7f37;}.delete-button",t," {color: #d1242f;border-color: #d1242f;}.delete-button:hover",t," {background-color: #fff8f8;border-color: #a40e26;}.icon-button:disabled",t," {opacity: 0.5;cursor: not-allowed;background-color: #f6f8fa;border-color: #d0d7de;color: #656d76;}.icon-button:disabled:hover",t," {background-color: #f6f8fa;border-color: #d0d7de;}.plus-button:disabled",t," {color: #656d76;border-color: #d0d7de;}.plus-button:disabled:hover",t," {background-color: #f6f8fa;border-color: #d0d7de;color: #656d76;}.form-input:disabled",t,",\r.form-textarea:disabled",t,",\r.form-select:disabled",t," {background-color: #f6f8fa;border-color: #d0d7de;color: #656d76;cursor: not-allowed;opacity: 0.8;transition: all 0.3s ease;}.form-checkbox:disabled",t," {cursor: not-allowed;opacity: 0.6;}.checkbox-label:has(.form-checkbox:disabled)",t," {cursor: not-allowed;opacity: 0.8;}.checkbox-label:has(.form-checkbox:disabled)",t," .checkbox-text",t," {color: #656d76;}.multiple-tasks-container",t," {display: flex;flex-direction: column;gap: 24px;}.task-form-container",t," {border: 2px solid #e1e8ed;border-radius: 12px;padding: 20px;background: #f8fafc;position: relative;transition: border-color 0.3s ease;}.task-form-container:hover",t," {border-color: #0891b2;}.task-form-header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: 16px;padding-bottom: 12px;border-bottom: 1px solid #e1e8ed;}.task-form-title",t," {font-size: 16px;font-weight: 600;color: #1f2937;margin: 0;}.task-counter",t," {font-size: 14px;font-weight: 500;color: #6b7280;margin-left: 8px;}.task-form-buttons",t," {display: flex;gap: 8px;align-items: center;}.task-form-fields",t," {display: grid;grid-template-columns: 1fr;gap: 16px;}.task-field",t," {background: #ffffff;border-radius: 8px;padding: 12px;border: 1px solid #e5e7eb;}.icon-button",t," {background: none;border: 2px solid;border-radius: 8px;padding: 6px 10px;cursor: pointer;font-size: 14px;transition: all 0.3s ease;font-weight: 600;min-width: 36px;height: 36px;display: flex;align-items: center;justify-content: center;}.plus-button",t," {border-color: #16a34a;color: #16a34a;background: rgba(22, 163, 74, 0.1);}.plus-button:hover:not(:disabled)",t," {background: #16a34a;color: white;transform: translateY(-1px);box-shadow: 0 4px 8px rgba(22, 163, 74, 0.3);}.delete-button",t," {border-color: #dc2626;color: #dc2626;background: rgba(220, 38, 38, 0.1);}.delete-button:hover:not(:disabled)",t," {background: #dc2626;color: white;transform: translateY(-1px);box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);}.icon-button:disabled",t," {opacity: 0.5;cursor: not-allowed;transform: none;box-shadow: none;}@media (max-width: 768px) {.task-form-header",t," {flex-direction: column;align-items: flex-start;gap: 12px;}.task-form-buttons",t," {align-self: flex-end;}.task-form-fields",t," {gap: 12px;}.task-field",t," {padding: 8px;}}.toast",t," {position: fixed;top: 20px;right: 20px;z-index: 10000;border-radius: 8px;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);max-width: 400px;min-width: 300px;animation: slideInRight",o," 0.3s ease-out;}.toast-success",t," {background: #10b981;color: white;}.toast-error",t," {background: #ef4444;color: white;}.toast-info",t," {background: #3b82f6;color: white;}.toast-content",t," {display: flex;align-items: center;padding: 12px 16px;gap: 12px;}.toast-icon",t," {font-size: 18px;flex-shrink: 0;}.toast-message",t," {flex: 1;font-size: 14px;font-weight: 500;line-height: 1.4;}.toast-close",t," {background: none;border: none;color: inherit;font-size: 18px;cursor: pointer;padding: 0;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;border-radius: 4px;flex-shrink: 0;opacity: 0.8;transition: opacity 0.2s ease;}.toast-close:hover",t," {opacity: 1;background: rgba(255, 255, 255, 0.1);}@keyframes slideInRight",o," {from {transform: translateX(100%);opacity: 0;}to {transform: translateX(0);opacity: 1;}}.help-button",t," {display: inline-block;width: 18px;height: 18px;border-radius: 50%;background-color: #0070d2;color: white;border: none;font-size: 12px;font-weight: bold;cursor: pointer;margin-left: 8px;vertical-align: middle;line-height: 1;text-align: center;transition: background-color 0.2s ease;}.help-button:hover",t," {background-color: #005fb2;}.help-button:active",t," {background-color: #004a8c;}.help-modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0, 0, 0, 0.6);backdrop-filter: blur(8px);display: flex;align-items: center;justify-content: center;z-index: 1300;padding: 20px;animation: fadeIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.help-modal",t," {background: #ffffff;border-radius: 8px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);max-width: 500px;width: 100%;max-height: 80vh;overflow: hidden;animation: slideIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.help-modal-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 20px 24px;border-bottom: 1px solid #e5e5e5;background-color: #f8f9fa;}.help-modal-header",t," h3",t," {margin: 0;font-size: 18px;font-weight: 600;color: #333;}.help-modal-close",t," {background: none;border: none;font-size: 24px;color: #666;cursor: pointer;padding: 0;width: 30px;height: 30px;display: flex;align-items: center;justify-content: center;border-radius: 4px;transition: background-color 0.2s ease;}.help-modal-close:hover",t," {background-color: #e5e5e5;}.help-modal-content",t," {padding: 24px;max-height: 60vh;overflow-y: auto;}.help-modal-content",t," p",t," {margin: 0;line-height: 1.6;color: #555;font-size: 14px;}@keyframes slideIn",o," {from {transform: scale(0.9) translateY(-20px);opacity: 0;}to {transform: scale(1) translateY(0);opacity: 1;}}"].join("")}var wo=[Ar];function Ir(n,e,s){var t=n?"["+n+"]":"";return".file-upload-wrapper"+t+" {display: flex;flex-direction: column;gap: 0.5rem;margin-top: 1rem;}.file-label"+t+" {font-weight: bold;}.file-input"+t+" {padding: 0.25rem;}.thumbnail"+t+" img"+t+" {width: 120px;height: auto;border: 1px solid #ccc;margin-top: 0.5rem;}.file-name"+t+" {margin: 0;font-size: 15px;font-weight: 500;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;max-width: 200px;color: #333;}.file-info"+t+" {display: flex;}.file-uploader.simple"+t+" {max-width: 600px;margin: 0 auto;padding: 12px;background: transparent;border: 0;}.file-uploader.simple"+t+" .upload-area"+t+" {text-align: center;padding: 16px;border: 1px dashed #d1d5db;border-radius: 8px;background-color: transparent;}.upload-actions"+t+" {display: flex;flex-direction: column;align-items: center;gap: 8px;}.or"+t+" {display: block;margin: 8px 0;color: #6b7280;font-size: 14px;}.file-list"+t+" {margin-top: 12px;background: #fff;border: 1px solid #ece7f6;border-radius: 8px;padding: 8px;}.file-item"+t+" {display: flex;align-items: center;justify-content: space-between;padding: 8px 6px;border-bottom: 1px solid #f1eaff;}.file-item:last-child"+t+" {border-bottom: 0;}.remove-button"+t+" {background: none;border: 0;cursor: pointer;font-size: 18px;}.btn-plain"+t+" {background: #ffffff;color: #374151;border: 1px solid #d1d5db;border-radius: 6px;padding: 8px 12px;font-size: 14px;display: inline-flex;align-items: center;gap: 8px;}.btn-plain:disabled"+t+" {opacity: 0.6;cursor: not-allowed;}.icon"+t+" {display: inline-block;}.uploader-header"+t+",\r.status-indicator"+t+",\r.upload-hint"+t+",\r.error-message"+t+",\r.section-header"+t+",\r.selected-files"+t+",\r.uploaded-files"+t+" {display: none;}"}var xo=[Ir];const Fr=p`<div class="upload-area${0}"${2}><div class="upload-actions${0}"${2}><button class="btn-plain${0}"${"a2:disabled"}${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm0 2.5L18.5 9H14zM8 13h8v2H8zm0 4h8v2H8zm0-8h4v2H8z"${3}/></svg>Upload file</button></div><span class="or${0}"${2}>or</span><div class="upload-actions${0}"${2}><button class="btn-plain${0}"${"a9:disabled"}${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M9 2l1.5 2H14l2 2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2h3l2-2zM12 9a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 9zm0 2a3 3 0 1 1-.001 6.001A3 3 0 0 1 12 11z"${3}/></svg>Capture image</button></div></div>`,Dr=p`<div class="file-info${0}"${2}><span class="file-name${0}"${2}>${"t2"}</span><span class="file-size${0}"${2}>${"t4"}</span></div>`,Tr=p`<button class="remove-button${0}"${"a0:data-file-id"} title="Remove file"${2}>🗑️</button>`,Or=p`<div class="spinner-container${0}"${2}><div class="spinner${0}"${2}></div></div>`,Lr={classMap:{"file-uploader":!0,simple:!0},key:0},Nr={classMap:{"file-list":!0},key:3},Mr={"file-item":!0};function qe(n,e,s,t){const{b:o,sp:i,st:a,k:r,d:l,h:c,i:d}=n,{_m0:h,_m1:u,_m2:f,_m3:g}=t;return[c("div",Lr,[a(Fr,2,[i(2,{on:h||(t._m0={click:o(e.handleFilePick)}),attrs:{disabled:e.isUploading?"":null}},null),i(9,{on:u||(t._m1={click:o(e.handleCameraCapture)}),attrs:{disabled:e.isUploading?"":null}},null)]),e.hasSelectedFiles?c("div",Nr,d(e.allFiles,function(_){return c("div",{classMap:Mr,attrs:{"data-status":_.uploadStatus},key:r(4,_.id)},[a(Dr,6,[i(2,null,l(_.statusIcon)+" "+l(_.name)),i(4,null,"("+l(_.readableSize)+")")]),_.canRemove?a(Tr,8,[i(0,{on:g||(t._m3={click:o(e.handleRemoveFile)}),attrs:{"data-file-id":_.id}},null)]):null])})):null,e.isUploading?a(Or,10):null])]}var Pr=J(qe);qe.stylesheets=[],qe.stylesheetToken="lwc-66n0batj9ij",qe.legacyStylesheetToken="c-fileUploader_fileUploader",xo&&qe.stylesheets.push.apply(qe.stylesheets,xo),Q(qe);/*! Capacitor: https://capacitorjs.com/ - MIT License */var xt;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(xt||(xt={}));var kt=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},jr=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},Ur=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:jr(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new kt(`"${h}" plugin is not implemented on ${g}`,xt.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new kt(`"${h}.${v}()" is not implemented on ${g}`,xt.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=kt,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},Vr=n=>n.Capacitor=Ur(n),gs=Vr(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),_s=gs.registerPlugin,bs=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new gs.Exception(n,xt.Unimplemented)}unavailable(n="not available"){return new gs.Exception(n,xt.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},ko=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),$o=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),qr=class extends bs{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=$o(t).trim(),o=$o(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=ko(n.key),s=ko(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};_s("CapacitorCookies",{web:()=>new qr});var zr=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),Wr=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},Br=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,Hr=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=Wr(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},Jr=class extends bs{async request(n){const e=Hr(n,n.webFetchExtra),s=Br(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await zr(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};_s("CapacitorHttp",{web:()=>new Jr});var we;(function(n){n.Prompt="PROMPT",n.Camera="CAMERA",n.Photos="PHOTOS"})(we||(we={}));var Tt;(function(n){n.Rear="REAR",n.Front="FRONT"})(Tt||(Tt={}));var $t;(function(n){n.Uri="uri",n.Base64="base64",n.DataUrl="dataUrl"})($t||($t={}));var Co=class extends bs{async getPhoto(n){return new Promise(async(e,s)=>{if(n.webUseInput||n.source===we.Photos)this.fileInputExperience(n,e,s);else if(n.source===we.Prompt){let t=document.querySelector("pwa-action-sheet");t||(t=document.createElement("pwa-action-sheet"),document.body.appendChild(t)),t.header=n.promptLabelHeader||"Photo",t.cancelable=!1,t.options=[{title:n.promptLabelPhoto||"From Photos"},{title:n.promptLabelPicture||"Take Picture"}],t.addEventListener("onSelection",async o=>{o.detail===0?this.fileInputExperience(n,e,s):this.cameraExperience(n,e,s)})}else this.cameraExperience(n,e,s)})}async pickImages(n){return new Promise(async(e,s)=>{this.multipleFileInputExperience(e,s)})}async cameraExperience(n,e,s){if(customElements.get("pwa-camera-modal")){const t=document.createElement("pwa-camera-modal");t.facingMode=n.direction===Tt.Front?"user":"environment",document.body.appendChild(t);try{await t.componentOnReady(),t.addEventListener("onPhoto",async o=>{const i=o.detail;i===null?s(new kt("User cancelled photos app")):i instanceof Error?s(i):e(await this._getCameraPhoto(i,n)),t.dismiss(),document.body.removeChild(t)}),t.present()}catch(o){this.fileInputExperience(n,e,s)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(n,e,s)}fileInputExperience(n,e,s){let t=document.querySelector("#_capacitor-camera-input");const o=()=>{var i;(i=t.parentNode)===null||i===void 0||i.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input",t.type="file",t.hidden=!0,document.body.appendChild(t),t.addEventListener("change",i=>{const a=t.files[0];let r="jpeg";if(a.type==="image/png"?r="png":a.type==="image/gif"&&(r="gif"),n.resultType==="dataUrl"||n.resultType==="base64"){const l=new FileReader;l.addEventListener("load",()=>{if(n.resultType==="dataUrl")e({dataUrl:l.result,format:r});else if(n.resultType==="base64"){const c=l.result.split(",")[1];e({base64String:c,format:r})}o()}),l.readAsDataURL(a)}else e({webPath:URL.createObjectURL(a),format:r}),o()}),t.addEventListener("cancel",i=>{s(new kt("User cancelled photos app")),o()})),t.accept="image/*",t.capture=!0,n.source===we.Photos||n.source===we.Prompt?t.removeAttribute("capture"):n.direction===Tt.Front?t.capture="user":n.direction===Tt.Rear&&(t.capture="environment"),t.click()}multipleFileInputExperience(n,e){let s=document.querySelector("#_capacitor-camera-input-multiple");const t=()=>{var o;(o=s.parentNode)===null||o===void 0||o.removeChild(s)};s||(s=document.createElement("input"),s.id="_capacitor-camera-input-multiple",s.type="file",s.hidden=!0,s.multiple=!0,document.body.appendChild(s),s.addEventListener("change",o=>{const i=[];for(let a=0;a<s.files.length;a++){const r=s.files[a];let l="jpeg";r.type==="image/png"?l="png":r.type==="image/gif"&&(l="gif"),i.push({webPath:URL.createObjectURL(r),format:l})}n({photos:i}),t()}),s.addEventListener("cancel",o=>{e(new kt("User cancelled photos app")),t()})),s.accept="image/*",s.click()}_getCameraPhoto(n,e){return new Promise((s,t)=>{const o=new FileReader,i=n.type.split("/")[1];e.resultType==="uri"?s({webPath:URL.createObjectURL(n),format:i,saved:!1}):(o.readAsDataURL(n),o.onloadend=()=>{const a=o.result;e.resultType==="dataUrl"?s({dataUrl:a,format:i,saved:!1}):s({base64String:a.split(",")[1],format:i,saved:!1})},o.onerror=a=>{t(a)})})}async checkPermissions(){if(typeof navigator=="undefined"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(n){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}};new Co;var Vt=_s("Camera",{web:()=>new Co});/*! Capacitor: https://capacitorjs.com/ - MIT License */var Ct;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Ct||(Ct={}));var ys=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},Qr=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},Yr=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:Qr(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new ys(`"${h}" plugin is not implemented on ${g}`,Ct.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new ys(`"${h}.${v}()" is not implemented on ${g}`,Ct.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=ys,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},Kr=n=>n.Capacitor=Yr(n),vs=Kr(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),ws=vs.registerPlugin,xs=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new vs.Exception(n,Ct.Unimplemented)}unavailable(n="not available"){return new vs.Exception(n,Ct.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},So=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Eo=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),Gr=class extends xs{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=Eo(t).trim(),o=Eo(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=So(n.key),s=So(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};ws("CapacitorCookies",{web:()=>new Gr});var Xr=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),Zr=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},el=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,tl=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=Zr(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},sl=class extends xs{async request(n){const e=tl(n,n.webFetchExtra),s=el(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await Xr(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};ws("CapacitorHttp",{web:()=>new sl});var ol=class extends xs{constructor(){super(...arguments);this.ERROR_PICK_FILE_CANCELED="pickFiles canceled."}async checkPermissions(){throw this.unimplemented("Not implemented on web.")}async convertHeicToJpeg(n){throw this.unimplemented("Not implemented on web.")}async pickFiles(n){const e=await this.openFilePicker(n);if(!e)throw new Error(this.ERROR_PICK_FILE_CANCELED);const s={files:[]};for(const t of e){const o={blob:t,modifiedAt:t.lastModified,mimeType:this.getMimeTypeFromUrl(t),name:this.getNameFromUrl(t),path:void 0,size:this.getSizeFromUrl(t)};(n==null?void 0:n.readData)&&(o.data=await this.getDataFromFile(t)),s.files.push(o)}return s}async pickDirectory(){throw this.unimplemented("Not implemented on web.")}async pickImages(n){return this.pickFiles(Object.assign({types:["image/*"]},n))}async pickMedia(n){return this.pickFiles(Object.assign({types:["image/*","video/*"]},n))}async pickVideos(n){return this.pickFiles(Object.assign({types:["video/*"]},n))}async requestPermissions(n){throw this.unimplemented("Not implemented on web.")}async openFilePicker(n){var e;const s=((e=n==null?void 0:n.types)===null||e===void 0?void 0:e.join(","))||"",t=(n==null?void 0:n.limit)===void 0?0:n.limit;return new Promise(o=>{let i=!1;const a=document.createElement("input");a.type="file",a.accept=s,a.multiple=t===0,a.addEventListener("change",()=>{i=!0;const r=Array.from(a.files||[]);o(r)},{once:!0}),window.addEventListener("focus",async()=>{await this.wait(1e3),!i&&o(void 0)},{once:!0}),a.click()})}async getDataFromFile(n){return new Promise((e,s)=>{const t=new FileReader;t.readAsDataURL(n),t.onload=()=>{const a=(typeof t.result=="string"?t.result:"").split("base64,")[1]||"";e(a)},t.onerror=o=>{s(o)}})}getNameFromUrl(n){return n.name}getMimeTypeFromUrl(n){return n.type}getSizeFromUrl(n){return n.size}async wait(n){return new Promise(e=>setTimeout(e,n))}},St=ws("FilePicker",{web:()=>new ol});class Ro extends K{constructor(...e){super(...e);this.formType="general",this.formTempId=null,this.acceptedFileTypes=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.mp4",this.maxFileSize=5*1024*1024,this.multiple=!1,this.recordId=null,this._internalFormTempId=null,this.selectedFiles=[],this.uploadedFiles=[],this.isUploading=!1,this.errorMessage=""}connectedCallback(){this._internalFormTempId=this.formTempId,this.ensureFileUploadSyncAvailable(),this.loadExistingFiles()}ensureFileUploadSyncAvailable(){try{typeof window!="undefined"&&!window.fileUploadSync&&(window.fileUploadSync=G,console.log("\u{1F4C1} File upload sync service made available from FileUploader"))}catch(e){console.error("\u274C Error ensuring file upload sync availability:",e)}}get effectiveFormTempId(){return this._internalFormTempId||this.formTempId}async loadExistingFiles(){try{let e=[];this.recordId?e=await U.getFileUploadsByRecord(this.formType,this.recordId):this.effectiveFormTempId&&(e=await U.getFileUploadsByRecord(this.formType,this.effectiveFormTempId)),this.uploadedFiles=[],this.selectedFiles=[],this.uploadedFiles=e.map(s=>({id:s.id,name:s.file_name,size:s.file_size,type:s.mime_type,webPath:s.webPath,uploadStatus:s.upload_status,s3Key:s.s3_key,s3Url:s.s3_url,readableSize:this.formatFileSize(s.file_size)})),console.log(`\u{1F4C1} Loaded ${this.uploadedFiles.length} existing files for ${this.formType}/${this.recordId||this.effectiveFormTempId}`)}catch(e){console.error("\u274C Error loading existing files:",e)}}async handleFilePick(){console.log("\u{1F4C1} File picker button clicked"),this.errorMessage="";try{console.log("\u{1F680} Calling FilePicker.pickFiles...");const e=await St.pickFiles({multiple:this.multiple,readData:!1});if(console.log("\u{1F4C4} FilePicker result:",e),e&&e.files&&e.files.length>0)for(const s of e.files)console.log("\u{1F4CE} Processing selected file:",s),await this.processSelectedFile(s);else console.log("\u2139\uFE0F No files selected")}catch(e){console.error("\u274C Error picking file:",e),this.errorMessage="Failed to pick file: "+e.message}}async processSelectedFile(e,s=!1){console.log("\u{1F4CB} Processing selected file:",e),console.log("\u{1F4CA} File properties:",{name:e.name,path:e.path,size:e.size,mimeType:e.mimeType,webPath:e.webPath,uri:e.uri,url:e.url});const t=e.size||0;if(t>this.maxFileSize){this.errorMessage=`File ${e.name||"unknown"} is too large (max ${this.formatFileSize(this.maxFileSize)})`;return}const o={id:Pt(),name:e.name||(s?`PHOTO_${new Date().toISOString().replace(/[:.]/g,"-")}.jpg`:`file_${Date.now()}`),type:e.mimeType||e.type||(s?"image/jpeg":"application/octet-stream"),size:t,readableSize:this.formatFileSize(t),webPath:e.webPath||e.path||e.uri||e.url||"",formType:this.formType,uploaded:!1,createdDate:new Date().toISOString(),lastModifiedDate:new Date().toISOString(),description:`pre-inspection File uploaded from ${this.formType} (${s?"camera":"file picker"})`};console.log("\u{1F4BE} Created file record:",o),await this.saveFileRecord(o),this.updateFileList()}async saveFileRecord(e){try{await U.saveFileWithPath(e),await Ft({id:e.id,type:"UPLOAD_FILE",timestamp:Date.now(),data:e}),this.selectedFiles.push(e),console.log("\u{1F4F1} File saved to SQLite queue for later upload:",e)}catch(s){console.error("\u274C Error saving enhanced file:",s),this.errorMessage="Failed to save file."}}generateTempId(){return this.effectiveFormTempId||`temp_${this.formType}_${Date.now()}`}updateFileList(){const e=this.template.querySelector(".file-input");e&&(e.value="")}handleClearAll(){this.selectedFiles=[],this.errorMessage="",this.updateFileList()}async handleRemoveFile(e){const s=e.target.dataset.fileId;try{await U.updateFileUploadStatus(s,"deleted"),this.selectedFiles=this.selectedFiles.filter(t=>t.id!==s),this.uploadedFiles=this.uploadedFiles.filter(t=>t.id!==s),console.log(`\u{1F4C1} Removed file: ${s}`)}catch(t){console.error("\u274C Error removing file:",t),this.errorMessage="Failed to remove file."}}get hasSelectedFiles(){return this.selectedFiles.length>0||this.uploadedFiles.length>0}get allFiles(){const e=this.selectedFiles.map(o=>({...o,isNew:!0})),s=this.uploadedFiles.map(o=>({...o,isNew:!1}));return[...e,...s].map(o=>({...o,statusIcon:this.getStatusIcon(o.uploadStatus||"pending"),statusText:this.getStatusText(o.uploadStatus||"pending"),canRemove:(o.uploadStatus||"pending")!=="uploaded"}))}getStatusIcon(e){return{pending:"\u23F3",uploading:"\u{1F504}",uploaded:"\u2705",failed:"\u274C",deferred:"\u23F8\uFE0F"}[e]||"\u{1F4C4}"}getStatusText(e){return{pending:V()?"Pending":"Will upload when online",uploading:"Uploading...",uploaded:"Uploaded",failed:"Upload Failed",deferred:"Deferred (offline)"}[e]||"New"}formatFileSize(e){if(e===0)return"0 Bytes";const s=1024,t=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(2))+" "+t[o]}get maxFileSizeLabel(){return this.formatFileSize(this.maxFileSize)}get isOnlineStatus(){return V()}async handleCameraCapture(){console.log("\u{1F4F8} Camera capture button clicked"),this.errorMessage="";try{console.log("\u{1F680} Launching camera...");const e=await Vt.getPhoto({quality:90,resultType:$t.Uri,source:we.Camera,saveToGallery:!0,allowEditing:!1,width:1920,height:1080});if(!e?.webPath){this.errorMessage="Camera failed to return image path",console.error("\u274C Camera did not return webPath:",e);return}console.log("\u{1F4F8} Photo captured successfully:",{webPath:e.webPath,path:e.path,format:e.format}),console.log("\u{1F4F8} Camera webpath",e.webPath);const s={name:`PHOTO_${new Date().toISOString().replace(/[:.]/g,"-")}.jpg`,webPath:e.webPath,path:e.path,mimeType:"image/jpeg",type:"image/jpeg",size:0,uri:e.webPath};await this.processSelectedFile(s,!0),console.log("\u2705 Camera photo processed and queued for upload")}catch(e){console.error("\u274C Error capturing photo:",e),e.message&&e.message.includes("cancelled")?this.errorMessage="Photo capture was cancelled":this.errorMessage="Failed to capture photo: "+e.message}}setRecordId(e){this.recordId=e,this.loadExistingFiles()}setFormTempId(e){this._internalFormTempId=e}async updateRecordId(e){try{this.effectiveFormTempId&&(await U.updateFileRecordId(this.formType,this.effectiveFormTempId,e),this.recordId=e,this._internalFormTempId=null,await this.loadExistingFiles(),console.log(`\u{1F4C1} Updated file record ID to: ${e}`),console.log("\u{1F680} Record created, now triggering file upload sync"),window.fileUploadSync?window.fileUploadSync.triggerManualSync().catch(s=>{console.error("\u274C File upload sync error:",s)}):G?G.triggerManualSync().catch(s=>{console.error("\u274C File upload sync error:",s)}):console.warn("\u26A0\uFE0F File upload sync service not available"))}catch(s){console.error("\u274C Error updating file record ID:",s)}}async getFileUploadStats(){try{return await U.getFileUploadStats()}catch(e){return console.error("\u274C Error getting file upload stats:",e),{}}}}Y(Ro,{publicProps:{formType:{config:0},formTempId:{config:0},acceptedFileTypes:{config:0},maxFileSize:{config:0},multiple:{config:0}},publicMethods:["setRecordId","setFormTempId","updateRecordId","getFileUploadStats"],track:{recordId:1,_internalFormTempId:1,selectedFiles:1,uploadedFiles:1,isUploading:1,errorMessage:1}});const il=z(Ro,{tmpl:Pr,sel:"c-file-uploader",apiVersion:63}),al=p`<header class="modal-header${0}"${2}><h2 class="modal-title${0}"${2}>${"t2"}</h2></header>`,nl=p`<div class="loading-container${0}"${2}><div class="spinner${0}"${2}></div><p class="loading-text${0}"${2}>Loading form configuration...</p></div>`,rl=p`<div class="error-container${0}"${2}><div class="error-content${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><p class="error-text${0}"${2}>${"t5"}</p></div><button class="error-dismiss${0}" title="Dismiss error"${2}>×</button></div>`,ll=p`<div${"c0"}${2}><div class="toast-content${0}"${2}><span class="toast-icon${0}"${2}>${"t3"}</span><span class="toast-message${0}"${2}>${"t5"}</span><button class="toast-close${0}" aria-label="Close notification"${2}>×</button></div></div>`,cl=p`<div class="required-note${0}"${2}><span class="asterisk${0}"${2}>*</span> indicates required fields</div>`,dl=p`<h3 class="section-title${0}"${2}>${"t1"}</h3>`,hl=p`<span class="asterisk${0}"${2}>*</span>`,ul=p`<button type="button" class="help-button${0}"${"a0:data-field"} title="Show help"${2}>i</button>`,pl=p`<span class="asterisk${0}"${2}>*</span>`,fl=p`<button type="button" class="help-button${0}"${"a0:data-field"} title="Show help"${2}>i</button>`,ml=p`<textarea${"a0:id"} class="form-textarea${0}"${"a0:data-field"}${"a0:required"}${"a0:disabled"}${"a0:placeholder"} rows="3"${2}>${"t1"}</textarea>`,gl=p`<span class="asterisk${0}"${2}>*</span>`,_l=p`<button type="button" class="help-button${0}"${"a0:data-field"} title="Show help"${2}>i</button>`,bl=p`<span class="asterisk${0}"${2}>*</span>`,yl=p`<button type="button" class="help-button${0}"${"a0:data-field"} title="Show help"${2}>i</button>`,vl=p`<option value${3}>--NONE--</option>`,wl=p`<option${"a0:value"}${3}>${"t1"}</option>`,xl=p`<span class="asterisk${0}"${2}>*</span>`,kl=p`<option value${3}>--NONE--</option>`,$l=p`<option${"a0:value"}${3}>${"t1"}</option>`,Cl=p`<span class="asterisk${0}"${2}>*</span>`,Sl=p`<span class="asterisk${0}"${2}>*</span>`,El=p`<span class="asterisk${0}"${2}>*</span>`,Rl=p`<span class="asterisk${0}"${2}>*</span>`,Al=p`<h3 class="section-title${0}"${2}>Immediate Correction Analysis</h3>`,Il=p`<label class="field-label${0}"${"a0:for"}${2}>${"t1"}</label>`,Fl=p`<button type="button" class="icon-button plus-button${0}"${"a0:data-index"}${"a0:disabled"} title="Add another correction"${2}>➕</button>`,Dl=p`<button type="button" class="icon-button delete-button${0}"${"a0:data-index"} title="Remove this correction"${2}>🗑️</button>`,Tl=p`<h3 class="section-title${0}"${2}>Action Items<span class="task-counter${0}"${2}>${"t3"}</span></h3>`,Ol=p`<h4 class="task-form-title${0}"${2}>${"t1"}</h4>`,Ll=p`<button type="button" class="icon-button plus-button${0}"${"a0:data-task-id"} title="Add another action item"${2}>➕</button>`,Nl=p`<button type="button" class="icon-button delete-button${0}"${"a0:data-task-id"} title="Remove this action item"${2}>🗑️</button>`,Ml=p`<span class="asterisk${0}"${2}>*</span>`,Pl=p`<span class="asterisk${0}"${2}>*</span>`,jl=p`<textarea${"a0:id"} class="form-textarea${0}"${"a0:data-field"}${"a0:data-task-id"}${"a0:required"}${"a0:disabled"}${"a0:placeholder"} rows="3"${2}>${"t1"}</textarea>`,Ul=p`<span class="asterisk${0}"${2}>*</span>`,Vl=p`<option value${3}>--NONE--</option>`,ql=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,zl=p`<span class="asterisk${0}"${2}>*</span>`,Wl=p`<option value${3}>--NONE--</option>`,Bl=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,Hl=p`<span class="asterisk${0}"${2}>*</span>`,Jl=p`<h3 class="section-title${0}"${2}>${"t1"}</h3>`,Ql=p`<button type="button" class="button button-secondary${0}"${2}>Cancel</button>`,Yl=p`<div class="button-spinner${0}"${2}></div>`,Kl=p`<div class="help-modal-overlay${0}"${2}><div class="help-modal${0}"${2}><div class="help-modal-header${0}"${2}><h3${3}>${"t4"}</h3><button type="button" class="help-modal-close${0}"${2}>×</button></div><div class="help-modal-content${0}"${2}><p${3}>${"t9"}</p></div></div></div>`,Gl={classMap:{"page-wrapper":!0},key:0},Xl={"modal-container":!0},Zl={classMap:{"modal-content":!0},key:10},ec={classMap:{"safety-form":!0},key:13},tc={"form-section":!0},sc={classMap:{"fields-grid":!0},key:17},oc={"field-container":!0},ic={classMap:{"form-group":!0},key:19},he={"field-label":!0},De={"form-input":!0},ac={classMap:{"form-group":!0},key:26},nc={classMap:{"form-group":!0,"checkbox-group":!0},key:34},rc={classMap:{"checkbox-label":!0},key:35},lc={"form-checkbox":!0},cc={classMap:{"checkbox-text":!0},key:37},dc={classMap:{"form-group":!0},key:42},qt={"form-select":!0},hc={classMap:{"form-group":!0},key:53},uc={classMap:{"form-group":!0},key:62},pc={classMap:{"form-group":!0},key:67},fc={classMap:{"form-group":!0},key:72},mc={classMap:{"form-group":!0},key:77},gc={classMap:{"form-section":!0},key:82},_c={classMap:{"fields-grid":!0},key:85},bc={"field-container":!0,"immediate-correction-field":!0},yc={classMap:{"form-group":!0},key:87},vc={classMap:{"input-with-buttons":!0},key:90},wc={classMap:{"field-buttons":!0},key:92},xc={classMap:{"form-section":!0},key:97},kc={classMap:{"multiple-tasks-container":!0},key:100},$c={"task-form-container":!0},Cc={classMap:{"task-form-header":!0},key:102},Sc={classMap:{"task-form-buttons":!0},key:105},Ec={classMap:{"task-form-fields":!0},key:110},Rc={"field-container":!0,"task-field":!0},Ac={classMap:{"form-group":!0},key:112},Ic={classMap:{"form-group":!0},key:117},Fc={classMap:{"form-group":!0},key:123},Dc={classMap:{"form-group":!0},key:132},Tc={classMap:{"form-group":!0},key:141},Oc={classMap:{"form-section":!0},key:146},Lc={classMap:{"file-upload-container":!0},key:149},Nc={classMap:{"modal-footer":!0},key:151},Mc={button:!0,"button-primary":!0};function ze(n,e,s,t){const{b:o,d:i,sp:a,st:r,ncls:l,k:c,gid:d,t:h,h:u,i:f,f:g,c:_}=n,{_m0:m,_m1:x,_m2:k,_m3:$,_m4:S,_m5:O,_m6:F,_m7:D,_m8:v,_m9:A,_m10:w,_m11:y,_m12:C,_m13:I,_m14:L,_m15:N,_m16:T,_m17:q,_m18:te,_m19:pe,_m20:Ne,_m21:fe,_m22:Ce,_m23:_e,_m24:Se,_m25:xe,_m26:Ee,_m27:be,_m28:Re,_m29:ye,_m30:ke,_m31:M,_m32:ve,_m33:E,_m34:P,_m35:b,_m36:ee,_m37:j,_m38:_t,_m39:ce,_m40:Qi,_m41:Yi,_m42:Ki}=t;return[e.isVisible?u("div",Gl,[u("div",{classMap:Xl,key:1,on:m||(t._m0={click:o(e.handleModalClick)})},[r(al,3,[a(2,null,i(e.formTitle))]),e.isLoading?r(nl,5):null,e.error?r(rl,7,[a(5,null,i(e.error)),a(6,{on:x||(t._m1={click:o(e.dismissError)})},null)]):null,e.showToast?r(ll,9,[a(0,{className:l(e.toastClasses)},null),a(3,null,i(e.toastIcon)),a(5,null,i(e.toastMessage)),a(6,{on:k||(t._m2={click:o(e.handleToastClose)})},null)]):null,e.isLoading?null:u("div",Zl,[r(cl,12),u("div",ec,g([f(e.renderedSections,function(W){return u("div",{classMap:tc,key:c(14,W.name)},[r(dl,16,[a(1,null,i(W.label))]),u("div",sc,g([f(W.fields,function(R){return u("div",{classMap:oc,key:c(18,R.fieldApi)},[R.isText?u("div",ic,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:20},[h(i(R.label)),R.required?r(hl,22):null,R.helpText?r(ul,24,[a(0,{on:S||(t._m4={click:o(e.handleHelpClick)}),attrs:{"data-field":R.fieldApi}},null)]):null]),u("input",{classMap:De,attrs:{id:d(R.fieldApi),type:R.inputType,"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null,placeholder:R.label},props:{value:R.value},key:25,on:O||(t._m5={change:o(e.handleFieldChange)})})]):null,R.isTextarea?u("div",ac,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:27},[h(i(R.label)),R.required?r(pl,29):null,R.helpText?r(fl,31,[a(0,{on:D||(t._m7={click:o(e.handleHelpClick)}),attrs:{"data-field":R.fieldApi}},null)]):null]),r(ml,33,[a(0,{on:A||(t._m9={change:o(e.handleFieldChange)}),attrs:{id:d(R.fieldApi),"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null,placeholder:R.label}},null),a(1,null,i(R.value))])]):null,R.isCheckbox?u("div",nc,[u("label",rc,[u("input",{classMap:lc,attrs:{type:"checkbox","data-field":R.fieldApi,disabled:R.disabled?"":null,"data-value":R.checkedValue},props:{checked:R.checkedValue},key:36,on:w||(t._m10={click:o(e.handleCheckboxChange),change:o(e.handleCheckboxChange)})}),u("span",cc,[h(i(R.label)),R.required?r(gl,39):null,R.helpText?r(_l,41,[a(0,{on:C||(t._m12={click:o(e.handleHelpClick)}),attrs:{"data-field":R.fieldApi}},null)]):null])])]):null,R.isSelect?u("div",dc,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:43},[h(i(R.label)),R.required?r(bl,45):null,R.helpText?r(yl,47,[a(0,{on:L||(t._m14={click:o(e.handleHelpClick)}),attrs:{"data-field":R.fieldApi}},null)]):null]),u("select",{classMap:qt,attrs:{id:d(R.fieldApi),"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null},key:48,on:N||(t._m15={change:o(e.handleFieldChange)})},g([r(vl,50),f(R.options,function(ae){return r(wl,c(52,ae.value),[a(0,{attrs:{value:ae.value}},null),a(1,null,i(ae.label))])})]))]):null,R.isLookup?u("div",hc,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:54},[h(i(R.label)),R.required?r(xl,56):null]),u("select",{classMap:qt,attrs:{id:d(R.fieldApi),"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null},key:57,on:T||(t._m16={change:o(e.handleFieldChange)})},g([R.disabled?null:r(kl,59),f(R.lookupOptions,function(ae){return r($l,c(61,ae.value),[a(0,{attrs:{value:ae.value}},null),a(1,null,i(ae.label))])})]))]):null,R.isDate?u("div",uc,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:63},[h(i(R.label)),R.required?r(Cl,65):null]),u("input",{classMap:De,attrs:{id:d(R.fieldApi),type:R.inputType,"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null},props:{value:R.value},key:66,on:q||(t._m17={change:o(e.handleFieldChange)})})]):null,R.isDateTime?u("div",pc,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:68},[h(i(R.label)),R.required?r(Sl,70):null]),u("input",{classMap:De,attrs:{id:d(R.fieldApi),type:R.inputType,"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null},props:{value:R.value},key:71,on:te||(t._m18={change:o(e.handleFieldChange)})})]):null,R.isTime?u("div",fc,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:73},[h(i(R.label)),R.required?r(El,75):null]),u("input",{classMap:De,attrs:{id:d(R.fieldApi),type:"time","data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null},props:{value:R.value},key:76,on:pe||(t._m19={change:o(e.handleFieldChange)})})]):null,R.isNumber?u("div",mc,[u("label",{classMap:he,attrs:{for:d(R.fieldApi)},key:78},[h(i(R.label)),R.required?r(Rl,80):null]),u("input",{classMap:De,attrs:{id:d(R.fieldApi),type:R.inputType,"data-field":R.fieldApi,required:R.required?"":null,disabled:R.disabled?"":null,step:"0.01"},props:{value:R.value},key:81,on:Ne||(t._m20={change:o(e.handleFieldChange)})})]):null])})]))])}),e.showImmediateCorrectionSection?u("div",gc,[r(Al,84),u("div",_c,f(e.immediateCorrectionFields,function(W){return W.isVisible?u("div",{classMap:bc,key:c(86,W.fieldApi)},[u("div",yc,[r(Il,89,[a(0,{attrs:{for:d(W.fieldApi)}},null),a(1,null,i(W.label))]),u("div",vc,[u("input",{classMap:De,attrs:{id:d(W.fieldApi),type:"text","data-field":W.fieldApi,"data-index":W.index,placeholder:W.label},props:{value:W.value},key:91,on:fe||(t._m21={change:o(e.handleImmediateCorrectionChange)})}),u("div",wc,[W.canShowPlus?r(Fl,94,[a(0,{on:_e||(t._m23={click:o(e.handleAddImmediateCorrection)}),attrs:{"data-index":W.index,disabled:W.disablePlus?"":null}},null)]):null,W.canShowDelete?r(Dl,96,[a(0,{on:xe||(t._m25={click:o(e.handleRemoveImmediateCorrection)}),attrs:{"data-index":W.index}},null)]):null])])])]):null}))]):null,e.showMultipleTaskSection?u("div",xc,[r(Tl,99,[a(3,null,"("+i(e.multipleTaskForms.length)+" action item"+i(e.multipleTaskFormsPlural)+")")]),u("div",kc,f(e.multipleTaskForms,function(W){return u("div",{classMap:$c,attrs:{"data-task-id":W.id},key:c(101,W.id)},[u("div",Cc,[r(Ol,104,[a(1,null,"Action Item "+i(W.displayIndex))]),u("div",Sc,[W.canShowPlus?r(Ll,107,[a(0,{on:be||(t._m27={click:o(e.handleAddTask)}),attrs:{"data-task-id":W.id}},null)]):null,W.canShowDelete?r(Nl,109,[a(0,{on:ye||(t._m29={click:o(e.handleRemoveTask)}),attrs:{"data-task-id":W.id}},null)]):null])]),u("div",Ec,f(W.fields,function(R){return u("div",{classMap:Rc,key:c(111,R.fieldApi)},[R.isText?u("div",Ac,[u("label",{classMap:he,attrs:{for:d(R.uniqueId)},key:113},[h(i(R.label)),R.required?r(Ml,115):null]),u("input",{classMap:De,attrs:{id:d(R.uniqueId),type:R.inputType,"data-field":R.fieldApi,"data-task-id":W.id,required:R.required?"":null,disabled:R.disabled?"":null,placeholder:R.label},props:{value:R.value},key:116,on:ke||(t._m30={change:o(e.handleTaskFieldChange)})})]):null,R.isTextarea?u("div",Ic,[u("label",{classMap:he,attrs:{for:d(R.uniqueId)},key:118},[h(i(R.label)),R.required?r(Pl,120):null]),r(jl,122,[a(0,{on:ve||(t._m32={change:o(e.handleTaskFieldChange)}),attrs:{id:d(R.uniqueId),"data-field":R.fieldApi,"data-task-id":W.id,required:R.required?"":null,disabled:R.disabled?"":null,placeholder:R.label}},null),a(1,null,i(R.value))])]):null,R.isSelect?u("div",Fc,[u("label",{classMap:he,attrs:{for:d(R.uniqueId)},key:124},[h(i(R.label)),R.required?r(Ul,126):null]),u("select",{classMap:qt,attrs:{id:d(R.uniqueId),"data-field":R.fieldApi,"data-task-id":W.id,required:R.required?"":null,disabled:R.disabled?"":null},key:127,on:E||(t._m33={change:o(e.handleTaskFieldChange)})},g([r(Vl,129),f(R.options,function(ae){return r(ql,c(131,ae.value),[a(0,{attrs:{value:ae.value,selected:ae.selected?"":null}},null),a(1,null,i(ae.label))])})]))]):null,R.isLookup?u("div",Dc,[u("label",{classMap:he,attrs:{for:d(R.uniqueId)},key:133},[h(i(R.label)),R.required?r(zl,135):null]),u("select",{classMap:qt,attrs:{id:d(R.uniqueId),"data-field":R.fieldApi,"data-task-id":W.id,required:R.required?"":null,disabled:R.disabled?"":null},key:136,on:P||(t._m34={change:o(e.handleTaskFieldChange)})},g([r(Wl,138),f(R.lookupOptions,function(ae){return r(Bl,c(140,ae.value),[a(0,{attrs:{value:ae.value,selected:ae.selected?"":null}},null),a(1,null,i(ae.label))])})]))]):null,R.isDate?u("div",Tc,[u("label",{classMap:he,attrs:{for:d(R.uniqueId)},key:142},[h(i(R.label)),R.required?r(Hl,144):null]),u("input",{classMap:De,attrs:{id:d(R.uniqueId),type:R.inputType,"data-field":R.fieldApi,"data-task-id":W.id,required:R.required?"":null,disabled:R.disabled?"":null},props:{value:R.value},key:145,on:b||(t._m35={change:o(e.handleTaskFieldChange)})})]):null])}))])}))]):null,e.isHFESessionObject||e.isTaskFromListView?null:u("div",Oc,[r(Jl,148,[a(1,null,i(e.attachmentSectionTitle))]),u("div",Lc,[_("c-file-uploader",il,{props:{formType:e.objectApiName,formTempId:e.formTempId,maxFileSize:"10485760",acceptedFileTypes:e.acceptedFormats,multiple:"true"},key:150})])])]))]),e.isLoading?null:u("footer",Nc,[r(Ql,153,[a(0,{on:j||(t._m37={click:o(e.handleCancel)})},null)]),u("button",{classMap:Mc,attrs:{type:"button",disabled:e.showSpinner?"":null},key:154,on:_t||(t._m38={click:o(e.handleSubmit)})},[e.showSpinner?r(Yl,156):null,e.showSpinner?h("Saving..."):null,e.showSpinner?null:h("Save")])])])]):null,e.showHelpModal?r(Kl,158,[a(0,{on:Qi||(t._m40={click:o(e.closeHelpModal)})},null),a(1,{on:Yi||(t._m41={click:o(e.handleModalClick)})},null),a(4,null,"Help: "+i(e.helpFieldLabel)),a(5,{on:Ki||(t._m42={click:o(e.closeHelpModal)})},null),a(9,null,i(e.helpText))]):null]}var Pc=J(ze);ze.stylesheets=[],ze.stylesheetToken="lwc-3rdsgj407v4",ze.legacyStylesheetToken="c-safetyEventForm_safetyEventForm",wo&&ze.stylesheets.push.apply(ze.stylesheets,wo),Q(ze);class jc{constructor(){this.encryptionKey=null,this.initEncryption()}async initEncryption(){try{const e=this.getUserSession(),s=await this.getDeviceFingerprint();if(!e||!s){console.warn("\u26A0\uFE0F Missing session data - offline encryption disabled"),this.encryptionKey=null;return}const t=await crypto.subtle.importKey("raw",new TextEncoder().encode(e+s),{name:"PBKDF2"},!1,["deriveKey"]);this.encryptionKey=await crypto.subtle.deriveKey({name:"PBKDF2",salt:new TextEncoder().encode("salesforce_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),console.log("\u{1F510} Secure offline encryption initialized (SQLite)")}catch(e){console.error("\u274C Failed to initialize secure offline encryption:",e),this.encryptionKey=null}}getUserSession(){const e=sessionStorage.getItem("sf_user_id"),s=sessionStorage.getItem("sf_session_id")||sessionStorage.getItem("sf_access_token")?.substring(0,32),t=sessionStorage.getItem("sf_instance_url");return!e||!s||!t?null:btoa(e+":"+s+":"+t.replace(/[^a-zA-Z0-9]/g,""))}async getDeviceFingerprint(){try{const e=document.createElement("canvas"),s=e.getContext("2d");s.textBaseline="top",s.font="14px Arial",s.fillText("Salesforce Offline Security",2,2);const t=[navigator.userAgent,navigator.language,window.screen.width+"x"+window.screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");return btoa(t).substring(0,64)}catch(e){return btoa(navigator.userAgent+Date.now()).substring(0,64)}}async encryptData(e){if(!this.encryptionKey)return console.warn("\u26A0\uFE0F Encryption not available, storing data unencrypted (SQLite)"),JSON.stringify(e);try{const s=crypto.getRandomValues(new Uint8Array(12)),t=new TextEncoder().encode(JSON.stringify(e)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},this.encryptionKey,t),i=new Uint8Array(s.length+o.byteLength);return i.set(s),i.set(new Uint8Array(o),s.length),Array.from(i)}catch(s){return console.error("\u274C Encryption failed:",s),JSON.stringify(e)}}async decryptData(e){if(!this.encryptionKey||typeof e=="string")return JSON.parse(e);try{const s=new Uint8Array(e),t=s.slice(0,12),o=s.slice(12),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},this.encryptionKey,o),a=new TextDecoder().decode(i);return JSON.parse(a)}catch(s){throw console.error("\u274C Decryption failed:",s),new Error("Failed to decrypt offline data")}}validateRequiredFields(e,s){const t=[];return s.forEach(o=>{o.fields.forEach(i=>{i.required&&(!e[i.fieldApi]||e[i.fieldApi].toString().trim()==="")&&t.push(`${i.label} is required`)})}),t}async createSafetyEvent(e,s,t,o=!1){let i=!o&&V()&&navigator.onLine,a=!1,r=null;if(i){const l=sessionStorage.getItem("sf_access_token"),c=sessionStorage.getItem("sf_instance_url");(!l||!c)&&(console.log("\u{1F510} Missing authentication tokens, forcing offline mode"),i=!1)}if(i)try{a=!0;const l=this.createRecordOnline(e,s,!0),c=new Promise((h,u)=>setTimeout(()=>u(new Error("Online creation timeout")),1e4)),d=await Promise.race([l,c]);return{success:!0,id:d.id,isOffline:!1}}catch(l){return r=l,console.warn("\u26A0\uFE0F Online creation failed, details:",{errorMessage:l.message,errorType:l.constructor.name,isNetworkError:l.message.includes("fetch")||l.message.includes("Failed to fetch")||l.message.includes("timeout")||l.message.includes("NetworkError"),willFallback:!0}),console.log("onlineError in line 270",JSON.stringify(l.message)),{success:!1,error:l.message}}else{console.log("\u{1F4F1} Device is offline or forced offline, skipping online attempt"),console.log("\u{1F4BE} Creating record offline...",{onlineAttempted:a,onlineError:r?.message,reason:o?"Force offline mode":a?"Online failed, fallback":"Device offline"});const l={objectApiName:e,formData:s,_createdOffline:!0,_createdAt:new Date().toISOString(),_deviceId:this.getDeviceId(),_onlineAttempted:a,_onlineError:r?.message,_forceOffline:o};try{const c=await this.createRecordOffline(l,e);return console.log("\u2705 Record created offline successfully:",c.id),c}catch(c){console.error("\u274C Both online and offline creation failed:",{onlineError:r?.message,offlineError:c.message});const d=[];throw a&&d.push(`Online: ${r.message}`),d.push(`Offline: ${c.message}`),new Error(`Failed to save record. ${d.join(", ")}`)}}}async createRecordOnline(e,s,t){const o=window.jsforce;if(!o)throw new Error("JSForce not available");console.log("formData in line 332",JSON.stringify(s));const i={...s};if(Object.keys(i).forEach(c=>{c.endsWith("_DisplayName")&&(delete i[c],console.log(`\u{1F9F9} Removed internal DisplayName field: ${c}`))}),e==="Rhythm__Hazard__c")i.Rhythm__Status__c||(i.Rhythm__Status__c="Raised",console.log("\u{1F3AF} Set default Rhythm__Status__c: Raised for Hazard"));else if(e==="Rhythm__Incident_Injury__c"&&(i.Rhythm__Status__c||(i.Rhythm__Status__c="Raised",console.log("\u{1F3AF} Set default Rhythm__Status__c: Raised for Incident")),!i.Rhythm__Reported_By__c)){const c=sessionStorage.getItem("sf_user_id")||localStorage.getItem("sf_user_id");c?(i.Rhythm__Reported_By__c=c,console.log("\u{1F464} Set Rhythm__Reported_By__c to current user ID:",c)):console.warn("\u26A0\uFE0F Unable to set Rhythm__Reported_By__c - user ID not found")}const a=this.normalizeFormDataDatetimes(i);console.log("\u{1F50D} === OFFLINE SERVICE - FINAL DATA TO SALESFORCE CREATE ==="),Object.keys(a).forEach(c=>{if(c.toLowerCase().includes("date")||c.toLowerCase().includes("time")){const d=a[c];if(console.log(`\u{1F50D} ${c}: "${d}"`),c==="Rhythm__Date_Time_of_Incident__c"&&(console.log("\u{1F6A8} INCIDENT DATE - Final analysis before CREATE:"),console.log(`   \u{1F4DD} Value type: ${typeof d}`),console.log(`   \u{1F4DD} Value: "${d}"`),typeof d=="string"&&d))try{const h=new Date(d);console.log(`   \u{1F30D} JavaScript parsing result: ${h.toISOString()}`),console.log(`   \u{1F4C5} As local date: ${h.toLocaleDateString()}`)}catch(h){console.log(`   \u274C JavaScript parsing failed: ${h.message}`)}}}),console.log("\u{1F50D} === END OFFLINE SERVICE ANALYSIS ===");const r=new o.Connection({accessToken:sessionStorage.getItem("sf_access_token"),instanceUrl:sessionStorage.getItem("sf_instance_url")});console.log("\u{1F310} Creating record online:",e,a);const l=await r.sobject(e).create(a);if(!l.success)throw new Error(l.errors?.join(", ")||"Failed to create record");return t&&this.triggerFileUploadWithRecordId(l.id),l}async updateRecordOnline(e,s,t){const o=window.jsforce;if(!o)throw new Error("JSForce not available");console.log("\u{1F310} Updating record online:",e,s,t);const i=new o.Connection({accessToken:sessionStorage.getItem("sf_access_token"),instanceUrl:sessionStorage.getItem("sf_instance_url")}),a={...t};if(delete a._operation,delete a._createdOffline,delete a._createdAt,delete a._deviceId,delete a._onlineAttempted,delete a._onlineError,delete a._forceOffline,Object.keys(a).forEach(c=>{c.endsWith("_DisplayName")&&(delete a[c],console.log(`\u{1F9F9} Removed internal DisplayName field from update: ${c}`))}),e==="Rhythm__Hazard__c")a.Rhythm__Status__c||(a.Rhythm__Status__c="Raised",console.log("\u{1F3AF} Set default Rhythm__Status__c: Raised for Hazard update"));else if(e==="Rhythm__Incident_Injury__c"&&!a.Rhythm__Date_Time_of_Incident__c){const c=new Date,d=c.getFullYear(),h=String(c.getMonth()+1).padStart(2,"0"),u=String(c.getDate()).padStart(2,"0"),f=`${d}-${h}-${u}`;a.Rhythm__Date_Time_of_Incident__c=f,console.log("\u{1F3AF} Set default Rhythm__Date_Time_of_Incident__c for Incident update:"),console.log(`   \u{1F4C5} Local date: ${f}`),console.log(`   \u{1F550} Local time: ${c.toLocaleString()}`),console.log(`   \u{1F30D} Timezone offset: ${c.getTimezoneOffset()} minutes`)}const r=this.normalizeFormDataDatetimes(a);console.log("\u{1F50D} === OFFLINE SERVICE - FINAL DATA TO SALESFORCE UPDATE ==="),Object.keys(r).forEach(c=>{if(c.toLowerCase().includes("date")||c.toLowerCase().includes("time")){const d=r[c];if(console.log(`\u{1F50D} ${c}: "${d}"`),c==="Rhythm__Date_Time_of_Incident__c"&&(console.log("\u{1F6A8} INCIDENT DATE - Final analysis before UPDATE:"),console.log(`   \u{1F4DD} Value type: ${typeof d}`),console.log(`   \u{1F4DD} Value: "${d}"`),typeof d=="string"&&d))try{const h=new Date(d);console.log(`   \u{1F30D} JavaScript parsing result: ${h.toISOString()}`),console.log(`   \u{1F4C5} As local date: ${h.toLocaleDateString()}`)}catch(h){console.log(`   \u274C JavaScript parsing failed: ${h.message}`)}}}),console.log("\u{1F50D} === END OFFLINE SERVICE UPDATE ANALYSIS ===");const l=await i.sobject(e).update({Id:s,...r});if(!l.success)throw new Error(l.errors?.join(", ")||"Failed to update record");return{...l,id:s}}triggerFileUploadWithRecordId(e){try{typeof window!="undefined"&&(window.fileUploadSync?(console.log(`\u{1F680} Triggering file upload sync with recordId: ${e}`),window.fileUploadSync.syncFilesForRecord(e).catch(s=>{console.error("\u274C File upload sync error:",s)})):G?(console.log(`\u{1F680} Triggering file upload sync with recordId: ${e}`),G.syncFilesForRecord(e).catch(s=>{console.error("\u274C File upload sync error:",s)})):console.warn("\u26A0\uFE0F File upload sync service not available"))}catch(s){console.error("\u274C Error triggering file upload sync:",s)}}async createRecordOffline(e,s){try{const t=this.generateOfflineId(),o=await this.encryptData(e),i={id:t,objectType:s,encryptedData:o,syncStatus:"pending",createdAt:new Date().toISOString(),attempts:0,lastAttempt:null};await re(Z.SAFETY_EVENTS,i),await Ft({id:t,type:"CREATE_SAFETY_EVENT",objectType:s,timestamp:Date.now(),data:i});try{const r=(await U.getAllFileUploads()).filter(l=>!l.related_record_id);console.log(`\u{1F4C1} Found ${r.length} unassociated file uploads to link with offline record ${t}`);for(const l of r){const c={...l,related_record_id:t};await U.saveFileUploadItem(c),console.log(`\u{1F4C1} Associated file ${l.id} with offline record: ${t}`)}}catch(a){console.error("\u274C Error associating files with offline record:",a)}return console.log("\u{1F4BE} Safety event saved offline with encryption (SQLite)"),{success:!0,id:t,isOffline:!0}}catch(t){throw console.error("\u274C Failed to save offline (SQLite):",t),new Error("Failed to save safety event offline")}}async syncPendingSafetyEvents(){if(!V())return console.log("\u{1F4F4} Offline, skipping sync"),{synced:0,failed:0};console.log("\u{1F504} Starting enhanced sync for safety events (SQLite)");const s=(await jt()).filter(a=>a.type==="CREATE_SAFETY_EVENT");if(s.length===0)return console.log("\u2705 No pending safety events to sync"),{synced:0,failed:0};console.log(`\u{1F504} Found ${s.length} safety events to sync`);let t=0,o=0;const i=5;for(let a=0;a<s.length;a+=i){const r=s.slice(a,a+i);(await Promise.allSettled(r.map(c=>this.syncSingleSafetyEvent(c)))).forEach((c,d)=>{c.status==="fulfilled"&&c.value.success?t++:(o++,console.error(`\u274C Failed to sync operation ${r[d].id}:`,c.reason))}),a+i<s.length&&await new Promise(c=>{setTimeout(c,1e3)})}return console.log(`\u2705 Sync completed (SQLite): ${t} synced, ${o} failed`),{synced:t,failed:o}}async syncSingleSafetyEvent(e){const s=3,{id:t}=e;try{const o=await this.getStoredRecord(t);if(!o)return console.warn(`\u26A0\uFE0F Stored record not found for operation ${t} (SQLite)`),{success:!1,error:"Record not found"};if(o.attempts>=s)return console.warn(`\u26A0\uFE0F Max retries exceeded for operation ${t}`),{success:!1,error:"Max retries exceeded"};const i=await this.decryptData(o.encryptedData);o.attempts++,o.lastAttempt=new Date().toISOString(),await re(Z.SAFETY_EVENTS,o);const r=(await U.getAllFileUploads()).filter(h=>h.related_record_id===t);console.log(`\u{1F4C1} Found ${r.length} files associated with offline record ${t}`);const l=o.objectType;console.log(`\u{1F504} Syncing record for object: ${l}`),console.log("\u{1F504} Record data:",i);let c;const d={...i.formData};if(delete d.objectApiName,i._operation==="UPDATE"&&i.Id){console.log(`\u{1F504} Performing UPDATE operation for record ${i.Id}`);const h={...i};delete h.objectApiName,c=await this.updateRecordOnline(l,i.Id,h)}else console.log("\u{1F504} Performing CREATE operation"),c=await this.createRecordOnline(l,d,!1);if(!c||!c.id)throw new Error(`Invalid result from createRecordOnline: ${JSON.stringify(c)}`);if(await fs(Z.SAFETY_EVENTS,t),await Ut(t),console.log(`\u2705 Successfully synced safety event ${t} -> ${c.id} (SQLite)`),r.length>0){console.log(`\u{1F680} Processing ${r.length} file uploads for record ${c.id}`);const{uploadFileToS3:h}=await ne("c/uploadFileToS3/v/1_0_0");for(const u of r)try{const f={id:u.id,name:u.file_name,webPath:u.file_path,type:u.mime_type,size:u.file_size,formType:u.form_type,recordId:c.id,description:u.description};console.log(`\u{1F4E4} Uploading file ${u.file_name} for record ${c.id}`);const g=await h(f);g.success?(await U.updateFileUploadStatus(u.id,"uploaded",g.s3Key,g.s3Url),console.log(`\u2705 Successfully uploaded file ${u.id} to S3: ${g.s3Key}`)):console.error(`\u274C Failed to upload file ${u.id}:`,g.error)}catch(f){console.error(`\u274C Error processing file ${u.id}:`,f)}}else this.triggerFileUploadSync();return{success:!0,onlineId:c.id}}catch(o){console.error(`\u274C Failed to sync safety event ${t}:`,o);const i=await this.getStoredRecord(t);return i&&(i.attempts++,i.lastAttempt=new Date().toISOString(),i.lastError=o.message,await re(Z.SAFETY_EVENTS,i)),{success:!1,error:o.message}}}async getStoredRecord(e){return(await me(Z.SAFETY_EVENTS)).find(t=>t.id===e)}async getPendingSafetyEvents(){try{const e=await me(Z.SAFETY_EVENTS),s=[];for(const t of e)try{const o=await this.decryptData(t.encryptedData);s.push({id:t.id,objectType:t.objectType,data:o,syncStatus:t.syncStatus,createdAt:t.createdAt,attempts:t.attempts,lastAttempt:t.lastAttempt,lastError:t.lastError})}catch(o){console.error("\u274C Failed to decrypt record:",t.id,o)}return console.log(`\u{1F4F1} Retrieved ${s.length} pending safety events from SQLite`),s}catch(e){return console.error("\u274C Failed to get pending safety events from SQLite:",e),[]}}getDeviceId(){let e=localStorage.getItem("device_id");return e||(e="device_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),localStorage.setItem("device_id",e)),e}generateOfflineId(){return"offline_"+Math.random().toString(36).substr(2,9)+"_"+Date.now()}normalizeFormDataDatetimes(e){const s={...e};return Object.keys(s).forEach(t=>{const o=s[t];o&&typeof o=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(o)&&(s[t]=o+":00")}),s}initAutoSync(){window.addEventListener("online",()=>{console.log("\u{1F310} Device came online, triggering sync (SQLite)"),setTimeout(()=>{this.syncPendingSafetyEvents(),this.triggerFileUploadSync()},2e3)}),setInterval(()=>{V()&&(this.syncPendingSafetyEvents(),this.triggerFileUploadSync())},5*60*1e3)}triggerFileUploadSync(){try{let e=null;typeof window!="undefined"&&window.fileUploadSync?(e=window.fileUploadSync,console.log("\u{1F504} Found file upload sync service on window")):G&&(e=G,console.log("\u{1F504} Found file upload sync service via import")),e?(console.log("\u{1F504} Triggering file upload sync..."),e.triggerManualSync().catch(s=>{console.error("\u274C File upload sync error:",s)})):console.log("\u26A0\uFE0F File upload sync service not available")}catch(e){console.error("\u274C Error triggering file upload sync:",e)}}async clearAllOfflineData(){try{const e=await me(Z.SAFETY_EVENTS);for(const o of e)await fs(Z.SAFETY_EVENTS,o.id);const t=(await jt()).filter(o=>o.type==="CREATE_SAFETY_EVENT");for(const o of t)await Ut(o.id);console.log("\u{1F5D1}\uFE0F All offline safety event data cleared from SQLite")}catch(e){console.error("\u274C Failed to clear offline data from SQLite:",e)}}}const We=new jc;We.initAutoSync();var ks;class ge extends K{constructor(...e){super(...e);this.objectApiName="",this.isVisible=!1,this.qrData=null,this.whatId=null,this.openedFromListView=!1,this.relatedId=null,this.relatedToApi=null,this.sections=[],this.formData={},this.isLoading=!1,this.selectedContractorId=null,this.contactAccountMap={},this.selectedLocationId=null,this.workAreaLocationMap={},this.assetLocationMap={},this.contactLocationMap={},this.userContractorInfo=null,this.error=null,this.showSpinner=!1,this.showToast=!1,this.toastMessage="",this.toastType="info",this.lookupOptionsMap={},this.currentFieldApi=null,this.isSubmitting=!1,this.devNameToApi={},this.allFieldsMap={},this.controllingFieldsMap={},this.objectSchema={},this.picklistValues={},this.objectLabel="",this.formTitle="",this.acceptedFormats=".jpg,.jpeg,.png,.pdf,.doc,.docx,.txt",this.formTempId=null,this.defaultLocationId=null,this.qrLocationId=null,this.qrWorkAreaId=null,this.isQrMode=!1,this.immediateCorrectionFields=[],this.visibleCorrectionFields=1,this.multipleTaskForms=[],this.nextTaskId=1,this.showHelpModal=!1,this.helpText="",this.helpFieldLabel="",this.userName="",this.lastLoadedObjectApiName="",this.READ_ONLY_FIELDS=["Rhythm__Total_Attendance_session__c","Rhythm__Man_Hour_Trained__c"],this.CONDITIONAL_EDITABLE_FIELDS={Rhythm__SubContractor__c:["Rhythm__Contractor__c","Rhythm__Contractor_Account__c"],Rhythm__Sub_Contractor__c:["Rhythm__Contractor__c","Rhythm__Contractor_Account__c"]},this.LISTVIEW_ALLOWED_FIELDS={Task:["Subject","ActivityDate","Rhythm__CAPA_Type__c","OwnerId","Description"]},this.LISTVIEW_FIELD_ORDER={Task:{Subject:1,ActivityDate:2,Rhythm__CAPA_Type__c:3,OwnerId:4,Description:5}},this.HARDCODED_TASK_FIELDS={Subject:{fieldApi:"Subject",label:"Action as per plan",fieldType:"STRING",required:!0,section:"Task Information",fieldOrder:1,picklistValues:[],lookupOptions:[],developerName:"Subject",isMobile:!0,visibleWhenValues:{},isEnhanced:!0,referenceTo:[],maxLength:255},ActivityDate:{fieldApi:"ActivityDate",label:"Target Date",fieldType:"DATE",required:!0,section:"Task Information",fieldOrder:2,picklistValues:[],lookupOptions:[],developerName:"ActivityDate",isMobile:!0,visibleWhenValues:{},isEnhanced:!0,referenceTo:[]},Rhythm__CAPA_Type__c:{fieldApi:"Rhythm__CAPA_Type__c",label:"CAPA Type",fieldType:"PICKLIST",required:!0,section:"Task Information",fieldOrder:3,picklistValues:[{label:"Corrective Action",value:"Corrective Action",active:!0},{label:"Preventive Action",value:"Preventive Action",active:!0}],lookupOptions:[],developerName:"CAPA_Type",isMobile:!0,visibleWhenValues:{},isEnhanced:!0,referenceTo:[]},OwnerId:{fieldApi:"OwnerId",label:"Responsibility",fieldType:"REFERENCE",required:!0,section:"Task Information",fieldOrder:4,picklistValues:[],lookupOptions:[],developerName:"OwnerId",isMobile:!0,visibleWhenValues:{},isEnhanced:!0,referenceTo:["User"]},Description:{fieldApi:"Description",label:"Remarks",fieldType:"TEXTAREA",required:!1,section:"Task Information",fieldOrder:5,picklistValues:[],lookupOptions:[],developerName:"Description",isMobile:!0,visibleWhenValues:{},isEnhanced:!0,referenceTo:[],maxLength:32e3}},this.HARDCODED_FIELDS={Task:{Rhythm__CAPA_Type__c:{fieldApi:"Rhythm__CAPA_Type__c",label:"CAPA Type",fieldType:"picklist",required:!1,section:"Task Information",fieldOrder:3,picklistValues:[{label:"Preventive Action",value:"Preventive Action",active:!0},{label:"Corrective Action",value:"Corrective Action",active:!0}],lookupOptions:[],developerName:"CAPA_Type",isMobile:!0,visibleWhenValues:{},isEnhanced:!0,referenceTo:[]}}}}connectedCallback(){this.ensureFileUploadSyncAvailable(),this.picklistValues||(this.picklistValues={}),this.loadCachedPicklistValues()}loadCachedPicklistValues(){try{const e=`picklist_values_${this.objectApiName}`,s=sessionStorage.getItem(e);if(s){const t=JSON.parse(s);this.picklistValues={...this.picklistValues,...t}}}catch(e){}}ensureFileUploadSyncAvailable(){try{typeof window!="undefined"&&!window.fileUploadSync&&(window.fileUploadSync=G)}catch(e){}}async loadDefaultLocation(){try{const e=await se.getConnectionForComponent("SafetyEventForm");let s=sessionStorage.getItem("sf_user_id");if(s||(s=localStorage.getItem("sf_user_id")),!s)return;const t=`
                SELECT Id, ContactId, Email, Rhythm__Default_Location__c, Name
                FROM User
                WHERE Id = '${s}'
                LIMIT 1
            `,o=await e.query(t);if(o.records.length>0&&o.records[0].Rhythm__Default_Location__c){if(this.userName=o.records[0].Name,this.defaultLocationId=o.records[0].Rhythm__Default_Location__c,this.selectedLocationId=this.defaultLocationId,this.defaultLocationId){const i=await this.getUsersFromUserAccess();this.lookupOptionsMap.Rhythm__Assigned_To__c=i.map(a=>({label:a.Rhythm__User__r.Name,value:a.Rhythm__User__c,selected:!1}))}Promise.resolve().then(()=>{console.log("\u{1F3D7}\uFE0F Triggering work area and asset loading for default location:",this.defaultLocationId),this.lookupOptionsMap.Rhythm__Work_Area__c&&(console.log("\u{1F3D7}\uFE0F Loading work areas for default location:",this.defaultLocationId),this.queryWorkAreaLocationIds(this.defaultLocationId)),console.log("\u{1F3D7}\uFE0F Loading assets for default location:",this.defaultLocationId),this.loadAssetsForLocation(this.defaultLocationId)})}else console.log("\u{1F3E2} No default location found for user")}catch(e){console.error("\u274C Error loading default location:",e)}}async validateUserAccess(e,s){try{console.log("\u{1F510} Validating user access to location and work area...");const t=await se.getConnectionForComponent("SafetyEventForm");let o=sessionStorage.getItem("sf_user_id");if(o||(o=localStorage.getItem("sf_user_id")),!o)return{hasAccess:!1,error:"User not authenticated. Please login first."};const i=`
                SELECT Id, Name
                FROM Rhythm__Location__c 
                WHERE Id = '${e}' 
                
            `,a=await t.query(i);if(a.records.length===0){console.log("\u{1F510} Access denied via location check, trying default location");const c=`
                    SELECT Id, Rhythm__Default_Location__c
                    FROM User
                    WHERE Id = '${o}'
                    LIMIT 1
                `,d=await t.query(c);if(d.records.length>0&&d.records[0].Rhythm__Default_Location__c===e)console.log("\u{1F510} Access granted via default location");else return{hasAccess:!1,error:"You do not have access to this location. Please contact your administrator."}}const r=`
                SELECT Rhythm__Organization_Component__c,Rhythm__Org_Component_Name__c, Rhythm__Location__c
                FROM Rhythm__Location_OrgComp_Map__c
                WHERE Rhythm__Organization_Component__c = '${s}' 
                AND Rhythm__Location__c = '${e}'
                
                LIMIT 1
            `;console.log("workAreaQuery in line 257",r);const l=await t.query(r);return console.log("workAreaResult in line 259",JSON.stringify(l)),l.records.length===0?{hasAccess:!1,error:"Invalid work area or work area is not associated with the specified location."}:(console.log("\u2705 User access validated successfully"),{hasAccess:!0,locationName:a.records[0]?.Name||"Location",workAreaName:l.records[0]?.Name||"Work Area"})}catch(t){return console.error("\u274C Error validating user access:",t),{hasAccess:!1,error:"Failed to validate access: "+t.message}}}initializeImmediateCorrectionFields(){if(this.objectApiName==="Rhythm__Incident_Injury__c"){this.immediateCorrectionFields=[];for(let e=1;e<=7;e++){const s=`Rhythm__Immediate_Correction_${e}__c`;this.immediateCorrectionFields.push({fieldApi:s,label:`Immediate Correction ${e}`,value:this.formData[s]||"",isVisible:e<=this.visibleCorrectionFields,canDelete:e>1,canShowPlus:!1,canClickPlus:!1,disablePlus:!0,canShowDelete:e>1&&e<=this.visibleCorrectionFields,index:e})}this.updateImmediateCorrectionVisibility()}else this.immediateCorrectionFields=[],this.visibleCorrectionFields=1}initializeContractorDependencies(){let e=null,s=!1;if(this.allFieldsMap&&this.allFieldsMap.Rhythm__Contractor__c?(e=this.formData.Rhythm__Contractor__c,s=!0):this.allFieldsMap&&this.allFieldsMap.Rhythm__Contractor_Account__c&&(e=this.formData.Rhythm__Contractor_Account__c,s=!0),s&&e){this.selectedContractorId=e;const t="Rhythm__Contractor_Employee_Involved__c";this.allFieldsMap&&this.allFieldsMap[t]&&this.queryContactAccountIds()}s?(console.log("\u{1F3E2} Contractor field exists, will query user contractor info for prepopulation"),this.queryUserContractorInfo()):console.log("\u{1F3E2} No contractor field in form, skipping contractor prepopulation")}renderedCallback(){this.isSubmitting||(this.isVisible&&this.objectApiName&&this.objectApiName!==this.lastLoadedObjectApiName&&(this.lastLoadedObjectApiName=this.objectApiName,this.formData={},this.objectLabel=this.computeObjectLabelFromApiName(this.objectApiName),this.updateFormTitle(),this.loadMetadataConfiguration(),this.loadDefaultLocation(),this.initializeImmediateCorrectionFields(),this.qrData&&this.processQrData().catch(e=>{console.error("\u274C Error processing QR data:",e),this.error="Failed to validate QR location access: "+e.message})),this.initializeCheckboxes(),this.initializeSelectValues(),this.initializeDefaultValues())}initializeCheckboxes(){const e=this.template.querySelectorAll('input[type="checkbox"]');e.length>0&&e.forEach(s=>{const t=s.dataset.field;if(t&&this.formData){const o=this.formData[t];if(o!==void 0){const i=o===!0||o==="true";s.checked=i,s.dataset.value=String(i)}}})}handleModalClick(e){e.stopPropagation()}async initializeForm(){this.objectApiName!==this.lastLoadedObjectApiName&&(this.formData={},this.sections=[],this.lookupOptionsMap={},this.error=null,this.formTempId=this.generateFormTempId(),this.updateFileUploaderFormTempId()),this.lastLoadedObjectApiName=this.objectApiName,this.objectLabel=this.computeObjectLabelFromApiName(this.objectApiName),this.updateFormTitle(),await this.loadMetadataConfiguration()}initializeSelectValues(){const e=this.template.querySelectorAll("select[data-field]");e.length>0&&e.forEach(s=>{const t=s.dataset.field,o=this.formData[t];o!=null&&o!==""&&(s.value=o)})}initializeDefaultValues(){const e=this.template.querySelectorAll("input[data-field], textarea[data-field]");e.length>0&&e.forEach(s=>{const t=s.dataset.field,o=this.formData[t];o!=null&&(s.type==="checkbox"?s.checked=o===!0||o==="true":s.value=o)})}resetFormDataStructures(){this.sections=[],this.lookupOptionsMap={},this.devNameToApi={},this.allFieldsMap={},this.controllingFieldsMap={},this.objectSchema={},this.picklistValues={},this.formData||(this.formData={})}async loadMetadataConfiguration(){this.isLoading=!0,this.error=null;try{this.resetFormDataStructures(),this.objectLabel=this.computeObjectLabelFromApiName(this.objectApiName),this.updateFormTitle();const e=await H.getMetadata(this.objectApiName);if(console.log("meta in line 544",JSON.stringify(e)),e&&e.fieldMetadata&&e.fieldMetadata.length>0){const[s,t]=await Promise.all([H.getCachedObjectSchema(this.objectApiName).catch(()=>null),H.getCachedLookupOptions(this.objectApiName).catch(()=>null)]);this.objectSchema=s||e.objectSchema||{},this.lookupOptionsMap=t||e.lookupOptionsMap||{},console.log("cachedLookups in line 565",JSON.stringify(t)),console.log("cachedSchema in line 566",JSON.stringify(s)),this.loadCachedPicklistValues(),await this.processCachedMetadata(e)}else if(await V())try{const s=await se.getConnectionForComponent();await this.loadObjectSchemaWithLookups(s,e.fieldMetadata||[]),await Promise.all([H.cacheObjectSchema(this.objectApiName,this.objectSchema),H.cacheLookupOptions(this.objectApiName,this.lookupOptionsMap)]),await this.processCachedMetadata(e)}catch(s){throw new Error(`Failed to load form configuration: ${s.message}. No cached data available.`)}else throw new Error("No cached form configuration found and device is offline. Please connect to internet to load initial configuration.")}catch(e){this.error=`Failed to load form configuration: ${e.message}`}finally{this.isLoading=!1}}isCacheStale(e){if(!e.cachedAt)return!0;const s=Date.now()-new Date(e.cachedAt).getTime(),t=60*60*1e3;return s>t}async processCachedMetadata(e){const s=e.fieldMetadata||[];console.log("fieldMetadata in line 661",JSON.stringify(s));let t=e.controllingFields||[];console.log("controllingFields in line 665",JSON.stringify(t));try{const l=await H.getCachedControllingFields(this.objectApiName);console.log("cachedCtrl in line 671",JSON.stringify(l)),l&&Array.isArray(l.records)&&l.records.length>0?t=l.records:(!t||t.length===0)&&(t=[])}catch(l){t=t||[]}this.lookupOptionsMap={...this.lookupOptionsMap||{}},this.picklistValues={},e.objectSchema&&(this.objectSchema=e.objectSchema),Object.keys(this.objectSchema).forEach(l=>{const c=this.objectSchema[l];(c.type==="picklist"||c.type==="multipicklist")&&c.picklistValues&&c.picklistValues.length>0&&(this.picklistValues[l]=c.picklistValues.map(d=>({label:d.label,value:d.value,active:d.active!==!1,defaultValue:d.defaultValue||!1})))}),s.forEach(l=>{const c=l.Rhythm__Field_Api_Name__c;if(l._lookupOptions&&l._lookupOptions.length>0&&(this.lookupOptionsMap[c]=l._lookupOptions),l._fieldType==="picklist"||l._fieldType==="multipicklist"){if(l._picklistValues&&l._picklistValues.length>0)this.picklistValues[c]=l._picklistValues;else if(!this.picklistValues[c]){const d=this.objectSchema[c];d&&d.picklistValues&&d.picklistValues.length>0&&(this.picklistValues[c]=d.picklistValues.map(h=>({label:h.label,value:h.value,active:h.active!==!1,defaultValue:h.defaultValue||!1})))}}});try{const l=await H.getMobileLookupOptions(this.objectApiName);Object.keys(l).forEach(c=>{l[c]&&l[c].length>0&&(!this.lookupOptionsMap[c]||this.lookupOptionsMap[c].length===0)&&(this.lookupOptionsMap[c]=l[c])})}catch(l){}const o="Rhythm__Contractor_Employee_Involved__c";this.lookupOptionsMap[o]&&this.queryContactAccountIds();const i="Rhythm__Work_Area__c";this.lookupOptionsMap[i]&&this.queryWorkAreaLocationIds(),["Rhythm__Employee_Individual_Involved__c","Rhythm__Name_of_Person_Injured__c"].some(l=>this.lookupOptionsMap[l]&&this.lookupOptionsMap[l].length>0)&&this.queryContactLocationIds(),await this.processMetadataForForm(s,t),this.openedFromListView&&this.objectApiName==="Task"&&(await this.loadUserLookupOptions(),this.initializeMultipleTaskForms()),this.objectApiName==="Task"&&this.initializeTaskDefaults(),this.checkAndLoadInitialAssetOptions()}async checkAndLoadInitialAssetOptions(){try{console.log("\u{1F50D} Checking for initial location to load asset options...");let e=null;e=this.formData.AccountRhythm__Location__c||this.formData.Rhythm__Site__c,!e&&this.qrLocationId&&(e=this.qrLocationId,console.log("\u{1F3D7}\uFE0F Using QR location for asset loading:",e)),!e&&this.defaultLocationId&&(e=this.defaultLocationId,console.log("\u{1F3D7}\uFE0F Using default location for asset loading:",e)),!e&&this.selectedLocationId&&(e=this.selectedLocationId,console.log("\u{1F3D7}\uFE0F Using previously selected location for asset loading:",e)),e?(console.log("\u2705 Found initial location, loading work areas and assets for location:",e),this.selectedLocationId=e,this.queryWorkAreaLocationIds(e),await this.loadAssetsForLocation(e),this.sections=[...this.sections]):(console.log("\u2139\uFE0F No initial location found, asset fields will be empty until location is selected"),this.populateAssetFields([]))}catch(e){console.error("\u274C Error checking initial location for asset options:",e)}}populateAssetFields(e){console.log("\u{1F504} Populating asset fields with",e.length,"options");const s=this.objectApiName==="Rhythm__Hazard__c"?"Rhythm__Assets__c":"Rhythm__Asset_Equipment__c";this.lookupOptionsMap[s]!==void 0?(this.lookupOptionsMap[s]=e,console.log(`\u2705 Populated ${s} with ${e.length} asset options for ${this.objectApiName}`)):console.log(`\u2139\uFE0F Asset field ${s} not found in lookup options for ${this.objectApiName}, skipping population`),this.sections=[...this.sections],console.log("\u{1F504} Asset fields populated and UI updated")}async loadFreshMetadata(){const e=window.jsforce;if(!e)throw new Error("JSForce library not loaded");const s=sessionStorage.getItem("sf_access_token"),t=sessionStorage.getItem("sf_instance_url");if(!s||!t)throw new Error("Not authenticated. Please login first.");const o=new e.Connection({accessToken:s,instanceUrl:t}),i=`
                SELECT Id, MasterLabel, DeveloperName, 
                       Rhythm__Object_Api_Name__c, Rhythm__Field_Api_Name__c,
                       Rhythm__Required__c, Rhythm__is_Mobile__c,
                       Rhythm__Section_Name__c, Rhythm__Order__c,
                       Rhythm__Lookup_Filter_Label__c, Rhythm__is_New__c
                FROM Rhythm__Fields_Level_Configuration__mdt 
                WHERE Rhythm__Object_API_Name__c = '${this.objectApiName}'
                ORDER BY Rhythm__Section_Name__c, Rhythm__Order__c
            `,a=await o.query(i);console.log("metadataResult in line 871",JSON.stringify(a));const r=`
                SELECT Id, MasterLabel, DeveloperName, Label,
                       Rhythm__Value__c, 
                       Rhythm__Fields_Level_Configuration__r.Id,
                       Rhythm__Fields_Level_Configuration__r.DeveloperName,
                       Rhythm__Fields_Level_Configuration__r.MasterLabel,
                       Rhythm__Fields_Level_Configuration__r.Rhythm__Field_Api_Name__c
                FROM Rhythm__Controlling_Field__mdt
                WHERE Rhythm__Fields_Level_Configuration__r.Rhythm__Object_API_Name__c = '${this.objectApiName}'
            `,l=await o.query(r);console.log("\u{1F517} Controlling fields records found:",l.records.length),await this.loadObjectSchemaWithLookups(o,a.records);const c=await this.enhanceMetadataWithSchema(a.records,this.objectSchema);this.processMetadataForForm(c,l.records);try{await this.cacheEnhancedMetadata(c,l.records)}catch(d){}}async enhanceMetadataWithSchema(e,s){const t=[];for(const i of e){const a=i.Rhythm__Field_Api_Name__c,r=s[a];if(!r){const c={...i,_fieldType:"string",_enhanced:!0,_picklistValues:[],_lookupOptions:[]};t.push(c);continue}const l={...i,_fieldType:r.type,_label:r.label,_required:!r.nillable&&!r.defaultedOnCreate,_length:r.length,_precision:r.precision,_scale:r.scale,_referenceTo:r.referenceTo||[],_relationshipName:r.relationshipName,_enhanced:!0};if(r.type==="picklist"||r.type==="multipicklist"){let c=this.picklistValues[a]||r.picklistValues||[];c.length>0&&typeof c[0]=="object"?l._picklistValues=c:c.length>0?l._picklistValues=c.map(d=>({label:d.label||d,value:d.value||d,active:d.active!==!1,defaultValue:d.defaultValue||!1})):l._picklistValues=[],l._picklistValues.length>0&&console.log("   Sample values:",l._picklistValues.slice(0,3))}else l._picklistValues=[];r.type==="reference"?(l._lookupOptions=this.lookupOptionsMap[a]||[],l._lookupOptions.length>0&&console.log("   Sample options:",l._lookupOptions.slice(0,3))):l._lookupOptions=[],t.push(l)}const o=this.validateEnhancementQuality(t);return console.log("\u{1F4CA} Enhancement validation:",o),console.log(`\u2705 Enhanced ${t.length} metadata records`),t}validateEnhancementQuality(e){let s=e.length,t=0,o=0,i=0,a=0,r=0;return e.forEach(l=>{l._enhanced&&t++,(l._fieldType==="picklist"||l._fieldType==="multipicklist")&&(a++,l._picklistValues&&l._picklistValues.length>0&&o++),l._fieldType==="reference"&&(r++,l._lookupOptions&&l._lookupOptions.length>0&&i++)}),{totalFields:s,enhancedFields:t,enhancementRatio:t/s,picklistFields:{total:a,withValues:o,coverage:a>0?o/a:1},lookupFields:{total:r,withOptions:i,coverage:r>0?i/r:1}}}async cacheEnhancedMetadata(e,s){try{await H.cacheFieldMetadata(this.objectApiName,e,this.objectSchema),await H.cacheControllingFields(this.objectApiName,s),await H.cacheCompleteMetadataForMobile(this.objectApiName,e,s,e),console.log("\u{1F4F1} Cached complete metadata for mobile offline use")}catch(t){throw console.error("\u274C Failed to cache enhanced metadata:",t),t}}async loadObjectSchemaWithLookups(e,s=[]){try{const t=ge.preparedCache.get(this.objectApiName);if(t&&t.objectSchema){this.objectSchema=t.objectSchema,this.lookupOptionsMap=t.lookupOptionsMap||{},this.picklistValues=t.picklistValues||{};return}const o=new Set((s||[]).map(l=>l.Rhythm__Field_Api_Name__c).filter(l=>!!l)),i=await e.sobject(this.objectApiName).describe();this.objectSchema={},this.picklistValues={},this.lookupOptionsMap={};try{this.objectLabel=i?.label||this.objectLabel,this.updateFormTitle()}catch(l){}const a=i.fields.filter(l=>o.has(l.name)),r=[];a.forEach(l=>{this.objectSchema[l.name]=l,(l.type==="picklist"||l.type==="multipicklist")&&(this.picklistValues[l.name]=l.picklistValues.map(c=>({label:c.label,value:c.value,active:c.active,defaultValue:c.defaultValue}))),l.type==="reference"&&l.referenceTo&&l.referenceTo.length>0&&r.push({fieldName:l.name,referencedObject:l.referenceTo[0]})});for(const l of r){const c=await this.queryLookupOptions(e,l.referencedObject);this.lookupOptionsMap[l.fieldName]=c}ge.preparedCache.set(this.objectApiName,{objectSchema:this.objectSchema,lookupOptionsMap:this.lookupOptionsMap,picklistValues:this.picklistValues})}catch(t){console.error("Error describing object or loading lookups:",t)}}async queryLookupOptions(e,s){console.log(`\u{1F50D} Querying lookup options for: ${s}`);try{let t;try{t=await e.sobject(s).describe()}catch(u){return console.warn(`\u26A0\uFE0F Cannot describe ${s}:`,u.message),[]}const o=t.fields,i={};o.forEach(u=>{i[u.name]=u});let a="Id";const r=["Name","Subject","Title","Label","MasterLabel"];for(const u of r)if(i[u]&&i[u].type==="string"){a=u;break}let l=["Id"];a!=="Id"&&l.push(a),s==="Contact"&&l.push("Account.RecordType.Name");const c=[];s==="Rhythm__Location__c"||s==="Rhythm__OrgComponent__c"&&i.Rhythm__Status__c?c.push("Rhythm__Status__c = 'Active'"):s==="User"&&i.IsActive?c.push("IsActive = true"):s==="Contact"&&i.IsDeleted?c.push("Account.RecordType.Name = ''"):s.includes("Contract")&&i.Status&&c.push("Status = 'Activated'"),i.IsDeleted&&i.IsDeleted.type==="boolean"&&c.push("IsDeleted = false");let d=`SELECT ${l.join(", ")} FROM ${s}`;c.length>0&&(d+=` WHERE ${c.join(" AND ")}`),a!=="Id"&&(d+=` ORDER BY ${a}`),d+=" LIMIT 200",console.log(`\u{1F50D} Executing generic lookup query: ${d}`);const h=await e.query(d);return console.log("line 776",JSON.stringify(h,null,2)),h.records.map(u=>{const f=u[a]||u.Id||"Unknown";return{label:f,value:u.Id,displayValue:f,objectType:s}})}catch(t){return console.error(`\u274C Error querying lookup options for ${s}:`,t),console.warn(`\u26A0\uFE0F Falling back to empty options for ${s}`),[]}}findControllingField(e,s){if(console.log(`\u{1F50D} Searching for controlling field: "${e}"`),!e||!s||!Array.isArray(s))return console.warn("\u26A0\uFE0F Invalid inputs for findControllingField"),null;const t=e.trim().toLowerCase();if(this._controllerFieldCache&&this._controllerFieldCache[t])return console.log(`\u2705 Using cached controller field for "${e}"`),this._controllerFieldCache[t];this._controllerFieldCache||(this._controllerFieldCache={});let o=s.find(r=>r.MasterLabel===e);if(o)return console.log(`\u2705 Strategy 1 - Exact MasterLabel match: "${e}" -> ${o.MasterLabel}`),this._controllerFieldCache[t]=o,o;if(o=s.find(r=>r.DeveloperName===e),o)return console.log(`\u2705 Strategy 2 - Exact DeveloperName match: "${e}" -> ${o.DeveloperName}`),this._controllerFieldCache[t]=o,o;if(o=s.find(r=>r.MasterLabel?.toLowerCase()===e?.toLowerCase()),o)return console.log(`\u2705 Strategy 3 - Case-insensitive MasterLabel match: "${e}" -> ${o.MasterLabel}`),this._controllerFieldCache[t]=o,o;if(o=s.find(r=>r.DeveloperName?.toLowerCase()===e?.toLowerCase()),o)return console.log(`\u2705 Strategy 4 - Case-insensitive DeveloperName match: "${e}" -> ${o.DeveloperName}`),this._controllerFieldCache[t]=o,o;if(o=s.find(r=>r.MasterLabel?.toLowerCase().includes(e?.toLowerCase())||e?.toLowerCase().includes(r.MasterLabel?.toLowerCase())),o)return console.log(`\u2705 Strategy 5 - Partial MasterLabel match: "${e}" -> ${o.MasterLabel}`),this._controllerFieldCache[t]=o,o;if(o=s.find(r=>r.DeveloperName?.toLowerCase().includes(e?.toLowerCase())||e?.toLowerCase().includes(r.DeveloperName?.toLowerCase())),o)return console.log(`\u2705 Strategy 6 - Partial DeveloperName match: "${e}" -> ${o.DeveloperName}`),o;const i=e?.replace(/^(Rhythm__|IncidentExternal|HazardExternal|Incident|Hazard)/,"").replace(/__c$/,"");if(i!==e&&(o=s.find(r=>r.MasterLabel?.toLowerCase().includes(i?.toLowerCase())||r.DeveloperName?.toLowerCase().includes(i?.toLowerCase())),o))return console.log(`\u2705 Strategy 7 - Cleaned label match: "${e}" -> "${i}" -> ${o.MasterLabel}`),o;const a=e?.toLowerCase().split(/[\s_]+/).filter(r=>r.length>2);return a&&a.length>0&&(o=s.find(r=>{const l=r.MasterLabel?.toLowerCase().split(/[\s_]+/)||[],c=r.DeveloperName?.toLowerCase().split(/[\s_]+/)||[];return a.some(d=>l.some(h=>h.includes(d)||d.includes(h))||c.some(h=>h.includes(d)||d.includes(h)))}),o)?(console.log(`\u2705 Strategy 8 - Word-based match: "${e}" -> ${o.MasterLabel}`),o):(o=s.find(r=>r.Rhythm__Field_Api_Name__c?.toLowerCase()===e?.toLowerCase()),o?(console.log(`\u2705 Strategy 9 - Field API name match: "${e}" -> ${o.Rhythm__Field_Api_Name__c}`),this._controllerFieldCache[t]=o,o):(console.warn(`\u274C All matching strategies failed for: "${e}"`),null))}processMetadataForForm(e,s){if(console.log("\u{1F3D7}\uFE0F Starting metadata processing for form..."),console.log("\u{1F3D7}\uFE0F Field metadata records:",e.length),console.log("\u{1F3D7}\uFE0F Controlling metadata records:",s.length),this.openedFromListView){const l=this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName];console.log(`\u{1F4CB} DEBUG: openedFromListView=true, objectApiName='${this.objectApiName}'`),console.log("\u{1F4CB} DEBUG: Available LISTVIEW_ALLOWED_FIELDS keys:",Object.keys(this.LISTVIEW_ALLOWED_FIELDS)),l?console.log(`\u{1F4CB} List view filtering active for ${this.objectApiName}. Allowed fields:`,l):console.log(`\u{1F4CB} Form opened from list view but no field filtering configured for ${this.objectApiName}`)}else console.log(`\u{1F4CB} Form opened normally (not from list view) - no field filtering. objectApiName='${this.objectApiName}'`);console.log("\u{1F517} Raw controlling metadata:",s),this.devNameToApi={};const t={};e.forEach(l=>{const c=l.Rhythm__Field_Api_Name__c,d=l.DeveloperName,h=l.MasterLabel;d&&(t[d]=l,this.devNameToApi[d]=c),h&&(this.devNameToApi[h]=c),this.devNameToApi[c]=c}),console.log("\u{1F4CB} Fields by developer name:",Object.keys(t)),console.log("\u{1F4CB} Dev name to API mapping:",this.devNameToApi);const o={};s&&s.length>0&&s.forEach((l,c)=>{console.log(`\u{1F517} Processing controlling field ${c+1}:`,l);const d=l.Rhythm__Fields_Level_Configuration__r?.DeveloperName,h=l.MasterLabel,u=l.Rhythm__Value__c;console.log("\u{1F517} Controlling relationship:"),console.log(`   Dependent Field DevName: ${d}`),console.log(`   Controlling Field Label: ${h}`),console.log(`   Expected Value: ${u}`),d&&h&&u?(o[d]||(o[d]={}),o[d][h]||(o[d][h]=[]),o[d][h].push(u),console.log(`\u2705 Added controlling dependency: ${d} depends on ${h} = ${u}`)):console.warn("\u274C Incomplete controlling field data:",l)}),console.log("\u{1F517} Final controlling dependencies:",o);let i=[...e];if(this.openedFromListView){const l=this.getHardcodedFields();console.log(`\u{1F4CB} Adding ${l.length} hardcoded fields for ${this.objectApiName} in list view`),l.forEach(c=>{const d={Rhythm__Field_Api_Name__c:c.fieldApi,MasterLabel:c.label,DeveloperName:c.developerName,Rhythm__Required__c:c.required,Rhythm__is_Mobile__c:!0,Rhythm__Section_Name__c:c.section,Rhythm__Order__c:c.fieldOrder,Rhythm__is_New__c:!0,_fieldType:c.fieldType,_picklistValues:c.picklistValues,_lookupOptions:c.lookupOptions,_enhanced:c.isEnhanced,_isHardcoded:!0};i.push(d),console.log(`\u{1F4CB} Added hardcoded field: ${c.fieldApi} (${c.label})`)})}const a={};this.allFieldsMap={},i.forEach((l,c)=>{if(console.log(`\u{1F4CB} Processing field ${c+1}: ${l.MasterLabel} (${l.DeveloperName})`),!l.Rhythm__is_Mobile__c){console.log(`\u23ED\uFE0F Skipping non-mobile field: ${l.DeveloperName}`);return}const d=l.Rhythm__Field_Api_Name__c;if(this.openedFromListView&&this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName]){const w=this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName],y=l._isHardcoded===!0;if(console.log(`\u{1F50D} FILTERING: Checking field ${d} for object ${this.objectApiName} (hardcoded: ${y})`),console.log("\u{1F50D} FILTERING: Allowed fields:",w),!w.includes(d)){console.log(`\u{1F512} Skipping field ${d} - not in allowed list for ${this.objectApiName} in list view`);return}console.log(`\u2705 Field ${d} is allowed for ${this.objectApiName} in list view`)}else this.openedFromListView&&console.log(`\u{1F50D} FILTERING: No filtering config for object ${this.objectApiName}, allowing field ${d}`);const h=l._isHardcoded===!0,u=l.Rhythm__is_New__c===!0||l.Rhythm__is_New__c==="true",f=l.Rhythm__is_Mobile__c===!0||l.Rhythm__is_Mobile__c==="true";if(!h&&!f){console.log(`\u23ED\uFE0F Skipping field not marked for mobile: ${l.DeveloperName} (is_Mobile: ${f})`);return}if(!h&&!u){console.log(`\u23ED\uFE0F Skipping field not marked for new forms: ${l.DeveloperName} (is_New: ${u})`);return}let g;if(this.openedFromListView&&this.objectApiName==="Task")g=["Task Information"];else{const w=l.Rhythm__Section_Name__c||"General Information";g=w.split(",").map(y=>y.trim()).filter(y=>y),console.log(`\u{1F4CB} Processing field ${l.Rhythm__Field_Api_Name__c}:`),console.log(`\u{1F4CB}   Raw section name: "${w}"`),console.log(`\u{1F4CB}   Split sections: [${g.map(y=>`"${y}"`).join(", ")}]`),console.log(`\u{1F4CB}   Number of sections: ${g.length}`)}const _=g[0];let m=[_];const x=ge.DISALLOWED_SECTIONS_FOR_NEW_FORMS;if(m=m.filter(w=>!x.includes(w)),console.log(`\u{1F50D} SafetyEventForm: Using first section "${_}" for field ${l.DeveloperName}`),m.length===0){console.log(`\u23ED\uFE0F Skipping field - all sections disallowed: ${l.DeveloperName} (sections: ${g.join(", ")})`),console.log(`\u23ED\uFE0F Disallowed sections: ${x.join(", ")}`);return}if(m.length<g.length){const w=g.filter(y=>x.includes(y));console.log(`\u{1F50D} Field ${l.DeveloperName} filtered: removed sections [${w.join(", ")}], keeping [${m.join(", ")}]`)}const k=l.DeveloperName,$=l._enhanced===!0;m.forEach(w=>{a[w]||(a[w]=[])});const S={};o[k]&&Object.entries(o[k]).forEach(([w,y])=>{let C=this.findControllingField(w,e);C?(S[C.DeveloperName]=y,console.log(`\u{1F517} Field ${k} controlled by ${C.DeveloperName} = [${Array.isArray(y)?y.join(", "):y}]`),console.log(`\u{1F517} Matching: "${w}" -> ${C.MasterLabel} (${C.DeveloperName})`)):(console.warn(`\u274C Could not find controlling field with any pattern for: "${w}"`),console.warn("\u274C Available field labels:",e.map(I=>`"${I.MasterLabel}" (${I.DeveloperName})`)))});const O=this.objectSchema[d],F=$?l._fieldType:O?.type||this.inferFieldType(d);let D=[],v=[];if(F==="reference")D=$?l._lookupOptions||[]:this.lookupOptionsMap[d]||[],console.log(`\u{1F517} Lookup options for ${d}:`,D.length);else if(F==="picklist"||F==="multipicklist"){if($&&l._picklistOptions&&l._picklistOptions.length>0?(v=l._picklistOptions,console.log(`\u{1F4CB} Using _picklistOptions for ${d}: ${v.length} options`)):$&&l._picklistValues&&l._picklistValues.length>0?(v=l._picklistValues,console.log(`\u{1F4CB} Using _picklistValues for ${d}: ${v.length} options`)):this.picklistValues[d]&&this.picklistValues[d].length>0?(v=this.picklistValues[d],console.log(`\u{1F4CB} Using picklistValues map for ${d}: ${v.length} options`)):O?.picklistValues&&O.picklistValues.length>0?(v=O.picklistValues,console.log(`\u{1F4CB} Using schema picklistValues for ${d}: ${v.length} options`)):(v=[],console.warn(`\u26A0\uFE0F No picklist values found for ${d} from any source`)),v.length>0){this.picklistValues[d]=v;try{const w=`picklist_values_${this.objectApiName}`,y=JSON.parse(sessionStorage.getItem(w)||"{}");y[d]=v,sessionStorage.setItem(w,JSON.stringify(y)),console.log(`\u{1F4CB} Cached ${v.length} picklist values for ${d} in session storage`)}catch(w){console.warn("Failed to cache picklist values in session storage:",w)}}console.log(`\u{1F4CB} Final picklist values for ${d}:`,v.length)}const A={fieldApi:d,label:$?l._label||l.MasterLabel:O?.label||l.MasterLabel,fieldType:F,required:l.Rhythm__Required__c||($?l._required:!1)||O?.required||!1,defaultValue:$?l._defaultValue:O?.defaultValue||null,fieldOrder:this.openedFromListView?this.getFieldOrder(d):l.Rhythm__Order__c||0,developerName:l.DeveloperName,lookupFilterLabel:l.Rhythm__Lookup_Filter_Label__c,isActive:l.Rhythm__IsActive__c,visibleWhenValues:S,isEnhanced:$,length:$?l._length:O?.length,precision:$?l._precision:O?.precision,scale:$?l._scale:O?.scale,picklistValues:v,lookupOptions:D,referenceTo:$?l._referenceTo:O?.referenceTo||[],relationshipName:$?l._relationshipName:O?.relationshipName,helpText:l._inlineHelpText||O?.inlineHelpText};A.helpText?console.log(`\u{1F50D} Help text found for field ${d}:`,A.helpText):console.log(`\u{1F50D} No help text for field ${d} - isEnhanced: ${$}, field._inlineHelpText: ${l._inlineHelpText}, fieldSchema?.inlineHelpText: ${O?.inlineHelpText}`),m.forEach(w=>{const y={...A,section:w};a[w].push(y),console.log(`\u2705 Added field ${d} to section "${w}"`)}),this.allFieldsMap[d]=A,A.defaultValue&&(this.formData[d]=A.fieldType==="BOOLEAN"?A.defaultValue==="true"||A.defaultValue===!0:A.defaultValue)}),this.sections=Object.keys(a).map(l=>({name:l,label:l.replace(/_/g," "),fields:a[l].sort((c,d)=>{if(this.openedFromListView&&this.LISTVIEW_FIELD_ORDER[this.objectApiName]){const h=this.getFieldOrder(c.fieldApi),u=this.getFieldOrder(d.fieldApi);return console.log(`\u{1F4CB} Ordering fields: ${c.fieldApi} (order: ${h}) vs ${d.fieldApi} (order: ${u})`),h-u}return c.fieldOrder-d.fieldOrder})})).sort((l,c)=>{const d=l.fields[0]?.fieldOrder||0,h=c.fields[0]?.fieldOrder||0;return d-h}),console.log("\u2705 Final processed sections:",this.sections),this.openedFromListView&&this.objectApiName==="Task"&&(console.log("\u{1F4CB} LIST VIEW DEBUG: Task form opened from cpexpListView"),console.log("\u{1F4CB} Expected fields in order:",Object.keys(this.LISTVIEW_FIELD_ORDER.Task)),this.sections.forEach(l=>{console.log(`\u{1F4CB} Section: ${l.label}`),l.fields.forEach((c,d)=>{console.log(`\u{1F4CB}   ${d+1}. ${c.fieldApi} (${c.label}) - Order: ${c.fieldOrder}`)})})),this.debugControllingFieldsSetup(),console.log("\u{1F517} FINAL CONTROLLING DEPENDENCIES SUMMARY:");let r=0;Object.keys(this.allFieldsMap).forEach(l=>{const c=this.allFieldsMap[l];c.visibleWhenValues&&Object.keys(c.visibleWhenValues).length>0&&(r++,console.log(`\u{1F517} ${c.label} (${c.developerName}) depends on:`,c.visibleWhenValues))}),console.log(`\u{1F41B} Summary: ${r}/${Object.keys(this.allFieldsMap).length} fields have controlling dependencies`),this.initializeContractorDependencies()}debugControllingFieldsSetup(){console.log("\u{1F41B} === DEBUGGING CONTROLLING FIELDS SETUP ===");let e=0,s=0;this.sections.forEach(t=>{console.log(`\u{1F41B} Section: ${t.label}`),t.fields.forEach(o=>{s++,o.visibleWhenValues&&Object.keys(o.visibleWhenValues).length>0?(e++,console.log(`\u{1F41B}   Field: ${o.label} (${o.fieldApi} / ${o.developerName})`),console.log("\u{1F41B}     Has controlling dependencies:",o.visibleWhenValues),Object.keys(o.visibleWhenValues).forEach(a=>{const r=this.devNameToApi[a];console.log(`\u{1F41B}     Controller ${a} -> API: ${r||"NOT FOUND"}`)})):console.log(`\u{1F41B}   Field: ${o.label} - No controlling dependencies`)})}),console.log(`\u{1F41B} Summary: ${e}/${s} fields have controlling dependencies`),console.log("\u{1F41B} === END DEBUGGING ===")}inferFieldType(e){const s=e.toLowerCase();return s.includes("date")||s.includes("time")?"DATE":s.includes("email")?"EMAIL":s.includes("phone")?"PHONE":s.includes("url")?"URL":s.includes("number")||s.includes("amount")?"NUMBER":s.includes("description")||s.includes("comment")?"TEXTAREA":s.includes("checkbox")||s.includes("flag")||s.includes("is_")?"BOOLEAN":"TEXT"}get showImmediateCorrectionSection(){return this.objectApiName==="Rhythm__Incident_Injury__c"}get isHFESessionObject(){return this.objectApiName==="Rhythm__HFE_Session__c"||this.objectApiName==="Rhythm__Water_Usage_Transaction__c"||this.objectApiName==="Rhythm__Waste_Management__c"||this.objectApiName==="Rhythm__Fuel__c"||this.objectApiName==="Rhythm__Permit_Extension__c"?this.objectApiName:!1}get showMultipleTaskSection(){return this.openedFromListView&&this.objectApiName==="Task"&&this.multipleTaskForms&&this.multipleTaskForms.length>0}get multipleTaskFormsPlural(){return this.multipleTaskForms&&this.multipleTaskForms.length!==1?"s":""}get isTaskFromListView(){return this.objectApiName==="Task"}get attachmentSectionTitle(){return this.objectApiName==="Rhythm__Hazard__c"?"Hazard Evidence":"Attachments"}get toastClasses(){let e="toast";return this.toastType==="success"?e+=" toast-success":this.toastType==="error"?e+=" toast-error":e+=" toast-info",e}get toastIcon(){switch(this.toastType){case"success":return"\u2705";case"error":return"\u274C";case"info":default:return"\u2139\uFE0F"}}initializeTaskDefaults(){console.log("\u{1F3AF} Initializing Task default values..."),this.formData.Priority||(this.formData={...this.formData,Priority:"Normal"},console.log("\u2705 Set default Priority: Normal")),this.formData.Status||(this.formData={...this.formData,Status:"Open"},console.log("\u2705 Set default Status: Open")),console.log("\u{1F3AF} Task defaults initialized")}async getUsersFromUserAccessFunc(){const e=await this.getUsersFromUserAccess();console.log("\u{1F3A8} users in line 379",JSON.stringify(e)),this.lookupOptionsMap.Rhythm__Assigned_To__c=e.map(s=>({label:s.Rhythm__User__r.Name,value:s.Rhythm__User__c,selected:!1}))}get renderedSections(){if(this.isSubmitting)return console.log("\u{1F6D1} Skipping section rendering during form submission"),this._cachedRenderedSections||[];if(console.log("\u{1F3A8} === RENDERING SECTIONS ==="),console.log("\u{1F3A8} Available sections:",this.sections.length),console.log("\u{1F3A8} Current form data for visibility:",this.formData),this.openedFromListView&&this.objectApiName==="Task")return console.log("\u{1F3A8} Task form from cpExpListView - hiding main sections, using multiple task section only"),[];const e=this.sections.filter(o=>o.name!=="RCA Summary"&&o.label!=="RCA Summary");console.log(`\u{1F3A8} Filtered out RCA Summary section. Remaining: ${e.length}`);let s=localStorage.getItem("sf_user_id");this.defaultLocationId&&this.getUsersFromUserAccessFunc();const t=e.map(o=>{console.log(`\u{1F3A8} Processing section: ${o.label} (${o.fields.length} fields)`);const i=o.fields.filter(a=>{const r=this.isFieldVisible(a);return console.log(`\u{1F441}\uFE0F Field ${a.label} (${a.fieldApi}) visible: ${r}`),!r&&a.visibleWhenValues&&Object.keys(a.visibleWhenValues).length>0&&console.log("\u{1F441}\uFE0F   Hidden due to controlling fields:",a.visibleWhenValues),r}).map(a=>{const r=this.formData[a.fieldApi]||a.defaultValue||"",l=a.fieldType?.toLowerCase()==="boolean";let c=r,d={...a,...this.enhanceFieldForRendering(a),value:c,checkedValue:l?c===!0||c==="true"||c===(!0).toString():!1};return this.objectApiName==="Rhythm__Incident_Injury__c"&&a.fieldApi==="Rhythm__Reported_By__c"&&(console.log("\u{1F50D} Auto-populating Reported By field:",JSON.stringify(a)),d={...d,value:s,disabled:this.isFieldReadOnly(a.fieldApi)},this.formData[a.fieldApi]=s),console.log(`\u2728 Enhanced field: ${d.label} (value: ${d.value})`),d});return console.log(`\u{1F3A8} Section ${o.label} visible fields: ${i.length}/${o.fields.length}`),i.length>0?{name:o.name,label:o.label,fields:i}:null}).filter(Boolean);return console.log("\u{1F3A8} Final rendered sections:",t.length),console.log("\u{1F3A8} === END RENDERING ==="),this._cachedRenderedSections=t,t}computeObjectLabelFromApiName(e){try{if(console.log("\u{1F50D} step0",e),!e)return"Form";let s=e.replace(/^[A-Za-z0-9]+__/,"");return s=s.replace(/__c$/i,""),s=s.replace(/_/g," ").trim(),s?s=s.toLowerCase().replace(/\b\w/g,t=>t.toUpperCase()):s="Form",console.log("\u{1F50D} Computed object label:",s),s||"Form"}catch(s){return"Form"}}updateFormTitle(){if(this.openedFromListView&&this.objectApiName==="Task"){this.formTitle="Action Items";return}if(this.objectApiName==="Rhythm__Hazard__c"){this.formTitle="New Observation";return}else if(this.objectApiName==="Rhythm__Incident_Injury__c"){this.formTitle="New Incident";return}this.formTitle=this.objectLabel||this.computeObjectLabelFromApiName(this.objectApiName)}isFieldVisible(e){const s=e.visibleWhenValues||{};if(Object.keys(s).length===0)return!0;console.log(`\u{1F50D} Checking visibility for field: ${e.fieldApi} (${e.label})`);for(const[t,o]of Object.entries(s)){const i=this.devNameToApi[t];if(!i){console.warn(`\u26A0\uFE0F No API name found for controller: ${t}`);continue}const a=Array.isArray(o)?o:o!=null?[o]:[];let r=this.formData[i],l=r;if((i==="Rhythm__Assets__c"||i==="Rhythm__Asset_Equipment__c")&&r){console.log(`\u{1F50D} Debug: Looking for asset options for ${i} with value: ${r}`);const d=this.formData[`${i}_DisplayName`];if(d)l=d,console.log(`\u{1F3D7}\uFE0F Asset field: Using stored display name "${l}" instead of ID "${r}" for controlling logic`);else{const h=this.allFieldsMap[i];if(console.log("\u{1F50D} Debug: assetField exists:",!!h),console.log("\u{1F50D} Debug: assetField.lookupOptions exists:",!!(h&&h.lookupOptions)),console.log("\u{1F50D} Debug: assetField.lookupOptions length:",h?.lookupOptions?.length||0),h&&h.lookupOptions){console.log("\u{1F50D} Debug: Sample lookup options:",h.lookupOptions.slice(0,3));const u=h.lookupOptions.find(f=>f.value===r);u?(l=u.label||u.displayValue||u.Name,console.log(`\u{1F3D7}\uFE0F Asset field: Using display name "${l}" instead of ID "${r}" for controlling logic`)):console.log(`\u{1F50D} Debug: No matching option found in assetField.lookupOptions for value: ${r}`)}else{console.log("\u{1F50D} Debug: Trying fallback lookupOptionsMap");const u=this.lookupOptionsMap[i];if(console.log("\u{1F50D} Debug: lookupOptionsMap exists:",!!u),console.log("\u{1F50D} Debug: lookupOptionsMap length:",u?.length||0),u){console.log("\u{1F50D} Debug: Sample fallback options:",u.slice(0,3));const f=u.find(g=>g.value===r);f?(l=f.label||f.displayValue||f.Name,console.log(`\u{1F3D7}\uFE0F Asset field (fallback): Using display name "${l}" instead of ID "${r}" for controlling logic`)):console.log(`\u{1F50D} Debug: No matching option found in lookupOptionsMap for value: ${r}`)}else console.log("\u{1F50D} Debug: No lookup options found in either location")}}console.log(`\u{1F50D} Debug: Final comparison value: ${l}`)}if(console.log(`\u{1F50D} Controller field: ${i}, actual value: ${r}, comparison value: ${l}, expected values: [${a.join(", ")}]`),a.length===0){console.log(`\u26A0\uFE0F No expected values for controller ${i}, skipping`);continue}let c=!1;for(const d of a)if(String(d).toLowerCase()==="true"||String(d).toLowerCase()==="false"||d===!0||d===!1){const u=this.normalizeBooleanValue(d),f=this.normalizeBooleanValue(r);if(console.log(`\u{1F50D} Boolean comparison: actual=${f}, expected=${u}, match=${f===u}`),f===u){c=!0,console.log(`\u2705 Controller ${i} matched boolean value: ${d}`);break}}else if(l!=null){const u=String(l).toLowerCase(),f=String(d).toLowerCase();if(console.log(`\u{1F50D} String comparison: comparison="${u}", expected="${f}", match=${u===f}`),u===f){c=!0,console.log(`\u2705 Controller ${i} matched string value: ${d} (using ${i==="Rhythm__Assets__c"||i==="Rhythm__Asset_Equipment__c"?"display name":"direct value"})`);break}}if(!c)return console.log(`\u{1F50D} Field ${e.fieldApi} hidden: controller ${i} didn't match any expected values`),!1}return console.log(`\u2705 Field ${e.fieldApi} is visible - all controllers matched`),!0}normalizeBooleanValue(e){if(e==null)return!1;if(typeof e=="boolean")return e;if(typeof e=="string"){const s=e.toLowerCase();return s==="true"||s==="yes"||s==="1"}return typeof e=="number"?e!==0:Boolean(e)}updateFieldVisibility(){if(this.isSubmitting){console.log("\u{1F6D1} Skipping field visibility update during form submission");return}console.log("\u{1F504} Updating field visibility after value change..."),console.log("\u{1F504} Current form data:",this.formData),console.log&&typeof this.debugFieldVisibility=="function"&&this.debugFieldVisibility(),this.sections=[...this.sections],this.formData={...this.formData},this.template.querySelectorAll(".form-section").forEach(e=>{e.classList.add("force-update"),requestAnimationFrame(()=>{e.classList.remove("force-update")})}),console.log("\u2705 Field visibility update triggered")}debugFieldVisibility(){try{(this.sections||[]).forEach(e=>{(e.fields||[]).forEach(s=>{this.isFieldVisible(s)})})}catch(e){}}isQrField(e){return e?e==="Rhythm__Location__c"||e==="Rhythm__Site__c"||e==="Rhythm__Work_Area__c":!1}isFieldReadOnly(e){if(!e)return!1;if(this.READ_ONLY_FIELDS.includes(e))return console.log(`\u{1F512} Field ${e} is read-only (generic configuration)`),!0;if(this.CONDITIONAL_EDITABLE_FIELDS[e]){const s=this.CONDITIONAL_EDITABLE_FIELDS[e],t=Array.isArray(s)?s:[s];let o=!1,i=[];for(const a of t){const r=this.formData[a];r&&r!==""&&r!==null&&r!==void 0&&(o=!0,i.push(`${a}=${r}`))}return o?(console.log(`\u{1F513} Field ${e} is editable (dependency fields satisfied: ${i.join(", ")})`),!1):(console.log(`\u{1F512} Field ${e} is read-only (none of dependency fields [${t.join(", ")}] have values)`),!0)}return this.isQrMode&&this.isQrField(e)?(console.log(`\u{1F512} Field ${e} is read-only (QR prepopulated)`),!0):this.objectApiName==="Rhythm__Incident_Injury__c"&&e==="Rhythm__Reported_By__c"?(console.log(`\u{1F512} Field ${e} is read-only (Incident Injury - auto-populated with current user)`),!0):!1}addReadOnlyField(e){this.READ_ONLY_FIELDS.includes(e)||(this.READ_ONLY_FIELDS.push(e),console.log(`\u{1F512} Added ${e} to read-only fields list`))}removeReadOnlyField(e){const s=this.READ_ONLY_FIELDS.indexOf(e);s>-1&&(this.READ_ONLY_FIELDS.splice(s,1),console.log(`\u{1F513} Removed ${e} from read-only fields list`))}getReadOnlyFields(){return[...this.READ_ONLY_FIELDS]}addConditionalEditableField(e,s){this.CONDITIONAL_EDITABLE_FIELDS[e]=s,console.log(`\u{1F517} Added conditional dependency: ${e} depends on ${s}`)}removeConditionalEditableField(e){this.CONDITIONAL_EDITABLE_FIELDS[e]&&(delete this.CONDITIONAL_EDITABLE_FIELDS[e],console.log(`\u{1F517} Removed conditional dependency for: ${e}`))}getConditionalEditableFields(){return{...this.CONDITIONAL_EDITABLE_FIELDS}}isFieldAllowedInListView(e){return!this.openedFromListView||!this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName]?!0:this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName].includes(e)}getAllowedFieldsForListView(){return!this.openedFromListView||!this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName]?[]:[...this.LISTVIEW_ALLOWED_FIELDS[this.objectApiName]]}getFieldOrder(e){return!this.openedFromListView||!this.LISTVIEW_FIELD_ORDER[this.objectApiName]?0:this.LISTVIEW_FIELD_ORDER[this.objectApiName][e]||999}getHardcodedFields(){return this.openedFromListView?this.objectApiName==="Task"?(console.log("\u{1F3D7}\uFE0F Using HARDCODED_TASK_FIELDS for Task object from cpExpListView"),Object.values(this.HARDCODED_TASK_FIELDS)):this.HARDCODED_FIELDS[this.objectApiName]?Object.values(this.HARDCODED_FIELDS[this.objectApiName]):[]:[]}isHardcodedField(e){return!this.openedFromListView||!this.HARDCODED_FIELDS[this.objectApiName]?!1:!!this.HARDCODED_FIELDS[this.objectApiName][e]}addAllowedFieldForListView(e,s){this.LISTVIEW_ALLOWED_FIELDS[e]||(this.LISTVIEW_ALLOWED_FIELDS[e]=[]),this.LISTVIEW_ALLOWED_FIELDS[e].includes(s)||(this.LISTVIEW_ALLOWED_FIELDS[e].push(s),console.log(`\u{1F513} Added ${s} to allowed fields for ${e} in list view`))}removeAllowedFieldForListView(e,s){if(this.LISTVIEW_ALLOWED_FIELDS[e]){const t=this.LISTVIEW_ALLOWED_FIELDS[e].indexOf(s);t>-1&&(this.LISTVIEW_ALLOWED_FIELDS[e].splice(t,1),console.log(`\u{1F512} Removed ${s} from allowed fields for ${e} in list view`))}}async loadUserLookupOptions(){try{console.log("\u{1F465} Loading user lookup options for OwnerId field...");const e=await se.getConnectionForComponent("SafetyEventForm"),s=`
                SELECT Id, Name, Email, IsActive
                FROM User
                WHERE IsActive = true
                ORDER BY Name
                LIMIT 500
            `,t=await e.query(s);console.log("\u{1F465} User lookup records loaded:",t.records.length);const o=t.records.map(i=>({label:i.Name,value:i.Id,email:i.Email}));this.lookupOptionsMap||(this.lookupOptionsMap={}),this.lookupOptionsMap.OwnerId=o,this.HARDCODED_TASK_FIELDS&&this.HARDCODED_TASK_FIELDS.OwnerId&&(this.HARDCODED_TASK_FIELDS.OwnerId.lookupOptions=o),this.allFieldsMap&&this.allFieldsMap.OwnerId&&(this.allFieldsMap.OwnerId.lookupOptions=o),console.log("\u2705 User lookup options loaded successfully for OwnerId field")}catch(e){console.error("\u274C Error loading user lookup options:",e)}}initializeMultipleTaskForms(){this.openedFromListView&&this.objectApiName==="Task"&&(console.log("\u{1F4CB} Initializing multiple action item forms..."),this.multipleTaskForms=[],this.nextTaskId=1,this.addNewTaskForm(),console.log("\u2705 Multiple action item forms initialized"))}addNewTaskForm(){const e=this.nextTaskId++,s={id:e,displayIndex:this.multipleTaskForms.length+1,fields:this.createTaskFormFields(e),canShowPlus:!1,canShowDelete:!1};this.multipleTaskForms=[...this.multipleTaskForms,s],this.updateTaskFormButtons(),console.log(`\u2795 Added new action item form with ID: ${e}`)}removeTaskForm(e){this.multipleTaskForms=this.multipleTaskForms.filter(s=>s.id!==e),this.multipleTaskForms.forEach((s,t)=>{s.displayIndex=t+1}),this.updateTaskFormButtons(),console.log(`\u{1F5D1}\uFE0F Removed action item form with ID: ${e}`)}createTaskFormFields(e){const s=[];return["Subject","ActivityDate","Rhythm__CAPA_Type__c","OwnerId","Description"].forEach(o=>{const i=this.HARDCODED_TASK_FIELDS[o];if(i){const a={...i,uniqueId:`${o}_${e}`,value:"",isText:i.fieldType==="STRING",isTextarea:i.fieldType==="TEXTAREA",isSelect:i.fieldType==="PICKLIST",isLookup:i.fieldType==="REFERENCE",isDate:i.fieldType==="DATE",options:i.picklistValues||[],lookupOptions:i.lookupOptions||this.lookupOptionsMap[o]||[],inputType:this.getInputTypeForField(i.fieldType)};s.push(a)}}),s}getInputTypeForField(e){switch(e){case"DATE":return"date";case"DATETIME":return"datetime-local";case"TIME":return"time";case"EMAIL":return"email";case"PHONE":return"tel";case"URL":return"url";case"NUMBER":case"DOUBLE":case"INTEGER":case"CURRENCY":return"number";default:return"text"}}updateTaskFormButtons(){this.multipleTaskForms.forEach((e,s)=>{e.canShowPlus=s===this.multipleTaskForms.length-1,e.canShowDelete=this.multipleTaskForms.length>1})}handleAddTask(e){e.preventDefault(),this.addNewTaskForm()}handleRemoveTask(e){e.preventDefault();const s=parseInt(e.target.dataset.taskId,10);this.removeTaskForm(s)}handleTaskFieldChange(e){const s=e.target.dataset.field,t=parseInt(e.target.dataset.taskId,10),o=e.target.value;console.log(`\u{1F4DD} Action item field change: ${s} = ${o} (ID: ${t})`);const i=this.multipleTaskForms.find(a=>a.id===t);if(i){const a=i.fields.find(r=>r.fieldApi===s);a&&(a.value=o,console.log(`\u2705 Updated action item ${t} field ${s} to: ${o}`))}}enhanceFieldForRendering(e){const s=this.formData[e.fieldApi]||e.defaultValue||"",t=(e.fieldType||"").toLowerCase(),o=e.fieldApi||"";this.currentFieldApi=o;const i=this.objectSchema[o],a=t==="boolean"||i&&i.type==="boolean",r=t==="picklist"||t==="multipicklist"||i&&["picklist","multipicklist"].includes(i.type)||e.picklistValues&&e.picklistValues.length>0||this.picklistValues[o]&&this.picklistValues[o].length>0,l=t==="reference"||i&&i.type==="reference"||e.referenceTo&&e.referenceTo.length>0||this.lookupOptionsMap[o]&&this.lookupOptionsMap[o].length>0,c=t==="textarea"||t==="longtextarea"||i&&["textarea","longtextarea"].includes(i.type)||o.toLowerCase().includes("description")||o.toLowerCase().includes("comment"),d=i?.type?.toLowerCase()||"",h=t.toLowerCase(),u=o.toLowerCase(),f=d==="datetime"||h==="datetime"||u.includes("datetime")&&!d&&!h,g=!f&&(d==="time"||h==="time"||u.includes("time")&&!u.includes("date")&&!d&&!h),_=!f&&!g&&(d==="date"||h==="date"||u.includes("date")&&!u.includes("time")&&!d&&!h);(_||f||g)&&console.log(`\u{1F4C5} Date/Time field detected: ${o}`,{fieldType:t,schemaType:d,fieldApiLower:u,isDate:_,isDateTime:f,isTime:g});const m=t==="email"||i&&i.type==="email",x=t==="phone"||i&&i.type==="phone",k=t==="url"||i&&i.type==="url",$=["double","integer","currency","percent"].includes(t)||i&&["double","integer","currency","percent"].includes(i.type),S=!(a||r||l||c||_||f||g||m||x||k||$);let O=this.formData[e.fieldApi];if(O==null||O===""){let y=e.defaultValue;if(!y){const C=new Date;if(f){const I=C.getFullYear(),L=String(C.getMonth()+1).padStart(2,"0"),N=String(C.getDate()).padStart(2,"0"),T=String(C.getHours()).padStart(2,"0"),q=String(C.getMinutes()).padStart(2,"0"),te=String(C.getSeconds()).padStart(2,"0");y=`${I}-${L}-${N}T${T}:${q}:${te}`}else if(_){const I=C.getFullYear(),L=String(C.getMonth()+1).padStart(2,"0"),N=String(C.getDate()).padStart(2,"0");y=`${I}-${L}-${N}`}else if(g){const I=String(C.getHours()).padStart(2,"0"),L=String(C.getMinutes()).padStart(2,"0");y=`${I}:${L}`}}if(y!=null){let C=y;f&&typeof y=="string"&&(C=this.normalizeDateTimeValue(y)),this.formData={...this.formData,[e.fieldApi]:a?y===!0||y==="true":C},O=C,(_||f||g)&&console.log(`\u{1F4C5} Auto-populated ${o} with default value: ${y}`)}}let F=[];r?F=this.getPicklistOptions(e):l&&(F=this.getLookupOptions(e),this.defaultLocationId&&!this.formData[e.fieldApi]&&(e.fieldApi==="Rhythm__Location__c"||e.fieldApi==="Rhythm__Site__c")&&F.find(I=>I.value===this.defaultLocationId)&&(this.formData={...this.formData,[e.fieldApi]:this.defaultLocationId},console.log(`\u{1F3E2} Enhanced field prepopulation: ${e.fieldApi} = ${this.defaultLocationId}`)),(e.fieldApi==="Rhythm__Contractor__c"||e.fieldApi==="Rhythm__Contractor_Account__c")&&this.userContractorInfo&&!this.formData[e.fieldApi]&&(F.find(C=>C.value===this.userContractorInfo.accountId)?(this.formData={...this.formData,[e.fieldApi]:this.userContractorInfo.accountId},this.selectedContractorId=this.userContractorInfo.accountId,console.log(`\u{1F3E2} Enhanced contractor field prepopulation: ${e.fieldApi} = ${this.userContractorInfo.accountId} (${this.userContractorInfo.accountName})`)):console.log(`\u{1F3E2} User contractor account "${this.userContractorInfo.accountName}" (${this.userContractorInfo.accountId}) not found in contractor field options`)),this.objectApiName==="Rhythm__Incident_Injury__c"&&e.fieldApi==="Rhythm__Reported_By__c"&&(F=F.map(y=>({...y,selected:y.label===this.userName})))),l&&console.log(`\u{1F50D} Enhancing lookup field ${e.fieldApi}:`,{hasOptions:F.length>0,optionsCount:F.length,sampleOptions:F.slice(0,3)});const D=this.formData[e.fieldApi]||O||s;l&&e.fieldApi&&console.log(`\u{1F3E2} Location field ${e.fieldApi} value assignment:`,{formDataValue:this.formData[e.fieldApi],currentValue:O,originalValue:s,finalValue:D,defaultLocationId:this.defaultLocationId,hasOptions:F.length>0});const v=this.isFieldReadOnly(e.fieldApi);this.READ_ONLY_FIELDS.includes(e.fieldApi)&&console.log(`\u{1F50D} Processing read-only field ${e.fieldApi}:`,{isReadOnly:v,currentValue:D,inReadOnlyArray:this.READ_ONLY_FIELDS.includes(e.fieldApi)});let A=D;if(v&&this.READ_ONLY_FIELDS.includes(e.fieldApi))if(!D||D===""){const y=new Date;let C=null;if(e.fieldApi==="Rhythm__Date_and_Time_of_Observation__c"){const I=y.getFullYear(),L=String(y.getMonth()+1).padStart(2,"0"),N=String(y.getDate()).padStart(2,"0"),T=String(y.getHours()).padStart(2,"0"),q=String(y.getMinutes()).padStart(2,"0"),te=String(y.getSeconds()).padStart(2,"0");C=`${I}-${L}-${N}T${T}:${q}:${te}`,console.log(`\u{1F550} Read-only field ${e.fieldApi} auto-populated with current datetime (ONE-TIME): ${C}`)}C&&(A=C,this.formData[e.fieldApi]=C,console.log(`\u{1F512} Read-only field ${e.fieldApi} final value set (ONE-TIME): ${C}`))}else console.log(`\u{1F512} Read-only field ${e.fieldApi} already has value, not updating: ${D}`);const w={...e,value:A,isCheckbox:a,isSelect:r,isLookup:l,isTextarea:c,isDate:_,isDateTime:f,isTime:g,isEmail:m,isPhone:x,isUrl:k,isNumber:$,isText:S,inputType:this.getInputType(e.fieldType,_,f,g),checkedValue:a?s===!0||s==="true":!1,options:F,lookupOptions:l?F:[],isReadOnly:v,disabled:v};return this.READ_ONLY_FIELDS.includes(e.fieldApi)&&console.log(`\u{1F512} Final enhanced field ${e.fieldApi}:`,{disabled:w.disabled,isReadOnly:w.isReadOnly,value:w.value,fieldType:w.fieldType}),l&&w.lookupOptions.length===0&&(console.warn(`\u26A0\uFE0F Lookup field ${e.fieldApi} has no options available`),console.log("\u{1F50D} Available in lookupOptionsMap:",this.lookupOptionsMap[e.fieldApi]?.length||0)),w}getPicklistOptions(e){let s=[];if(e.picklistValues&&Array.isArray(e.picklistValues)&&e.picklistValues.length>0?(s=e.picklistValues,console.log(`\u{1F4CB} Using field's own picklist values for ${e.fieldApi}: ${s.length} options`)):this.picklistValues&&this.picklistValues[e.fieldApi]&&Array.isArray(this.picklistValues[e.fieldApi])&&this.picklistValues[e.fieldApi].length>0?(s=this.picklistValues[e.fieldApi],console.log(`\u{1F4CB} Using picklistValues map for ${e.fieldApi}: ${s.length} options`)):this.objectSchema&&this.objectSchema[e.fieldApi]&&this.objectSchema[e.fieldApi].picklistValues&&Array.isArray(this.objectSchema[e.fieldApi].picklistValues)&&this.objectSchema[e.fieldApi].picklistValues.length>0?(s=this.objectSchema[e.fieldApi].picklistValues,console.log(`\u{1F4CB} Using object schema for ${e.fieldApi}: ${s.length} options`)):e._picklistOptions&&Array.isArray(e._picklistOptions)&&e._picklistOptions.length>0&&(s=e._picklistOptions,console.log(`\u{1F4CB} Using _picklistOptions for ${e.fieldApi}: ${s.length} options`)),!s.length){console.warn(`\u26A0\uFE0F No picklist options found for ${e.fieldApi}, checking for fallbacks...`);const t=e.fieldApi.toLowerCase();t.includes("status")?(s=[{label:"New",value:"New",active:!0},{label:"In Progress",value:"In Progress",active:!0},{label:"Completed",value:"Completed",active:!0}],console.log(`\u{1F4CB} Using fallback status options for ${e.fieldApi}`)):t.includes("priority")?(s=[{label:"High",value:"High",active:!0},{label:"Medium",value:"Medium",active:!0},{label:"Low",value:"Low",active:!0}],console.log(`\u{1F4CB} Using fallback priority options for ${e.fieldApi}`)):t.includes("type")&&(s=[{label:"Type 1",value:"Type 1",active:!0},{label:"Type 2",value:"Type 2",active:!0},{label:"Type 3",value:"Type 3",active:!0}],console.log(`\u{1F4CB} Using fallback type options for ${e.fieldApi}`))}return s.filter(t=>t.active!==!1).map(t=>({label:t.label||t.value||String(t),value:t.value||t.label||String(t),selected:!!t.defaultValue}))}getLookupOptions(e){let s=[];e.lookupOptions&&Array.isArray(e.lookupOptions)&&e.lookupOptions.length>0?s=e.lookupOptions:this.lookupOptionsMap[e.fieldApi]&&Array.isArray(this.lookupOptionsMap[e.fieldApi])&&this.lookupOptionsMap[e.fieldApi].length>0?s=this.lookupOptionsMap[e.fieldApi]:e.referenceTo&&this.lookupOptionsMap[e.referenceTo]&&Array.isArray(this.lookupOptionsMap[e.referenceTo])&&this.lookupOptionsMap[e.referenceTo].length>0&&(s=this.lookupOptionsMap[e.referenceTo]);const t=s.map(i=>{const a=i.value||i.Id,r=this.defaultLocationId&&a===this.defaultLocationId,l=this.qrData?.objectApiName||this.objectApiName,d=this.getActiveLocationFields(l).includes(e.fieldApi);if(r&&d&&(this.formData[e.fieldApi]||(this.formData={...this.formData,[e.fieldApi]:a})),this.isQrMode){const h=e.fieldApi==="Rhythm__Location__c"||e.fieldApi==="Rhythm__Site__c",u=e.fieldApi==="Rhythm__Work_Area__c";h&&this.qrLocationId&&s.find(g=>g.value===this.qrLocationId)&&(this.formData={...this.formData,[e.fieldApi]:this.qrLocationId},console.log(`\u{1F4F1} QR: Pre-populated location field ${e.fieldApi} = ${this.qrLocationId}`)),u&&this.qrWorkAreaId&&s.find(g=>g.value===this.qrWorkAreaId)&&(this.formData={...this.formData,[e.fieldApi]:this.qrWorkAreaId},console.log(`\u{1F4F1} QR: Pre-populated work area field ${e.fieldApi} = ${this.qrWorkAreaId}`))}return{label:i.label||i.displayValue||i.Name||i.value||"Unknown",value:a,selected:r}}).filter(i=>i.value);if(console.log(`\u{1F50D} Field ${e.fieldApi}: ${s.length} raw options \u2192 ${t.length} mapped options`),(e.fieldApi==="Rhythm__Contractor__c"||e.fieldApi==="Rhythm__Contractor_Account__c")&&(console.log(`\u{1F3E2} Processing contractor field ${e.fieldApi}`),this.selectedLocationId)){const i=`contractor_location_${this.selectedLocationId}`;return this.lookupOptionsMap[i]?(console.log(`\u{1F3E2} Using cached contractors for location: ${this.selectedLocationId}`),this.lookupOptionsMap[i]):(console.log(`\u{1F3E2} Loading contractors for location: ${this.selectedLocationId}`),this.loadContractorsForLocationAsync(this.selectedLocationId),t)}if(e.fieldApi==="Rhythm__Contractor_Employee_Involved__c"){if(console.log("\u{1F465} Processing contractor employee field"),console.log(`\u{1F465} Selected contractor ID: ${this.selectedContractorId}`),!this.allFieldsMap||!this.allFieldsMap[e.fieldApi])return console.warn("\u26A0\uFE0F Contractor employee field not found in allFieldsMap, returning empty options"),[];if(this.selectedContractorId){const i=this.selectedLocationId||"",a=`contractor_${this.selectedContractorId}_location_${i}`;return this.lookupOptionsMap[a]?(console.log(`\u{1F465} Using cached contractor employees for contractor: ${this.selectedContractorId} and location: ${i||"any"}`),this.lookupOptionsMap[a]):(console.log(`\u{1F465} Loading contractor employees for contractor: ${this.selectedContractorId} and location: ${i||"any"}`),this.loadContractorEmployeesAsync(this.selectedContractorId),[])}return console.log("\u{1F465} No contractor selected, contractor employee list is empty"),[]}if(e.fieldApi==="Rhythm__Work_Area__c"){if(this.selectedLocationId){const i=t.filter(a=>{const r=a.value,c=this.workAreaLocationMap[r]===this.selectedLocationId;return c&&console.log(`\u{1F3D7}\uFE0F Work area ${a.label} (${r}) is related to location ${this.selectedLocationId}`),c});return console.log(`\u{1F3D7}\uFE0F Filtered work areas from ${t.length} to ${i.length} options for location ${this.selectedLocationId}`),console.log("\u{1F3D7}\uFE0F Available work area LocationIds:",Object.keys(this.workAreaLocationMap).length),i}return console.log("\u{1F3D7}\uFE0F No location selected, work area list is empty"),[]}const o=this.objectApiName==="Rhythm__Hazard__c"?"Rhythm__Assets__c":"Rhythm__Asset_Equipment__c";if(e.fieldApi===o)return console.log(`\u{1F3D7}\uFE0F Returning ${t.length} asset options for ${e.fieldApi} (${this.objectApiName})`),t;if(e.fieldApi==="Rhythm__Employee_Individual_Involved__c"&&this.objectApiName!=="Rhythm__Incident_Injury__c"||e.fieldApi==="Rhythm__Name_of_Person_Injured__c"){if(console.log(`\u{1F465} Processing employee contact field ${e.fieldApi}`),this.selectedLocationId){const i=`employee_${this.selectedLocationId}`;return this.lookupOptionsMap[i]?(console.log(`\u{1F465} Using cached employee contacts for location: ${this.selectedLocationId}`),this.lookupOptionsMap[i]):(console.log(`\u{1F465} Loading employee contacts for location: ${this.selectedLocationId}`),this.loadEmployeeContactsAsync(this.selectedLocationId),[])}return console.log("\u{1F465} No location selected, showing empty employee contact list"),[]}return t.length===0&&console.log(`\u{1F50D} No lookup options found for ${e.fieldApi}:`,{fieldLookupOptions:e.lookupOptions?.length||0,mapOptions:this.lookupOptionsMap[e.fieldApi]?.length||0,referenceTo:e.referenceTo,availableInMap:Object.keys(this.lookupOptionsMap)}),t}getInputType(e,s,t,o){const i=(e||"").toLowerCase();return t?"datetime-local":s?"date":o?"time":{email:"email",phone:"tel",url:"url",double:"number",integer:"number",currency:"number",percent:"number"}[i]||"text"}handleFieldChange(e){const s=e.target.dataset.field;let t=e.target.value;const o=e.target.type;if(console.log(`\u{1F4DD} Field change captured: ${s} = "${t}" (input type: ${o})`),o==="datetime-local"&&t){if(typeof t=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(t)){const a=t;t=t+":00",console.log(`\u{1F550} Normalized datetime value: ${a} -> ${t}`)}}else o==="date"&&t&&(console.log(`\u{1F4C5} Date field ${s} input value: ${t} (local timezone)`),s==="Rhythm__Date_Time_of_Incident__c"&&(console.log("\u{1F6A8} INCIDENT DATE INPUT DETECTED - Raw input value processing:"),console.log(`   \u{1F4DD} Original input: "${e.target.value}"`),console.log(`   \u{1F4DD} Processed value: "${t}"`),console.log(`   \u{1F550} Current time: ${new Date().toLocaleString()}`)));this.formData={...this.formData,[s]:t};const i=this.objectApiName==="Rhythm__Hazard__c"?"Rhythm__Assets__c":"Rhythm__Asset_Equipment__c";if(s===i&&t){const a=e.target,r=a.options[a.selectedIndex],l=r?r.text:null;l&&(this.formData={...this.formData,[`${s}_DisplayName`]:l},console.log(`\u{1F3D7}\uFE0F Stored asset display name: ${s}_DisplayName = "${l}"`))}(s==="Rhythm__Contractor__c"||s==="Rhythm__Contractor_Account__c")&&this.handleContractorChange(t),(s==="Rhythm__Location__c"||s==="Rhythm__Site__c")&&this.handleLocationChange(t),this.updateFieldVisibility()}handleContractorChange(e){console.log("\u{1F3E2} Contractor changed to:",e);const s="Rhythm__Contractor_Employee_Involved__c",t=this.allFieldsMap&&this.allFieldsMap[s];t?(console.log("\u{1F465} Contractor employee field exists in form, clearing it"),this.formData={...this.formData,[s]:""}):console.log("\u{1F465} Contractor employee field does not exist in this form, skipping");const o=["Rhythm__SubContractor__c","Rhythm__Sub_Contractor__c"];let i=[];o.forEach(a=>{this.allFieldsMap&&this.allFieldsMap[a]&&(console.log(`\u{1F3D7}\uFE0F Sub-contractor field ${a} exists in form, clearing it`),this.formData={...this.formData,[a]:""},i.push(a))}),this.selectedContractorId=e,this.sections=[...this.sections],t&&(console.log("\u{1F504} Contractor employee field cleared and options will be filtered"),this.queryContactAccountIds()),i.length>0&&console.log(`\u{1F504} Sub-contractor field(s) [${i.join(", ")}] editability updated based on contractor selection`),console.log("\u{1F504} Contractor change processing complete")}async queryContactAccountIds(){try{console.log("\u{1F4DE} Querying contact AccountIds for contractor filtering...");const e="Rhythm__Contractor_Employee_Involved__c",s=this.lookupOptionsMap[e]||[];if(s.length===0){console.log("\u{1F4DE} No contractor employee options available to query");return}const t=s.map(r=>r.value||r.Id).filter(r=>r&&!this.contactAccountMap[r]);if(t.length===0){console.log("\u{1F4DE} All contact AccountIds already cached");return}console.log(`\u{1F4DE} Querying AccountId for ${t.length} contacts`);const o=await se.getConnectionForComponent("SafetyEventForm"),i=`
                SELECT Id, AccountId 
                FROM Contact 
                WHERE Id IN ('${t.join("','")}')
            `;console.log("\u{1F4DE} Executing contact query:",i);const a=await o.query(i);a.records.forEach(r=>{this.contactAccountMap[r.Id]=r.AccountId}),console.log(`\u{1F4DE} Cached AccountId for ${a.records.length} contacts:`,this.contactAccountMap),this.sections=[...this.sections]}catch(e){console.error("\u274C Error querying contact AccountIds:",e)}}async queryUserContractorInfo(){try{console.log("\u{1F3E2} Querying current user contractor information...");const e=await se.getConnectionForComponent();if(!e)return console.error("\u{1F3E2} No Salesforce connection available"),null;let s=sessionStorage.getItem("sf_user_id");if(s||(s=localStorage.getItem("sf_user_id")),!s)return console.error("\u{1F3E2} No current user ID available in storage"),null;console.log("\u{1F3E2} Found user ID in storage:",s);const t=`
                SELECT Id, ContactId
                FROM User
                WHERE Id = '${s}' AND ContactId != null
                LIMIT 1
            `;console.log("\u{1F3E2} Executing user query to get ContactId:",t);const o=await e.query(t);if(o.records.length===0)return console.log("\u{1F3E2} No contact found for current user - not a contractor user"),null;const i=o.records[0].ContactId;console.log("\u{1F3E2} Found ContactId for user:",i);const a=`
                SELECT Id, AccountId, Account.Name, Account.RecordType.DeveloperName
                FROM Contact
                WHERE Id = '${i}' AND AccountId != null
                LIMIT 1
            `;console.log("\u{1F3E2} Executing user contractor query:",a);const r=await e.query(a);if(r.records.length===0)return console.log("\u{1F3E2} No contact found with account for current user - not a contractor user"),null;const l=r.records[0],c={contactId:l.Id,accountId:l.AccountId,accountName:l.Account?.Name,recordTypeDeveloperName:l.Account?.RecordType?.DeveloperName};return console.log("\u{1F3E2} User contractor info retrieved:",c),this.userContractorInfo=c,c}catch(e){return console.error("\u{1F3E2} Error querying user contractor info:",e),null}}handleLocationChange(e){console.log("\u{1F3E2} Location changed to:",e);const s={...this.formData,Rhythm__Work_Area__c:""};this.allFieldsMap&&this.allFieldsMap.Rhythm__Name_of_Person_Injured__c&&(s.Rhythm__Name_of_Person_Injured__c=""),this.allFieldsMap&&this.allFieldsMap.Rhythm__Employee_Individual_Involved__c&&this.objectApiName!=="Rhythm__Incident_Injury__c"&&(s.Rhythm__Employee_Individual_Involved__c=""),this.objectApiName==="Rhythm__Hazard__c"?(s.Rhythm__Assets__c="",console.log("\u{1F504} Cleared Rhythm__Assets__c for Hazard object")):this.objectApiName==="Rhythm__Incident_Injury__c"&&(s.Rhythm__Asset_Equipment__c="",console.log("\u{1F504} Cleared Rhythm__Asset_Equipment__c for Incident object")),this.formData=s,this.selectedLocationId=e,this.sections=[...this.sections],console.log("\u{1F504} Work area and asset fields cleared and options will be filtered"),this.queryWorkAreaLocationIds(e),this.loadAssetsForLocation(e),this.queryContactLocationIds()}async loadAssetsForLocation(e){try{if(console.log("\u{1F3D7}\uFE0F Loading assets for location:",e),!e&&(e=this.selectedLocationId||this.defaultLocationId,console.log(`\u{1F3D7}\uFE0F No locationId provided, using ${e?"selected/default location: "+e:"no location"}`),!e)){console.log("\u{1F3D7}\uFE0F No location available, clearing asset options"),this.populateAssetFields([]);return}const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm"),o=`SELECT Id, Rhythm__Asset_Name__c FROM Rhythm__CustomAsset__c WHERE Rhythm__Location__c = '${e}' AND IsDeleted = false ORDER BY Rhythm__Asset_Name__c LIMIT 1000`;console.log("\u{1F50D} Executing location-specific asset query:",o);const i=await t.query(o);console.log(`\u2705 Found ${i.records.length} assets for location ${e}`);const a=i.records.map(r=>({label:r.Rhythm__Asset_Name__c||r.Id,value:r.Id,displayValue:r.Rhythm__Asset_Name__c||r.Id}));this.populateAssetFields(a)}catch(s){console.error("\u274C Error loading assets for location:",s),this.populateAssetFields([])}}async queryContactLocationIds(){try{console.log("\u{1F465} Querying contact LocationIds/SiteIds for contact filtering...");const e=["Rhythm__Employee_Individual_Involved__c","Rhythm__Name_of_Person_Injured__c"];let s=[];e.forEach(d=>{const h=this.lookupOptionsMap[d]||[];s=s.concat(h)});const t=s.filter((d,h,u)=>h===u.findIndex(f=>(f.value||f.Id)===(d.value||d.Id)));if(t.length===0){console.log("\u{1F465} No contact options available to query");return}const o=t.map(d=>d.value||d.Id).filter(d=>d&&!this.contactLocationMap[d]);if(o.length===0){console.log("\u{1F465} All contact LocationIds already cached");return}const a=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm"),l=`
                SELECT Id, Rhythm__Loc__c, Rhythm__Site__c 
                FROM Contact
                WHERE Id IN (${o.map(d=>`'${d}'`).join(",")}) 
                AND IsDeleted = false
            `;console.log("\u{1F465} Executing contact query:",l);const c=await a.query(l);console.log("\u{1F465} Contact query result:",JSON.stringify(c)),c.records.forEach(d=>{this.contactLocationMap[d.Id]={locationId:d.Rhythm__Loc__c,siteId:d.Rhythm__Site__c}}),console.log(`\u{1F465} Cached Location/Site IDs for ${c.records.length} contacts:`,JSON.stringify(this.contactLocationMap)),this.sections=[...this.sections]}catch(e){console.error("\u274C Error querying contact Location/Site IDs:",e)}}async queryWorkAreaLocationIds(e){try{if(console.log("\u{1F3D7}\uFE0F Querying work area LocationIds for location filtering..."),!e&&(e=this.selectedLocationId||this.defaultLocationId,console.log(`\u{1F3D7}\uFE0F No locationId provided, using ${e?"selected/default location: "+e:"no location"}`),!e)){console.log("\u{1F3D7}\uFE0F No location available to query work areas");return}const s="Rhythm__Work_Area__c",t=this.lookupOptionsMap[s]||[];if(t.length===0){console.log("\u{1F3D7}\uFE0F No work area options available to query");return}if(t.map(c=>c.value||c.Id).filter(c=>c&&!this.workAreaLocationMap[c]).length===0){console.log("\u{1F3D7}\uFE0F All work area LocationIds already cached");return}const a=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm");console.log(`\u{1F3D7}\uFE0F Querying work areas for location: ${e}`);const r=`
                SELECT Rhythm__Organization_Component__c,Rhythm__Location__c FROM Rhythm__Location_OrgComp_Map__c
                WHERE Rhythm__location__c = '${e}' AND Rhythm__Classification_Type__c = 'Work Area'
                AND Rhythm__Status__c = 'Active'
            `;console.log("\u{1F3D7}\uFE0F Executing work area query:",r);const l=await a.query(r);console.log("\u{1F3D7}\uFE0F Work area query result:",JSON.stringify(l)),l.records.forEach(c=>{this.workAreaLocationMap[c.Rhythm__Organization_Component__c]=c.Rhythm__Location__c}),console.log(`\u{1F3D7}\uFE0F Cached LocationId for ${l.records.length} work areas:`,JSON.stringify(this.workAreaLocationMap)),this.sections=[...this.sections],this.refreshWorkAreaCacheInBackground()}catch(s){console.error("\u274C Error querying work area LocationIds:",s)}}async refreshWorkAreaCacheInBackground(){try{console.log("\u{1F504} Background: Refreshing work area cache...");const e="Rhythm__Work_Area__c",s=this.lookupOptionsMap[e]||[];if(s.length===0){console.log("\u{1F504} Background: No work area options to refresh");return}const t=s.map(d=>d.value||d.Id).filter(d=>d);if(t.length===0){console.log("\u{1F504} Background: No valid work area IDs found");return}const i=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm"),r=`
                SELECT Rhythm__Organization_Component__c,Rhythm__Location__c FROM Rhythm__Location_OrgComp_Map__c
                WHERE Rhythm__Organization_Component__c IN (${t.map(d=>`'${d}'`).join(",")}) 
                AND Rhythm__Classification_Type__c = 'Work Area'
                AND Rhythm__Status__c = 'Active'
            `;console.log("\u{1F504} Background: Executing work area cache refresh query");const l=await i.query(r),c={};l.records.forEach(d=>{c[d.Rhythm__Organization_Component__c]=d.Rhythm__Location__c}),this.workAreaLocationMap=c,console.log(`\u{1F504} Background: Refreshed work area cache with ${l.records.length} entries:`,JSON.stringify(this.workAreaLocationMap))}catch(e){console.error("\u274C Background: Error refreshing work area cache:",e)}}handleCheckboxChange(e){const s=e.target.dataset.field,t=e.target.checked;console.log(`Checkbox ${s} changed: ${t}`);const o=Boolean(t);this.formData={...this.formData,[s]:o},this.sections=[...this.sections],this.updateFieldVisibility();const i=e.target;i&&(i.checked=o,this.template.querySelectorAll(`[data-field="${s}"]`).forEach(a=>{a!==i&&(a.checked=o)})),this.forceRerender()}handleHelpClick(e){const s=e.target.dataset.field;console.log(`Help clicked for field: ${s}`);const t=this.allFieldsMap[s];t&&t.helpText?(this.helpText=t.helpText,this.helpFieldLabel=t.label,this.showHelpModal=!0):console.warn(`No help text found for field: ${s}`)}closeHelpModal(){this.showHelpModal=!1,this.helpText="",this.helpFieldLabel=""}handleImmediateCorrectionChange(e){const s=e.target.dataset.field,t=e.target.value;console.log(`\u{1F527} Immediate correction field ${s} changed: ${t}`),this.formData={...this.formData,[s]:t},this.immediateCorrectionFields=this.immediateCorrectionFields.map(o=>o.fieldApi===s?{...o,value:t}:o),this.updateImmediateCorrectionVisibility()}handleAddImmediateCorrection(){this.visibleCorrectionFields<7&&(this.visibleCorrectionFields++,console.log(`\u{1F527} Added immediate correction field ${this.visibleCorrectionFields}`),this.immediateCorrectionFields=this.immediateCorrectionFields.map(e=>e.index<=this.visibleCorrectionFields?{...e,isVisible:!0}:e),this.updateImmediateCorrectionVisibility())}handleRemoveImmediateCorrection(e){const s=parseInt(e.target.dataset.index,7),t=`Rhythm__Immediate_Correction_${s}__c`;console.log(`\u{1F527} Removing immediate correction field ${s}`),this.formData={...this.formData,[t]:""};for(let i=s;i<this.visibleCorrectionFields;i++){const a=`Rhythm__Immediate_Correction_${i}__c`,r=`Rhythm__Immediate_Correction_${i+1}__c`;this.formData={...this.formData,[a]:this.formData[r]||""}}const o=`Rhythm__Immediate_Correction_${this.visibleCorrectionFields}__c`;this.formData={...this.formData,[o]:""},this.visibleCorrectionFields--,this.immediateCorrectionFields=this.immediateCorrectionFields.map(i=>({...i,isVisible:i.index<=this.visibleCorrectionFields,value:this.formData[i.fieldApi]||""})),this.updateImmediateCorrectionVisibility()}updateImmediateCorrectionVisibility(){this.immediateCorrectionFields=this.immediateCorrectionFields.map(e=>{const s=this.formData[e.fieldApi]&&this.formData[e.fieldApi].trim()!=="",t=e.index===this.visibleCorrectionFields,o=e.index>1&&e.isVisible,i=t&&this.visibleCorrectionFields<7,a=s&&i,r=o;return{...e,canShowPlus:i,canClickPlus:a,disablePlus:!a,canShowDelete:r,canDelete:r,value:this.formData[e.fieldApi]||""}})}normalizeFormDataForSalesforce(e){console.log("\u{1F50D} Normalizing and filtering form data for Salesforce submission");const s=new Set;if(this.sections.forEach(t=>{t.fields.forEach(o=>{o.fieldApi&&s.add(o.fieldApi)})}),this.objectApiName==="Rhythm__Incident_Injury__c")for(let t=1;t<=7;t++)s.add(`Rhythm__Immediate_Correction_${t}__c`);console.log(`\u{1F50D} Found ${s.size} valid fields for ${this.objectApiName}`),Object.keys(e).forEach(t=>{t==="WhatId"||t.endsWith("_DisplayName")||s.has(t)||(console.log(`\u{1F9F9} Removing invalid field for ${this.objectApiName}: ${t}`),delete e[t])}),this.sections.forEach(t=>{t.fields.forEach(o=>{const i=e[o.fieldApi];i&&o.fieldType&&o.fieldType.toLowerCase()==="datetime"&&typeof i=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(i)&&(e[o.fieldApi]=i+":00",console.log(`\u{1F550} Normalized datetime for Salesforce: ${o.fieldApi} = ${i} -> ${e[o.fieldApi]}`))})})}normalizeDateTimeValue(e){return e&&typeof e=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(e)?e+":00":e}forceRerender(){this.template.querySelectorAll(".form-section").forEach(e=>{e.classList.add("force-update"),requestAnimationFrame(()=>{e.classList.remove("force-update")})})}async handleSubmit(e){if(e&&e.preventDefault(),this.isSubmitting||this.showSpinner){console.log("\u{1F6D1} Form submission already in progress, ignoring duplicate submit");return}console.log("\u{1F680} Starting form submission process"),this.error=null;try{if(this.isSubmitting=!0,!await Promise.resolve().then(()=>this.validateForm())){console.log("\u274C Form validation failed, aborting submission"),this.isSubmitting=!1;return}this.showSpinner=!0;let t;if(this.openedFromListView&&this.objectApiName==="Task"&&this.multipleTaskForms){console.log("\u{1F4DD} Submitting multiple task forms...");const o=[];for(const a of this.multipleTaskForms){const r={};a.fields.forEach(c=>{c.value&&c.value.trim()!==""&&(r[c.fieldApi]=c.value)}),this.whatId&&(r.WhatId=this.whatId),console.log(`\u{1F4DD} Submitting task ${a.displayIndex}:`,JSON.stringify(r));const l=await We.createSafetyEvent(this.objectApiName,r,this.sections);o.push(l)}t={success:o.every(a=>a.success),isOffline:o.some(a=>a.isOffline),count:o.length}}else{const o=JSON.parse(JSON.stringify(this.formData));this.whatId&&(o.WhatId=this.whatId,console.log("\u{1F4CE} Added WhatId to form data:",this.whatId)),console.log("log in line 5435",this.relatedId),console.log("log in line 5436",this.relatedToApi),this.openedFromListView&&this.relatedId&&this.relatedToApi&&(o[this.relatedToApi]=this.relatedId),this.normalizeFormDataForSalesforce(o),console.log("\u{1F50D} === DETAILED FORM DATA ANALYSIS BEFORE SALESFORCE SUBMISSION ==="),Object.keys(o).forEach(a=>{const r=o[a];if(a.toLowerCase().includes("date")||a.toLowerCase().includes("time")){if(console.log(`\u{1F50D} Field: ${a}`),console.log(`   \u{1F4DD} Raw Value: "${r}" (type: ${typeof r})`),a==="Rhythm__Date_Time_of_Incident__c"&&(console.log("   \u{1F6A8} THIS IS THE PROBLEMATIC INCIDENT DATE FIELD"),console.log(`   \u{1F550} Original form input: ${this.formData[a]||"undefined"}`),console.log(`   \u{1F4C5} Final value being sent: "${r}"`),r))try{const l=new Date(r);console.log(`   \u{1F30D} Parsed as Date object: ${l}`),console.log(`   \u{1F4C6} Local date string: ${l.toLocaleDateString()}`),console.log(`   \u{1F552} Local time string: ${l.toLocaleTimeString()}`),console.log(`   \u{1F522} UTC milliseconds: ${l.getTime()}`),console.log(`   \u{1F310} ISO string: ${l.toISOString()}`),console.log(`   \u{1F30D} Timezone offset: ${l.getTimezoneOffset()} minutes`)}catch(l){console.log(`   \u274C Error parsing date: ${l.message}`)}typeof r=="string"&&(/^\d{4}-\d{2}-\d{2}$/.test(r)?console.log("   \u{1F4CB} Format: Date-only (YYYY-MM-DD)"):/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(r)?console.log("   \u{1F4CB} Format: DateTime with seconds (YYYY-MM-DDTHH:MM:SS)"):/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(r)?console.log("   \u{1F4CB} Format: DateTime without seconds (YYYY-MM-DDTHH:MM)"):console.log("   \u{1F4CB} Format: Other/Unknown pattern")),console.log("   ---")}});const i=new Date;console.log("\u{1F30D} === BROWSER TIMEZONE INFORMATION ==="),console.log(`   Local time now: ${i.toLocaleString()}`),console.log(`   UTC time now: ${i.toUTCString()}`),console.log(`   Timezone offset: ${i.getTimezoneOffset()} minutes`),console.log(`   Timezone name: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`),console.log("\u{1F50D} === END DETAILED ANALYSIS ==="),console.log("\u{1F4DD} Submitting form data:",JSON.stringify(o)),t=await We.createSafetyEvent(this.objectApiName,o,this.sections)}if(t.success){console.log("\u{1F50D} Submission result:",JSON.stringify(t)),t.id&&this.formTempId&&(console.log("\u{1F50D} Updating file upload record ID:",t.id),await this.updateFileUploadRecordId(t.id));let o;t.count&&t.count>1?o=t.isOffline?`${t.count} action items saved offline and will sync when online!`:`${t.count} action items created successfully!`:o=t.isOffline?"Record saved offline and will sync when online!":"Record created successfully!",this.showSuccessMessage(o),this.resetForm()}else throw this.showErrorMessage(`Error: ${t.error}`),new Error(`${t.error}`);console.log("\u2705 Form submission completed successfully")}catch(s){console.error("\u274C Error submitting form:",s.message);const t="Failed to save record, Please Contact your Administrator";this.error=t,this.showErrorMessage(`Error: ${t}`),this.scrollToTop()}finally{this.showSpinner=!1,Promise.resolve().then(()=>{this.isSubmitting=!1,console.log("\u{1F3C1} Form submission process complete, flags reset")})}}handleHiddenRequiredFields(){console.log("\u{1F527} Handling hidden required fields...");const e=[];(this.sections||[]).forEach(t=>{t.name!=="RCA Summary"&&(t.fields||[]).forEach(o=>{if(o.required){const i=this.formData[o.fieldApi],a=i!=null&&(i!==""||this.normalizeBooleanValue(i)===!0);e.push({label:o.label,api:o.fieldApi,fieldType:o.fieldType,value:i,hasValue:a})}})}),console.log(`\u{1F527} Found ${e.length} required fields total`),e.forEach(t=>{const o=this.allFieldsMap[t.api];if(!o){console.warn(`\u26A0\uFE0F Could not find original field definition for ${t.api}`);return}if(this.isFieldVisible(o))console.log(`\u{1F527} Required field ${t.label} is visible, no default value needed`);else if(console.log(`\u{1F527} Required field ${t.label} is hidden`),t.hasValue)console.log(`\u{1F527} Hidden required field ${t.label} already has value: ${t.value}`);else{const a=o.fieldType?.toLowerCase()||"";let r;a==="boolean"?r=!1:a==="number"||a==="double"||a==="integer"?r=0:a==="date"?r=new Date().toISOString().split("T")[0]:a==="time"?r="00:00":a==="datetime"?r=new Date().toISOString().split(".")[0]:a==="picklist"&&o.options&&o.options.length?r=o.options[0].value:r="",console.log(`\u{1F527} Setting default value for hidden required field ${t.label}: ${r}`),this.formData={...this.formData,[t.api]:r}}});const s=e.filter(t=>{const o=this.allFieldsMap[t.api];if(!o)return!1;const i=this.isFieldVisible(o),a=this.formData[t.api],r=a!=null&&a!=="";return i&&!r});s.length>0?(console.warn(`\u26A0\uFE0F Still have ${s.length} visible required fields without values`),s.forEach(t=>{console.warn(`\u26A0\uFE0F Missing value for: ${t.label}`)})):console.log("\u2705 All required fields now have values or are hidden")}validateForm(){console.log("\u{1F50D} Validating form...");const e=[];if(this.openedFromListView&&this.objectApiName==="Task"&&this.multipleTaskForms?(console.log("\u{1F50D} Validating multiple task forms..."),this.multipleTaskForms.forEach(s=>{s.fields.forEach(t=>{t.required&&(!t.value||t.value.trim()==="")&&(e.push(`${t.label} (Action Item ${s.displayIndex})`),console.log(`\u{1F50D} Required field ${t.label} is empty in Action Item ${s.displayIndex}`))})})):this.sections.forEach(s=>{s.fields.forEach(t=>{if(t.required&&this.isFieldVisible(t)){const o=this.formData[t.fieldApi],i=o==null||o==="";t.fieldType==="BOOLEAN"&&o===!1||t.fieldType==="NUMBER"&&o===0||i&&(e.push(t.label),console.log(`\u{1F50D} Required field ${t.label} is empty`))}})}),this.showImmediateCorrectionSection&&this.immediateCorrectionFields.forEach(s=>{if(s.isVisible&&s.required){const t=this.formData[s.fieldApi];(t==null||t==="")&&(e.push(s.label),console.log(`\u{1F50D} Required immediate correction field ${s.label} is empty`))}}),e.length>0){const s=`Please fill in all required fields: ${e.join(", ")}`;return this.error=s,this.scrollToTop(),!1}return console.log("\u2705 Form validation passed"),!0}handleCancel(){this.resetForm(),this.dispatchEvent(new CustomEvent("cancel"))}dismissError(){console.log("Dismissing error message"),this.error=null}getLocationFieldMappings(e){const s={Rhythm__Incident_Injury__c:{locationFields:["Rhythm__Location__c","Rhythm__Site__c"],workAreaField:"Rhythm__Work_Area__c"},Rhythm__Hazard__c:{locationFields:["Rhythm__Location__c","Rhythm__Site__c"],workAreaField:"Rhythm__Work_Area__c"},Task:{locationFields:["WhatId"],workAreaField:"Rhythm__Work_Area__c"}};return s[e]||s.Rhythm__Incident_Injury__c}getActiveLocationFields(e){const s=this.getLocationFieldMappings(e),t=[];if(s.locationFields.forEach(o=>{this.allFieldsMap&&this.allFieldsMap[o]&&t.push(o)}),t.length===0&&this.allFieldsMap){const o=["location","site","facility","place","area"];Object.keys(this.allFieldsMap).forEach(i=>{const a=this.allFieldsMap[i],r=i.toLowerCase(),l=a.label?.toLowerCase()||"",c=o.some(h=>r.includes(h)||l.includes(h)),d=a.fieldType==="REFERENCE"||a.referenceTo?.length>0||i.includes("__c");c&&d&&t.push(i)})}return t}async waitForFormMetadata(e=3e3){const s=Date.now(),t=100;for(;Date.now()-s<e;){if(this.allFieldsMap&&Object.keys(this.allFieldsMap).length>0)return console.log("\u2705 Form metadata is ready for QR processing"),!0;await new Promise(o=>setTimeout(o,t))}return console.warn("\u26A0\uFE0F Timeout waiting for form metadata, proceeding anyway"),!1}async processQrData(){if(!this.qrData)return;if(console.log("\u{1F50D} Processing QR data:",this.qrData),this.qrData.locationId){const t=await this.validateUserAccess(this.qrData.locationId,this.qrData.workAreaId);if(!t.hasAccess){this.error=t.error,console.log("\u274C QR Location access denied:",t.error),this.isQrMode=!1,this.qrLocationId=null,this.qrWorkAreaId=null,console.log("\u26A0\uFE0F Opened normal form due to QR location access denial");return}console.log("\u2705 QR Location access granted:",t)}this.isQrMode=!0,this.qrLocationId=this.qrData.locationId,this.qrWorkAreaId=this.qrData.workAreaId,await this.waitForFormMetadata();const e=this.qrData.objectApiName||this.objectApiName,s=this.getLocationFieldMappings(e);if(this.qrLocationId){const t=this.getActiveLocationFields(e);if(t.length>0){const o={};t.forEach(i=>{o[i]=this.qrLocationId,console.log(`\u{1F3E2} Mapping location ${this.qrLocationId} to field: ${i}`)}),this.formData={...this.formData,...o},console.log("\u{1F3E2} Prepopulated location fields from QR:",t)}else{console.warn("\u26A0\uFE0F No location fields found to populate for object:",e),console.warn("\u{1F4CA} Available form fields:",Object.keys(this.allFieldsMap||{}));const o=["Rhythm__Location__c","Rhythm__Site__c"],i={};let a=!1;o.forEach(r=>{this.allFieldsMap&&this.allFieldsMap[r]&&(i[r]=this.qrLocationId,a=!0,console.log(`\u{1F504} Fallback: Mapping location ${this.qrLocationId} to field: ${r}`))}),a&&(this.formData={...this.formData,...i},console.log("\u{1F504} Used fallback location field mapping"))}}this.qrWorkAreaId&&(this.allFieldsMap&&this.allFieldsMap[s.workAreaField]?(this.formData={...this.formData,[s.workAreaField]:this.qrWorkAreaId},console.log(`\u{1F3D7}\uFE0F Prepopulated work area ${this.qrWorkAreaId} to field: ${s.workAreaField}`)):console.warn(`\u26A0\uFE0F Work area field ${s.workAreaField} not found in form for object:`,e)),this.requestFieldRerender()}requestFieldRerender(){this.sections=[...this.sections]}resetForm(){this.formData={},this.error=null,this.showSpinner=!1,this.selectedContractorId=null,this.contactAccountMap={},this.formTempId=this.generateFormTempId(),this.updateFileUploaderFormTempId()}scrollToTop(){try{const e=this.template.querySelector(".modal-content");e?e.scrollTo({top:0,behavior:"smooth"}):typeof window!="undefined"&&window.scrollTo({top:0,behavior:"smooth"})}catch(e){}}generateFormTempId(){return`temp_${this.objectApiName}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`}updateFileUploaderFormTempId(){const e=this.template.querySelector("c-file-uploader");e&&this.formTempId&&e.setFormTempId(this.formTempId)}async updateFileUploadRecordId(e){try{const s=this.template.querySelector("c-file-uploader");s&&await s.updateRecordId(e)}catch(s){}}showSuccessMessage(e){console.log("\u2705 Form submitted successfully:",e),this.dispatchEvent(new CustomEvent("success",{detail:{message:e}})),this.showToastMessage(e,"success")}showErrorMessage(e){console.log("\u274C Form error:",e),this.dispatchEvent(new CustomEvent("error",{detail:{message:e}})),this.showToastMessage(e,"error")}showToastMessage(e,s="info"){this.toastMessage=e,this.toastType=s,this.showToast=!0,console.log(`\u{1F4E2} Toast: [${s.toUpperCase()}] ${e}`),this.autoHideToast()}autoHideToast(){Promise.resolve().then(()=>{let e=0;const s=300,t=()=>{e++,e>=s?(this.showToast=!1,this.toastMessage="",this.toastType="info"):Promise.resolve().then(t)};t()})}handleToastClose(){this.showToast=!1,this.toastMessage="",this.toastType="info"}isMetadataFullyEnhanced(e){if(!e||!Array.isArray(e.fieldMetadata))return!1;const s=e.fieldMetadata.length;let t=0;return e.fieldMetadata.forEach(o=>{(o._fieldType||o.Rhythm__Field_Type__c)&&t++}),s>0&&t/s>=.6}async queryEmployeeContacts(e){try{console.log(`\u{1F465} Querying employee contacts for location: ${e}`);const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm"),o=`
                SELECT Id, Name 
                FROM Contact 
                WHERE RecordType.Name = 'Employee'
                AND Rhythm__Loc__c = '${e}'
                AND IsDeleted = false
                ORDER BY Name
                LIMIT 1000
            `;console.log("\u{1F465} Executing employee query:",o);const i=await t.query(o);return console.log(`\u{1F465} Found ${i.records.length} employee contacts for location ${e}`),i.records.map(r=>({label:r.Name,value:r.Id}))}catch(s){return console.error("\u274C Error querying employee contacts:",s),[]}}async queryContractorEmployees(e){try{console.log(`\u{1F465} Querying contractor employees for contractor: ${e}`);const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm"),o=this.selectedLocationId,i=!!o;console.log(`\u{1F465} Using location filter: ${i?o:"No location selected"}`);const a=`
                SELECT Id, Name, RecordType.Name, Rhythm__Loc__r.Name, Account.Name
                FROM Contact 
                WHERE RecordType.Name = 'Contractor Employee'
                AND AccountId = '${e}'
                ${i?`AND Rhythm__Loc__c = '${o}'`:""}
                AND IsDeleted = false
                ORDER BY Name
                LIMIT 1000
            `;console.log("\u{1F465} Executing enhanced contractor employee query:",a);const r=await t.query(a);return console.log(`\u{1F465} Found ${r.records.length} contractor employees matching criteria`),r.records.map(c=>({label:c.Rhythm__Loc__r?.Name?`${c.Name} (${c.Rhythm__Loc__r.Name})`:c.Name,value:c.Id,accountName:c.Account?.Name,locationName:c.Rhythm__Loc__r?.Name,recordTypeName:c.RecordType?.Name}))}catch(s){return console.error("\u274C Error querying contractor employees:",s),[]}}async loadEmployeeContactsAsync(e){try{const s=await this.queryEmployeeContacts(e),t=`employee_${e}`;this.lookupOptionsMap[t]=s,console.log(`\u{1F465} Cached ${s.length} employee contacts for location ${e}`),this.sections=[...this.sections]}catch(s){console.error("\u274C Error loading employee contacts asynchronously:",s)}}async loadContractorEmployeesAsync(e){try{const s=this.selectedLocationId||"",t=await this.queryContractorEmployees(e),o=`contractor_${e}_location_${s}`;this.lookupOptionsMap[o]=t,console.log(`\u{1F465} Cached ${t.length} contractor employees for contractor ${e} and location ${s||"any"}`),this.sections=[...this.sections]}catch(s){console.error("\u274C Error loading contractor employees asynchronously:",s)}}async getUsersFromUserAccess(){try{const e=`SELECT Id, Rhythm__User__c, Rhythm__User__r.Name FROM Rhythm__UserAccess__c WHERE Rhythm__Location__c = '${this.defaultLocationId}' ORDER BY CreatedDate DESC`,s=await le(e);return console.log("\u{1F3A8} result in line 6355",JSON.stringify(s)),s}catch(e){return console.error("\u274C Error getting users from user access:",e),[]}}async queryContractorsForLocation(e){try{console.log(`\u{1F3E2} Querying contractors for location: ${e}`);const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("SafetyEventForm"),o=`
                SELECT Id,Name,Rhythm__Supplier_Name__c,Rhythm__Supplier_Name__r.Name
            FROM Rhythm__LocationSupplierAssociation__c
            WHERE Rhythm__Location_Association__c = '${e}'

            ORDER BY Name
            `;console.log("\u{1F3E2} Executing contractor location query:",o);const i=await t.query(o);return console.log(`\u{1F3E2} Found ${i.records.length} contractors for location ${e}`),i.records.map(r=>({label:r.Rhythm__Supplier_Name__r.Name,value:r.Rhythm__Supplier_Name__c}))}catch(s){return console.error("\u274C Error querying contractors for location:",s),[]}}async loadContractorsForLocationAsync(e){try{const s=await this.queryContractorsForLocation(e),t=`contractor_location_${e}`;this.lookupOptionsMap[t]=s,console.log(`\u{1F3E2} Cached ${s.length} contractors for location ${e}`),this.sections=[...this.sections]}catch(s){console.error("\u274C Error loading contractors for location asynchronously:",s)}}}ks=ge,ge.INVESTIGATION_SECTIONS=["Investigation Team & Status","Investigation Questionnaire","Investigation Details"],ge.BASE_DISALLOWED_SECTIONS=["RCA Summary"],ge.DISALLOWED_SECTIONS_FOR_NEW_FORMS=[...ks.BASE_DISALLOWED_SECTIONS,...ks.INVESTIGATION_SECTIONS],ge.preparedCache=new Map,Y(ge,{publicProps:{objectApiName:{config:0},isVisible:{config:0},qrData:{config:0},whatId:{config:0},openedFromListView:{config:0},relatedId:{config:0},relatedToApi:{config:0}},track:{sections:1,formData:1,isLoading:1,selectedContractorId:1,contactAccountMap:1,selectedLocationId:1,workAreaLocationMap:1,assetLocationMap:1,contactLocationMap:1,userContractorInfo:1,error:1,showSpinner:1,showToast:1,toastMessage:1,toastType:1,lookupOptionsMap:1,devNameToApi:1,allFieldsMap:1,controllingFieldsMap:1,objectSchema:1,picklistValues:1,objectLabel:1,formTitle:1,acceptedFormats:1,formTempId:1,defaultLocationId:1,qrLocationId:1,qrWorkAreaId:1,isQrMode:1,immediateCorrectionFields:1,visibleCorrectionFields:1,multipleTaskForms:1,nextTaskId:1,showHelpModal:1,helpText:1,helpFieldLabel:1},fields:["currentFieldApi","isSubmitting","userName","lastLoadedObjectApiName","READ_ONLY_FIELDS","CONDITIONAL_EDITABLE_FIELDS","LISTVIEW_ALLOWED_FIELDS","LISTVIEW_FIELD_ORDER","HARDCODED_TASK_FIELDS","HARDCODED_FIELDS"]});const $s=z(ge,{tmpl:Pc,sel:"c-safety-event-form",apiVersion:63});function Uc(n,e,s){var t=n?"["+n+"]":"",o=n?"["+n+"-host]":"",i=n?"-"+n:"";return(e?":host {":o+" {")+"display: block;width: 100%;height: 100%;background-color: #f8f9fa;}.dynamic-host"+t+" {width: 100%;height: 100%;display: flex;flex-direction: column;}.page-header"+t+` {display: flex;align-items: center;padding: 1rem 1.5rem;padding-top: calc(\r
 50px + 1rem\r
 );background-color: #ffffff;border-bottom: 1px solid #e2e8f0;min-height: 60px;position: relative;}.back-button`+t+" {display: flex;align-items: center;justify-content: center;background-color: transparent;border: none;border-radius: 6px;padding: 0.5rem;cursor: pointer;transition: all 0.2s;width: 40px;height: 40px;position: absolute;left: 1rem;}.back-button:hover"+t+" {background-color: #f3f4f6;}.back-icon"+t+" {width: 20px;height: 20px;color: #4b5563;}.page-title"+t+" {font-size: 1.25rem;font-weight: 600;color: #1f2937;margin: 0;text-align: center;width: 100%;}.component-container"+t+" {flex: 1;overflow-y: auto;padding: 0;background-color: #ffffff;}.loading-container"+t+",\r.error-container"+t+" {padding: 12px;text-align: center;}.loading-container"+t+" {display: flex;flex-direction: column;align-items: center;gap: 8px;}.loading-spinner"+t+" {width: 24px;height: 24px;border: 2px solid #e5e7eb;border-top: 2px solid #3b82f6;border-radius: 50%;animation: spin"+i+" 1s linear infinite;}@keyframes spin"+i+" {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text"+t+" {font-size: 14px;color: #6b7280;}.error-container"+t+" {display: flex;flex-direction: column;align-items: center;gap: 8px;}.error-icon"+t+" {font-size: 24px;}.error-message"+t+" {font-size: 14px;color: #dc2626;text-align: center;max-width: 300px;word-wrap: break-word;}.retry-button"+t+" {margin-top: 8px;padding: 8px 16px;background-color: #3b82f6;color: white;border: none;border-radius: 6px;font-size: 14px;cursor: pointer;transition: background-color 0.2s;}.retry-button:hover"+t+" {background-color: #2563eb;}.retry-button:focus"+t+" {outline: 2px solid #3b82f6;outline-offset: 2px;}.retry-button:active"+t+" {background-color: #1d4ed8;}.dynamic-component-container"+t+" {min-height: 24px;width: 100%;}"}var Ao=[Uc];function Vc(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".detail-page-container",t," {background: #fff;border-radius: 8px;box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);margin: 8px;max-width: 380px;height: calc(100% - 16px);overflow-y: auto;padding-bottom: 60px;}.loading-container",t," {position: relative;padding: 16px;text-align: center;}.error-container",t," {color: #dc2626;background-color: #fff5f5;border: 1px solid #ff8080;border-radius: 4px;padding: 16px;margin: 12px;display: flex;align-items: flex-start;justify-content: space-between;flex-direction: row;text-align: left;}.error-content",t," {display: flex;align-items: flex-start;flex: 1;}.error-icon",t," {font-size: 24px;margin-right: 12px;margin-bottom: 0;flex-shrink: 0;}.error-text",t," {font-size: 16px;font-weight: 500;margin: 0;line-height: 1.5;flex: 1;word-break: break-word;}.error-dismiss",t," {background: none;border: none;color: #dc2626;font-size: 24px;font-weight: bold;cursor: pointer;padding: 0 0 0 12px;margin-left: 12px;line-height: 1;align-self: flex-start;flex-shrink: 0;}.error-dismiss:hover",t," {color: #b91c1c;}.section-container",t," {margin: 12px auto;padding: 8px;max-width: 400px;}.section-header",t," {font-size: 16px;color: #683987;margin-bottom: 12px;text-align: left;background-color: #f3ebff;border-radius: 6px;padding: 8px 12px;}.fields-grid",t," {display: grid;grid-template-columns: 1fr;gap: 16px;padding: 0 8px;margin-bottom: 20px;}@media (min-width: 640px) {.fields-grid",t," {grid-template-columns: 1fr 1fr;}}.field-container",t," {padding: 4px 0;}.field-label",t," {font-weight: 400;color: #5c5c5c;margin-bottom: 4px;text-align: left;font-size: 13px;}.field-value",t," {min-height: 20px;color: #181818;text-align: left;border-bottom: 0.1rem solid #d0cccc;padding-bottom: 2px;font-size: 13px;}.required-field",t," {color: #c23934;margin-left: 3px;}.readonly-field",t," {color: #555;background-color: #f5f5f5;padding: 8px 12px;border-radius: 4px;border: 1px solid #ddd;font-style: normal;font-size: 14px;display: inline-block;min-height: 20px;width: 100%;box-sizing: border-box;}.readonly-checkbox",t," {opacity: 0.8;pointer-events: none;}.checkbox-field-value",t," {margin-top: 8px;}.edit-mode-input",t," {width: 100%;background: #fff;}.checkbox-label",t," {display: flex;align-items: center;cursor: pointer;font-size: 14px;margin: 8px 0;}.form-checkbox",t," {width: 18px;height: 18px;margin-right: 8px;cursor: pointer;}.checkbox-text",t," {flex: 1;color: #181818;}.form-select",t," {width: 100%;padding: 8px 12px;border: 1px solid #d0cccc;border-radius: 8px;font-size: 14px;color: #181818;background-color: #fff;min-height: 44px;box-sizing: border-box;}.form-select:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.15);}.form-input",t," {width: 100%;padding: 8px 12px;border: 1px solid #d0cccc;border-radius: 8px;font-size: 14px;color: #181818;background-color: #fff;min-height: 44px;box-sizing: border-box;}.form-input:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.15);}.form-textarea",t," {width: 100%;padding: 8px 12px;border: 1px solid #d0cccc;border-radius: 8px;font-size: 14px;color: #181818;background-color: #fff;min-height: 80px;box-sizing: border-box;resize: vertical;}.form-textarea:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.15);}.edit-mode-input",t," lightning-input",t," .field",t,",.edit-mode-input",t," lightning-combobox",t," .select",t,",.edit-mode-input",t," lightning-textarea",t," .area",t," {width: 100%;border: 1px solid #d0cccc;border-radius: 8px;padding: 8px 12px;font-size: 14px;color: #181818;background-color: #fff;min-height: 44px;box-sizing: border-box;}.edit-mode-input",t," lightning-input",t," .field:focus",t,",.edit-mode-input",t," lightning-combobox",t," .select:focus",t,",.edit-mode-input",t," lightning-textarea",t," .area:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.15);}.injury-illness-related-list",t," {padding: 8px;margin: 0 7px;border-radius: 8px;}.button-container",t," {display: flex;justify-content: center;gap: 12px;margin: 24px 0;padding: 16px;border-top: 1px solid #e5e5e5;}.edit-button",t,",.save-button",t,",.cancel-button",t," {min-width: 100px;padding: 10px 20px;border-radius: 6px;font-size: 14px;font-weight: 500;cursor: pointer;border: 1px solid;transition: all 0.2s ease;}.edit-button",t," {background-color: #f3f3f3;border-color: #c9c9c9;color: #181818;}.edit-button:hover",t," {background-color: #e8e8e8;border-color: #a8a8a8;}.save-button",t," {background-color: #551a8b;border-color: #551a8b;color: white;}.save-button:hover:not(:disabled)",t," {background-color: #551a8b;border-color: #551a8b;}.save-button:disabled",t," {background-color: #c9c9c9;border-color: #c9c9c9;color: #6c6c6c;cursor: not-allowed;}.cancel-button",t," {background-color: #f3f3f3;border-color: #c9c9c9;color: #181818;}.cancel-button:hover:not(:disabled)",t," {background-color: #e8e8e8;border-color: #a8a8a8;}.cancel-button:disabled",t," {background-color: #f8f8f8;border-color: #e0e0e0;color: #a0a0a0;cursor: not-allowed;}.offline-indicator",t," {padding: 12px 16px;margin: 8px 16px;background-color: #f0f9ff;border: 1px solid #bae6fd;border-radius: 8px;color: #0369a1;display: flex;align-items: center;font-size: 14px;}.offline-icon",t," {margin-right: 8px;font-size: 16px;}.offline-text",t," {font-weight: 500;}.edit-icon-button-container",t," {width: 100%;display: flex;justify-content: end;align-items: center;padding-right: 10px;margin: 10px 0;}.edit-icon-button",t," {width: 40px;height: 40px;color: #6a1b9a;display: flex;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s ease;z-index: 5;padding: 0;background: transparent;border: none;}.attachment-section",t," {margin: 20px auto;max-width: 400px;background: #f0f9ff;border-radius: 12px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);overflow: hidden;}.attachment-section-header",t," {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);padding: 16px 20px;border-bottom: 1px solid #e5e7eb;}.attachment-section-title",t," {margin: 0;font-size: 18px;font-weight: 600;color: #ffffff;text-align: center;text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);}.attachment-section-content",t," {padding: 0;background: #ffffff;}@media (max-width: 640px) {.attachment-section",t," {margin: 16px 0;border-radius: 8px;}.attachment-section-header",t," {padding: 12px 16px;}.attachment-section-title",t," {font-size: 16px;}}.help-button",t," {display: inline-block;width: 18px;height: 18px;border-radius: 50%;background-color: #0070d2;color: white;border: none;font-size: 12px;font-weight: bold;cursor: pointer;margin-left: 8px;vertical-align: middle;line-height: 1;text-align: center;transition: background-color 0.2s ease;}.help-button:hover",t," {background-color: #005fb2;}.help-button:active",t," {background-color: #004a8c;}.help-modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0, 0, 0, 0.6);backdrop-filter: blur(8px);display: flex;align-items: center;justify-content: center;z-index: 1300;padding: 20px;animation: fadeIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.help-modal",t," {background: #ffffff;border-radius: 8px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);max-width: 500px;width: 100%;max-height: 80vh;overflow: hidden;animation: slideIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.help-modal-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 20px 24px;border-bottom: 1px solid #e5e5e5;background-color: #f8f9fa;}.help-modal-header",t," h3",t," {margin: 0;font-size: 18px;font-weight: 600;color: #333;}.help-modal-close",t," {background: none;border: none;font-size: 24px;color: #666;cursor: pointer;padding: 0;width: 30px;height: 30px;display: flex;align-items: center;justify-content: center;border-radius: 4px;transition: background-color 0.2s ease;}.help-modal-close:hover",t," {background-color: #e5e5e5;}.help-modal-content",t," {padding: 24px;max-height: 60vh;overflow-y: auto;}.help-modal-content",t," p",t," {margin: 0;line-height: 1.6;color: #555;font-size: 14px;}@keyframes slideIn",o," {from {transform: scale(0.9) translateY(-20px);opacity: 0;}to {transform: scale(1) translateY(0);opacity: 1;}}@keyframes fadeIn",o," {from {opacity: 0;}to {opacity: 1;}}.message-modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0, 0, 0, 0.7);backdrop-filter: blur(5px);display: flex;align-items: center;justify-content: center;z-index: 1500;padding: 20px;animation: fadeIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.message-modal",t," {background: #ffffff;border-radius: 12px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);max-width: 400px;width: 100%;overflow: hidden;animation: slideIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.message-modal-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 16px 20px;border-bottom: 1px solid #e5e5e5;background-color: #551a8b;}.message-modal-header",t," h3",t," {margin: 0;font-size: 18px;font-weight: 600;color: #ffffff;}.message-modal-close",t," {background: none;border: none;font-size: 24px;color: #ffffff;cursor: pointer;padding: 0;width: 30px;height: 30px;display: flex;align-items: center;justify-content: center;border-radius: 4px;transition: background-color 0.2s ease;}.message-modal-close:hover",t," {background-color: rgba(255, 255, 255, 0.2);}.message-modal-content",t," {padding: 24px;}.message-modal-content",t," p",t," {margin: 0;line-height: 1.6;color: #333;font-size: 16px;text-align: center;}.message-modal-footer",t," {display: flex;justify-content: center;padding: 16px 20px 20px;}.message-modal-button",t," {background-color: #551a8b;color: white;border: none;border-radius: 6px;padding: 10px 24px;font-size: 16px;font-weight: 500;cursor: pointer;transition: background-color 0.2s ease;}.message-modal-button:hover",t," {background-color: #683987;}.immediate-correction-section",t," {margin: 16px auto;}.immediate-correction-content",t," {padding: 12px;}.immediate-correction-field",t," {margin-bottom: 16px;}.immediate-correction-field",t," .input-with-buttons",t," {display: flex;align-items: center;gap: 8px;margin-top: 8px;}.immediate-correction-field",t," .form-input",t," {flex: 1;}.immediate-correction-field",t," .field-value",t," {padding: 10px 12px;background: #f9fafb;border-radius: 6px;font-size: 14px;color: #1f2937;min-height: 20px;width: 100%;}.immediate-correction-input",t," {width: 100%;padding: 10px 12px;border: 2px solid #e5e7eb;border-radius: 8px;font-size: 14px;font-family: inherit;transition: all 0.2s ease;background: #ffffff;color: #374151;}.immediate-correction-input:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);background: #f9fafb;}.field-buttons",t," {display: flex;gap: 4px;flex-shrink: 0;}.icon-button",t," {background: none;border: 1px solid #d0d7de;border-radius: 4px;padding: 4px 8px;cursor: pointer;font-size: 14px;line-height: 1;transition: all 0.2s ease;min-width: 32px;height: 32px;display: flex;align-items: center;justify-content: center;}.icon-button:hover",t," {background-color: #f6f8fa;border-color: #1f2328;}.icon-button:active",t," {background-color: #eaeef2;}.plus-button",t," {color: #1f883d;border-color: #1f883d;}.plus-button:hover",t," {background-color: #f6f8fa;border-color: #1a7f37;}.delete-button",t," {color: #d1242f;border-color: #d1242f;}.delete-button:hover",t," {background-color: #fff8f8;border-color: #a40e26;}.icon-button:disabled",t," {opacity: 0.5;cursor: not-allowed;background-color: #f6f8fa;border-color: #d0d7de;color: #656d76;}.icon-button:disabled:hover",t," {background-color: #f6f8fa;border-color: #d0d7de;}.plus-button:disabled",t," {color: #656d76;border-color: #d0d7de;}.plus-button:disabled:hover",t," {background-color: #f6f8fa;border-color: #d0d7de;}"].join("")}var Io=[Vc];function qc(n,e,s){var t=n?"["+n+"]":"",o=n?"["+n+"-host]":"",i=n?"-"+n:"";return(e?":host {":o+" {")+"display: block;}.spinner"+t+" {display: flex;align-items: center;gap: 8px;padding: 8px 0;}.ring"+t+" {width: 24px;height: 24px;border: 3px solid rgba(0, 0, 0, 0.15);border-top-color: rgba(0, 0, 0, 0.6);border-radius: 50%;animation: spin"+i+" 1s linear infinite;}"+(e?":host([size='small']) .ring":o+"[size='small'] .ring")+t+" {width: 16px;height: 16px;}"+(e?":host([size='large']) .ring":o+"[size='large'] .ring")+t+" {width: 32px;height: 32px;}.label"+t+" {font-size: 14px;color: #444;}@keyframes spin"+i+" {to {transform: rotate(360deg);}}"}var Fo=[qc];const zc=p`<div class="spinner${0}" role="status" aria-live="polite" aria-busy="true"${"a0:title"}${2}><div class="ring${0}"${2}></div><div class="label${0}"${2}>${"t3"}</div></div>`;function Be(n,e,s,t){const{d:o,sp:i,st:a}=n;return[a(zc,1,[i(0,{attrs:{title:e.alternativeText}},null),i(3,null,o(e.alternativeText))])]}var Wc=J(Be);Be.stylesheets=[],Be.stylesheetToken="lwc-47dd688sbro",Be.legacyStylesheetToken="lightning-spinner_spinner",Fo&&Be.stylesheets.push.apply(Be.stylesheets,Fo),Q(Be);class Do extends K{constructor(...e){super(...e);this.alternativeText="Loading",this.size="medium"}}Y(Do,{publicProps:{alternativeText:{config:0},size:{config:0}}});const To=z(Do,{tmpl:Wc,sel:"lightning-spinner",apiVersion:63});function Bc(n,e,s){var t=n?"["+n+"]":"";return".error-message"+t+" {color: #d32f2f;background: #fff3f3;border: 1px solid #d32f2f;border-radius: 4px;padding: 8px 12px;margin: 10px 0;font-size: 15px;font-weight: 500;text-align: center;}.alert-modal-container"+t+` {color: #000;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
 Helvetica, Arial, sans-serif;}.button-container`+t+" {display: flex;gap: 10px;margin: 10px 0;justify-content: center;}.acknowledge-button"+t+",.complete-button"+t+" {padding: 8px 16px;border-radius: 4px;font-size: 14px;font-weight: 500;cursor: pointer;border: 1px solid;transition: all 0.2s ease;}.acknowledge-button"+t+" {background-color: #4051b5;border-color: #4051b5;color: white;}.complete-button"+t+" {background-color: #4051b5;border-color: #4051b5;color: white;}.acknowledge-button:hover"+t+" {background-color: #3244a8;}.complete-button:hover"+t+" {background-color: #3244a8;}.edit-icon-button"+t+" {width: 40px;height: 40px;color: #6a1b9a;display: flex;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s ease;z-index: 5;padding: 0;background: transparent;border: none;}.modal-container"+t+" {position: fixed;top: 0;left: 0;right: 0;bottom: 0;z-index: 9000;display: flex;justify-content: center;align-items: center;}.modal-backdrop"+t+" {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);z-index: -1;}.modal-content"+t+" {background: white;border-radius: 8px;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);width: 90%;max-width: 500px;max-height: 90vh;overflow-y: auto;display: flex;flex-direction: column;}.modal-header"+t+" {display: flex;justify-content: space-between;align-items: center;padding: 16px 24px;border-bottom: 1px solid #e5e5e5;}.modal-header"+t+" h2"+t+" {margin: 0;font-size: 18px;font-weight: 600;color: #333;}.close-button"+t+" {background: none;border: none;font-size: 24px;cursor: pointer;color: #666;}.modal-body"+t+" {padding: 24px;flex: 1;overflow-y: auto;}.modal-footer"+t+" {display: flex;justify-content: flex-end;gap: 12px;padding: 16px 24px;border-top: 1px solid #e5e5e5;}.cancel-button"+t+" {background-color: #f3f3f3;border: 1px solid #c9c9c9;color: #181818;padding: 8px 16px;border-radius: 4px;font-size: 14px;cursor: pointer;}.save-button"+t+" {background-color: #4051b5;border: 1px solid #4051b5;color: white;padding: 8px 16px;border-radius: 4px;font-size: 14px;cursor: pointer;}.cancel-button:hover"+t+" {background-color: #e8e8e8;}.save-button:hover"+t+" {background-color: #3244a8;}.form-group"+t+" {margin-bottom: 20px;}.form-group"+t+" label"+t+" {display: block;margin-bottom: 6px;font-size: 14px;font-weight: 500;color: #333;}.form-control"+t+" {width: 100%;padding: 8px 12px;border: 1px solid #d0d0d0;border-radius: 4px;font-size: 14px;color: #333;}textarea.form-control"+t+" {min-height: 80px;resize: vertical;}.required-field"+t+"::after {content: '*';color: #c23934;margin-left: 3px;}.file-upload-container"+t+" {display: flex;flex-direction: column;border: 1px dashed #d0d0d0;border-radius: 4px;padding: 16px;margin-bottom: 12px;}.file-upload-actions"+t+" {display: flex;gap: 10px;margin-bottom: 10px;}.action-button"+t+" {display: flex;align-items: center;gap: 8px;background-color: #f3f3f3;border: 1px solid #c9c9c9;color: #181818;padding: 8px 16px;border-radius: 4px;font-size: 14px;cursor: pointer;transition: all 0.2s ease;}.action-button:hover"+t+" {background-color: #e8e8e8;}.action-button"+t+" .icon"+t+" {width: 16px;height: 16px;}.file-upload-text"+t+" {margin-left: 12px;color: #666;font-size: 14px;}.hidden-file-input"+t+" {position: absolute;top: 0;left: 0;opacity: 0;width: 0.1px;height: 0.1px;overflow: hidden;}.selected-files"+t+" {margin-top: 12px;}.selected-file"+t+" {display: flex;justify-content: space-between;align-items: center;background-color: #f3f3f3;padding: 8px 12px;border-radius: 4px;margin-bottom: 8px;}.selected-file"+t+" span"+t+" {font-size: 14px;color: #333;}.selected-file"+t+" button"+t+" {background: none;border: none;color: #666;font-size: 18px;cursor: pointer;padding: 0 4px;}"}var Oo=[Bc];const Hc=p`<button class="acknowledge-button${0}"${2}>Acknowledge</button>`,Jc=p`<button class="complete-button${0}"${2}>Complete</button>`,Qc=p`<button type="button" title="Edit Record" class="edit-icon-button${0}"${2}><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"${3}><path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"${3}/></svg></button>`,Yc=p`<div class="modal-backdrop${0}"${2}></div>`,Kc=p`<header class="modal-header${0}"${2}><h2${3}>Acknowledge Alert</h2><button class="close-button${0}"${2}>×</button></header>`,Gc=p`<div class="error-message${0}"${2}>${"t1"}</div>`,Xc=p`<label${"a0:for"}${3}>Alert</label>`,Zc=p`<div class="form-group${0}"${2}><label${"a1:for"} class="required-field${0}"${2}>Comments</label><textarea${"a3:id"} class="form-control${0}"${2}>${"t4"}</textarea></div>`,ed=p`<footer class="modal-footer${0}"${2}><button class="cancel-button${0}"${2}>Cancel</button><button class="save-button${0}"${2}>Acknowledge</button></footer>`,td=p`<div class="modal-backdrop${0}"${2}></div>`,sd=p`<header class="modal-header${0}"${2}><h2${3}>Complete Alert</h2><button class="close-button${0}"${2}>×</button></header>`,od=p`<div class="error-message${0}"${2}>${"t1"}</div>`,id=p`<label${"a0:for"}${3}>Alert Name</label>`,ad=p`<label${"a0:for"}${3}>Status</label>`,nd=p`<div class="form-group${0}"${2}><label${"a1:for"} class="required-field${0}"${2}>Comments</label><textarea${"a3:id"} class="form-control${0}"${2}>${"t4"}</textarea></div>`,rd=p`<label${"a0:for"} class="required-field${0}"${2}>Attach Files</label>`,ld=p`<div class="file-upload-container${0}"${2}><div class="file-upload-actions${0}"${2}><button class="action-button${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm0 2.5L18.5 9H14zM8 13h8v2H8zm0 4h8v2H8zm0-8h4v2H8z"${3}/></svg>Upload Files</button><button class="action-button${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M9 2l1.5 2H14l2 2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2h3l2-2zM12 9a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 9zm0 2a3 3 0 1 1-.001 6.001A3 3 0 0 1 12 11z"${3}/></svg>Capture Image</button></div><div class="file-upload-text${0}"${2}>Or drop files</div></div>`,cd=p`<div class="selected-file${0}"${2}><span${3}>${"t2"}</span><button${"a3:data-id"}${3}>×</button></div>`,dd=p`<footer class="modal-footer${0}"${2}><button class="cancel-button${0}"${2}>Cancel</button><button class="complete-button${0}"${2}>Complete</button></footer>`,hd={classMap:{"alert-modal-container":!0},key:0},ud={classMap:{"button-container":!0},key:1},pd={classMap:{"modal-container":!0},attrs:{role:"dialog",tabindex:"-1"},key:8},fd={classMap:{"modal-content":!0},key:11},md={classMap:{"modal-body":!0},key:16},gd={classMap:{"form-group":!0},key:17},Cs={"form-control":!0},_d={classMap:{"modal-container":!0},attrs:{role:"dialog",tabindex:"-1"},key:25},bd={classMap:{"modal-content":!0},key:28},yd={classMap:{"modal-body":!0},key:33},vd={classMap:{"form-group":!0},key:34},wd={classMap:{"form-group":!0},key:38},xd={value:"Completed"},kd={classMap:{"form-group":!0},key:44},$d={classMap:{"selected-files":!0},key:49};function He(n,e,s,t){const{b:o,sp:i,st:a,h:r,d:l,gid:c,k:d,i:h}=n,{_m0:u,_m1:f,_m2:g,_m3:_,_m4:m,_m5:x,_m6:k,_m7:$,_m8:S,_m9:O,_m10:F,_m11:D,_m12:v,_m13:A,_m14:w,_m15:y,_m16:C}=t;return[r("div",hd,[r("div",ud,[e.showAcknowledgeButton?a(Hc,3,[i(0,{on:f||(t._m1={click:o(e.handleAcknowledge)})},null)]):null,e.showCompleteButton?a(Jc,5,[i(0,{on:_||(t._m3={click:o(e.handleComplete)})},null)]):null,e.showEditButton?a(Qc,7,[i(0,{on:x||(t._m5={click:o(e.handleEdit)})},null)]):null]),e.showAcknowledgeModal?r("section",pd,[a(Yc,10),r("div",fd,[a(Kc,13,[i(3,{on:k||(t._m6={click:o(e.closeModal)})},null)]),e.error?a(Gc,15,[i(1,null,l(e.error))]):null,r("div",md,[r("div",gd,[a(Xc,19,[i(0,{attrs:{for:c("alertName")}},null)]),r("input",{classMap:Cs,attrs:{type:"text",id:c("alertName"),disabled:""},props:{value:e.alert.name},key:20})]),a(Zc,22,[i(1,{attrs:{for:c("comments")}},null),i(3,{on:$||(t._m7={change:o(e.handleCommentChange)}),attrs:{id:c("comments")}},null),i(4,null,l(e.alert.comments))])]),a(ed,24,[i(1,{on:S||(t._m8={click:o(e.closeModal)})},null),i(3,{on:O||(t._m9={click:o(e.handleSave)})},null)])])]):null,e.showCompleteModal?r("section",_d,[a(td,27),r("div",bd,[a(sd,30,[i(3,{on:F||(t._m10={click:o(e.closeModal)})},null)]),e.error?a(od,32,[i(1,null,l(e.error))]):null,r("div",yd,[r("div",vd,[a(id,36,[i(0,{attrs:{for:c("completeAlertName")}},null)]),r("input",{classMap:Cs,attrs:{type:"text",id:c("completeAlertName"),disabled:""},props:{value:e.alert.name},key:37})]),r("div",wd,[a(ad,40,[i(0,{attrs:{for:c("compStatus")}},null)]),r("input",{classMap:Cs,attrs:{type:"text",id:c("compStatus"),disabled:""},props:xd,key:41})]),e.showCompleteButton?a(nd,43,[i(1,{attrs:{for:c("completeComments")}},null),i(3,{on:D||(t._m11={change:o(e.handleCommentChange)}),attrs:{id:c("completeComments")}},null),i(4,null,l(e.alert.comments))]):null,e.showCompleteButton?r("div",kd,[a(rd,46,[i(0,{attrs:{for:c("fileUpload")}},null)]),a(ld,48,[i(2,{on:v||(t._m12={click:o(e.handleFileUploadClick)})},null),i(6,{on:A||(t._m13={click:o(e.handleCameraCapture)})},null)]),r("div",$d,h(e.selectedFiles,function(I){return a(cd,d(51,I.name),[i(2,null,l(I.name)),i(3,{on:w||(t._m14={click:o(e.removeFile)}),attrs:{"data-id":I.name}},null)])}))]):null]),a(dd,53,[i(1,{on:y||(t._m15={click:o(e.closeModal)})},null),i(3,{on:C||(t._m16={click:o(e.handleCompleteSubmit)})},null)])])]):null])]}var Cd=J(He);He.stylesheets=[],He.stylesheetToken="lwc-1uh6unv5blb",He.legacyStylesheetToken="c-alertModal_alertModal",Oo&&He.stylesheets.push.apply(He.stylesheets,Oo),Q(He);class Lo extends K{constructor(...e){super(...e);this.recordId=void 0,this.objectApiName=void 0,this.alertType=void 0,this.formData=void 0,this.isLoading=!1,this.error=null,this.alert={id:"",name:"",relationName:"R-1",comments:"",status:"",type:""},this.showAcknowledgeModal=!1,this.showCompleteModal=!1,this.selectedFiles=[],this.showAcknowledgeButton=!1,this.showCompleteButton=!1,this.showEditButton=!1}connectedCallback(){this.recordId&&this.loadAlertData()}async loadAlertData(){try{this.isLoading=!0,console.log("formData in loadAlertData",JSON.stringify(this.formData)),this.formData&&(this.alert={id:this.recordId,name:this.formData["Rhythm__Alert__r.Name"]||"",relationName:this.formData.Name||"",comments:this.formData.Rhythm__Comments__c||"",status:this.formData.Rhythm__Status__c||"",type:this.alertType},this.formData.Rhythm__Status__c==="Completed"?(console.log("in line 54",this.formData.Rhythm__Status__c),this.showAcknowledgeButton=!1,this.showCompleteButton=!1):this.formData.Rhythm__Status__c==="Acknowledged"?(console.log("in line 59",this.formData.Rhythm__Status__c),this.showAcknowledgeButton=!1,this.showCompleteButton=!0):(console.log("in line 64",this.formData.Rhythm__Status__c),this.showAcknowledgeButton=!0,this.showCompleteButton=!1),this.formData.Rhythm__Status__c==="Completed"&&this.formData.Rhythm__Status__c==="Acknowledged"&&(this.showAcknowledgeButton=!0,this.showCompleteButton=!0),this.showEditButton=this.alertType==="Information Required",this.alertType!=="Information Required"&&(this.showAcknowledgeButton=!1,this.showCompleteButton=!1),console.log("Edit button visibility:",this.showEditButton,"Alert Type:",this.alertType)),this.isLoading=!1}catch(e){this.error=e.message||"Error loading alert data",this.isLoading=!1}}handleAcknowledge(){this.showAcknowledgeModal=!0}handleComplete(){this.showCompleteModal=!0}handleEdit(){console.log("\u{1F58B}\uFE0F Edit button clicked - requesting edit mode"),this.dispatchEvent(new CustomEvent("editclicked",{detail:{action:"edit"}}))}closeModal(){this.showAcknowledgeModal=!1,this.showCompleteModal=!1,this.error=null}handleCommentChange(e){this.alert.comments=e.target.value}async handleSave(){if(!this.alert.comments||this.alert.comments.trim()===""){this.error="Comments are required.";return}try{this.isLoading=!0;const e={Id:this.alert.id,Rhythm__Status__c:"Acknowledged",Rhythm__Comments__c:this.alert.comments},s=await oe(this.objectApiName,e);console.log("result in handleSave",JSON.stringify(s)),this.closeModal(),this.dispatchEvent(new CustomEvent("alertupdated",{detail:{success:!0,status:"Acknowledged",message:"Alert acknowledged successfully"}})),this.isLoading=!1}catch(e){this.error=e.message||"Error acknowledging alert",this.isLoading=!1}}async handleFileUploadClick(e){e.preventDefault(),console.log("\u{1F4C1} File picker button clicked");try{console.log("\u{1F680} Calling FilePicker.pickFiles...");const s=await St.pickFiles({multiple:!0,readData:!1});console.log("\u{1F4C4} FilePicker result:",s),s&&s.files&&s.files.length>0?(async o=>{const i=[...o],a=async()=>{if(i.length===0)return;const r=i.shift();console.log("\u{1F4CE} Processing selected file:",r),await this.processSelectedFile(r),await a()};await a()})(s.files):console.log("\u2139\uFE0F No files selected")}catch(s){console.error("\u274C Error picking file:",s),this.error=s.message||"Error picking file"}}async handleCameraCapture(){console.log("\u{1F4F8} Camera capture button clicked");try{console.log("\u{1F680} Launching camera...");const e=await Vt.getPhoto({quality:90,resultType:$t.Uri,source:we.Camera,saveToGallery:!0,allowEditing:!1});if(!e?.webPath){console.error("\u274C Camera did not return webPath:",e);return}console.log("\u{1F4F8} Photo captured successfully:",{webPath:e.webPath,path:e.path,format:e.format});let s="";if(e.webPath){const o=e.webPath.split("/"),i=o[o.length-1],a=i.split("_");if(a.length>1){const r=a[0],l=new Date().toISOString().replace(/[:.]/g,"-");s=`${r}_${l}.jpg`}else s=i}else s=`JPEG_${new Date().toISOString().replace(/[:.]/g,"-")}.jpg`;console.log("\u{1F4F8} Extracted filename:",s);const t={name:s,webPath:e.webPath,path:e.path,mimeType:"image/jpeg",type:"image/jpeg",size:0,uri:e.webPath};await this.processSelectedFile(t,!0),console.log("\u2705 Camera photo processed and added to selected files")}catch(e){console.error("\u274C Error capturing photo:",e),this.error=e.message||"Error capturing photo",e.message&&e.message.includes("cancelled")?console.log("Photo capture was cancelled"):console.error("Failed to capture photo:",e.message)}}async processSelectedFile(e,s=!1){console.log("\u{1F4CB} Processing selected file:",e),console.log("\u{1F4CA} File properties:",{name:e.name,path:e.path,size:e.size,mimeType:e.mimeType,webPath:e.webPath,uri:e.uri,url:e.url}),this.isLoading=!0,this.error="";try{if(!this.selectedFiles.some(o=>o.name===e.name)){const o={name:e.name,type:e.mimeType||e.type||(s?"image/jpeg":"application/octet-stream"),size:e.size||0,webPath:e.webPath||e.path||e.uri||e.url||"",recordId:this.recordId,formType:this.objectApiName,description:`File uploaded from ${this.objectApiName} (${s?"camera":"file picker"})`};this.selectedFiles=[...this.selectedFiles,o],console.log("\u{1F4BE} Added file to selected files:",o.name)}}catch(t){console.error("Error processing file:",t),this.error=`Error processing file: ${t.message||"Unknown error"}`}finally{this.isLoading=!1}}removeFile(e){const s=e.currentTarget.dataset.id;this.selectedFiles=this.selectedFiles.filter(t=>t.name!==s)}async handleCompleteSubmit(){try{if(this.isLoading=!0,this.showCompleteButton){let e=[];if((!this.alert.comments||this.alert.comments.trim()==="")&&e.push("Comments"),this.selectedFiles.length===0&&e.push("One or more file attachments"),e.length>0){this.error=e.join(" and ")+" are  required.",this.isLoading=!1;return}let s=!1;try{s=(await X.getStatus())?.connected}catch(r){console.error("Error checking network status:",r),s=navigator.onLine}if(!s){this.error="Cannot complete alert while offline. Please try again when online.",this.isLoading=!1;return}const t=[];let o=!0;if(await(async r=>{const l=[...r],c=async()=>{if(l.length===0)return;const d=l.shift();try{console.log("Uploading file:",d.name);const h=await It(d);h.success?(console.log("File uploaded successfully:",h),t.push({fileName:d.name,status:"success",s3Key:h.s3Key,s3Url:h.s3Url})):(console.error("Error uploading file:",h.error),t.push({fileName:d.name,status:"error",error:h.error}),o=!1)}catch(h){console.error("Error uploading file:",h),t.push({fileName:d.name,status:"error",error:h.message||"Unknown error"}),o=!1}await c()};await c()})(this.selectedFiles),!o){this.error="One or more files failed to upload. Please try again.",this.isLoading=!1;return}console.log("All files uploaded successfully:",t);const a={Id:this.alert.id,Rhythm__Status__c:"Completed",Rhythm__Comments__c:this.alert.comments};await oe(this.objectApiName,a),this.closeModal(),this.dispatchEvent(new CustomEvent("alertupdated",{detail:{success:!0,status:"Completed",message:"Alert completed successfully with file uploads",uploadResults:t}}))}else{const e={Id:this.alert.id,Rhythm__Status__c:"Completed"};await oe(this.objectApiName,e),this.closeModal(),this.dispatchEvent(new CustomEvent("alertupdated",{detail:{success:!0,status:"Completed",message:"Alert completed successfully"}}))}this.isLoading=!1}catch(e){console.error("Error completing alert:",e),this.error=e.message||"Error completing alert",this.isLoading=!1}}}Y(Lo,{publicProps:{recordId:{config:0},objectApiName:{config:0},alertType:{config:0},formData:{config:0}},track:{isLoading:1,error:1,alert:1,showAcknowledgeModal:1,showCompleteModal:1,selectedFiles:1,showAcknowledgeButton:1,showCompleteButton:1,showEditButton:1}});const Sd=z(Lo,{tmpl:Cd,sel:"c-alert-modal",apiVersion:63});function Ed(n,e,s){var t=n?"["+n+"]":"",o=n?"["+n+"-host]":"",i=n?"-"+n:"";return[".card",t," {border-radius: 16px;box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);background: #fff;overflow: hidden;margin: 20px;}.container",t," {height: 100%;min-height: 500px;display: flex;flex-direction: column;}.file-list",t," {height: 300px;overflow-y: auto;}.file-list-section",t," {width: 100%;display: flex;flex-direction: column;background-color: #fff;flex: 1;}.scrollable-area",t," {display: flex;flex-direction: column;padding: 24px;height: 100%;position: relative;}.spinner-container",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;display: flex;justify-content: center;align-items: center;background-color: rgba(255, 255, 255, 0.7);z-index: 2000;}.spinner",t," {width: 60px;height: 60px;border: 5px solid rgba(0, 123, 255, 0.1);border-radius: 50%;border-top-color: #007bff;border-left-color: #007bff;animation: spin",i," 0.8s cubic-bezier(0.5, 0.1, 0.5, 0.9) infinite;box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);position: relative;}.spinner",t,"::before {content: '';position: absolute;top: 50%;left: 50%;width: 30px;height: 30px;border-radius: 50%;background-color: rgba(0, 123, 255, 0.05);transform: translate(-50%, -50%);animation: pulse",i," 1.5s ease-in-out infinite;}@keyframes spin",i," {to {transform: rotate(360deg);}}@keyframes pulse",i," {0% {transform: translate(-50%, -50%) scale(0.8);opacity: 0.5;}50% {transform: translate(-50%, -50%) scale(1.2);opacity: 0.8;}100% {transform: translate(-50%, -50%) scale(0.8);opacity: 0.5;}}.info-box",t," {background-color: #f8f9fa;border-radius: 4px;padding: 12px;margin-bottom: 16px;display: flex;align-items: flex-start;}.info-icon",t," {display: inline-flex;align-items: center;justify-content: center;width: 20px;height: 20px;border-radius: 50%;background-color: #007bff;color: white;font-weight: bold;margin-right: 8px;font-size: 14px;}.info-text",t," {font-size: 14px;color: #555;flex: 1;}.file-list",t," {overflow-y: auto;margin-bottom: 20px;padding-right: 5px;max-height: calc(100vh - 300px);}.files-table",t," {width: 100%;border-collapse: separate;border-spacing: 0 8px;}.file-row",t," {transition: all 0.2s ease;border-radius: 8px;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);background-color: #fff;}.file-row:hover",t," {background-color: #f8f9fa;transform: translateY(-2px);box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);}.file-row",t," td:first-child",t," {border-top-left-radius: 8px;border-bottom-left-radius: 8px;}.file-row",t," td:last-child",t," {border-top-right-radius: 8px;border-bottom-right-radius: 8px;}.file-icon-cell",t," {width: 50px;text-align: center;padding: 14px 8px;}.file-name-cell",t," {padding: 14px 8px;}.file-action-cell",t," {width: 50px;text-align: center;padding: 8px;}.file-name",t," {margin: 0;font-size: 15px;font-weight: 500;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;max-width: 200px;color: #333;}.eye-icon",t,"::before {content: '\\1F441';font-size: 18px;}.download-icon",t,"::before {content: '\\2193';font-size: 18px;}.trash-icon",t,"::before {content: '\\1F5D1';font-size: 18px;}.upload-icon",t,"::before {content: '\\2191';font-size: 18px;}.icon-button",t," {background: none;border: none;cursor: pointer;padding: 10px;border-radius: 50%;transition: all 0.3s ease;width: 40px;height: 40px;display: flex;align-items: center;justify-content: center;}.icon-button:hover",t," {transform: scale(1.1);}.preview-button",t," {color: #007bff;}.preview-button:hover",t," {color: #0069d9;}.download-button",t," {color: #28a745;}.download-button:hover",t," {color: #218838;}.delete-button",t," {color: #dc3545;}.delete-button:hover",t," {color: #c82333;}.empty-state",t," {display: flex;justify-content: center;align-items: center;height: 150px;color: #6c757d;background-color: #f8f9fa;border-radius: 12px;margin: 20px 0;}.empty-text",t," {font-size: 16px;font-weight: 500;color: #6c757d;position: relative;padding: 15px 25px;text-align: center;}.empty-text",t,"::before {content: '\u{1F4C1}';display: block;font-size: 32px;margin-bottom: 10px;animation: pulse",i," 2s infinite ease-in-out;}@keyframes pulse",i," {0% {transform: scale(1);}50% {transform: scale(1.1);}100% {transform: scale(1);}}.upload-section",t," {margin-top: auto;padding-top: 16px;position: sticky;bottom: 0;background-color: #fff;z-index: 10;}.offline-indicator",t,",\r.error-message",t,",\r.pending-files-indicator",t," {display: flex;align-items: center;border-radius: 8px;padding: 12px;margin-bottom: 16px;font-size: 14px;line-height: 1.4;animation: fadeIn",i," 0.5s ease-out;}.offline-indicator",t," {background-color: #fff3f3;border: 1px solid #ffccd1;color: #dc3545;}.error-message",t," {background-color: #fff9e6;border: 1px solid #ffe0a6;color: #856404;}.pending-files-indicator",t," {background-color: #e6f7ff;border: 1px solid #a6d8ff;color: #0070cc;}.offline-icon",t,",\r.error-icon",t,",\r.pending-icon",t," {margin-right: 10px;flex-shrink: 0;font-size: 18px;}.file-actions-container",t," {padding: 20px;background-color: #f8f9fa;border-radius: 12px;box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);text-align: center;}.upload-actions",t," {display: flex;flex-direction: column;align-items: center;gap: 16px;}.action-button",t," {display: flex;align-items: center;justify-content: center;background-color: #fff;color: #333;border: none;border-radius: 8px;padding: 12px 24px;font-size: 15px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);width: 100%;max-width: 250px;}.action-button:hover",t," {background-color: #f0f7ff;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);transform: translateY(-2px);}.action-button:active",t," {transform: translateY(0);box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);}.action-button",t," .icon",t," {margin-right: 10px;color: #007bff;}.action-button:last-child",t," .icon",t," {color: #28a745;}@media (min-width: 768px) {.upload-actions",t," {flex-direction: row;justify-content: center;}.action-button",t," {width: auto;}}.preview-modal-overlay",t," {z-index: 1100;}.preview-modal-container",t," {width: 90%;max-width: 90%;max-height: 90vh;display: flex;flex-direction: column;}.preview-modal-content",t," {flex: 1;padding: 0;overflow: hidden;display: flex;min-height: 70vh;align-items: center;justify-content: center;}.preview-wrapper",t," {width: 100%;height: 100%;display: flex;align-items: center;justify-content: center;overflow: hidden;}.preview-frame",t," {width: 100%;height: 100%;border: none;background-color: white;transition: all 0.3s ease;animation: fadeIn",i," 0.5s ease-out;}@keyframes fadeIn",i," {from {opacity: 0;transform: translateY(10px);}to {opacity: 1;transform: translateY(0);}}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;display: flex;justify-content: center;align-items: center;z-index: 1000;animation: fadeIn",i," 0.3s ease-out;}",e?":host(.modal-open),\rbody.modal-open":o+".modal-open,\rbody.modal-open",t," {overflow: hidden;}.modal-backdrop",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.6);backdrop-filter: blur(4px);z-index: 999;}.modal-container",t," {background-color: white;border-radius: 16px;width: 90%;max-width: 400px;box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);z-index: 1001;overflow: hidden;animation: slideUp",i," 0.4s ease-out;transform-origin: bottom;}@keyframes slideUp",i," {from {opacity: 0;transform: translateY(30px);}to {opacity: 1;transform: translateY(0);}}.modal-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 20px 24px;border-bottom: 1px solid #e9ecef;background-color: #f8f9fa;position: relative;}.modal-title",t," {text-align: center;margin: 0;font-size: 20px;font-weight: 600;color: #343a40;position: absolute;left: 0;right: 0;width: 100%;}.close-button",t," {background: none;border: none;font-size: 24px;cursor: pointer;padding: 0;color: #6c757d;width: 36px;height: 36px;display: flex;align-items: center;justify-content: center;border-radius: 50%;transition: all 0.2s ease;z-index: 10;}.close-button:hover",t," {background-color: rgba(108, 117, 125, 0.1);color: #343a40;}.close-icon",t," {line-height: 1;}.modal-content",t," {padding: 24px;}.modal-message",t," {margin: 0;font-size: 16px;line-height: 1.5;color: #495057;text-align: center;}.modal-message",t,"::before {content: '\u26A0\uFE0F';display: block;font-size: 48px;margin-bottom: 16px;}.modal-footer",t," {display: flex;justify-content: center;gap: 16px;padding: 16px 24px 24px;}.cancel-button",t," {background-color: #f8f9fa;border: 1px solid #ced4da;border-radius: 8px;padding: 12px 24px;font-size: 15px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;min-width: 120px;}.cancel-button:hover",t," {background-color: #e9ecef;}.modal-footer",t," .delete-button",t," {background-color: #dc3545;color: white;border: none;border-radius: 8px;padding: 12px 24px;font-size: 15px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;box-shadow: 0 2px 5px rgba(220, 53, 69, 0.3);min-width: 120px;}.modal-footer",t," .delete-button:hover",t," {background-color: #c82333;box-shadow: 0 4px 8px rgba(220, 53, 69, 0.4);transform: translateY(-2px);}.modal-footer",t," .delete-button:active",t," {transform: translateY(0);}@media screen and (max-width: 767px) {.container",t," {height: auto;}.file-list-section",t," {border-bottom: 1px solid #e0e0e0;}.file-name",t," {max-width: 150px;}.upload-actions",t," {flex-direction: column;gap: 8px;}.upload-hint",t," {margin-top: 8px;}.preview-modal-container",t," {width: 100%;max-width: 100%;height: 100%;max-height: 100%;border-radius: 0;}}"].join("")}var No=[Ed];const Rd=p`<div class="spinner-container${0}"${2}><div class="spinner${0}"${2}></div></div>`,Ad=p`<div class="info-box${0}"${2}><span class="info-icon${0}"${2}>i</span><span class="info-text${0}"${2}>${"t4"}</span></div>`,Id=p`<td class="file-icon-cell${0}"${2}><span${"c1"}${2}></span></td>`,Fd=p`<td class="file-name-cell${0}"${2}><p class="file-name${0}"${"a1:title"}${2}>${"t2"}</p></td>`,Dd=p`<button class="icon-button preview-button${0}" title="Preview"${"a0:data-key"}${2}><span class="eye-icon${0}"${2}></span></button>`,Td=p`<td class="file-action-cell${0}"${2}><button class="icon-button delete-button${0}" title="Delete"${"a1:data-key"}${2}><span class="trash-icon${0}"${2}></span></button></td>`,Od=p`<div class="empty-state${0}"${2}><h3 class="empty-text${0}"${2}>${"t2"}</h3></div>`,Ld=p`<div class="offline-indicator${0}"${2}><span class="offline-icon${0}"${2}>📴</span><span${3}>You are currently offline. Files will be uploaded when you reconnect.</span></div>`,Nd=p`<div class="error-message${0}"${2}><span class="error-icon${0}"${2}>⚠️</span><span${3}>${"t4"}</span></div>`,Md=p`<div class="pending-files-indicator${0}"${2}><span class="pending-icon${0}"${2}>⏳</span><span${3}>${"t4"}</span></div>`,Pd=p`<div class="file-actions-container${0}"${2}><div class="upload-actions${0}"${2}><button class="action-button${0}" title="Upload Files"${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm0 2.5L18.5 9H14zM8 13h8v2H8zm0 4h8v2H8zm0-8h4v2H8z"${3}/></svg>Upload Files</button><button class="action-button${0}" title="Capture Image"${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M9 2l1.5 2H14l2 2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2h3l2-2zM12 9a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 9zm0 2a3 3 0 1 1-.001 6.001A3 3 0 0 1 12 11z"${3}/></svg>Capture Image</button></div></div>`,jd=p`<div class="modal-header${0}"${2}><button class="close-button${0}" title="Close"${2}><span class="close-icon${0}"${2}>×</span></button><h2 class="modal-title${0}"${2}>File Preview</h2></div>`,Ud=p`<div class="modal-backdrop${0}"${2}></div>`,Vd=p`<div class="modal-overlay${0}"${2}><div class="modal-container${0}"${2}><div class="modal-header${0}"${2}><button class="close-button${0}" title="Close"${2}><span class="close-icon${0}"${2}>×</span></button><h2 class="modal-title${0}"${2}>Delete File</h2></div><div class="modal-content${0}"${2}><p class="modal-message${0}"${2}>Are you sure you want to delete this file?</p></div><div class="modal-footer${0}"${2}><button class="cancel-button${0}"${2}>Cancel</button><button class="delete-button${0}"${2}>Delete</button></div></div></div>`,qd=p`<div class="modal-backdrop${0}"${2}></div>`,zd={classMap:{card:!0},key:0},Wd={classMap:{container:!0},key:1},Bd={classMap:{"file-list-section":!0},key:2},Hd={classMap:{"scrollable-area":!0},key:3},Jd={classMap:{"file-list":!0},key:8},Qd={classMap:{"files-table":!0},key:9},Yd={"file-row":!0},Kd={classMap:{"file-action-cell":!0},key:15},Gd={classMap:{"upload-section":!0},key:22},Xd={classMap:{"modal-overlay":!0,"preview-modal-overlay":!0},key:31},Zd={classMap:{"modal-container":!0,"preview-modal-container":!0},key:32},eh={classMap:{"modal-content":!0,"preview-modal-content":!0},key:35},th={classMap:{"preview-wrapper":!0},key:36},sh={"preview-frame":!0};function Je(n,e,s,t){const{st:o,d:i,sp:a,k:r,ncls:l,b:c,h:d,i:h}=n,{_m0:u,_m1:f,_m2:g,_m3:_,_m4:m,_m5:x,_m6:k,_m7:$,_m8:S}=t;return[d("div",zd,[d("div",Wd,[d("div",Bd,[d("div",Hd,[e.showSpinner?o(Rd,5):null,e.helpTextContent?o(Ad,7,[a(4,null,i(e.helpTextContent))]):null,d("div",Jd,[e.keyList?d("table",Qd,h(e.keyList,function(O,F){return d("tr",{classMap:Yd,key:r(10,O.key)},[o(Id,12,[a(1,{className:l(O.iconClass)},null)]),o(Fd,14,[a(1,{attrs:{title:O.value}},null),a(2,null,i(O.value))]),d("td",Kd,[O.preview?o(Dd,17,[a(0,{on:f||(t._m1={click:c(e.filePreview)}),attrs:{"data-key":O.key}},null)]):null]),e.disableFlag?null:o(Td,19,[a(1,{on:g||(t._m2={click:c(e.handleDeletePopup)}),attrs:{"data-key":O.key}},null)])])})):null,e.getFilesFlag?null:o(Od,21,[a(2,null,i(e.noFilesContent))])]),e.disableFlag?null:d("div",Gd,[e.isOffline?o(Ld,24):null,e.errorMessage?o(Nd,26,[a(4,null,i(e.errorMessage))]):null,e.offlineFiles.length?o(Md,28,[a(4,null,i(e.offlineFiles.length)+" file(s) pending upload")]):null,o(Pd,30,[a(2,{on:_||(t._m3={click:c(e.handleFilePick)})},null),a(6,{on:m||(t._m4={click:c(e.handleCameraCapture)})},null)])])])])])]),e.showFrame?d("div",Xd,[d("div",Zd,[o(jd,34,[a(1,{on:x||(t._m5={click:c(e.handleClosePreview)})},null)]),d("div",eh,[d("div",th,[d("iframe",{classMap:sh,attrs:{src:e.previewUrl,scrolling:"auto"},key:37})])])])]):null,e.showFrame?o(Ud,39):null,e.showDeleteModal?o(Vd,41,[a(3,{on:k||(t._m6={click:c(e.handleCloseDelPopup)})},null),a(12,{on:$||(t._m7={click:c(e.handleCloseDelPopup)})},null),a(14,{on:S||(t._m8={click:c(e.handleDeleteFile)})},null)]):null,e.showDeleteModal?o(qd,43):null]}var oh=J(Je);Je.stylesheets=[],Je.stylesheetToken="lwc-4v422rhmil0",Je.legacyStylesheetToken="c-awsS3Files_awsS3Files",No&&Je.stylesheets.push.apply(Je.stylesheets,No),Q(Je);class Mo extends K{constructor(...e){super(...e);this.recordId=void 0,this.objectApiName=void 0,this.type=void 0,this.formType=void 0,this.acceptedFormats=".png, .jpg, .jpeg, .pdf, .doc, .docx, .xls, .xlsx, .csv",this.disableFlag=!1,this.helpTextContent="",this.noFilesContent="No files to display",this.noPreviewContent="No preview available",this.keyList=[],this.showSpinner=!1,this.showDeleteModal=!1,this.showFrame=!1,this.previewUrl="",this.getFilesFlag=!1,this.selectedFileKey="",this.isOffline=!1,this.offlineFiles=[],this.errorMessage="",this.s3ConfigType=null}async connectedCallback(){this.isOffline=!V(),ho(this.handleConnectivityChange.bind(this)),this.offlineFiles=[];try{const e=await Mt();this.s3ConfigType=e?.Rhythm__customValue__c||null,console.log("\u{1F50D} S3 Configuration type:",this.s3ConfigType)}catch(e){console.error("Error getting S3 configuration:",e)}this.getFiles(),this.loadOfflineFiles(),this.ensureFileUploadSyncAvailable()}ensureFileUploadSyncAvailable(){try{typeof window!="undefined"&&!window.fileUploadSync&&(window.fileUploadSync=G,console.log("\u{1F4C1} File upload sync service made available from awsS3Files")),window.fileUploadSync&&window.fileUploadSync.addEventListener?(window.fileUploadSync.addEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Registered for sync completion events")):G&&G.addEventListener&&(G.addEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Registered for sync completion events from import"))}catch(e){console.error("\u274C Error ensuring file upload sync availability:",e)}}handleSyncComplete(e){console.log("\u2705 Sync completed event received:",e),this.loadOfflineFiles(),V()&&this.getFiles()}disconnectedCallback(){uo(this.handleConnectivityChange.bind(this));try{window.fileUploadSync&&window.fileUploadSync.removeEventListener?(window.fileUploadSync.removeEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Removed sync completion event listener")):G&&G.removeEventListener&&(G.removeEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Removed sync completion event listener from import"))}catch(e){console.error("\u274C Error removing sync event listener:",e)}}renderedCallback(){}handleConnectivityChange(e){this.isOffline=!e,e&&(this.syncOfflineFiles(),this.getFiles())}async syncOfflineFiles(){console.log("\u{1F504} Checking for offline files to sync...");try{window.fileUploadSync?(console.log("\u{1F504} Triggering file upload sync from window..."),await window.fileUploadSync.triggerManualSync()):G?(console.log("\u{1F504} Triggering file upload sync from import..."),await G.triggerManualSync()):console.warn("\u26A0\uFE0F File upload sync service not available"),this.loadOfflineFiles()}catch(e){console.error("\u274C Error syncing offline files:",e)}}async loadOfflineFiles(){try{if(this.recordId){const e=await U.getFileUploadsByRecord(this.objectApiName,this.recordId);console.log("files",JSON.stringify(e)),this.offlineFiles=e.filter(s=>s.upload_status==="pending"),console.log(`\u{1F4F1} Loaded ${this.offlineFiles.length} offline files for record ${this.recordId}`),this.addOfflineFilesToKeyList()}else this.offlineFiles=[],console.log("No recordId available to load offline files")}catch(e){console.error("\u274C Error loading offline files:",e),this.offlineFiles=[]}}addOfflineFilesToKeyList(){this.keyList=this.keyList.filter(s=>!s.isOfflineFile),console.log("this.keyList",JSON.stringify(this.keyList));const e=this.offlineFiles.map(s=>{console.log("file",JSON.stringify(s));const t=s.mime_type.split("/")[1];let o="doctype:unknown",i=!1;return["jpg","jpeg","png","gif"].includes(t)?(o="doctype:image",i=!0):t==="pdf"?(o="doctype:pdf",i=!0):["doc","docx"].includes(t)?o="doctype:word":["xls","xlsx","csv"].includes(t)&&(o="doctype:excel"),{key:s.id,value:s.file_name,webPath:s.file_path,icon:o,iconClass:this.getIconClass(o),preview:i,isOfflineFile:!0,offlineData:s}});e.length>0&&(this.keyList=[...e,...this.keyList],this.getFilesFlag=!0)}getIconClass(e){switch(e){case"doctype:image":return"file-image";case"doctype:pdf":return"file-pdf";case"doctype:word":return"file-doc";case"doctype:excel":return"file-excel";default:return"file-unknown"}}async getLocalS3Files(){try{const e=`aws_s3_list_${this.objectApiName}`,t=(await de(Z.AWS_S3_LIST)).find(o=>o.id===e);return t&&t.records?(console.log(`\u{1F4F1} Retrieved ${t.records.length} cached records for ${this.objectApiName}`),console.log("cachedData records",t.records),t.records):(console.log(`\u{1F4F1} No cached records found for ${this.objectApiName}`),[])}catch(e){return console.error(`Error getting local records for ${this.objectApiName}:`,e),[]}}async getFiles(){this.showSpinner=!0;try{let e=[];if((await X.getStatus())?.connected){if(this.s3ConfigType==="salesforce"){console.log("\u{1F4C1} Using Salesforce standard files");const d=await rs(this.recordId);console.log("salesforceFiles",JSON.stringify(d)),this.type&&this.type.trim()!==""?(console.log("Filtering files by type:",this.type),this.keyList=d.filter(h=>(h.description||h.originalTitle||h.value||"").toLowerCase().includes(this.type.toLowerCase())),console.log("Filtered files:",JSON.stringify(this.keyList))):this.keyList=d,this.getFilesFlag=this.keyList.length>0,this.dispatchEvent(new CustomEvent("filesloaded",{detail:{recordId:this.recordId,objectApiName:this.objectApiName,type:this.type,hasFiles:this.keyList.length>0,fileCount:this.keyList.length},bubbles:!0,composed:!0})),this.showSpinner=!1;return}let l="";const c=await At(this.objectApiName,this.recordId);c&&c.supplierName&&c.supplierName.includes("_Personal_Files")&&(l=`${c.customerName}/${c.objectLabel}/${c.supplierName}`),e=await Ae(l,"list")}else{console.error("Device is offline");const l=await this.getLocalS3Files();console.log("localFiles",JSON.stringify(l)),e=l,this.dispatchEvent(new CustomEvent("filesuploaded",{detail:{recordId:this.recordId,objectApiName:this.objectApiName},bubbles:!0,composed:!0}))}let t=e;try{t=t.replace(/\\"/g,'"');const l=/"ETag":"\\+"([a-f0-9]+)\\+"/g;t=t.replace(l,(c,d)=>`"ETag":"${d}`)}catch(l){console.error("Error cleaning JSON:",l)}const o=JSON.parse(t);let i=o.ListBucketResult.Contents;const a=o.ListBucketResult.KeyCount;let r=[];this.keyList=[],Array.isArray(i)||(i=[i]),a>0&&i&&i.forEach(l=>{let c=l.Key.split("/");if(console.log("checkFile",JSON.stringify(c)),c[c.length-1]!=null&&c[c.length-1]!==""){const d=l.Key;let h=d.substring(d.lastIndexOf("/")+1);if(h.split("_")[0]===this.recordId){let f=h.substring(h.lastIndexOf(".")+1),g=h.split("_").slice(2).join("_"),_=f==="doc"||f==="docx"||f==="xls"||f==="xlsx"?"preview: false":"preview: true";r.push({type:f,preview:_,key:d,url:`${this.endpoint}/${d}`,value:g})}}}),this.keyList=r.reverse(),this.getFilesFlag=this.keyList.length>0,this.dispatchEvent(new CustomEvent("filesloaded",{detail:{recordId:this.recordId,objectApiName:this.objectApiName,type:this.type,hasFiles:this.keyList.length>0,fileCount:this.keyList.length},bubbles:!0,composed:!0})),this.keyList&&this.keyList.length>0&&this.keyList.forEach(l=>{l.icon=l.type==="png"?"doctype:image":l.type==="pdf"?"doctype:pdf":l.type==="jpg"||l.type==="jpeg"?"doctype:image":l.type==="xlsx"||l.type==="xls"?"doctype:excel":l.type==="txt"?"doctype:txt":l.type==="doc"||l.type==="docx"?"doctype:word":"doctype:flash"}),this.showSpinner=!1}catch(e){console.error("Error getting files:",e),this.getFilesFlag=!1,this.keyList=[]}finally{this.showSpinner=!1}}async handleFilePick(){console.log("\u{1F4C1} File picker button clicked");try{console.log("\u{1F680} Calling FilePicker.pickFiles...");const e=await St.pickFiles({multiple:!0,readData:!1});console.log("\u{1F4C4} FilePicker result:",e),e&&e.files&&e.files.length>0?(async t=>{const o=[...t],i=async()=>{if(o.length===0)return;const a=o.shift();console.log("\u{1F4CE} Processing selected file:",a),await this.processSelectedFile(a),await i()};await i()})(e.files):console.log("\u2139\uFE0F No files selected")}catch(e){console.error("\u274C Error picking file:",e)}}async handleCameraCapture(){console.log("\u{1F4F8} Camera capture button clicked");try{console.log("\u{1F680} Launching camera...");const e=await Vt.getPhoto({quality:90,resultType:$t.Uri,source:we.Camera,saveToGallery:!0,allowEditing:!1});if(!e?.webPath){console.error("\u274C Camera did not return webPath:",e);return}console.log("\u{1F4F8} Photo captured successfully:",{webPath:e.webPath,path:e.path,format:e.format}),console.log("\u{1F4F8} Camera webpath",e.webPath),console.log("image",JSON.stringify(e));let s="";if(e.webPath){const o=e.webPath.split("/"),i=o[o.length-1],a=i.split("_");if(a.length>1){const r=a[0],l=new Date().toISOString().replace(/[:.]/g,"-");s=`${r}_${l}.jpg`}else s=i}else s=`JPEG_${new Date().toISOString().replace(/[:.]/g,"-")}.jpg`;console.log("\u{1F4F8} Extracted filename:",s);const t={name:s,webPath:e.webPath,path:e.path,mimeType:"image/jpeg",type:"image/jpeg",size:0,uri:e.webPath};await this.processSelectedFile(t,!0),console.log("\u2705 Camera photo processed and queued for upload")}catch(e){console.error("\u274C Error capturing photo:",e),e.message&&e.message.includes("cancelled")?console.log("Photo capture was cancelled"):console.error("Failed to capture photo:",e.message)}}async filePreview(e){let s;if(e.target.dataset&&e.target.dataset.key?s=e.target.dataset.key:e.target.parentElement&&e.target.parentElement.dataset&&e.target.parentElement.dataset.key&&(s=e.target.parentElement.dataset.key),console.log("key",s),s){this.showSpinner=!0;try{const t=this.keyList.find(o=>o.key===s);if(t&&t.isOfflineFile)console.log("Previewing offline file:",t),t.webPath?t.preview&&["jpg","jpeg","png","gif"].includes(t.value.split(".").pop().toLowerCase())?(this.previewUrl=t.webPath,this.showFrame=!0,document.body&&document.body.classList.add("modal-open")):this.errorMessage="This file type cannot be previewed while offline.":this.errorMessage="Preview not available for this offline file.";else if(t&&t.isSalesforceFile){console.log("Getting ContentDistribution for Salesforce file:",JSON.stringify(t));const o=await Ae(t.key,"salesforce");console.log("contentDistributionData raw:",JSON.stringify(o));let i="";try{if(o.contentDistribution&&o.contentDistribution.DistributionPublicUrl)i=o.contentDistribution.DistributionPublicUrl;else{const a=o.replace(/\\\\/g,"\\").replace(/\\"/g,'"'),r=JSON.parse(a);r.contentDistribution&&r.contentDistribution.DistributionPublicUrl&&(i=r.contentDistribution.DistributionPublicUrl)}}catch(a){console.error("Error parsing contentDistributionData:",a)}this.previewUrl=i,this.showFrame=!0,document.body&&document.body.classList.add("modal-open"),this.showSpinner=!1}else{const o=await this.awsCall(s,"preview");console.log("data in preview",o),o&&(this.previewUrl=o,this.showFrame=!0,document.body&&document.body.classList.add("modal-open"))}}catch(t){console.error("Error loading preview:",t),this.errorMessage="Failed to load preview. Please try again."}finally{this.showSpinner=!1}}else console.error("Preview key is undefined")}handleClosePreview(){this.showFrame=!1,this.previewUrl="",document.body&&document.body.classList.remove("modal-open")}async awsCall(e,s){const t={filePath:e,type:s};try{const i=await(await fetch("https://i3keec7y9j.execute-api.ap-south-1.amazonaws.com/default/preSignedUrl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("data in line 243",JSON.stringify(i)),i}catch(o){return console.error("Error deleting file:",o),null}}handleDownload(e){const s=e.target.dataset.id,t=this.keyList.find(o=>o.key===s);t&&window.open(t.url,"_blank")}handleDeletePopup(e){let s;e.target.dataset&&e.target.dataset.key?(s=e.target.dataset.key,this.selectedFileKey=s):e.target.parentElement&&e.target.parentElement.dataset&&e.target.parentElement.dataset.key&&(s=e.target.parentElement.dataset.key,this.selectedFileKey=s),this.showDeleteModal=!0,console.log("selectedFileKey",this.selectedFileKey)}handleCloseDelPopup(){this.showDeleteModal=!1}async handleDeleteFile(){if(!!this.selectedFileKey){this.showSpinner=!0,this.showDeleteModal=!1;try{if(!(await X.getStatus())?.connected){console.error("Device is offline"),this.showSpinner=!1;return}const s=this.keyList.find(o=>o.key===this.selectedFileKey);console.log("selectedFile",JSON.stringify(s));let t=!1;if(s&&s.isSalesforceFile)console.log("Deleting Salesforce file:",this.selectedFileKey),t=await so(s.key);else{console.log("Deleting S3 file:",this.selectedFileKey);const o=await Ae(this.selectedFileKey,"delete");console.log("S3 delete response:",o),t=!0}t?(this.keyList=this.keyList.filter(o=>o.key!==this.selectedFileKey),this.keyList.length===0&&(this.getFilesFlag=!1),this.previewUrl&&this.previewUrl.includes(this.selectedFileKey)&&(this.previewUrl="",this.showFrame=!1)):this.errorMessage="Failed to delete file. Please try again.",this.selectedFileKey=""}catch(e){console.error("Error deleting file:",e),this.errorMessage="Error deleting file: "+(e.message||"Unknown error")}finally{this.showSpinner=!1}}}async processSelectedFile(e,s=!1){console.log("\u{1F4CB} Processing selected file:",e),console.log("\u{1F4CA} File properties:",{name:e.name,path:e.path,size:e.size,mimeType:e.mimeType,webPath:e.webPath,uri:e.uri,url:e.url}),this.showSpinner=!0,this.errorMessage="";try{const t=e.size||0;console.log("this.type",this.type);let o="";this.type==="post-inspection"?o=`post-inspection ${e.name}`:this.type==="pre-inspection"?o=`pre-inspection ${e.name}`:o=`File uploaded from ${this.objectApiName} (${s?"camera":"file picker"})`;const i={id:Pt(),name:e.name,type:e.mimeType||e.type||(s?"image/jpeg":"application/octet-stream"),size:t,webPath:e.webPath||e.path||e.uri||e.url||"",recordId:this.recordId,formType:this.objectApiName,uploaded:!1,createdDate:new Date().toISOString(),lastModifiedDate:new Date().toISOString(),description:o};if(console.log("\u{1F4BE} Created file record:",JSON.stringify(i)),(await X.getStatus())?.connected){const l=await It(i);if(l.success){const c=i.name.split(".").pop().toLowerCase();let d="doctype:unknown",h=!1;["jpg","jpeg","png","gif"].includes(c)?(d="doctype:image",h=!0):c==="pdf"?(d="doctype:pdf",h=!0):["doc","docx"].includes(c)?d="doctype:word":["xls","xlsx","csv"].includes(c)&&(d="doctype:excel"),console.log("result",JSON.stringify(l));let u;l.contentDocumentId?(u={key:l.contentDocumentId,value:i.name,icon:d,iconClass:this.getIconClass(d),preview:h,isSalesforceFile:!0},await this.getFiles()):(u={key:l.s3Key,value:i.name,url:l.s3Url,icon:d,iconClass:this.getIconClass(d),preview:h},this.keyList=[u,...this.keyList],this.getFilesFlag=!0),this.dispatchEvent(new CustomEvent("filesuploaded",{detail:{recordId:this.recordId,objectApiName:this.objectApiName,fileName:i.name,fileKey:u.key},bubbles:!0,composed:!0}))}else console.error("Error uploading file:",l.error),this.errorMessage=`Failed to upload file: ${l.error||"Unknown error"}`}else await this.saveFileRecord(i),await this.loadOfflineFiles()}catch(t){console.error("Error processing file:",t),this.errorMessage=`Error processing file: ${t.message||"Unknown error"}`}finally{this.showSpinner=!1}}async saveFileRecord(e){try{await U.saveFileWithPath(e),await Ft({id:e.id,type:"UPLOAD_FILE",timestamp:Date.now(),data:e}),console.log("\u{1F4F1} File saved to SQLite queue for later upload:",e)}catch(s){throw console.error("\u274C Error saving file for offline sync:",s),s}}formatFileSize(e){if(e===0)return"0 Bytes";const s=1024,t=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(2))+" "+t[o]}}Y(Mo,{publicProps:{recordId:{config:0},objectApiName:{config:0},type:{config:0}},track:{keyList:1,showSpinner:1,showDeleteModal:1,showFrame:1,previewUrl:1,getFilesFlag:1,selectedFileKey:1,isOffline:1,offlineFiles:1,errorMessage:1,s3ConfigType:1},fields:["formType","acceptedFormats","disableFlag","helpTextContent","noFilesContent","noPreviewContent"]});const zt=z(Mo,{tmpl:oh,sel:"c-aws-s3files",apiVersion:63}),ih=p`<div class="error-container${0}"${2}><div class="error-content${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><p class="error-text${0}"${2}>${"t5"}</p></div><button class="error-dismiss${0}" title="Dismiss error"${2}>×</button></div>`,ah=p`<button type="button" title="Edit Record" class="edit-icon-button${0}"${2}><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"${3}><path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"${3}/></svg></button>`,nh=p`<div${"c0"}${2}>${"t1"}</div>`,rh=p`<abbr class="required-field${0}"${2}>*</abbr>`,lh=p`<button type="button" class="help-button${0}"${"a0:data-field"} title="Show help"${2}>i</button>`,ch=p`<span class="field-display-value${0}"${2}>${"t1"}</span>`,dh=p`<abbr class="required-field${0}"${2}>*</abbr>`,hh=p`<option value${3}>--NONE--</option>`,uh=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,ph=p`<textarea${"a0:name"} class="form-textarea edit-mode-input${0}"${"a0:data-field"}${"a0:placeholder"} rows="3"${2}>${"t1"}</textarea>`,fh=p`<option value${3}>--NONE--</option>`,mh=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,gh=p`<span class="empty-field-readonly${0}"${2}>--</span>`,_h=p`<span class="empty-field${0}"${2}></span>`,bh=p`<div class="section-header contact-section-header${0}"${2}>${"t1"}</div>`,yh=p`<div class="field-label${0}"${2}>${"t1"}</div>`,vh=p`<span class="field-display-value contact-field-value${0}"${2}>${"t1"}</span>`,wh=p`<span class="empty-field${0}"${2}>-</span>`,xh=p`<span class="field-display-value contact-field-value${0}"${2}>${"t1"}</span>`,kh=p`<div class="section-header${0}"${2}>Immediate Correction Analysis</div>`,$h=p`<label class="field-label${0}"${"a0:for"}${2}>${"t1"}</label>`,Ch=p`<span class="empty-field${0}"${2}>--</span>`,Sh=p`<button type="button" class="icon-button plus-button${0}"${"a0:data-index"}${"a0:disabled"} title="Add another correction"${2}>➕</button>`,Eh=p`<button type="button" class="icon-button delete-button${0}"${"a0:data-index"} title="Remove this correction"${2}>🗑️</button>`,Rh=p`<div class="section-header${0}"${2}>${"t1"}</div>`,Ah=p`<button type="button" title="Save Changes" class="save-button${0}"${"a0:disabled"}${2}>Save</button>`,Ih=p`<button type="button" title="Cancel Changes" class="cancel-button${0}"${"a0:disabled"}${2}>Cancel</button>`,Fh=p`<div class="help-modal-overlay${0}"${2}><div class="help-modal${0}"${2}><div class="help-modal-header${0}"${2}><h3${3}>${"t4"}</h3><button type="button" class="help-modal-close${0}"${2}>×</button></div><div class="help-modal-content${0}"${2}><p${3}>${"t9"}</p></div></div></div>`,Dh=p`<div class="message-modal-overlay${0}"${2}><div class="message-modal${0}"${2}><div class="message-modal-header${0}"${2}><h3${3}>${"t4"}</h3><button type="button" class="message-modal-close${0}"${2}>×</button></div><div class="message-modal-content${0}"${2}><p${3}>${"t9"}</p></div><div class="message-modal-footer${0}"${2}><button type="button" class="message-modal-button${0}"${2}>OK</button></div></div></div>`,Th={classMap:{"detail-page-container":!0},key:0},Oh={classMap:{"loading-container":!0},key:1},Lh={props:{alternativeText:"Loading details...",size:"medium"},key:2},Nh={classMap:{"edit-icon-button-container":!0},key:5},Mh={classMap:{"fields-grid":!0},key:12},Ph={classMap:{"field-label":!0},key:14},jh={classMap:{"checkbox-label":!0},key:22},Uh={"form-checkbox":!0},Vh={classMap:{"checkbox-text":!0},key:24},Po={"form-select":!0,"edit-mode-input":!0},Te={"form-input":!0,"edit-mode-input":!0},qh={classMap:{"field-display-value":!0,"readonly-field":!0},key:47},zh={"section-container":!0,"contact-section":!0},Wh={classMap:{"fields-grid":!0},key:55},Bh={"field-container":!0,"contact-field":!0},jo=[],Hh={classMap:{"section-container":!0,"immediate-correction-section":!0},key:66},Jh={classMap:{"immediate-correction-content":!0},key:69},Qh={"immediate-correction-field":!0},Yh={classMap:{"input-with-buttons":!0},key:73},Kh={classMap:{"field-value":!0},key:74},Gh={"form-input":!0,"immediate-correction-input":!0},Xh={classMap:{"field-buttons":!0},key:78},Zh={classMap:{"section-container":!0},key:83},eu={classMap:{"attachment-section-content":!0},key:86},tu={classMap:{"button-container":!0},key:88};function Qe(n,e,s,t){const{c:o,h:i,d:a,b:r,sp:l,st:c,ncls:d,k:h,t:u,i:f,f:g,gid:_}=n,{_m0:m,_m1:x,_m2:k,_m3:$,_m4:S,_m5:O,_m6:F,_m7:D,_m8:v,_m9:A,_m10:w,_m11:y,_m12:C,_m13:I,_m14:L,_m15:N,_m16:T,_m17:q,_m18:te,_m19:pe,_m20:Ne,_m21:fe,_m22:Ce,_m23:_e,_m24:Se,_m25:xe,_m26:Ee,_m27:be,_m28:Re,_m29:ye,_m30:ke,_m31:M,_m32:ve,_m33:E}=t;return[i("div",Th,g([e.loading?i("div",Oh,[o("lightning-spinner",To,Lh)]):null,e.error?c(ih,4,[l(5,null,a(e.error)),l(6,{on:m||(t._m0={click:r(e.dismissError)})},null)]):null,e.loading?jo:g([i("div",Nh,[e.showAlertModal?o("c-alert-modal",Sd,{props:{recordId:e.recordId,objectApiName:e.objectApiName,alertType:e.alertTypeValue,formData:e.formData},key:6,on:x||(t._m1={alertupdated:r(e.handleAlertUpdated),editclicked:r(e.handleEdit)})}):null,e.isEditMode||e.showAlertModal?null:c(ah,8,[l(0,{on:$||(t._m3={click:r(e.handleEdit)})},null)])]),f(e.renderedSections,function(P){return i("div",{className:d(P.containerClass),key:h(9,P.name)},[c(nh,11,[l(0,{className:d(P.headerClass)},null),l(1,null,a(P.name))]),i("div",Mh,f(P.fields,function(b){return b.isVisible?i("div",{className:d(b.containerClass),key:h(13,b.fieldApi)},[i("div",Ph,[u(a(b.label)),b.required?c(rh,16):null,b.helpText?c(lh,18,[l(0,{on:O||(t._m5={click:r(e.handleHelpClick)}),attrs:{"data-field":b.fieldApi}},null)]):null]),i("div",{className:d(b.fieldValueClass),key:19},[b.isCheckbox?e.isEditMode?null:c(ch,21,[l(1,null,a(b.displayValue))]):null,b.isCheckbox&&e.isEditMode?i("label",jh,[i("input",{classMap:Uh,attrs:{type:"checkbox","data-field":b.fieldApi,disabled:e.loading?"":null,"data-value":b.checkedValue},props:{checked:b.checkedValue},key:23,on:F||(t._m6={click:r(e.handleCheckboxChange),change:r(e.handleCheckboxChange)})}),i("span",Vh,[u(a(b.label)),b.required?c(dh,26):null])]):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isSelect?i("select",{classMap:Po,attrs:{name:b.fieldApi,"data-field":b.fieldApi},key:27,on:D||(t._m7={change:r(e.handleFieldChange)})},g([c(hh,29),f(b.options,function(ee){return c(uh,h(31,ee.value),[l(0,{attrs:{value:ee.value,selected:ee.selected?"":null}},null),l(1,null,a(ee.label))])})])):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isTextarea?c(ph,33,[l(0,{on:A||(t._m9={change:r(e.handleFieldChange)}),attrs:{name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.placeholder}},null),l(1,null,a(b.value))]):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isLookup?i("select",{classMap:Po,attrs:{name:b.fieldApi,"data-field":b.fieldApi},key:34,on:w||(t._m10={change:r(e.handleFieldChange)})},g([c(fh,36),f(b.lookupOptions,function(ee){return c(mh,h(38,ee.value),[l(0,{attrs:{value:ee.value,selected:ee.selected?"":null}},null),l(1,null,a(ee.label))])})])):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isText?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.placeholder},props:{value:b.value},key:39,on:y||(t._m11={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isNumber?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.placeholder},props:{value:b.value},key:40,on:C||(t._m12={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isDate?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi},props:{value:b.inputValue},key:41,on:I||(t._m13={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isDateTime?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi},props:{value:b.inputValue},key:42,on:L||(t._m14={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isTime?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi},props:{value:b.inputValue},key:43,on:N||(t._m15={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isEmail?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.placeholder},props:{value:b.value},key:44,on:T||(t._m16={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isPhone?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.placeholder},props:{value:b.value},key:45,on:q||(t._m17={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isUrl?i("input",{classMap:Te,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.placeholder},props:{value:b.value},key:46,on:te||(t._m18={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode?b.isEditable?null:i("span",qh,[b.hasValue?u(a(b.displayValue)):null,b.hasValue?null:c(gh,49)]):null,b.isCheckbox||e.isEditMode?null:b.hasValue?u(a(b.displayValue)):null,b.isCheckbox||e.isEditMode||b.hasValue?null:c(_h,51)])]):null}))])}),e.hasContactFields?f(e.contactSections,function(P){return i("div",{classMap:zh,key:h(52,P.name)},[c(bh,54,[l(1,null,a(P.sectionName))]),i("div",Wh,f(P.fields,function(b){return b.isVisible?i("div",{classMap:Bh,key:h(56,b.fieldApi)},[c(yh,58,[l(1,null,a(b.label))]),i("div",{className:d(b.fieldValueClass),key:59},[b.isBoolean?null:b.hasValue?c(vh,61,[l(1,null,a(b.displayValue))]):null,b.isBoolean||b.hasValue?null:c(wh,63),b.isBoolean?c(xh,65,[l(1,null,a(b.displayValue))]):null])]):null}))])}):jo,e.showImmediateCorrectionSection?i("div",Hh,[c(kh,68),i("div",Jh,f(e.immediateCorrectionFields,function(P){return P.isVisible?i("div",{classMap:Qh,key:h(70,P.fieldApi)},[c($h,72,[l(0,{attrs:{for:_(P.fieldApi)}},null),l(1,null,a(P.label))]),i("div",Yh,[e.isEditMode?null:i("div",Kh,[P.value?u(a(P.value)):null,P.value?null:c(Ch,76)]),e.isEditMode?i("input",{classMap:Gh,attrs:{id:_(P.fieldApi),type:"text","data-field":P.fieldApi,"data-index":P.index,placeholder:P.label},props:{value:P.value},key:77,on:pe||(t._m19={change:r(e.handleImmediateCorrectionChange)})}):null,e.isEditMode?i("div",Xh,[P.canShowPlus?c(Sh,80,[l(0,{on:fe||(t._m21={click:r(e.handleAddImmediateCorrection)}),attrs:{"data-index":P.index,disabled:P.disablePlus?"":null}},null)]):null,P.canShowDelete?c(Eh,82,[l(0,{on:_e||(t._m23={click:r(e.handleRemoveImmediateCorrection)}),attrs:{"data-index":P.index}},null)]):null]):null])]):null}))]):null,e.isAttachment?i("div",Zh,[c(Rh,85,[l(1,null,a(e.attachmentSectionTitle))]),i("div",eu,[o("c-aws-s3-files",zt,{props:{objectApiName:e.objectApiName,recordId:e.recordId,type:"pre-inspection"},key:87})])]):null,i("div",tu,[e.isEditMode?c(Ah,90,[l(0,{on:xe||(t._m25={click:r(e.handleSave)}),attrs:{disabled:e.isSubmitting?"":null}},null)]):null,e.isEditMode?c(Ih,92,[l(0,{on:be||(t._m27={click:r(e.handleCancel)}),attrs:{disabled:e.isSubmitting?"":null}},null)]):null])])])),e.showHelpModal?c(Fh,94,[l(0,{on:ye||(t._m29={click:r(e.closeHelpModal)})},null),l(1,{on:ke||(t._m30={click:r(e.handleModalClick)})},null),l(4,null,"Help: "+a(e.helpFieldLabel)),l(5,{on:M||(t._m31={click:r(e.closeHelpModal)})},null),l(9,null,a(e.helpText))]):null,e.showMessageModal?c(Dh,96,[l(4,null,a(e.messageModalTitle)),l(5,{on:ve||(t._m32={click:r(e.closeMessageModal)})},null),l(9,null,a(e.messageModalText)),l(11,{on:E||(t._m33={click:r(e.closeMessageModal)})},null)]):null]}var su=J(Qe);Qe.stylesheets=[],Qe.stylesheetToken="lwc-2ii5nl4sh8e",Qe.legacyStylesheetToken="c-cpDetailPage_cpDetailPage",Io&&Qe.stylesheets.push.apply(Qe.stylesheets,Io),Q(Qe);class Ye extends K{constructor(...e){super(...e);this.objectApiName=void 0,this.recordId=void 0,this.isAttachment=void 0,this.loading=!0,this.error=void 0,this.isEditMode=!1,this.showSpinner=!1,this.isOfflineData=!1,this.sections=[],this.formData={},this.lookupOptionsMap={},this.devNameToApi={},this.allFieldsMap={},this.controllingFieldsMap={},this.objectSchema={},this.picklistValues={},this.fieldConfigurations=[],this.recordData={},this.dependentPicklistMap={},this.recordTypeId="",this.selectedContractorId=null,this.contactAccountMap={},this.selectedLocationId=null,this.defaultLocationId=null,this.workAreaLocationMap={},this.assetLocationMap={},this.contactLocationMap={},this.originalRecordData={},this.hasUnsavedChanges=!1,this.changedFields={},this.currentUserId=null,this._activeTab=void 0,this.isDetailsTab=void 0,this.contactSections=[],this.contactFormData={},this.hasContactFields=!1,this.showAlertModal=!1,this.alertTypeValue="",this.isSubmitting=!1,this.currentFieldApi=null,this.immediateCorrectionFields=[],this.visibleCorrectionFields=1,this.showImmediateCorrectionSection=!1,this.showMessageModal=!1,this.messageModalTitle="",this.messageModalText="",this.READ_ONLY_FIELDS=["Rhythm__Number_of_Modules_new__c","Rhythm__Water_withdrawal_Yearly_Limit_In_KL__c","Rhythm__Water_Balance__c","Rhythm__Balance_for_Year__c","Rhythm__Daily_Variance__c","Rhythm__Daily_Limit__c","Rhythm__Date_Time_of_Incident__c","Rhythm__DateTimeReportingFormulae__c","Rhythm__location__c","Rhythm__Site__c","Rhythm__Work_Area__c","Rhythm__Asset_Equipment__c","Rhythm__Reported_By__c","Rhythm__Reported_By_F__c","Rhythm__Work_AreaFormulae__c","Rhythm__Location__c","HFE_Training_Session_Name","Rhythm__Total_Attendance_session__c","Rhythm__Man_Hour_Trained__c","Rhythm__Contractor_Account__c"],this.CONDITIONAL_EDITABLE_FIELDS={Rhythm__SubContractor__c:["Rhythm__Contractor__c","Rhythm__Contractor_Account__c"],Rhythm__Sub_Contractor__c:["Rhythm__Contractor__c","Rhythm__Contractor_Account__c"]},this.DISALLOWED_SECTIONS_FOR_INVESTIGATION=[]}set activeTab(e){this._activeTab=e,console.log("log in line 137",this._activeTab),this.fieldConfigurations&&Object.keys(this.fieldConfigurations).length>0&&this.organizeFieldsBySection()}get activeTab(){return this._activeTab}renderedCallback(){this.isSubmitting||(this.recordId&&this._lastRecordId!==this.recordId&&(this._lastRecordId=this.recordId,this.tryLoadData()),X.addListener("networkStatusChange",async()=>{V()}))}connectedCallback(){this.loadCurrentUserId(),this.objectApiName||(this._defaultObjectApiName="Rhythm__Incident__c"),this.picklistValues||(this.picklistValues={}),this.loadCachedPicklistValues(),this.loadDefaultLocation(),this.recordId&&this.tryLoadData(),this.objectApiName==="Rhythm__HFE_Session__c"&&this.READ_ONLY_FIELDS.push("Name"),X.addListener("networkStatusChange",async()=>{V()})}async loadDefaultLocation(){try{console.log("\u{1F3E2} Loading default location for user...");const e=await se.getConnectionForComponent("CpDetailPage");let s=sessionStorage.getItem("sf_user_id");if(s||(s=localStorage.getItem("sf_user_id")),!s){console.warn("\u26A0\uFE0F No user ID found, cannot load default location");return}const t=`
                SELECT Id, ContactId, Email, Rhythm__Default_Location__c, Name
                FROM User
                WHERE Id = '${s}'
                LIMIT 1
            `,o=await e.query(t);console.log("\u{1F3E2} User records:",JSON.stringify(o)),o.records.length>0&&o.records[0].Rhythm__Default_Location__c?(this.userName=o.records[0].Name,this.defaultLocationId=o.records[0].Rhythm__Default_Location__c,console.log("\u{1F3E2} Default location ID loaded:",this.userName,this.defaultLocationId),this.selectedLocationId=this.defaultLocationId,console.log("\u{1F3D7}\uFE0F Setting selectedLocationId for work area filtering:",this.selectedLocationId),Promise.resolve().then(()=>{console.log("\u{1F3D7}\uFE0F Triggering work area and asset loading for default location:",this.defaultLocationId),console.log("\u{1F3D7}\uFE0F Loading work areas for default location:",this.defaultLocationId),this.queryWorkAreaLocationIds(this.defaultLocationId),console.log("\u{1F3D7}\uFE0F Loading assets for default location:",this.defaultLocationId),this.loadAssetsForLocation(this.defaultLocationId)})):console.log("\u{1F3E2} No default location found for user")}catch(e){console.error("\u274C Error loading default location:",e)}}loadCachedPicklistValues(){try{const e=`picklist_values_${this.objectApiName}`,s=sessionStorage.getItem(e);if(s){const t=JSON.parse(s);this.picklistValues={...this.picklistValues,...t}}else console.log(`\u{1F4CB} No cached picklist values found for ${this.objectApiName}`)}catch(e){console.warn("Failed to load cached picklist values from session storage:",e)}}isValidObjectApiName(e){return/^[a-zA-Z0-9_]+__c$/.test(e)}tryLoadData(){if(!this.objectApiName){this.error="Object API name is required",this.loading=!1;return}if(!this.recordId){this.error="Record ID is required",this.loading=!1;return}this.loading&&this.loadFieldConfigurations()}async processCachedMetadata(e,s=null){const t=e.fieldMetadata||[],o=s||this.objectApiName;let i=e.controllingFields||[];try{const _=await H.getCachedControllingFields(o);_&&Array.isArray(_.records)&&_.records.length>0?i=_.records:(!i||i.length===0)&&(i=[])}catch(_){console.warn("\u26A0\uFE0F Error loading controlling fields from cache:",_.message),i=i||[]}this.lookupOptionsMap={...this.lookupOptionsMap||{}},this.picklistValues={},e.objectSchema&&(this.objectSchema=e.objectSchema),Object.keys(this.objectSchema).forEach(_=>{const m=this.objectSchema[_];(m.type==="picklist"||m.type==="multipicklist")&&m.picklistValues&&m.picklistValues.length>0&&(this.picklistValues[_]=m.picklistValues.map(x=>({label:x.label,value:x.value,active:x.active!==!1,defaultValue:x.defaultValue||!1})))}),t.filter(_=>_.Rhythm__is_Mobile__c===!0).forEach(_=>{const m=_.Rhythm__Field_Api_Name__c;if(_._lookupOptions&&_._lookupOptions.length>0&&(this.lookupOptionsMap[m]=_._lookupOptions),_._fieldType==="picklist"||_._fieldType==="multipicklist"){if(_._picklistValues&&_._picklistValues.length>0)this.picklistValues[m]=_._picklistValues;else if(!this.picklistValues[m]){const x=this.objectSchema[m];x&&x.picklistValues&&x.picklistValues.length>0&&(this.picklistValues[m]=x.picklistValues.map(k=>({label:k.label,value:k.value,active:k.active!==!1,defaultValue:k.defaultValue||!1})))}}});try{const _=await H.getMobileLookupOptions(o);Object.keys(_).forEach(m=>{_[m]&&_[m].length>0&&(!this.lookupOptionsMap[m]||this.lookupOptionsMap[m].length===0)&&(this.lookupOptionsMap[m]=_[m])})}catch(_){console.warn("\u26A0\uFE0F Could not load mobile lookup options:",_)}const a="Rhythm__Contractor_Employee_Involved__c";this.lookupOptionsMap[a]&&this.queryContactAccountIds();const r="Rhythm__Work_Area__c";this.lookupOptionsMap[r]&&this.queryWorkAreaLocationIds();const l="Rhythm__Contractor__c",c=this.formData[l];this.allFieldsMap&&this.allFieldsMap[l]&&c&&(this.selectedContractorId=c,this.allFieldsMap&&this.allFieldsMap[a]?(console.log("\u{1F465} Contractor employee field exists, will prepare filtering"),this.queryContactAccountIds()):console.log("\u{1F465} No contractor employee field in form, skipping contact filtering"));const h="Rhythm__Location__c",u="Rhythm__Site__c",f=this.formData[h]||this.formData[u];f&&(this.selectedLocationId=f,console.log("\u{1F3E2} Initialized location dependency with:",this.selectedLocationId));const g={};return console.log(`\u{1F4CB} Converting ${t.length} field metadata records for ${o}...`),t.forEach(_=>{const m=_.Rhythm__Field_Api_Name__c;if(m){const x=this.objectSchema[m];let k=_._fieldType||"TEXT";if(x&&x.type)switch(x.type.toLowerCase()){case"reference":k="REFERENCE";break;case"picklist":k="PICKLIST";break;case"multipicklist":k="MULTIPICKLIST";break;case"boolean":k="BOOLEAN";break;case"date":k="DATE";break;case"datetime":k="DATETIME";break;case"time":k="TIME";break;case"email":k="EMAIL";break;case"phone":k="PHONE";break;case"url":k="URL";break;case"textarea":k="TEXTAREA";break;case"double":case"currency":case"percent":k="NUMBER";break;default:k="TEXT"}g[m]={fieldApi:m,label:_.MasterLabel||_.DeveloperName,fieldType:k,sectionName:_.Rhythm__Section_Name__c||"General Information",required:_.Rhythm__Required__c||!1,isVisible:_.Rhythm__is_Mobile__c===!0,hasValue:!1,displayValue:"",order:_.Rhythm__Order__c||0,isReadOnly:!1,lookupOptions:this.lookupOptionsMap[m]||[],picklistValues:this.picklistValues[m]||[],referenceTo:x?.referenceTo||[],relationshipName:x?.relationshipName}}}),{fieldMetadata:g,fieldMetadataArray:t,controllingFields:i,objectSchema:this.objectSchema}}async loadFieldConfigurations(){this.loading=!0,this.error=null;try{let e,s=!1;try{const t=await H.getMetadata(this.objectApiName);if(t&&t.fieldMetadata&&t.fieldMetadata.length>0){console.log("\u{1F4F1} Using cached metadata first (offline-first approach)");const[o,i,a]=await Promise.all([H.getCachedObjectSchema(this.objectApiName).catch(()=>null),H.getCachedLookupOptions(this.objectApiName).catch(()=>null),H.getCachedControllingFields(this.objectApiName).catch(()=>null)]),r=await this.processCachedMetadataLegacy(t.fieldMetadata,a?.records||[],o||{},i||{});r&&Object.keys(r).length>0&&(e=r,s=!0)}}catch(t){console.warn("\u26A0\uFE0F Failed to check offline field configurations:",t)}if((!e||Object.keys(e).length===0)&&(e=await this.js_getDynamicFieldConfig(this.objectApiName),e&&Object.keys(e).length>0))try{const t=[],o=[];Object.entries(e).forEach(([i,a])=>{Object.values(a).forEach(r=>{t.push({Rhythm__Field_Api_Name__c:r.fieldApi,Rhythm__Section_Name__c:i,DeveloperName:r.developerName,MasterLabel:r.label,Rhythm__Order__c:r.fieldOrder,Rhythm__Required__c:r.required,Rhythm__is_Mobile__c:!0,_fieldType:r.fieldType,_label:r.label,_picklistValues:r.picklistValues||[],_lookupOptions:r.lookupOptions||[]}),r.visibleWhenValues&&Object.keys(r.visibleWhenValues).length>0&&Object.entries(r.visibleWhenValues).forEach(([l,c])=>{o.push({MasterLabel:l,Rhythm__Value__c:c,Rhythm__Fields_Level_Configuration__r:{DeveloperName:r.developerName,Rhythm__Object_Api_Name__c:this.objectApiName}})})})}),await H.cacheFieldMetadata(this.objectApiName,t),await H.cacheControllingFields(this.objectApiName,o)}catch(t){console.warn("\u26A0\uFE0F Failed to store field configurations in SQLite:",t)}if(e&&Object.keys(e).length>0){if(console.log(`Field configurations loaded (${s?"offline":"online"}):`,e),this.objectApiName==="Rhythm__Hazard__c"){const t=await se.getValidConnection(),o=await t.sobject(this.objectApiName).describe();if(console.log("describe.recordTypeInfos in line 678",JSON.stringify(o.recordTypeInfos)),o.recordTypeInfos&&o.recordTypeInfos.length>0){const i=o.recordTypeInfos[0];console.log("defaultRecordType in line 683",JSON.stringify(i)),i&&(this.recordTypeId=i.recordTypeId,console.log(`\u{1F4CB} Found record type ID: ${this.recordTypeId}`),console.log("this.recordTypeId in line 686",this.recordTypeId),await this.fetchDependentPicklistValues(t,this.objectApiName,this.recordTypeId))}}this.fieldConfigurations=e,this.buildDevNameToApi(),this.organizeFieldsBySection(),await this.loadRecordData()}else console.warn(`No field configurations found for ${this.objectApiName}, using standard fields`),await this.loadStandardObjectFields()}catch(e){console.error("Error loading field configurations:",e),this.error=e?.message||"Failed to load field configurations",this.loading=!1,this.scrollToTop()}}async js_getDynamicFieldConfig(e){try{const s=await se.getValidConnection();console.log("Executing field configuration queries for:",e);const[t,o]=await Promise.all([ns(e),Za(e)]);console.log("cfgRecords in line 645",JSON.stringify(t)),console.log("depRecords in line 646",JSON.stringify(o)),console.log("Field configuration query results:",{configCount:t?.length||0,dependencyCount:o?.length||0});const i={};for(const h of o||[]){const u=h.Rhythm__Fields_Level_Configuration__r?.DeveloperName,f=h.MasterLabel,g=h.Rhythm__Value__c;!u||!f||(i[u]||(i[u]={}),i[u][f]=g)}const a=await s.sobject(e).describe(),r={};for(const h of a.fields)r[h.name]=h;if(e==="Rhythm__Hazard__c"&&(console.log("describe.recordTypeInfos in line 678",JSON.stringify(a.recordTypeInfos)),a.recordTypeInfos&&a.recordTypeInfos.length>0)){const h=a.recordTypeInfos[0];console.log("defaultRecordType in line 683",JSON.stringify(h)),h&&(this.recordTypeId=h.recordTypeId,console.log(`\u{1F4CB} Found record type ID: ${this.recordTypeId}`),console.log("this.recordTypeId in line 686",this.recordTypeId),await this.fetchDependentPicklistValues(s,this.objectApiName,this.recordTypeId))}const l={},c={};for(const h of t||[]){if(!h.Rhythm__is_Mobile__c)continue;const u=h.Rhythm__Field_Api_Name__c;if(c[u]){console.log(`\u23ED\uFE0F [cpDetailPage] SKIPPING: Field "${u}" already processed and assigned to section "${c[u]}"`);continue}const f=h.Rhythm__Section_Name__c||"General",g=f.split(",").map(F=>F.trim()).filter(F=>F&&F.length>0);console.log(`\u{1F3F7}\uFE0F [cpDetailPage] Processing field ${u}:`),console.log(`   \u{1F4DD} Raw section: "${f}"`),console.log(`   \u{1F4CB} Split sections: [${g.map(F=>`"${F}"`).join(", ")}]`),console.log(`   \u{1F522} Number of sections: ${g.length}`);let _;if(g.length>=2){const F=g[1];F==="Investigation Details"?(_=g[0],console.log(`   \u26A0\uFE0F  Exception: Second section is "Investigation Details", using FIRST section: "${_}"`)):(_=F,console.log(`   \u2705 Using SECOND section: "${_}"`))}else g.length===1?(_=g[0],console.log(`   \u2705 Only one section, using FIRST section: "${_}"`)):(_="General",console.log(`   \u26A0\uFE0F  No valid sections found, defaulting to: "${_}"`));console.log(`   \u{1F3AF} FINAL TARGET SECTION: "${_}"`),c[u]=_,console.log(`   ${"\u2500".repeat(80)}`),l[_]||(l[_]={});const m=r[u],x=m?String(m.type).toUpperCase():"UNKNOWN";let k=[],$=null,S="";m&&(x==="PICKLIST"&&Array.isArray(m.picklistValues)&&(k=m.picklistValues.filter(function(F){return F.active}).map(function(F){return{value:F.value,label:F.label?F.label:F.value}})),x==="REFERENCE"&&Array.isArray(m.referenceTo)&&m.referenceTo.length>0&&($=m.referenceTo),S=m.defaultValue!==void 0&&m.defaultValue!==null?String(m.defaultValue):"");const O=i[h.DeveloperName]?i[h.DeveloperName]:{};l[_][u]={fieldApi:u,label:h.Label||u,defaultFormula:S,lookupFilterLabel:h.Rhythm__Lookup_Filter_Label__c||"",section:_,required:!!h.Rhythm__Required__c,developerName:h.DeveloperName||u,fieldOrder:Number(h.Rhythm__Order__c||0),fieldType:x,visibleWhenValues:O,picklistValues:k,referenceToObject:$,objectApiName:e}}console.log("\u{1F3AF} [cpDetailPage] SECTION ASSIGNMENT SUMMARY:");const d={};return Object.keys(l).forEach(h=>{const u=Object.keys(l[h]).length;console.log(`   \u{1F4C1} "${h}": ${u} fields`),Object.keys(l[h]).forEach(f=>{d[f]||(d[f]=[]),d[f].push(h)})}),console.log("\u{1F50D} [cpDetailPage] CHECKING FOR DUPLICATE FIELDS:"),Object.keys(d).forEach(h=>{d[h].length>1?console.log(`   \u26A0\uFE0F  DUPLICATE: Field "${h}" appears in multiple sections: [${d[h].join(", ")}]`):console.log(`   \u2705 Field "${h}" appears only in: ${d[h][0]}`)}),console.log(`   \u{1F4CA} Total sections: ${Object.keys(l).length}`),console.log(`${"\u2550".repeat(80)}`),console.log(`Field configurations built for ${e}:`,l),l}catch(s){throw console.error(`Error in js_getDynamicFieldConfig for ${e}:`,s),s}}async processCachedMetadataLegacy(e,s,t,o){try{const i={fieldMetadata:e,controllingFields:s,objectSchema:t};this.lookupOptionsMap=o||{},await this.processCachedMetadata(i);const a=e,r={};return a.filter(l=>l.Rhythm__is_Mobile__c===!0).forEach(l=>{const d=(l.Rhythm__Section_Name__c||"General Information").split(",").map(m=>m.trim()).filter(m=>m),h=l.Rhythm__Field_Api_Name__c,u=t[h],f=l._fieldType||(u?u.type:"TEXT"),g={};s.forEach(m=>{if(m.Rhythm__Fields_Level_Configuration__r?.DeveloperName===l.DeveloperName){const x=m.MasterLabel,k=m.Rhythm__Value__c;g[x]||(g[x]=[]),g[x].push(k)}});let _;if(d.length>=2){const m=d[1];m==="Investigation Details"?_=d[0]:_=m}else d.length===1?_=d[0]:_="General Information";r[_]||(r[_]={}),r[_][h]={fieldApi:h,label:l._label||l.MasterLabel||h,fieldType:(f||"").toUpperCase(),required:l.Rhythm__Required__c||!1,section:_,fieldOrder:l.Rhythm__Order__c||0,developerName:l.DeveloperName||h,visibleWhenValues:g,picklistValues:l._picklistValues||[],lookupOptions:l._lookupOptions||o[h]||[],referenceToObject:u?.referenceTo||[]}}),r}catch(i){return console.error("Error processing cached metadata:",i),null}}buildDevNameToApi(){const e={};this.fieldConfigurations&&Object.values(this.fieldConfigurations).forEach(s=>{Object.values(s).forEach(t=>{t?.developerName&&t?.fieldApi&&(e[t.developerName]=t.fieldApi)})}),this.devNameToApi=e}async loadStandardObjectFields(){try{console.log(`Loading standard fields for ${this.objectApiName}...`);const s=await(await se.getValidConnection()).sobject(this.objectApiName).describe();console.log(`Describe for ${this.objectApiName}:`,s);const t={},o={Information:[],"System Information":[]};s.fields.forEach(i=>{if(i.name==="Id")return;let a="Information";(i.name.startsWith("SystemModstamp")||i.name.startsWith("LastModified")||i.name.startsWith("Created")||i.name==="IsDeleted"||i.name==="OwnerId"||!i.updateable)&&(a="System Information"),o[a].push(i)}),Object.keys(o).forEach(i=>{!o[i].length||(t[i]={},o[i].forEach((a,r)=>{t[i][a.name]={fieldApi:a.name,label:a.label,fieldType:a.type?.toUpperCase(),required:!a.nillable&&a.updateable,section:i,fieldOrder:r+1,picklistValues:a.picklistValues||[],referenceToObject:a.referenceTo||[],defaultFormula:a.defaultValue||"",visibleWhenValues:{},developerName:a.name}}))}),console.log("Standard field configurations created:",t),this.fieldConfigurations=t,this.buildDevNameToApi(),this.organizeFieldsBySection(),await this.loadRecordData()}catch(e){console.error("Failed to load standard object fields:",e),this.showToast("Error",`Failed to load standard fields: ${e.message}`,"error"),this.loading=!1}}organizeFieldsBySection(){console.log("\u{1F504} Organizing fields by section from field configurations:",this.fieldConfigurations),this.sections=[],console.log("log in line 1360",this.activeTab);const e=Ye.BASE_DISALLOWED_SECTIONS,s=Ye.INVESTIGATION_ONLY_SECTIONS;let t=[],o=[];this.activeTab==="Initiation"?o=["Request Information","Permit Types","Stake Holder","Request Status"]:this.activeTab==="Permit Preparation"?(console.log("log in line 1332",JSON.stringify(this.formData)),o=["Toolbox Talk"],this.formData&&this.formData?.Rhythm__Topic__c!==null&&(this.formData?.Rhythm__Show_Hazardous_Atmospheres__c===!0&&(o.push("Equipment provided for Hazardous atmospheres(Confined Space)"),o.push("Precautions Taken for Hazardous Atmospheres(Confined Space)")),this.formData?.Rhythm__Show_Hot_Work__c===!0&&(o.push("Equipment Provided for Hot Work"),o.push("Fire Protection for Hot Work"),o.push("Precautions Taken for Hot Work")),this.formData?.Rhythm__Show_Excavation__c===!0&&o.push("Precautions Taken for Excavation Exceeding"),this.formData?.Rhythm__Show_Height_Work__c===!0&&(o.push("Precautions Taken For Elevated/Height work"),o.push("Equipment Provided for Elevated/Height work")),this.formData?.Rhythm__CraneLiftsCriticalRigging__c===!0&&o.push("Precautions Taken for Crane Lifts & Critical Rigging"),this.formData?.Rhythm__Show_Radiation_Work__c===!0&&o.push("Precautions Taken For Radiation(X-rays)"),this.formData?.Rhythm__PneumaticTesting__c===!0&&o.push("Precautions Taken for Working Around Pressurized or Energized Systems"),this.formData?.Rhythm__Show_Suspended_Basket__c===!0&&o.push("Precautions Taken For Suspended Work Basket/Platform"),this.formData?.Rhythm__Show_Electrical_Work__c===!0&&(o.push("Precautions Taken For Electrical Work"),o.push("Equipment Provided For Electrical Work")),this.formData?.Rhythm__LockoutTagOutLOTO__c===!0&&o.push("Precautions Taken For Lockout/Tagout(LOTO)"),this.formData?.Rhythm__Show_Commissioning_Activities__c===!0&&o.push("Commissioning Activities"),this.formData?.Rhythm__Isolation_Required_New__c===!0&&o.push("Isolation"),console.log("log in line 1403"),o.push("JSA"),o.push("Safety Check & Status")),console.log("Permit Preparation allowed sections:",o)):this.activeTab==="Permit Authorization"?(o=["Permit Approval"],console.log("On Permit Authorization tab, allowing sections:",o)):this.activeTab==="Permit Suspension"?o=["Permit Suspension"]:this.activeTab==="Status"&&this.objectApiName==="Rhythm__Safe_Work_Permit__c"?o=["Status"]:this.activeTab==="Permit Closure"?o=["Permit Closure"]:this.activeTab==="Details"?(this.isDetailsTab=!0,t=[...e,"Case Management",...s]):this.activeTab==="fiveWhys"?(t=[...s],o=["RCA Summary"]):this.activeTab==="Case"?(t=[...e,...s],o=["Case Management"]):t=[...e,"Case Management",...s],console.log("\u{1F50D} Section filtering - disallowedSections:",t),console.log("\u{1F50D} Section filtering - allowedOnlySections:",o),Object.keys(this.fieldConfigurations).forEach(i=>{if(console.log(`\u{1F50D} Evaluating section: ${i}`),i.toLowerCase()==="closure details"){console.log(`\u23ED\uFE0F Skipping closuredetails section: ${i} (hardcoded to be hidden)`);return}if(t.length&&t.includes(i)){console.log(`\u23ED\uFE0F Skipping disallowed section: ${i} (in disallowed list: ${t.join(", ")})`);return}if(o.length>0&&!o.includes(i)){console.log(`\u23ED\uFE0F Skipping section not in allowed sections list: ${i} (allowed: ${o.join(", ")})`);return}console.log(`\u{1F4CB} Processing section: ${i}`);const a=this.fieldConfigurations[i],l=Object.values(a).map(d=>{const h=d.fieldType&&d.fieldType.toUpperCase()==="BOOLEAN",u=JSON.parse(JSON.stringify(d));return u.hasValue=!1,u.displayValue="",u.isBoolean=h,u.booleanValue=!1,u.fieldValueClass=h?"field-value checkbox-field-value":"field-value",u.isVisible=!0,console.log(`\u{1F4CB} Added field to section ${i}: ${d.fieldApi} (${d.label}) - visibility will be set after record data loads`),u});if(l.length===0)return;l.sort((d,h)=>d.fieldOrder-h.fieldOrder);const c=Math.min(...l.map(function(d){return d&&d.fieldOrder?d.fieldOrder:0}));this.sections.push({name:i,fields:l,order:c})}),this.sections.sort((i,a)=>i.order-a.order),this.setStandardSectionClasses()}refreshSections(){this.fieldConfigurations&&Object.keys(this.fieldConfigurations).length>0&&this.organizeFieldsBySection()}get renderedSections(){return this.sections.map(s=>{const t=s.fields.filter(o=>o.isVisible===!0);return t.length>0?{...s,fields:t}:null}).filter(Boolean)}updateFieldVisibility(){this.isSubmitting||(this.sections.forEach(e=>{e.fields.forEach(s=>{const t=this.enhanceFieldForRendering(s);Object.assign(s,t)})}),this.sections=[...this.sections],this.formData={...this.formData})}async refreshFieldsAfterSave(){console.log("\u{1F504} Refreshing all fields after save..."),this.activeTab==="Permit Preparation"&&this.objectApiName==="Rhythm__Safe_Work_Permit__c"&&this.formData&&this.formData.Rhythm__Toolbox_Talk__c&&(this.loading=!0,console.log("\u{1F504} Permit Preparation tab with Toolbox Talk detected, reloading data"),this.tryLoadData(),console.log("\u{1F50D} Checking permitPreparationCheckFields after Toolbox Talk save"),this.refreshSections(),this.loading=!1),this.sections.forEach(e=>{e.fields.forEach(s=>{const t=this.enhanceFieldForRendering(s);Object.assign(s,t),s.isVisible=this.isFieldVisible(s),console.log(`\u{1F504} Refreshed field ${s.fieldApi}: hasValue=${s.hasValue}, isVisible=${s.isVisible}, displayValue="${s.displayValue}"`)})}),this.updateFieldVisibility()}isFieldVisible(e){if(!e.visibleWhenValues||Object.keys(e.visibleWhenValues).length===0)return!0;for(const[s,t]of Object.entries(e.visibleWhenValues)){const o=this.devNameToApi[s];if(!o)return!1;const i=this.formData[o];let a=i;if((o==="Rhythm__Assets__c"||o==="Rhythm__Asset_Equipment__c")&&i){const h=this.formData[`${o}_DisplayName`];if(h)a=h;else{const u=this.allFieldsMap[o];if(u&&u.lookupOptions){const f=u.lookupOptions.find(g=>g.value===i);f&&(a=f.label||f.displayValue||f.Name)}else{const f=this.lookupOptionsMap[o];if(f){const g=f.find(_=>_.value===i);g&&(a=g.label||g.displayValue||g.Name)}}}}const l=this.findFieldByApi(o)?.fieldType||"TEXT",c=Array.isArray(t)?t:t!=null?[t]:[];if(c.length===0)continue;let d=!1;for(const h of c){const u=this.normalizeValue(a,l),f=this.normalizeValue(h,l);if(u===f){d=!0;break}}if(!d)return!1}return!0}findFieldByApi(e){for(const s of this.sections){const t=s.fields.find(o=>o.fieldApi===e);if(t)return t}return null}isFieldReadOnly(e){if(!e)return!1;if(this.READ_ONLY_FIELDS.includes(e))return!0;if(this.CONDITIONAL_EDITABLE_FIELDS[e]){const s=this.CONDITIONAL_EDITABLE_FIELDS[e],t=Array.isArray(s)?s:[s];let o=!1;for(const i of t){const a=this.formData[i];a&&a!==""&&a!==null&&a!==void 0&&(o=!0)}return!o}if(this.objectApiName==="Rhythm__HFE_Session__c"){console.log(`\u{1F50D} Checking field restrictions for HFE Session: ${e}`);const s=this.formData.Rhythm__Training_Category__c==="Scheduled";if(console.log(`\u{1F50D} Training Category is ${s?"Scheduled":"Not Scheduled"}`),s){if(e==="Rhythm__User__c"||e==="Rhythm__Type_of_Training__c")return console.log(`\u{1F512} Field ${e} is read-only (HFE Session with Scheduled category)`),!0}else if(e==="Rhythm__Type_of_Training_m__c")return console.log(`\u{1F512} Field ${e} is read-only (HFE Session with non-Scheduled category)`),!0}return!1}updateFieldDisplayValues(){!this.recordData||Object.keys(this.recordData).length===0||this.error||(this.sections.forEach(e=>{e.fields=e.fields.filter(s=>{let t=this.isFieldVisible(s);if(t)try{if(s.displayValue=this.getFieldDisplayValue(s),s.hasValue=s.displayValue!==void 0&&s.displayValue!==null&&s.displayValue!=="",s.displayValue&&!s.hasValue&&(s.hasValue=!0),s.isEditable=!s.isBoolean,s.isPicklist=s.fieldType==="PICKLIST"&&s.picklistValues,s.isReference=s.fieldType==="REFERENCE",s.isTextarea=s.fieldType==="TEXTAREA",s.isNumeric=["DOUBLE","INTEGER","CURRENCY","PERCENT"].includes(s.fieldType),s.isOtherType=!s.isPicklist&&!s.isReference&&!s.isTextarea||s.isNumeric,s.inputValue=this.getInputValue(s),console.log("log in line 1997",JSON.stringify(this.getInputType(s))),console.log("log in line 1998",JSON.stringify(s)),s.inputType=this.getInputType(s),s.picklistOptions=this.getPicklistOptions(s),s.isReference?s.placeholder=`Search ${s.label}`:s.isPicklist?s.placeholder="--NONE--":s.placeholder=`Enter ${s.label}`,s.isBoolean){const o=this.getFieldValue(s);s.booleanValue=Boolean(o),s.checkedValue=o===!0||o==="true",s.hasValue=!0}}catch(o){console.error(`\u274C Error setting up field ${s.fieldApi}:`,o),s.displayValue="",s.hasValue=!1,s.isEditable=!1,s.isPicklist=!1,s.isReference=!1,s.isTextarea=!1,s.isOtherType=!0,s.inputValue="",s.inputType="text",s.picklistOptions=[],s.placeholder=`Enter ${s.label||"Field"}`}else console.log(`\u23ED\uFE0F Field ${s.fieldApi} is hidden due to controlling field conditions`);return t})}),this.sections=this.sections.filter(e=>e.fields&&e.fields.length>0))}handleFieldChange(e){const s=e.target.dataset.field;let t=e.target.value;if(e.target.type==="datetime-local"&&t&&typeof t=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(t)&&(t=t+":00",console.log(`\u{1F550} Normalized datetime value: ${e.target.value} -> ${t}`)),console.log(`\u{1F504} Field changed: ${s} = ${t}`),this.changedFields={...this.changedFields,[s]:t},this.formData={...this.formData,[s]:t},(s==="Rhythm__Assets__c"||s==="Rhythm__Asset_Equipment__c")&&t){const i=e.target,a=i.options[i.selectedIndex],r=a?a.text:null;r&&(this.formData={...this.formData,[`${s}_DisplayName`]:r},console.log(`\u{1F3D7}\uFE0F Stored asset display name: ${s}_DisplayName = "${r}"`))}this.handleDependentPicklistUpdates(s,t),(s==="Rhythm__Contractor__c"||s==="Rhythm__Contractor_Account__c")&&this.handleContractorChange(t),(s==="Rhythm__Location__c"||s==="Rhythm__Site__c")&&this.handleLocationChange(t),this.updateFieldVisibility(),this.hasUnsavedChanges=!0,this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!0}}))}handleContractorChange(e){console.log("\u{1F3E2} Contractor changed to:",e);const s="Rhythm__Contractor_Employee_Involved__c",t=this.allFieldsMap&&this.allFieldsMap[s];t?(console.log("\u{1F465} Contractor employee field exists in form, clearing it"),this.formData={...this.formData,[s]:""},this.changedFields={...this.changedFields,[s]:""}):console.log("\u{1F465} Contractor employee field does not exist in this form, skipping"),this.selectedContractorId=e,t&&e?(this.updateFieldVisibility(),console.log("\u{1F504} Contractor employee field cleared and options will be filtered"),this.loadContractorEmployeesAsync(e)):console.log("\u{1F504} No contractor employee field to filter, contractor selection complete")}async queryContractorEmployees(e){try{console.log(`\u{1F465} Querying contractor employees for contractor: ${e}`);const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("CpDetailPage"),o=this.selectedLocationId,i=!!o;console.log(`\u{1F465} Using location filter: ${i?o:"No location selected"}`);const a=`
                SELECT Id, Name, RecordType.Name, Rhythm__Loc__r.Name, Account.Name
                FROM Contact 
                WHERE RecordType.Name = 'Contractor Employee'
                AND AccountId = '${e}'
                ${i?`AND Rhythm__Loc__c = '${o}'`:""}
                AND IsDeleted = false
                ORDER BY Name
                LIMIT 1000
            `;console.log("\u{1F465} Executing enhanced contractor employee query:",a);const r=await t.query(a);return console.log(`\u{1F465} Found ${r.records.length} contractor employees matching criteria`),r.records.map(c=>({label:c.Rhythm__Loc__r?.Name?`${c.Name} (${c.Rhythm__Loc__r.Name})`:c.Name,value:c.Id,accountName:c.Account?.Name,locationName:c.Rhythm__Loc__r?.Name,recordTypeName:c.RecordType?.Name}))}catch(s){return console.error("\u274C Error querying contractor employees:",s),[]}}async loadContractorEmployeesAsync(e){try{const s=this.selectedLocationId||"",t=await this.queryContractorEmployees(e),o=`contractor_${e}_location_${s}`;this.lookupOptionsMap[o]=t,console.log(`\u{1F465} Cached ${t.length} contractor employees for contractor ${e} and location ${s||"any"}`),this.updateFieldVisibility()}catch(s){console.error("\u274C Error loading contractor employees asynchronously:",s)}}async queryContactAccountIds(){try{console.log("\u{1F4DE} Querying contact AccountIds for contractor filtering...");const e="Rhythm__Contractor_Employee_Involved__c",s=this.lookupOptionsMap[e]||[];if(s.length===0){console.log("\u{1F4DE} No contractor employee options available to query");return}const t=s.map(r=>r.value||r.Id).filter(r=>r&&!this.contactAccountMap[r]);if(t.length===0){console.log("\u{1F4DE} All contact AccountIds already cached");return}console.log(`\u{1F4DE} Querying AccountId for ${t.length} contacts`);const o=await se.getConnectionForComponent("CpDetailPage"),i=`
                SELECT Id, AccountId 
                FROM Contact 
                WHERE Id IN ('${t.join("','")}')
            `;console.log("\u{1F4DE} Executing contact query:",i);const a=await o.query(i);a.records.forEach(r=>{this.contactAccountMap[r.Id]=r.AccountId}),console.log(`\u{1F4DE} Cached AccountId for ${a.records.length} contacts`)}catch(e){console.error("\u274C Error querying contact AccountIds:",e)}}handleLocationChange(e){console.log("\u{1F3E2} Location changed to:",e);const s={...this.formData,Rhythm__Work_Area__c:""};this.allFieldsMap&&this.allFieldsMap.Rhythm__Name_of_Person_Injured__c&&(s.Rhythm__Name_of_Person_Injured__c=""),this.allFieldsMap&&this.allFieldsMap.Rhythm__Employee_Individual_Involved__c&&this.objectApiName!=="Rhythm__Incident_Injury__c"&&(s.Rhythm__Employee_Individual_Involved__c=""),this.objectApiName==="Rhythm__Hazard__c"?(s.Rhythm__Assets__c="",console.log("\u{1F504} Cleared Rhythm__Assets__c for Hazard object")):this.objectApiName==="Rhythm__Incident_Injury__c"&&(s.Rhythm__Asset_Equipment__c="",console.log("\u{1F504} Cleared Rhythm__Asset_Equipment__c for Incident object")),this.formData=s;const t={...this.changedFields,Rhythm__Work_Area__c:""};this.objectApiName==="Rhythm__Hazard__c"?t.Rhythm__Assets__c="":this.objectApiName==="Rhythm__Incident_Injury__c"&&(t.Rhythm__Asset_Equipment__c=""),this.changedFields=t,this.selectedLocationId=e,this.updateFieldVisibility(),console.log("\u{1F504} Work area and asset fields cleared and options will be filtered"),this.queryWorkAreaLocationIds(),this.loadAssetsForLocation(e),this.queryContactLocationIds()}async loadAssetsForLocation(e){try{if(console.log("\u{1F3D7}\uFE0F Loading assets for location:",e),!e&&(e=this.selectedLocationId,console.log(`\u{1F3D7}\uFE0F No locationId provided, using ${e?"selected location: "+e:"no location"}`),!e)){console.log("\u{1F3D7}\uFE0F No location available, clearing asset options"),this.populateAssetFields([]);return}const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("cpDetailPage"),o=`SELECT Id, Rhythm__Asset_Name__c FROM Rhythm__CustomAsset__c WHERE Rhythm__Location__c = '${e}' AND IsDeleted = false ORDER BY Rhythm__Asset_Name__c LIMIT 1000`;console.log("\u{1F50D} Executing location-specific asset query:",o);const i=await t.query(o);console.log(`\u2705 Found ${i.records.length} assets for location ${e}`);const a=i.records.map(r=>({label:r.Rhythm__Asset_Name__c||r.Id,value:r.Id,displayValue:r.Rhythm__Asset_Name__c||r.Id}));this.populateAssetFields(a)}catch(s){console.error("\u274C Error loading assets for location:",s),this.populateAssetFields([])}}populateAssetFields(e){console.log("\u{1F504} Populating asset fields with",e.length,"options");const s=this.objectApiName==="Rhythm__Hazard__c"?"Rhythm__Assets__c":"Rhythm__Asset_Equipment__c";this.lookupOptionsMap[s]!==void 0?(this.lookupOptionsMap[s]=e,console.log(`\u2705 Populated ${s} with ${e.length} asset options for ${this.objectApiName}`)):console.log(`\u2139\uFE0F Asset field ${s} not found in lookup options for ${this.objectApiName}, skipping population`),this.updateFieldVisibility(),console.log("\u{1F504} Asset fields populated and UI updated")}async queryContactLocationIds(){try{console.log("\u{1F465} Querying contact LocationIds/SiteIds for contact filtering...");const e=["Rhythm__Employee_Individual_Involved__c","Rhythm__Name_of_Person_Injured__c"];let s=[];e.forEach(d=>{const h=this.lookupOptionsMap[d]||[];s=s.concat(h)});const t=s.filter((d,h,u)=>h===u.findIndex(f=>(f.value||f.Id)===(d.value||d.Id)));if(t.length===0){console.log("\u{1F465} No contact options available to query");return}const o=t.map(d=>d.value||d.Id).filter(d=>d&&!this.contactLocationMap[d]);if(o.length===0){console.log("\u{1F465} All contact LocationIds already cached");return}const a=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("cpDetailPage"),l=`
                SELECT Id, Rhythm__Loc__c, Rhythm__Site__c 
                FROM Contact
                WHERE Id IN (${o.map(d=>`'${d}'`).join(",")}) 
                AND IsDeleted = false
            `;console.log("\u{1F465} Executing contact query:",l);const c=await a.query(l);console.log("\u{1F465} Contact query result:",JSON.stringify(c)),c.records.forEach(d=>{this.contactLocationMap[d.Id]={locationId:d.Rhythm__Loc__c,siteId:d.Rhythm__Site__c}}),console.log(`\u{1F465} Cached Location/Site IDs for ${c.records.length} contacts:`,JSON.stringify(this.contactLocationMap)),this.updateFieldVisibility()}catch(e){console.error("\u274C Error querying contact Location/Site IDs:",e)}}async queryWorkAreaLocationIds(e){try{if(!e&&(e=this.selectedLocationId||this.defaultLocationId,console.log(`\u{1F3D7}\uFE0F No locationId provided, using ${e?"selected/default location: "+e:"no location"}`),!e)){console.log("\u{1F3D7}\uFE0F No location available to query work areas");return}const s="Rhythm__Work_Area__c",t=this.lookupOptionsMap[s]||[];if(t.length===0||t.map(c=>c.value||c.Id).filter(c=>c&&!this.workAreaLocationMap[c]).length===0)return;const a=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("CpDetailPage");console.log(`\u{1F3D7}\uFE0F Querying work areas for location: ${e}`);const r=`
                SELECT Rhythm__Organization_Component__c,Rhythm__Location__c FROM Rhythm__Location_OrgComp_Map__c
                WHERE Rhythm__location__c = '${e}' AND Rhythm__Classification_Type__c = 'Work Area'
                AND Rhythm__Status__c = 'Active'
            `;(await a.query(r)).records.forEach(c=>{this.workAreaLocationMap[c.Rhythm__Organization_Component__c]=c.Rhythm__Location__c}),this.refreshWorkAreaCacheInBackground()}catch(s){console.error("\u274C Error querying work area LocationIds:",s)}}async refreshWorkAreaCacheInBackground(){try{console.log("\u{1F504} Background: Refreshing work area cache...");const e="Rhythm__Work_Area__c",s=this.lookupOptionsMap[e]||[];if(s.length===0){console.log("\u{1F504} Background: No work area options to refresh");return}const t=s.map(d=>d.value||d.Id).filter(d=>d);if(t.length===0){console.log("\u{1F504} Background: No valid work area IDs found");return}const i=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("CpDetailPage"),r=`
                SELECT Rhythm__Organization_Component__c,Rhythm__Location__c FROM Rhythm__Location_OrgComp_Map__c
                WHERE Rhythm__Organization_Component__c IN (${t.map(d=>`'${d}'`).join(",")}) 
                AND Rhythm__Classification_Type__c = 'Work Area'
                AND Rhythm__Status__c = 'Active'
            `;console.log("\u{1F504} Background: Executing work area cache refresh query");const l=await i.query(r),c={};l.records.forEach(d=>{c[d.Rhythm__Organization_Component__c]=d.Rhythm__Location__c}),this.workAreaLocationMap=c,console.log(`\u{1F504} Background: Refreshed work area cache with ${l.records.length} entries:`,JSON.stringify(this.workAreaLocationMap))}catch(e){console.error("\u274C Background: Error refreshing work area cache:",e)}}handleCheckboxChange(e){const s=e.target.dataset.field,t=e.target.checked;console.log(`Checkbox ${s} changed: ${t}`);const o=Boolean(t);this.changedFields={...this.changedFields,[s]:o},this.formData={...this.formData,[s]:o},this.sections=[...this.sections],this.updateFieldVisibility();const i=e.target;i&&(i.checked=o,this.template.querySelectorAll(`[data-field="${s}"]`).forEach(a=>{a!==i&&(a.checked=o)})),this.forceRerender(),this.hasUnsavedChanges=!0,this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!0}}))}async queryContractorsForLocation(e){try{console.log(`\u{1F3E2} Querying contractors for location: ${e}`);const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("CpDetailPage"),o=`
                SELECT id, Rhythm__Supplier_Name_2__c, Rhythm__Location_Association__r.name 
                FROM Rhythm__LocationSupplierAssociation__c
                WHERE Rhythm__Location_Association__c = '${e}'
                AND IsDeleted = false
                ORDER BY Rhythm__Supplier_Name_2__c
                LIMIT 1000
            `;console.log("\u{1F3E2} Executing contractor location query:",o);const i=await t.query(o);return console.log(`\u{1F3E2} Found ${i.records.length} contractors for location ${e}`),i.records.map(r=>({label:r.Rhythm__Supplier_Name_2__c||r.Rhythm__Location_Association__r?.name||r.Id,value:r.Id}))}catch(s){return console.error("\u274C Error querying contractors for location:",s),[]}}async loadContractorsForLocationAsync(e){try{const s=await this.queryContractorsForLocation(e),t=`contractor_location_${e}`;this.lookupOptionsMap[t]=s,console.log(`\u{1F3E2} Cached ${s.length} contractors for location ${e}`),this.updateFieldVisibility()}catch(s){console.error("\u274C Error loading contractors for location asynchronously:",s)}}async queryEmployeeContacts(e){try{console.log(`\u{1F465} Querying employee contacts for location: ${e}`);const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("CpDetailPage"),o=`
                SELECT Id, Name 
                FROM Contact 
                WHERE RecordType.Name = 'Employee'
                AND Rhythm__Loc__c = '${e}'
                AND IsDeleted = false
                ORDER BY Name
                LIMIT 1000
            `;console.log("\u{1F465} Executing employee query:",o);const i=await t.query(o);return console.log(`\u{1F465} Found ${i.records.length} employee contacts for location ${e}`),i.records.map(r=>({label:r.Name,value:r.Id}))}catch(s){return console.error("\u274C Error querying employee contacts:",s),[]}}async loadEmployeeContactsAsync(e){try{const s=await this.queryEmployeeContacts(e),t=`employee_${e}`;this.lookupOptionsMap[t]=s,console.log(`\u{1F465} Cached ${s.length} employee contacts for location ${e}`),this.updateFieldVisibility()}catch(s){console.error("\u274C Error loading employee contacts asynchronously:",s)}}forceRerender(){this.template.querySelectorAll(".section-container, .field-container").forEach(e=>{e.classList.add("force-update"),requestAnimationFrame(()=>{e.classList.remove("force-update")})})}handlePicklistChange(e){const s=e.target.dataset.field,t=e.target.value;console.log(`\u{1F504} Picklist ${s} changed: ${t}`),this.formData={...this.formData,[s]:t},this.updateFieldVisibility()}handleReferenceChange(e){const s=e.target.dataset.field,t=e.target.value;console.log(`\u{1F504} Reference ${s} changed: ${t}`),this.formData={...this.formData,[s]:t},this.updateFieldVisibility()}updateFieldDisplay(e,s){for(const t of this.sections){const o=t.fields.findIndex(i=>i.fieldApi===e);if(o>=0){const i=t.fields[o];if(i.value=s,i.hasValue=s!=null&&s!=="",i.isBoolean)i.booleanValue=Boolean(s),i.checkedValue=s===!0||s==="true",i.displayValue=i.booleanValue?"Yes":"No";else if(i.isPicklist){const a=i.picklistOptions.find(r=>r.value===s);i.displayValue=a?a.label:s||""}else i.displayValue=this.formatDisplayValue(s,i.fieldType);console.log(`\u2705 Updated field display for ${e}: ${i.displayValue}`),t.fields=[...t.fields];break}}}getInputType(e){console.log("log in line 2773",JSON.stringify(e));const s=e.fieldType?e.fieldType:"",t=e.fieldApi||"";return console.log("log in line 2777",JSON.stringify(e.fieldType.toLowerCase())),console.log("log in line 2805",s),s.toLowerCase().includes("datetime")?"datetime-local":t.toLowerCase().includes("date")&&!t.toLowerCase().includes("datetime")?"date":t.toLowerCase().includes("time")&&!t.toLowerCase().includes("datetime")?"time":{date:"date",datetime:"datetime-local",time:"time",email:"email",phone:"tel",url:"url",double:"number",integer:"number",currency:"number",percent:"number"}[s]||(e.isNumeric?"number":"text")}getPicklistOptions(e){let s=[];if(this.dependentPicklistMap&&this.dependentPicklistMap[e.fieldApi]){const t=this.dependentPicklistMap[e.fieldApi],o=t.controllingField,i=this.formData[o];if(i&&t.valueMap[i])return s=t.valueMap[i],s.filter(a=>a&&a.active!==!1).map(a=>({label:a.label||a.value||String(a),value:a.value||a.label||String(a)}))}return this.picklistValues&&this.picklistValues[e.fieldApi]&&Array.isArray(this.picklistValues[e.fieldApi])&&this.picklistValues[e.fieldApi].length>0?s=this.picklistValues[e.fieldApi]:e.picklistValues&&Array.isArray(e.picklistValues)&&e.picklistValues.length>0?s=e.picklistValues:e._picklistValues&&Array.isArray(e._picklistValues)&&e._picklistValues.length>0?s=e._picklistValues:e.picklistOptions&&Array.isArray(e.picklistOptions)&&e.picklistOptions.length>0&&(s=e.picklistOptions),s.filter(t=>t&&t.active!==!1).map(t=>({label:t.label||t.value||String(t),value:t.value||t.label||String(t)}))}getLookupOptions(e){let s=[];this.lookupOptionsMap&&this.lookupOptionsMap[e.fieldApi]&&Array.isArray(this.lookupOptionsMap[e.fieldApi])&&this.lookupOptionsMap[e.fieldApi].length>0?s=this.lookupOptionsMap[e.fieldApi]:e.lookupOptions&&Array.isArray(e.lookupOptions)&&e.lookupOptions.length>0?s=e.lookupOptions:e._lookupOptions&&Array.isArray(e._lookupOptions)&&e._lookupOptions.length>0?s=e._lookupOptions:e.referenceToObject&&Array.isArray(e.referenceToObject)&&e.referenceToObject.length>0;const t=this.formData[e.fieldApi]||this.recordData[e.fieldApi],o=s.map(i=>{const a=i.value||i.Id;return{label:i.label||i.displayValue||i.Name||i.value||"Unknown",value:a,selected:a===t}}).filter(i=>i.value);if((e.fieldApi==="Rhythm__Contractor__c"||e.fieldApi==="Rhythm__Contractor_Account__c")&&(console.log(`\u{1F3E2} Processing contractor field ${e.fieldApi}`),this.selectedLocationId)){const i=`contractor_location_${this.selectedLocationId}`;return this.lookupOptionsMap[i]?(console.log(`\u{1F3E2} Using cached contractors for location: ${this.selectedLocationId}`),this.lookupOptionsMap[i]):(console.log(`\u{1F3E2} Loading contractors for location: ${this.selectedLocationId}`),this.loadContractorsForLocationAsync(this.selectedLocationId),o)}if(e.fieldApi==="Rhythm__Contractor_Employee_Involved__c"){if(!this.allFieldsMap||!this.allFieldsMap[e.fieldApi])return[];if(this.selectedContractorId){const i=this.selectedLocationId||"",a=`contractor_${this.selectedContractorId}_location_${i}`;return this.lookupOptionsMap[a]?(console.log(`\u{1F465} Using cached contractor employees for contractor: ${this.selectedContractorId} and location: ${i||"any"}`),this.lookupOptionsMap[a]):(console.log(`\u{1F465} Loading contractor employees for contractor: ${this.selectedContractorId} and location: ${i||"any"}`),this.loadContractorEmployeesAsync(this.selectedContractorId),[])}return[]}if(e.fieldApi==="Rhythm__Work_Area__c")return this.selectedLocationId?o.filter(a=>{const r=a.value;return this.workAreaLocationMap[r]===this.selectedLocationId}):[];if(e.fieldApi==="Rhythm__Employee_Individual_Involved__c"&&this.objectApiName!=="Rhythm__Incident_Injury__c"||e.fieldApi==="Rhythm__Name_of_Person_Injured__c"){if(console.log(`\u{1F465} Processing employee contact field ${e.fieldApi}`),this.selectedLocationId){const i=`employee_${this.selectedLocationId}`;return this.lookupOptionsMap[i]?(console.log(`\u{1F465} Using cached employee contacts for location: ${this.selectedLocationId}`),this.lookupOptionsMap[i]):(console.log(`\u{1F465} Loading employee contacts for location: ${this.selectedLocationId}`),this.loadEmployeeContactsAsync(this.selectedLocationId),[])}return console.log("\u{1F465} No location selected, showing empty employee contact list"),[]}return o}getInputValue(e){const s=e?.fieldApi;if(!s)return"";const t=this.formData?.[s]??this.recordData?.[s]??"";if(t==null||t==="")return"";const o=String(e.fieldType||"").toUpperCase();if(o==="DATE")try{const i=new Date(t);if(!isNaN(i.getTime()))return i.toISOString().substring(0,10)}catch(i){console.warn(`Failed to format date value: ${t}`,i)}else if(o==="DATETIME")try{const i=new Date(t);if(!isNaN(i.getTime()))return i.toISOString().substring(0,16)}catch(i){console.warn(`Failed to format datetime value: ${t}`,i)}else if(o==="TIME")try{if(typeof t=="number")return new Date(0,0,0,0,0,0,t).toISOString().substring(11,16);if(typeof t=="string"){if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(t)){const a=t.split(":"),r=a[0].padStart(2,"0"),l=a[1];return`${r}:${l}`}const i=new Date(t);if(!isNaN(i.getTime()))return i.toISOString().substring(11,16)}return t}catch(i){return console.warn(`Failed to format time value: ${t}`,i),t}return String(t)}async js_getRecordData({objectApiName:e,recordId:s,fieldApiNames:t}){console.log(`\u{1F50D} Getting record data for ${e}:${s} with fields:`,t);try{let o;e==="Task"?o=new Set(["Id"]):o=new Set(["Id","Name"]);for(const d of t||[])!d||o.add(d);const i=Array.from(o),r={records:await is(e,s,i)};if(!r.records||r.records.length===0)throw new Error("Record not found");let l;if(Array.isArray(r.records)&&r.records.length>0?l=r.records[0]:(r.records&&typeof r.records=="object"||r.totalSize===1&&r.records||r.records&&Object.keys(r.records).length>0)&&(l=r.records),!l)throw new Error("Could not extract record data");const c={};l.Id&&(c.Id=l.Id);for(const d of Object.keys(l)){if(d==="attributes"||d==="Id")continue;const h=l[d];if(h&&typeof h=="object"&&"attributes"in h){"Name"in h&&(c[`${d}.Name`]=h.Name),"Id"in h&&(c[d]=h.Id);for(const u of Object.keys(h))u!=="attributes"&&u!=="Id"&&u!=="Name"&&(c[`${d}.${u}`]=h[u])}else c[d]=h}return!c.Id&&l.Id&&(c.Id=l.Id),c}catch(o){throw console.error("Error in js_getRecordData:",o),o}}escapeSOQL(e){return e==null?"":String(e).replace(/'/g,"\\'")}escapeId(e){return e?String(e).replace(/[^a-zA-Z0-9]/g,""):""}escapeSOQLIdentifier(e){return e?String(e).replace(/[^a-zA-Z0-9_.]/g,""):""}async loadRecordData(){if(!this.recordId){this.error="Record ID is required",this.loading=!1;return}const e=this.sections.flatMap(t=>t.fields.map(o=>o.fieldApi));let s=["CreatedById","LastModifiedById"];if(this.objectApiName!=="Rhythm__Permit_Extension__c"&&s.push("OwnerId"),s.forEach(t=>{e.includes(t)||e.push(t)}),this.objectApiName==="Rhythm__Incident_Injury__c"){console.log("\u2705 Adding Immediate Correction fields to query for Incident Injury object");let t=0;for(let o=1;o<=7;o++){const i=`Rhythm__Immediate_Correction_${o}__c`;e.includes(i)?console.log(`   \u2139\uFE0F  ${i} already in query`):(e.push(i),t++,console.log(`   \u2795 Added ${i} to query`))}console.log(`\u2705 Total Immediate Correction fields added to query: ${t}/7`)}this.objectApiName==="Rhythm__Safe_Work_Permit__c"&&this.activeTab==="Permit Preparation"&&["Rhythm__Show_Hazardous_Atmospheres__c","Rhythm__Show_Suspended_Basket__c","Rhythm__Show_Hot_Work__c","Rhythm__PneumaticTesting__c","Rhythm__Show_Excavation__c","Rhythm__Show_Electrical_Work__c","Rhythm__Show_Height_Work__c","Rhythm__LockoutTagOutLOTO__c","Rhythm__CraneLiftsCriticalRigging__c","Rhythm__Show_Commissioning_Activities__c","Rhythm__Show_Radiation_Work__c"].forEach(o=>{e.includes(o)||e.push(o)});try{let t,o=!1;if(await V()){console.log("log in line 3329",JSON.stringify(e));try{t=await this.js_getRecordData({objectApiName:this.objectApiName,recordId:this.recordId,fieldApiNames:e,contactFieldApiNames:[]})}catch(a){if(t=await this.tryOfflineFallback(),t)o=!0;else throw new Error("Unable to fetch data from Salesforce and no cached data available")}}else if(t=await this.tryOfflineFallback(),t)o=!0;else throw new Error("No cached data available for offline access");this.isOfflineData=o,this.recordData=t,this.formData={...t},this.ensureReferenceFieldIds();const i=this.formData.Rhythm__Location__c||this.formData.Rhythm__Site__c;if(i&&(this.selectedLocationId=i,Promise.resolve().then(()=>{this.lookupOptionsMap.Rhythm__Work_Area__c&&this.queryWorkAreaLocationIds()})),this.originalRecordData={...t},this.prepareFieldsForDisplay(),this.initializeImmediateCorrectionFields(),this.objectApiName==="Rhythm__Safe_Work_Permit__c"){console.log("Processing Safe Work Permit record with activeTab:",this.activeTab);const a=JSON.parse(JSON.stringify(this.sections));console.log("log in line 3485",JSON.stringify(this.sections)),this.activeTab==="Permit Preparation"&&(console.log("On Permit Preparation tab - ensuring conditional sections exist"),["Toolbox Talk","JSA","Safety Check & Status","Isolation","Equipment provided for Hazardous atmospheres(Confined Space)","Precautions Taken for Hazardous Atmospheres(Confined Space)","Equipment Provided for Hot Work","Fire Protection for Hot Work","Precautions Taken for Hot Work","Precautions Taken for Excavation Exceeding","Precautions Taken For Elevated/Height work","Equipment Provided for Elevated/Height work","Precautions Taken for Crane Lifts & Critical Rigging","Precautions Taken For Radiation(X-rays)","Precautions Taken for Working Around Pressurized or Energized Systems","Precautions Taken For Suspended Work Basket/Platform","Precautions Taken For Electrical Work","Equipment Provided For Electrical Work","Precautions Taken For Lockout/Tagout(LOTO)","Commissioning Activities"].forEach(l=>{this.fieldConfigurations[l]||(console.log(`Creating empty section: ${l}`),this.fieldConfigurations[l]={})})),this.organizeFieldsBySection(),this.restoreFieldValues(a),console.log("Sections after reorganization:",this.sections.map(r=>r.name)),this.updateFieldVisibility()}await this.checkAndLoadContactFields(),this.loading=!1}catch(t){console.error("\u274C Error loading record data:",t),this.error=t?.message||"Failed to load record data",console.error("Error:",this.error),this.loading=!1}}prepopulateFormDataFromRecord(){!this.recordData||Object.keys(this.recordData).forEach(e=>{this.formData[e]===void 0&&this.recordData[e]!==void 0&&(this.formData[e]=this.recordData[e])})}prepareFieldsForDisplay(){!this.sections||this.sections.length===0||(this.prepopulateFormDataFromRecord(),this.objectApiName!=="Rhythm__Alert_Relation__c"&&(this.showAlertModal=!1),this.sections.forEach(e=>{e.fields.forEach(s=>{if(s.developerName!=="Alert_Type")this.currentFieldApi=s.fieldApi,this.prepareFieldForDisplay(s);else{const t=this.formData[s.fieldApi];this.alertTypeValue=t,this.showAlertModal=!0}})}),this.updateFieldVisibility())}async tryOfflineFallback(){console.log("\u{1F50D} Trying offline fallback strategies...");try{const e=await de(Z.LIST_VIEW_RECORDS);console.log(`\u{1F4E6} Found ${e.length} cached records in storage`);const s=`records_${this.objectApiName}`,t=e.find(o=>o.id===s);if(t){const o=t.records||t.data;if(o&&Array.isArray(o)){console.log(`\u{1F50D} Strategy 1: Searching in leftMenu cache (${o.length} records) with pattern: ${s}`);const i=o.find(a=>a.Id===this.recordId);if(i)return console.log("\u2705 Strategy 1: Found record in leftMenu cache"),this.processAttributesStructure(i)}}console.log("\u{1F50D} Strategy 2: Searching through other list caches...");for(const o of e){if(o.id===s)continue;const i=o.records||o.data;if(Array.isArray(i)){const a=i.find(r=>r.Id===this.recordId);if(a)return console.log(`\u2705 Strategy 2: Found record in cache item: ${o.id}`),this.processAttributesStructure(a)}else if(i&&i.Id===this.recordId)return console.log(`\u2705 Strategy 2: Found record as single record in cache item: ${o.id}`),this.processAttributesStructure(i)}return console.log("\u274C All offline fallback strategies failed - no cached data found"),console.log("\u{1F4A1} Tip: Ensure leftMenu has cached records for this object type"),null}catch(e){return console.error("\u274C Error during offline fallback:",e),null}}ensureReferenceFieldIds(){console.log("\u{1F527} Ensuring reference field IDs are properly maintained in formData..."),Object.keys(this.formData).forEach(e=>{const s=this.formData[e];if(s&&typeof s=="object"&&s.attributes&&s.attributes.type){const t=e.endsWith("__r")?e.replace("__r","__c"):e;s.Id&&!this.formData[t]&&(this.formData[t]=s.Id,console.log(`\u2705 Set reference field ID: ${t} = ${s.Id}`));const o=`${e}.Name`;s.Name&&!this.formData[o]&&(this.formData[o]=s.Name,console.log(`\u2705 Set reference field Name: ${o} = ${s.Name}`))}if(e.endsWith("__r")&&s&&typeof s=="object"){const t=e.replace("__r","__c");s.Id&&!this.formData[t]&&(this.formData[t]=s.Id,console.log(`\u2705 Set missing reference field ID: ${t} = ${s.Id} (from ${e})`))}}),console.log("\u2705 Reference field ID maintenance complete")}processAttributesStructure(e){if(!e||typeof e!="object")return e;console.log("\u{1F504} Processing attributes structure from cached record..."),console.log("\u{1F50D} Original record structure (keys only):",Object.keys(e));const s={...e};Object.keys(e).forEach(i=>{const a=e[i];a&&typeof a=="object"&&a.attributes&&a.attributes.type?(console.log(`\u{1F504} Processing reference field: ${i} with attributes structure`),Object.keys(a).forEach(r=>{if(r!=="attributes"){const l=`${i}.${r}`;s[l]=a[r],console.log(`\u{1F4DD} Flattened: ${l} = ${a[r]}`)}})):i.includes(".")&&i.endsWith(".Name")&&console.log(`\u{1F50D} Found already flattened reference field: ${i} = ${a}`)}),Object.keys(e).filter(i=>i.endsWith("__r")&&!i.includes(".")).forEach(i=>{const a=`${i}.Name`;if(!s[a]){const r=e[i];r&&typeof r=="object"&&r.Name&&(s[a]=r.Name,console.log(`\u{1F4DD} Additional flattening: ${a} = ${r.Name}`))}}),console.log("\u2705 Attributes structure processing complete"),console.log("\u{1F50D} Processed record keys:",Object.keys(s));const o=Object.keys(s).filter(i=>i.includes(".Name"));return o.length>0&&(console.log("\u{1F50D} Reference field mappings:"),o.forEach(i=>{console.log(`  ${i}: ${s[i]}`)})),Object.keys(s).forEach(i=>{const a=s[i];a&&typeof a=="object"&&!a.attributes&&(a.Name&&!s[`${i}.Name`]&&(s[`${i}.Name`]=a.Name,console.log(`\u{1F4DD} Additional Name extraction: ${i}.Name = ${a.Name}`)),a.Id&&!s[`${i}.Id`]&&(s[`${i}.Id`]=a.Id,console.log(`\u{1F4DD} Additional Id extraction: ${i}.Id = ${a.Id}`)))}),s}prepareFieldForDisplay(e){try{this.currentFieldApi=e.fieldApi;const s=this.enhanceFieldForRendering(e);Object.assign(e,s)}catch(s){console.error(`\u274C Error preparing field ${e.fieldApi}:`,s),e.hasValue=!1,e.displayValue=""}}enhanceFieldForRendering(e){const s=this.formData[e.fieldApi]!==void 0?this.formData[e.fieldApi]:e.defaultValue!==void 0?e.defaultValue:"",t=String(e.fieldType||"").toLowerCase(),o=e.fieldApi||"";this.currentFieldApi=o;const i=this.objectSchema[o],a=t==="boolean"||i&&i.type==="boolean",r=t==="picklist"||t==="multipicklist"||i&&["picklist","multipicklist"].includes(i.type)||e.picklistValues&&e.picklistValues.length>0||this.picklistValues[o]&&this.picklistValues[o].length>0,l=t==="reference"||i&&i.type==="reference"||e.referenceTo&&e.referenceTo.length>0||e.referenceToObject&&e.referenceToObject.length>0||this.lookupOptionsMap[o]&&this.lookupOptionsMap[o].length>0,c=t==="reference"||i&&i.type==="reference"||e.referenceTo&&e.referenceTo.length>0||this.lookupOptionsMap[o]&&this.lookupOptionsMap[o].length>0,d=t==="textarea"||t==="longtextarea"||i&&["textarea","longtextarea"].includes(i.type)||o.toLowerCase().includes("description")||o.toLowerCase().includes("comment"),h=i?.type?.toLowerCase()||"",u=t.toLowerCase(),f=o.toLowerCase(),g=h==="datetime"||u==="datetime"||f.includes("datetime")&&!h&&!u,_=!g&&(h==="time"||u==="time"||f.includes("time")&&!f.includes("date")&&!h&&!u),m=!g&&!_&&(h==="date"||u==="date"||f.includes("date")&&!f.includes("time")&&!h&&!u),x=t==="email"||i&&i.type==="email",k=t==="phone"||i&&i.type==="phone",$=t==="url"||i&&i.type==="url",S=["double","integer","currency","percent"].includes(t)||i&&["double","integer","currency","percent"].includes(i.type),O=!(a||r||c||d||m||g||_||x||k||$||S);e.defaultValue&&!this.formData[e.fieldApi]&&(this.formData={...this.formData,[e.fieldApi]:a?e.defaultValue===!0||e.defaultValue==="true":e.defaultValue});let F=[];r?(F=this.getPicklistOptions(e),F=F.map(w=>({...w,selected:w.value===s}))):c&&(F=this.getLookupOptions(e),F=F.map(w=>({...w,selected:w.value===s})));let D="";if(a)D=s?"Yes":"No";else if(r&&F.length>0){const w=F.find(y=>y.value===s);D=w?w.label:s||""}else if(l){const w=`${o}.Name`,y=o.endsWith("__c")?`${o.replace("__c","__r")}.Name`:`${o}__r.Name`,C=o.endsWith("Id")?`${o.replace("Id","")}.Name`:null,I=o.endsWith("Id")?`${o.replace("Id","__r")}.Name`:null;let L=this.formData[w]||this.recordData[w]||this.formData[y]||this.recordData[y]||(C?this.formData[C]:null)||(C?this.recordData[C]:null)||(I?this.formData[I]:null)||(I?this.recordData[I]:null);const N=this.getFieldIdValue(e);if(!L){const T=[];o.endsWith("__c")?T.push(o.replace("__c","__r")):o.endsWith("Id")?T.push(o.replace("Id","")):T.push(`${o}__r`);for(const q of T){const te=this.formData[q]||this.recordData[q];if(te&&typeof te=="object"&&te.Name){L=te.Name,console.log(`\u2705 Found name from reference object ${q}: ${L}`),this.formData[w]=L,this.formData[y]=L,C&&(this.formData[C]=L),I&&(this.formData[I]=L);break}}L||console.log(`\u26A0\uFE0F No reference object found for patterns: ${T.join(", ")}`)}if(L&&String(L).trim()!=="")D=String(L).trim();else if(N&&F.length>0){const T=F.find(q=>q.value===N);T&&T.label?D=String(T.label).trim():D=N}else{const T=this.formData[o]||this.recordData[o];T&&typeof T=="object"&&T.Name?D=String(T.Name).trim():T&&typeof T=="object"&&T.attributes?D=T.Name?String(T.Name).trim():s||"":N?D=N:D=""}}else D=this.formatDisplayValue(s,e.fieldType);let v;if(_?(v=!0,console.log(`\u23F0 Time field ${o} hasValue ALWAYS forced to true to prevent disappearing`)):v=D!=null&&D!=="",l&&!v&&l){const w=`${o}.Name`;this.formData[w]||this.recordData[w],this.getFieldIdValue(e)}let A=s;if(this.isFieldReadOnly(e.fieldApi)&&this.READ_ONLY_FIELDS.includes(e.fieldApi)){const w=new Date;let y=null;if(e.fieldApi==="Rhythm__Date_and_Time_of_Observation__c"){const C=w.getFullYear(),I=String(w.getMonth()+1).padStart(2,"0"),L=String(w.getDate()).padStart(2,"0"),N=String(w.getHours()).padStart(2,"0"),T=String(w.getMinutes()).padStart(2,"0"),q=String(w.getSeconds()).padStart(2,"0");y=`${C}-${I}-${L}T${N}:${T}:${q}`}y&&(A=y,this.formData[e.fieldApi]=y)}return console.log("log in line 4383",JSON.stringify(this.getInputType(e))),console.log("log in line 4384",JSON.stringify(e.fieldType)),{...e,value:A,displayValue:D,hasValue:v,isCheckbox:a,isSelect:r,isLookup:c,isTextarea:d,isDate:m,isDateTime:g,isTime:_,isEmail:x,isPhone:k,isUrl:$,isNumber:S,isText:O,isEditable:!a&&!this.isEmployeeDetailsField(e)&&!this.isTaskFieldRestricted(e)&&!this.isFieldReadOnly(e.fieldApi)&&!this.isAlertRelationFieldRestricted(e)&&e.fieldApi!=="OwnerId",isVisible:this.isFieldVisible(e),inputType:this.getInputType(e),inputValue:this.getInputValue(e),checkedValue:a?s===!0||s==="true":!1,options:F,lookupOptions:c?F:[]}}formatDisplayValue(e,s){if(e==null||e==="")return"";const t=String(s||"").toUpperCase();if(t==="DATE")return new Date(e).toLocaleDateString();if(t==="DATETIME")return new Date(e).toLocaleString();if(t==="TIME")try{if(typeof e=="number")return new Date(0,0,0,0,0,0,e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});if(typeof e=="string"){if(/^\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/.test(e)){const i=e.replace("Z","").split(":"),a=parseInt(i[0],10),r=parseInt(i[1],10),l=new Date;return l.setHours(a,r,0,0),l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}else if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(e)){const i=e.split(":"),a=parseInt(i[0],10),r=parseInt(i[1],10),l=new Date;return l.setHours(a,r,0,0),l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}const o=new Date(e);if(!isNaN(o.getTime()))return o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}return e}catch(o){return console.warn("Failed to format time value:",e,o),e}else return t==="BOOLEAN"?e?"Yes":"No":String(e)}isPicklistField(e){return e.fieldType==="PICKLIST"&&e.picklistValues&&e.picklistValues.length>0}isReferenceField(e){return e.fieldType==="REFERENCE"||e.referenceToObject&&e.referenceToObject.length>0}isTextareaField(e){return e.fieldType==="TEXTAREA"||e.fieldApi&&e.fieldApi.toLowerCase().includes("description")}isEmployeeDetailsField(e){if(e.isContactField)return!0;if(!this.recordId)return!1;const s=e.sectionName||e.section||"";let t="";if(!s&&this.sections){for(const a of this.sections)if(a.fields?.find(l=>l.fieldApi===e.fieldApi)){t=a.name||a.label||"";break}}const o=s||t||"",i=o.toLowerCase().includes("employee")&&o.toLowerCase().includes("details");return i&&console.log(`\u{1F512} Making Employee Details field readonly: ${e.fieldApi} (section: ${o})`),i}isTaskFieldRestricted(e){if(this.objectApiName!=="Task")return!1;const s=e.fieldApi||"",t=this.formData?.CreatedById||this.recordData?.CreatedById,o=this.currentUserId&&t&&this.currentUserId===t;if(console.log("\u{1F50D} Task ownership check:",JSON.stringify({currentUserId:this.currentUserId,taskCreatedById:t,isTaskOwner:o,fieldApi:s})),o)return console.log(`\u2705 Task owner can edit all fields: ${s} (user owns this task)`),!1;const a=["Status","Description"].some(r=>s.toLowerCase().includes(r.toLowerCase()));return console.log(a?`\u2705 Allowing Task field edit: ${s} (user does not own task but field is in allowed list)`:`\u{1F512} Making Task field readonly: ${s} (user does not own this task, only Comments and Status are editable)`),!a}isAlertRelationFieldRestricted(e){if(this.objectApiName!=="Rhythm__Alert_Relation__c")return!1;const s=e.fieldApi||"",o=["Rhythm__Comments__c"].some(i=>s.toLowerCase().includes(i.toLowerCase()));return console.log(o?`\u2705 Allowing Alert Relation field edit: ${s} (comments field is editable)`:`\u{1F512} Making Alert Relation field readonly: ${s} (only comments field is editable for Rhythm__Alert_Relation__c)`),!o}loadCurrentUserId(){try{let e=sessionStorage.getItem("sf_user_id");e||(e=localStorage.getItem("sf_user_id")),e?(this.currentUserId=e,console.log("\u{1F464} Current user ID loaded for task ownership:",this.currentUserId)):console.warn("\u26A0\uFE0F Could not load current user ID for task ownership checks")}catch(e){console.error("\u274C Error loading current user ID:",e)}}includeRequiredNonEditableFields(e){console.log("\u{1F527} Including required non-editable fields in submission..."),console.log("\u{1F50D} Current submission data before adding required fields:",Object.keys(e)),this.sections.forEach(s=>{s.fields?.forEach(t=>{if(t.required&&!t.isEditable&&t.fieldApi)if(t.fieldApi in e)console.log(`\u2139\uFE0F Required non-editable field already in submission: ${t.fieldApi}`);else{const o=this.formData[t.fieldApi];o!=null&&o!==""?["CreatedDate","LastModifiedDate","SystemModstamp","CreatedById","LastModifiedById","IsDeleted","Name"].includes(t.fieldApi)?console.log(`\u23ED\uFE0F Skipping system field even though required: ${t.fieldApi}`):(e[t.fieldApi]=o,console.log(`\u2705 Included required non-editable field: ${t.fieldApi} = ${o}`)):console.log(`\u26A0\uFE0F Required non-editable field has no value: ${t.fieldApi}`)}})}),console.log("\u{1F50D} Final submission data after adding required fields:",Object.keys(e)),console.log("\u2705 Required non-editable fields inclusion complete")}getFieldValue(e){const s=e?.fieldApi;if(!s)return"";if((e.fieldType==="TIME"||e.fieldType==="DATE"||e.fieldType==="DATETIME")&&(console.log(`\u{1F50D} DEBUG: Getting value for ${e.fieldType} field ${s}`),console.log(`\u{1F50D} DEBUG: formData[${s}]:`,this.formData?.[s]),console.log(`\u{1F50D} DEBUG: recordData[${s}]:`,this.recordData?.[s]),console.log("\u{1F50D} DEBUG: formData keys:",Object.keys(this.formData||{})),console.log("\u{1F50D} DEBUG: recordData keys:",Object.keys(this.recordData||{}))),e.fieldType==="REFERENCE"){const t=`${s}.Name`,o=s.endsWith("__c")?`${s.replace("__c","__r")}.Name`:`${s}__r.Name`,i=this.formData?.[t]??this.recordData?.[t]??this.formData?.[o]??this.recordData?.[o];if(i)return i}return this.formData?.[s]??this.recordData?.[s]??""}getFieldIdValue(e){const s=e?.fieldApi;return s?this.formData?.[s]??this.recordData?.[s]??"":""}getFieldDisplayValue(e){const s=this.getFieldValue(e);console.log(`\u{1F4CA} Getting display value for field ${e.fieldApi}, type: ${e.fieldType}, raw value:`,s);let t="";if(e.fieldType==="DATE"||e.fieldType==="DATETIME")t=s?new Date(s).toLocaleDateString():"",console.log(`\u{1F4C5} Date field ${e.fieldApi}: ${s} -> ${t}`);else if(e.fieldType==="TIME")if(!s)t="";else{try{if(typeof s=="number")t=new Date(0,0,0,0,0,0,s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});else if(typeof s=="string"){if(s.includes("T")||s.includes("Z")){const i=new Date(s);isNaN(i.getTime())||(t=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}))}else if(/^\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/.test(s)){const i=s.replace("Z","").split(":"),a=parseInt(i[0],10),r=parseInt(i[1],10),l=new Date;l.setHours(a,r,0,0),t=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}else if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(s)){const i=s.split(":"),a=parseInt(i[0],10),r=parseInt(i[1],10),l=new Date;l.setHours(a,r,0,0),t=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}const o=new Date(s);isNaN(o.getTime())?t=s:t=o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}else t=String(s)}catch(o){console.warn(`Failed to format time value: ${s}`,o),t=String(s)}console.log(`\u23F0 Time field ${e.fieldApi}: ${s} -> ${t}`)}else if(e.fieldType&&e.fieldType.toUpperCase()==="BOOLEAN")t=s?"Yes":"No",console.log(`\u2713 Boolean field ${e.fieldApi}: ${s} -> ${t}`);else if(e.fieldType==="PICKLIST"&&e.picklistValues){const o=e.picklistValues.find(i=>i.value===s);t=o?o.label:s,console.log(`\u{1F4CB} Picklist field ${e.fieldApi}: ${s} -> ${t}`)}else if(e.fieldType==="REFERENCE"){if(s&&e.lookupOptions){const o=e.lookupOptions.find(i=>i.value===s);t=o?o.label:s}else t=s||"";console.log(`\u{1F517} Reference field ${e.fieldApi}: ${s} -> ${t}`)}else t=s!=null?String(s):"",console.log(`\u{1F4DD} Text field ${e.fieldApi}: ${s} -> ${t}`);return console.log(`\u{1F4CA} Final display value for ${e.fieldApi}: "${t}"`),t}handleBack(){this.dispatchEvent(new CustomEvent("backtolist"))}get pageTitle(){return this.objectApiName==="Rhythm__Hazard__c"?"Hazard Details":"Incident Details"}get pageIcon(){return this.objectApiName==="Rhythm__Hazard__c"?"standard:client":"standard:incident"}setEditMode(e){this.isEditMode=e,this.isEditMode?(this.hasUnsavedChanges=!1,this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!1}}))):this.handleCancel(),this.dispatchEvent(new CustomEvent("editmodechanged",{detail:{isEditMode:this.isEditMode}}))}getEditModeState(){return this.isEditMode}handleEdit(){console.log("\u{1F58B}\uFE0F Entering edit mode"),this.showAlertModal=!1,this.isEditMode=!0,this.hasUnsavedChanges=!1,this.error=null,this.originalRecordData=JSON.parse(JSON.stringify(this.formData)),this.dispatchEvent(new CustomEvent("editmodechanged",{detail:{isEditMode:!0}})),this.sections=[...this.sections]}handleCancel(){console.log("\u{1F504} Canceling edit mode"),this.formData=JSON.parse(JSON.stringify(this.originalRecordData)),this.recordData={...this.formData},this.isEditMode=!1,this.hasUnsavedChanges=!1,this.changedFields={},this.ensureReferenceFieldIds(),this.prepareFieldsForDisplay(),this.dispatchEvent(new CustomEvent("editmodechanged",{detail:{isEditMode:!1}})),this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!1}})),console.log("\u2705 Edit mode canceled, original data restored")}dismissError(){console.log("Dismissing error message"),this.error=null}handleSave(){console.log("\u{1F58A}\uFE0F Save button clicked"),this.isSubmitting=!0,console.log("\u{1F50D} Checking record ID for save operation..."),console.log("\u{1F50D} Current recordId:",this.recordId),console.log("\u{1F50D} recordId type:",typeof this.recordId),console.log("\u{1F50D} recordId truthy:",!!this.recordId),this.recordId?(console.log("\u{1F4BE} RecordId found - Starting existing record update process"),console.log("\u{1F4BE} Updating record:",this.recordId),this.saveForm().catch(e=>{console.error("\u274C Error in save process:",e),this.isSubmitting=!1})):(console.log("\u{1F680} No recordId found - Starting new record creation process"),this.createNewRecord().catch(e=>{console.error("\u274C Error in create process:",e),this.isSubmitting=!1}))}async createNewRecord(){try{console.log("\u{1F680} Starting record creation process"),console.log("\u{1F680} Current recordId:",this.recordId),console.log("\u{1F680} Object API Name:",this.objectApiName),console.log("\u{1F4CB} Step 1: Validating form...");const e=await Promise.resolve().then(()=>this.validateForm());if(console.log("\u{1F4CB} Form validation result:",e),!e){console.log("\u274C Form validation failed, aborting creation"),this.showRecordCreationMessage("Validation failed. Please check required fields.","error"),this.isSubmitting=!1;return}console.log("\u{1F4CB} Step 2: Showing spinner..."),this.showSpinner=!0,console.log("\u{1F4CB} Step 3: Collecting form data...");const s=this.collectFormDataForCreation();console.log("\u{1F4CB} Collected record data:",s),console.log("\u{1F4CB} Step 4: Creating record...");const t=await this.createRecord(s);if(console.log("\u{1F4CB} Create record result:",t),t.success){const o=t.isOffline?"Record saved offline and will sync when online!":"Record created successfully!";console.log(`\u2705 Record creation successful: ${o}`),console.log(`\u2705 New record ID: ${t.id}`),this.showRecordCreationMessage(o,"success"),this.dispatchEvent(new CustomEvent("createevent",{detail:{success:!0,message:o,recordId:t.id}})),console.log("\u{1F4CB} Refreshing record data..."),await this.loadRecordData()}else throw console.error("\u274C Record creation failed:",t),new Error(t.error||"Failed to create record")}catch(e){console.error("\u274C Error creating record:",e);const s=e.message||"An error occurred while creating the record";this.showRecordCreationMessage(s,"error"),this.dispatchEvent(new CustomEvent("createevent",{detail:{success:!1,message:s}}))}finally{this.showSpinner=!1,this.isSubmitting=!1}}async saveForm(){if(!this.recordId){console.log("\u274C No record ID found for save operation"),this.showRecordCreationMessage("No record ID to save. Use create instead.","error"),this.dispatchEvent(new CustomEvent("saveevent",{detail:{success:!1,message:"No record ID to save"}})),this.isSubmitting=!1;return}try{if(console.log("\u{1F680} Starting save process"),await Promise.resolve().then(()=>this.handleHiddenRequiredFields()),!await Promise.resolve().then(()=>this.validateForm())){console.log("\u274C Form validation failed, aborting save"),this.isSubmitting=!1;return}this.showSpinner=!0,this.syncFormDataFromDOM();const s=JSON.parse(JSON.stringify(this.changedFields));console.log("\u{1F4DD} Submitting ONLY changed fields:",s),console.log("\u{1F4DD} Total changed fields to submit:",Object.keys(s).length),s.Id=this.recordId;const t=await this.saveRecord(s);if(t.success)this.isEditMode=!1,this.originalRecordData={...this.formData},this.hasUnsavedChanges=!1,this.changedFields={},console.log("\u{1F504} Refreshing field display after successful save..."),this.showToast("Success",t.isOffline?"Changes saved offline and will sync when online!":"Record updated successfully!","log"),this.dispatchEvent(new CustomEvent("saveevent",{detail:{success:!0,message:t.isOffline?"Changes saved offline":"Record updated successfully!",hasChanges:!0,isOffline:t.isOffline,recordId:t.id||this.recordId}})),this.dispatchEvent(new CustomEvent("editmodechanged",{detail:{isEditMode:!1}})),this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!1}}));else throw new Error(t.error||"Failed to update record")}catch(e){const s=e?.message||"Failed to update record";this.error=s,this.scrollToTop(),this.dispatchEvent(new CustomEvent("saveevent",{detail:{success:!1,message:s}}))}finally{this.showSpinner=!1,this.isSubmitting=!1}}scrollToTop(){const e=this.template.querySelector(".detail-page-container");console.log("\u{1F4DA} Container:",JSON.stringify(e)),e&&e.scrollTo({top:0,behavior:"smooth"});let s=this.template.host;for(;s&&s.parentElement;){const t=s.parentElement;if(console.log("\u{1F4DA} Parent tagName:",t.tagName),t.tagName&&t.tagName.toLowerCase()==="c-dynamic-host"){console.log("\u{1F4DA} Found dynamic-host container, scrolling parent component-content");const o=t.parentElement;if(o&&o.classList&&o.classList.contains("component-content")){console.log("\u{1F4DA} Scrolling to top of component-content container"),o.scrollTo({top:0,behavior:"smooth"});return}}if(t.classList&&t.classList.contains("component-content")){console.log("\u{1F4DA} Scrolling to top of component-content container"),t.scrollTo({top:0,behavior:"smooth"});return}s=t}typeof window!="undefined"&&window.scrollTo({top:0,behavior:"smooth"})}initializeImmediateCorrectionFields(){if(this.objectApiName==="Rhythm__Incident_Injury__c"){this.showImmediateCorrectionSection=!0,this.immediateCorrectionFields=[];let e=0;for(let s=1;s<=7;s++){const t=`Rhythm__Immediate_Correction_${s}__c`,o=this.formData[t];o&&String(o).trim()!==""&&e++}this.visibleCorrectionFields=Math.max(1,e);for(let s=1;s<=7;s++){const t=`Rhythm__Immediate_Correction_${s}__c`;this.immediateCorrectionFields.push({fieldApi:t,label:`Immediate Correction ${s}`,value:this.formData[t]||"",isVisible:s<=this.visibleCorrectionFields,canDelete:s>1,canShowPlus:!1,canClickPlus:!1,disablePlus:!0,canShowDelete:s>1&&s<=this.visibleCorrectionFields,index:s})}this.updateImmediateCorrectionVisibility()}else this.showImmediateCorrectionSection=!1,this.immediateCorrectionFields=[],this.visibleCorrectionFields=1}handleImmediateCorrectionChange(e){const s=e.target.dataset.field,t=e.target.value;console.log(`\u{1F527} Immediate correction field ${s} changed: ${t}`),this.formData={...this.formData,[s]:t},this.changedFields={...this.changedFields,[s]:t},this.hasUnsavedChanges=!0,this.immediateCorrectionFields=this.immediateCorrectionFields.map(o=>o.fieldApi===s?{...o,value:t}:o),this.updateImmediateCorrectionVisibility(),this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!0}}))}handleAddImmediateCorrection(){this.visibleCorrectionFields<7&&(this.visibleCorrectionFields++,console.log(`\u{1F527} Added immediate correction field ${this.visibleCorrectionFields}`),this.immediateCorrectionFields=this.immediateCorrectionFields.map(e=>e.index<=this.visibleCorrectionFields?{...e,isVisible:!0}:e),this.updateImmediateCorrectionVisibility())}handleRemoveImmediateCorrection(e){const s=parseInt(e.target.dataset.index,10),t=`Rhythm__Immediate_Correction_${s}__c`;console.log(`\u{1F527} Removing immediate correction field ${s}`),this.formData={...this.formData,[t]:""},this.changedFields={...this.changedFields,[t]:""},this.hasUnsavedChanges=!0;for(let i=s;i<this.visibleCorrectionFields;i++){const a=`Rhythm__Immediate_Correction_${i}__c`,r=`Rhythm__Immediate_Correction_${i+1}__c`;this.formData={...this.formData,[a]:this.formData[r]||""},this.changedFields={...this.changedFields,[a]:this.formData[r]||""}}const o=`Rhythm__Immediate_Correction_${this.visibleCorrectionFields}__c`;this.formData={...this.formData,[o]:""},this.changedFields={...this.changedFields,[o]:""},this.visibleCorrectionFields--,this.immediateCorrectionFields=this.immediateCorrectionFields.map(i=>({...i,isVisible:i.index<=this.visibleCorrectionFields,value:this.formData[i.fieldApi]||""})),this.updateImmediateCorrectionVisibility(),this.dispatchEvent(new CustomEvent("unsavedchanges",{detail:{hasUnsavedChanges:!0}}))}updateImmediateCorrectionVisibility(){this.immediateCorrectionFields=this.immediateCorrectionFields.map(e=>{const s=this.formData[e.fieldApi]&&this.formData[e.fieldApi].trim()!=="",t=e.index===this.visibleCorrectionFields,o=e.index>1&&e.isVisible,i=t&&this.visibleCorrectionFields<7,a=s&&i;return{...e,canShowPlus:i,canClickPlus:a,disablePlus:!a,canShowDelete:o}})}syncFormDataFromDOM(){console.log("\u{1F504} Syncing formData with current DOM values..."),this.template.querySelectorAll("[data-field]").forEach(s=>{const t=s.dataset.field;if(!t)return;let o;if(s.type==="checkbox"?o=s.checked:(s.tagName==="SELECT"||s.value!==void 0)&&(o=s.value),o!==void 0){const i=this.findFieldByApi(t);if(i){const a=this.normalizeValueForSave(o,i.fieldType);this.formData[t]=a,console.log(`\u{1F4DD} Synced ${t}: ${o} -> ${a}`)}}}),console.log("\u2705 FormData sync complete:",this.formData)}collectAllVisibleFieldData(){console.log("\u{1F4CB} Collecting all visible field data for upsert...");const e={};return this.sections.forEach(s=>{s.fields.forEach(t=>{if(this.isFieldVisible(t)){const o=t.fieldApi;let i=this.formData[o];i==null&&(i=this.recordData[o]);const a=this.normalizeValueForSave(i,t.fieldType);e[o]=a,console.log(`\u2705 Collected ${o}: ${a} (type: ${t.fieldType})`)}})}),console.log(`\u{1F4CB} Total visible fields collected: ${Object.keys(e).length}`),e}handleHiddenRequiredFields(){if(console.log("\u{1F50D} Handling hidden required fields..."),!this.isEditMode){console.log("\u23ED\uFE0F Not in edit mode, skipping hidden required fields");return}this.sections.forEach(e=>{e.fields.forEach(s=>{if(s.required&&!this.isFieldVisible(s)){const t=this.formData[s.fieldApi];if(t!=null&&t!=="")return;console.log(`\u{1F50D} Setting default value for hidden required field: ${s.label} (${s.fieldApi})`);let o;switch(s.fieldType){case"BOOLEAN":o=!1;break;case"NUMBER":case"DOUBLE":case"INTEGER":case"CURRENCY":case"PERCENT":o=0;break;case"DATE":o=new Date().toISOString().split("T")[0];break;case"TIME":o="00:00:00.000Z";break;case"DATETIME":o=new Date().toISOString();break;case"PICKLIST":o=s.picklistValues&&s.picklistValues.length>0?s.picklistValues[0].value:"";break;default:o=""}this.formData={...this.formData,[s.fieldApi]:o},this.recordData={...this.recordData,[s.fieldApi]:o},console.log(`\u2705 Set default value for hidden required field ${s.fieldApi}: ${o}`)}})})}validateForm(){if(console.log("\u{1F50D} Validating form..."),!this.isEditMode)return console.log("\u23ED\uFE0F Not in edit mode, skipping validation"),!0;const e=[];if(this.sections.forEach(s=>{s.fields.forEach(t=>{if(t.required&&this.isFieldVisible(t)){const o=this.formData[t.fieldApi],i=o==null||o==="";t.fieldType==="BOOLEAN"&&o===!1||t.fieldType==="NUMBER"&&o===0||i&&(e.push(t.label),console.log(`\u{1F50D} Required field ${t.label} is empty`))}})}),e.length>0){const s=`Please fill in all required fields: ${e.join(", ")}`;return this.error=s,this.scrollToTop(),!1}return console.log("\u2705 Form validation passed"),!0}async saveRecord(e){try{console.log("\u{1F4BE} Step 1: Filter invalid fields and update formData");const s=new Set;this.sections.forEach(o=>{o.fields.forEach(i=>{i.fieldApi&&s.add(i.fieldApi)})}),s.add("Id"),console.log(`\u{1F50D} Found ${s.size} valid fields for ${this.objectApiName}`);const t={...e};if(Object.keys(t).forEach(o=>{o!=="Id"&&(s.has(o)||(console.log(`\u{1F9F9} Removing invalid field for ${this.objectApiName}: ${o}`),delete t[o]))}),console.log("\u{1F50D} Filtered fields for update:",t),this.formData={...this.formData,...t},await this.prepareFieldsForDisplay(),console.log("\u2705 UI updated immediately with changes"),console.log("\u{1F504} Step 2: Handling persistence and background sync..."),await V())try{await this.js_updateRecord(t),console.log("\u2705 Online save: Salesforce update successful")}catch(o){console.warn("\u274C Online save failed, using offlineService:",o),await this.saveToOfflineService(t)}else console.log("\u{1F4E1} Offline mode: Using offlineService for sync queue"),await this.saveToOfflineService(t);return{success:!0,isOffline:!await V(),id:this.recordId}}catch(s){return console.error("\u274C Failed to save record:",s),{success:!1,error:s.message}}}async saveToOfflineService(e){try{console.log("\u{1F4DD} Saving to offlineService for sync queue...");const s={Id:this.recordId,...e,_operation:"UPDATE"};await We.createRecordOffline(s,this.objectApiName),console.log("\u2705 Saved to offlineService sync queue")}catch(s){throw console.error("\u274C Failed to save to offlineService:",s),s}}async reloadDataFromCache(){try{console.log("\u{1F504} Reloading record data from SQLite cache");const s=(await de(Z.LIST_VIEW_RECORDS)).find(t=>t.Id===this.recordId);s?(console.log("\u2705 Found cached record, updating UI"),this.recordData={...s},this.formData={...s},await this.prepareFieldsForDisplay(),console.log("\u2705 UI updated with cached data")):console.warn("\u26A0\uFE0F No cached record found, keeping current data")}catch(e){console.error("\u274C Failed to reload from cache:",e)}}async syncToSalesforceInBackground(e){Promise.resolve().then(async()=>{try{if(await V())console.log("\u{1F310} Background sync: Attempting Salesforce update"),await this.js_updateRecord(e),console.log("\u2705 Background sync: Salesforce update successful");else{console.log("\u{1F4E1} Background sync: Offline - adding to sync queue");const s={objectApiName:this.objectApiName,formData:e,_updatedOffline:!0,_updatedAt:new Date().toISOString(),_deviceId:this._getDeviceId(),_recordId:this.recordId,_operation:"UPDATE"};await We.createRecordOffline(s,this.objectApiName),console.log("\u2705 Background sync: Added to offline queue")}}catch(s){console.error("\u274C Background sync failed:",s);try{const t={objectApiName:this.objectApiName,formData:e,_updatedOffline:!0,_updatedAt:new Date().toISOString(),_deviceId:this._getDeviceId(),_recordId:this.recordId,_operation:"UPDATE",_syncError:s.message};await We.createRecordOffline(t,this.objectApiName),console.log("\u2705 Background sync: Fallback to offline queue successful")}catch(t){console.error("\u274C Background sync: Fallback also failed:",t)}}})}async updateLocalRecord(e){try{const s=`record_${this.objectApiName}_${this.recordId}`,o=(await de(Z.LIST_VIEW_RECORDS)).find(a=>a.id===s),i=o&&o.data?{...o.data,...e}:e;return await re(Z.LIST_VIEW_RECORDS,{id:s,objectApiName:this.objectApiName,recordId:this.recordId,data:i,timestamp:new Date().toISOString()}),console.log("\u{1F4BE} Updated local record in SQLite"),!0}catch(s){throw console.error("\u274C Failed to update local record:",s),s}}_getDeviceId(){let e=localStorage.getItem("device_id");return e||(e="device_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),localStorage.setItem("device_id",e)),e}async js_updateRecord(e){const s=this.filterFieldsForUpdate(e);return console.log("\u{1F50D} Filtered fields for update:",s),oe(this.objectApiName,s)}filterFieldsForUpdate(e){const s={};console.log("\u{1F50D} Starting field filtering for update:",Object.keys(e));for(const[t,o]of Object.entries(e)){if(t.includes(".")||t.endsWith("__r")){console.log(`\u23ED\uFE0F Skipping relationship field: ${t}`);continue}if(["CreatedDate","LastModifiedDate","SystemModstamp","CreatedById","LastModifiedById","IsDeleted","Name"].includes(t)){console.log(`\u23ED\uFE0F Skipping system/read-only field: ${t}`);continue}if(t==="Id"){s[t]=o,console.log(`\u2705 Including Id field: ${t} = ${o}`);continue}o&&typeof o=="object"&&o.Id?(s[t]=o.Id,console.log(`\u{1F517} Converted reference field object to ID: ${t} = ${o.Id}`)):(s[t]=o,console.log(`\u2705 Including changed field: ${t} = ${o}`))}return this.recordId&&!s.Id&&(s.Id=this.recordId),console.log("\u{1F50D} Final filtered fields for update:",Object.keys(s)),s}getFieldMetadata(e){for(const s of this.sections)if(s.fields){const t=s.fields.find(o=>o.fieldApi===e);if(t)return t}return null}normalizeValueForSave(e,s){if(e==null)return null;switch(String(s||"").toLowerCase()){case"boolean":return Boolean(e);case"double":case"integer":case"currency":case"percent":return isNaN(Number(e))?null:Number(e);case"time":if(typeof e=="string"&&e.includes(":")){const[o,i]=e.split(":");return`${o.padStart(2,"0")}:${i.padStart(2,"0")}:00.000Z`}return e;case"date":case"datetime":return e;default:return String(e)}}normalizeValue(e,s){if(e==null)return null;switch(s?.toUpperCase()){case"BOOLEAN":{if(typeof e=="string"){const o=e.trim().toLowerCase();return o==="true"||o==="yes"||o==="1"}return Boolean(e)}case"DOUBLE":case"CURRENCY":case"INTEGER":case"PERCENT":return isNaN(Number(e))?null:Number(e);case"DATE":case"DATETIME":return e;case"TIME":{if(typeof e=="string"&&e.includes(":")){const[t,o]=e.split(":");return`${t.padStart(2,"0")}:${o.padStart(2,"0")}:00.000Z`}if(typeof e=="number")try{const t=new Date(e);return isNaN(t.getTime())?"00:00:00.000Z":t.toISOString().substring(11,23)+"Z"}catch(t){return console.error("Error converting time value:",t),"00:00:00.000Z"}return typeof e=="string"&&!e.includes(":")?"00:00:00.000Z":e||"00:00:00.000Z"}default:return e.toString()}}addReadOnlyField(e){this.READ_ONLY_FIELDS.includes(e)||(this.READ_ONLY_FIELDS.push(e),console.log(`\u{1F512} Added ${e} to read-only fields list`))}removeReadOnlyField(e){const s=this.READ_ONLY_FIELDS.indexOf(e);s>-1&&(this.READ_ONLY_FIELDS.splice(s,1),console.log(`\u{1F513} Removed ${e} from read-only fields list`))}getReadOnlyFields(){return[...this.READ_ONLY_FIELDS]}addConditionalEditableField(e,s){this.CONDITIONAL_EDITABLE_FIELDS[e]=s,console.log(`\u{1F517} Added conditional dependency: ${e} depends on ${s}`)}removeConditionalEditableField(e){this.CONDITIONAL_EDITABLE_FIELDS[e]&&(delete this.CONDITIONAL_EDITABLE_FIELDS[e],console.log(`\u{1F517} Removed conditional dependency for: ${e}`))}getConditionalEditableFields(){return{...this.CONDITIONAL_EDITABLE_FIELDS}}showToast(e,s,t){console[t==="error"?"error":t==="warning"?"warn":"log"](`${e}: ${s}`),this.showMessageInModal(e,s)}showMessageInModal(e,s){this.messageModalTitle=e||"Message",this.messageModalText=s||"",this.showMessageModal=!0,setTimeout(()=>{this.refreshFieldsAfterSave()},100)}async closeMessageModal(){this.showMessageModal=!1,await this.refreshFieldsAfterSave()}showRecordCreationMessage(e,s){console.log(`\u{1F4E2} Showing record creation message: ${e} (${s})`),this.showToast(s==="success"?"Success":"Error",e,s),this.dispatchEvent(new CustomEvent("recordmessage",{detail:{message:e,variant:s,type:"record-creation"}}))}collectFormDataForCreation(){console.log("\u{1F4CB} Collecting form data for record creation...");const e={},s=new Set;return this.sections.forEach(t=>{t.fields.forEach(o=>{o.fieldApi&&s.add(o.fieldApi)})}),console.log(`\u{1F50D} Found ${s.size} valid fields for ${this.objectApiName}`),this.sections.forEach(t=>{t.fields.forEach(o=>{if(this.isFieldVisible(o)&&!o.isContactField){const i=o.fieldApi;if(!s.has(i)){console.log(`\u{1F9F9} Skipping invalid field for ${this.objectApiName}: ${i}`);return}let a=this.formData[i];if(o.isBoolean)a=a===!0||a==="true";else if(a==null||a===""){o.required&&(e[i]="");return}e[i]=a,console.log(`\u{1F4CB} Added field ${i}: ${a}`)}})}),console.log("\u{1F4CB} Collected form data for creation:",e),e}async createRecord(e){try{console.log("\u{1F4BE} Creating record with data:",e);const s=await V();if(console.log(`\u{1F310} Online status: ${s}`),s){console.log("\u{1F310} Creating record online via Salesforce API"),console.log("\u{1F310} Object API Name:",this.objectApiName),console.log("\u{1F310} Record Data:",JSON.stringify(e,null,2));const o=await(await se.getValidConnection()).sobject(this.objectApiName).create(e);if(console.log("\u{1F4CA} Salesforce creation result (full):",JSON.stringify(o,null,2)),console.log("\u{1F4CA} Result type:",typeof o),console.log("\u{1F4CA} Result.success:",o.success),console.log("\u{1F4CA} Result.id:",o.id),o.success===!0||o.id){const i=o.id;return console.log(`\u2705 Record created successfully with ID: ${i}`),{success:!0,id:i,isOffline:!1}}else if(o.success===!1){const i=o.errors?o.errors.join(", "):"Creation failed";throw console.error("\u274C Salesforce creation failed:",i),new Error(i)}else{if(console.log("\u26A0\uFE0F Unexpected Salesforce response format, treating as success if ID exists"),o.id)return console.log(`\u2705 Record created successfully with ID: ${o.id}`),{success:!0,id:o.id,isOffline:!1};throw new Error("Unexpected response format from Salesforce")}}else{console.log("\u{1F4F1} Creating record offline");const t="temp_"+Date.now(),o={...e,Id:t,_isOffline:!0,_createdAt:new Date().toISOString()};return await We.createRecordOffline(o,this.objectApiName),console.log(`\u2705 Record created offline with temp ID: ${t}`),{success:!0,id:t,isOffline:!0}}}catch(s){return console.error("\u274C Failed to create record:",s),{success:!1,error:s.message||"Failed to create record"}}}handleAlertUpdated(e){const{success:s,message:t}=e.detail;s?(this.showToast("Success",t,"success"),this.showAlertModal=!1,this.loadRecordData()):this.showToast("Error",t||"Error updating alert","error")}async fetchDependentPicklistValues(e,s,t){try{console.log(`\u{1F50D} Fetching dependent picklist values for ${s} with record type ${t}`);const o=["Rhythm__Type_of_Cause__c"],i={},a=o.map(r=>{const l=`/ui-api/object-info/${s}/picklist-values/${t}/${r}`;return e.request(l).then(c=>{console.log(`\u{1F4CB} UI API picklist values response for ${r}:`,JSON.stringify(c)),c&&this.processDependentPicklistField(r,c,i)}).catch(c=>{console.error(`\u274C Error fetching dependent picklist values for ${r}:`,c)})});await Promise.all(a),console.log("\u{1F4CB} Complete dependent picklist map:",i),this.dependentPicklistMap=i,this.cacheDependentPicklistMap(i)}catch(o){console.error("\u274C Error in fetchDependentPicklistValues:",o)}}processDependentPicklistField(e,s,t){try{if(console.log(`\u{1F504} Processing dependent picklist field: ${e}`),s.controllerValues&&s.controllerValues!==null){console.log(`\u{1F4CB} Found dependent field: ${e}`);const o=s.controllingField||"Rhythm__Type__c";console.log(`\u{1F4CB} Controlling field: ${o}`),t[e]={controllingField:o,valueMap:{}};const i=s.controllerValues;console.log("\u{1F4CB} Controller values:",i),s.values.forEach(a=>{(a.validFor||[]).forEach(l=>{const c=Object.keys(i).find(d=>i[d]===l);c&&(t[e].valueMap[c]||(t[e].valueMap[c]=[]),t[e].valueMap[c].push({label:a.label,value:a.value,active:!0}))})}),console.log(`\u{1F4CB} Dependent values for ${e}:`,t[e].valueMap)}}catch(o){console.error(`\u274C Error processing dependent picklist field ${e}:`,o)}}processDependentPicklistValues(e){try{console.log("\u{1F504} Processing dependent picklist values (legacy method)");const s={};Object.keys(e).forEach(t=>{const o=e[t];this.processDependentPicklistField(t,o,s)}),console.log("\u{1F4CB} Dependent picklist map built:",s),this.dependentPicklistMap=s,this.cacheDependentPicklistMap(s)}catch(s){console.error("\u274C Error processing dependent picklist values:",s)}}cacheDependentPicklistMap(e){try{if(!this.objectApiName)return;const s=`dependent_picklists_${this.objectApiName}`;sessionStorage.setItem(s,JSON.stringify(e)),console.log(`\u{1F4E6} Cached dependent picklist map for ${this.objectApiName} in session storage`),H&&typeof H.cacheDependentPicklists=="function"&&H.cacheDependentPicklists(this.objectApiName,e).then(()=>{console.log(`\u{1F4E6} Cached dependent picklist map for ${this.objectApiName} in SQLite`)}).catch(t=>{console.error("\u274C Error caching dependent picklist map in SQLite:",t)})}catch(s){console.error("\u274C Error caching dependent picklist map:",s)}}async loadCachedDependentPicklists(){try{if(!this.objectApiName)return;const e=`dependent_picklists_${this.objectApiName}`,s=sessionStorage.getItem(e);if(s){this.dependentPicklistMap=JSON.parse(s),console.log(`\u{1F4CB} Loaded cached dependent picklist map for ${this.objectApiName} from session storage`);return}if(H&&typeof H.getCachedDependentPicklists=="function"){const t=await H.getCachedDependentPicklists(this.objectApiName);t&&(this.dependentPicklistMap=t,console.log(`\u{1F4CB} Loaded cached dependent picklist map for ${this.objectApiName} from SQLite`),sessionStorage.setItem(e,JSON.stringify(t)),localStorage.setItem(e,JSON.stringify(t)))}}catch(e){console.error("\u274C Error loading cached dependent picklist map:",e)}}handleDependentPicklistUpdates(e,s){this.dependentPicklistMap&&Object.keys(this.dependentPicklistMap).forEach(t=>{const o=this.dependentPicklistMap[t];if(o.controllingField===e&&(console.log(`\u{1F504} Field ${e} controls dependent picklist ${t}`),this.formData[t])){const i=this.formData[t],a=s;(o.valueMap[a]||[]).map(c=>c.value).includes(i)||(console.log(`\u{1F504} Resetting dependent field ${t} because its value is not valid for the new controlling value`),this.formData={...this.formData,[t]:""},this.changedFields={...this.changedFields,[t]:""},this.updateDependentFieldUI(t))}})}updateDependentFieldUI(e){const s=this.template.querySelector(`[data-field="${e}"]`);if(s&&(s.value="",s.tagName==="SELECT")){const t=this.findFieldByApi(e);if(t){const o=this.getPicklistOptions(t);for(;s.options.length>1;)s.remove(1);o.forEach(i=>{const a=document.createElement("option");a.value=i.value,a.text=i.label,s.add(a)}),this.updateFieldOptionsInSections(e,o)}}}updateFieldOptionsInSections(e,s){for(let t=0;t<this.sections.length;t++){const o=this.sections[t];for(let i=0;i<o.fields.length;i++){const a=o.fields[i];a.fieldApi===e&&(console.log(`\u{1F504} Updating options for field ${e} in section ${o.name}`),(a.isSelect||a.fieldType==="PICKLIST")&&(a.options=s,console.log(`\u2705 Updated ${s.length} options for field ${e}`),this.picklistValues&&(this.picklistValues[e]=s),a.picklistValues&&(a.picklistValues=s)),o.fields[i]={...a})}this.sections[t]={...o}}this.sections=[...this.sections]}get showEnvironmentalSummary(){return["Rhythm__Water_Usage_Transaction__c","Rhythm__Waste_Management__c","Rhythm__Fuel__c"].includes(this.objectApiName)}get environmentalModuleType(){return{Rhythm__Water_Usage_Transaction__c:"water",Rhythm__Waste_Management__c:"waste",Rhythm__Fuel__c:"fuel"}[this.objectApiName]||"water"}async checkAndLoadContactFields(){try{console.log("\u{1F50D} Checking for contact fields to load...");const e=this.getContactFieldsToCheck();let s=!1;const t=[];for(const o of e){const i=this.recordData[o.fieldApi]||this.formData[o.fieldApi];i&&(t.push({contactId:i,sectionName:o.sectionName,fieldApi:o.fieldApi}),s=!0)}s?(await this.loadSimpleContactData(t),this.hasContactFields=!0):(this.hasContactFields=!1,this.contactSections=[])}catch(e){console.error("\u274C Error checking contact fields:",e)}}getContactFieldsToCheck(){const e=[];return this.objectApiName==="Rhythm__Incident_Injury__c"?e.push({fieldApi:"Rhythm__Name_of_Person_Injured__c",sectionName:"Injured Person Details"},{fieldApi:"Rhythm__Contractor_Employee_Involved__c",sectionName:"Injured Person Details"}):this.objectApiName==="Rhythm__Hazard__c"&&e.push({fieldApi:"Rhythm__Employee_Individual_Involved__c",sectionName:"Employee Details"},{fieldApi:"Rhythm__Contractor_Employee_Involved__c",sectionName:"Employee Details"}),e}async processContactMetadataWithSchema(e,s){try{console.log("\u{1F4DE} Processing Contact metadata with schema enhancement...");const t=this.objectSchema,o=this.lookupOptionsMap,i=this.picklistValues;this.objectSchema=s,this.lookupOptionsMap={},this.picklistValues={},Object.keys(s).forEach(r=>{const l=s[r];(l.type==="picklist"||l.type==="multipicklist")&&l.picklistValues&&l.picklistValues.length>0&&(this.picklistValues[r]=l.picklistValues.map(c=>({label:c.label,value:c.value,active:c.active!==!1,defaultValue:c.defaultValue||!1})),console.log(`\u{1F4DE} Loaded Contact picklist values for ${r}: ${this.picklistValues[r].length} values`))});const a=await this.processCachedMetadata(e,"Contact");return this.objectSchema=t,this.lookupOptionsMap=o,this.picklistValues=i,console.log("\u{1F4DE} Contact metadata processing complete"),a}catch(t){return console.error("\u274C Error processing Contact metadata with schema:",t),null}}async loadSimpleContactData(e){try{console.log("\u{1F4DE} Loading Contact field configurations (same as main object)...");const t=await(await se.getValidConnection()).sobject("Contact").describe();console.log("\u{1F4DE} Contact object schema loaded");const o={};for(const m of t.fields)o[m.name]=m;const i=await H.getMetadata("Contact");if(!i||!i.fieldMetadata||i.fieldMetadata.length===0){console.error("\u274C Failed to load Contact metadata from cache");return}console.log("\u{1F4DE} Contact metadata loaded from cache");const a=await this.processContactMetadataWithSchema(i,o);if(!a||!a.fieldMetadata){console.error("\u274C Failed to process Contact metadata");return}let r;try{r=await ns("Contact")}catch(m){console.log("\u{1F4DE} Using processed Contact metadata for field configurations"),r={},Object.values(a.fieldMetadata).forEach(x=>{if(!x||!x.fieldApi)return;const k=x.sectionName||"General Information";r[k]||(r[k]={}),r[k][x.fieldApi]=x}),console.log("\u{1F4DE} Fallback field configurations created:",Object.keys(r))}if(!r||Object.keys(r).length===0){console.error("\u274C No Contact field configurations found");return}const l=[];console.log("\u{1F4DE} Field configurations structure:",Object.keys(r)),Object.keys(r).forEach(m=>{console.log(`\u{1F4DE} Section ${m} has ${Object.keys(r[m]).length} field keys`),console.log("\u{1F4DE} Sample field in section:",Object.values(r[m])[0]);const x={sectionName:m,fields:[]};Object.values(r[m]).forEach(k=>{if(!k||!k.fieldApi)return;if(k.fieldApi.includes(".Name")){console.log(`\u{1F4DE} Skipping .Name field to prevent duplication: ${k.fieldApi}`);return}const $={...k,isVisible:!0,hasValue:!1,displayValue:"",isReadOnly:!0,label:k.label||k.fieldApi};console.log(`\u{1F4DE} Added contact field to section: ${k.fieldApi} (mobile: ${k.isMobile!==!1&&k.is_Mobile!==!1})`),x.fields.push($)}),x.fields.length>0&&l.push(x)}),console.log(`\u{1F4DE} Built ${l.length} Contact sections with fields`);const c=l.length>0,d=l.some(m=>m.fields.some(x=>x.fieldApi));if(console.log(`\u{1F4DE} Section validation: hasValidSections=${c}, hasValidFields=${d}`),console.log("\u{1F4DE} Built sections:",l.map(m=>({name:m.sectionName,fieldCount:m.fields.length}))),!c||!d){console.log("\u{1F4DE} Sections building failed or fields are undefined, using processed metadata directly..."),l.length=0;const m={sectionName:"Contact Information",fields:[]};if(console.log(`\u{1F4DE} Using processed metadata with ${Object.keys(a.fieldMetadata||{}).length} Contact fields`),Object.values(a.fieldMetadata||{}).forEach(x=>{if(!x||!x.fieldApi){console.log("\u{1F4DE} Skipping field without fieldApi:",x);return}if(x.fieldApi.includes(".Name")){console.log(`\u{1F4DE} Skipping .Name field to prevent duplication: ${x.fieldApi}`);return}const k={fieldApi:x.fieldApi,label:x.label||x.fieldApi,fieldType:x.fieldType,sectionName:x.sectionName||"Contact Information",required:x.required||!1,isVisible:!0,hasValue:!1,displayValue:"",isReadOnly:!0};console.log(`\u{1F4DE} Fallback: Added field from metadata: ${x.fieldApi} (mobile: ${x.isMobile!==!1&&x.is_Mobile!==!1})`),m.fields.push(k)}),m.fields.length>0)l.push(m),console.log(`\u{1F4DE} Created fallback section with ${m.fields.length} fields`);else{console.error("\u274C Failed to create any Contact fields from metadata");return}}const h=l.flatMap(m=>m.fields.map(x=>x.fieldApi));["Id","Name"].forEach(m=>{h.includes(m)||h.push(m)}),console.log(`\u{1F4DE} Querying ${h.length} Contact fields`);const f=e.map(async({contactId:m,sectionName:x,fieldApi:k})=>{try{const $=await this.js_getRecordData({objectApiName:"Contact",recordId:m,fieldApiNames:h});let S=null;return $?.records&&Array.isArray($.records)&&$.records.length>0?S=$.records[0]:$?.records&&!Array.isArray($.records)?S=$.records:$&&$.Id&&(S=$),!S||!S.Id?(console.warn(`\u26A0\uFE0F Contact not found for ID: ${m}`),null):{contactId:m,sectionName:x,fieldApi:k,contactRecord:S,sections:l,fieldConfigs:r}}catch($){return console.error(`\u274C Error loading contact ${m}:`,$),null}}),_=(await Promise.all(f)).filter(m=>m!==null);_.length>0?(console.log(`\u{1F4DE} Processing ${_.length} contact records for display`),this.mergeContactDataIntoExistingSections(_)):console.log("\u{1F4DE} No valid contact data to process")}catch(s){console.error("\u274C Error loading contact data:",s)}}mergeContactDataIntoExistingSections(e){try{console.log("\u{1F4DE} Merging contact data into existing sections..."),e.forEach(({contactId:s,sectionName:t,contactRecord:o,sections:i})=>{console.log(`\u{1F4DE} Processing contact ${s} for section: ${t}`);let a=this.sections.find(r=>{const l=t.toLowerCase(),c=(r.sectionName||r.name||"").toLowerCase();return c===l?!0:l.includes("employee")&&l.includes("details")?c.includes("employee")&&c.includes("details"):l.includes("injured")&&l.includes("person")?c.includes("injured")&&c.includes("person"):!1});a?console.log(`\u{1F4DE} Found existing section: ${a.sectionName||a.name}, merging contact fields into it`):(console.log(`\u{1F4DE} Creating new section: ${t}`),a={sectionName:t,name:t,fields:[]},this.sections.push(a)),i.forEach(r=>{r.fields.forEach(l=>{if(!l||!l.fieldApi)return;if(l.fieldApi.includes(".Name")){console.log(`\u{1F4DE} Skipping .Name field to prevent duplication: ${l.fieldApi}`);return}const c=this.enhanceContactFieldUsingMainObjectLogic(l,o);c&&c.isVisible?a.fields.some(h=>h.fieldApi===c.fieldApi&&h.contactId===s)?console.log(`\u{1F4DE} Skipping duplicate contact field: ${c.fieldApi} for contact ${s}`):(c.isContactField=!0,c.isReadOnly=!0,c.containerClass="field-container",c.fieldValueClass=c.isBoolean?"field-value checkbox-field-value":"field-value",c.contactId=s,c.fieldKey=`${c.fieldApi}_${s}`,a.fields.push(c),console.log(`\u{1F4DE} Added contact field ${c.fieldApi} to section ${a.sectionName||a.name} (hasValue: ${c.hasValue}, display: "${c.displayValue}")`)):console.log(`\u{1F4DE} Skipping non-visible contact field: ${l.fieldApi}`)})}),a.fields.length>0&&a.fields.sort((r,l)=>{if(r.isContactField&&!l.isContactField)return 1;if(!r.isContactField&&l.isContactField)return-1;if(r.isContactField&&l.isContactField){const c=["Name","Email","Phone"],d=c.findIndex(u=>r.fieldApi?.includes(u)),h=c.findIndex(u=>l.fieldApi?.includes(u));if(d!==-1&&h!==-1)return d-h;if(d!==-1)return-1;if(h!==-1)return 1}return(r.label||"").localeCompare(l.label||"")})}),console.log("\u{1F4DE} Contact data merged into existing sections"),this.contactSections=[],this.hasContactFields=!1,this.setStandardSectionClasses()}catch(s){console.error("\u274C Error merging contact data into sections:",s)}}createContactSectionsFromFieldConfigs(e){try{console.log("\u{1F4DE} Creating contact sections from field configurations..."),this.contactSections=[],e.forEach(({contactId:s,sectionName:t,contactRecord:o,sections:i})=>{console.log(`\u{1F4DE} Processing contact ${s} for section: ${t}`);const a={sectionName:t,contactId:s,name:`${t}_${s}`,fields:[]};i.forEach(l=>{l.fields.forEach(c=>{if(!c||!c.fieldApi)return;const d=this.prepareContactFieldForDisplay(c,o);d&&d.isVisible&&a.fields.push(d)})}),a.fields.sort((l,c)=>{const d=["Name","Email","Phone"],h=d.findIndex(f=>l.fieldApi?.includes(f)),u=d.findIndex(f=>c.fieldApi?.includes(f));return h!==-1&&u!==-1?h-u:h!==-1?-1:u!==-1?1:(l.label||"").localeCompare(c.label||"")});const r=a.fields.filter(l=>l.hasValue&&l.displayValue&&l.displayValue!=="-"&&l.displayValue.trim()!=="");console.log(`\u{1F4DE} Section ${t} has ${a.fields.length} total fields, ${r.length} with values`),r.length>0?(a.fields=r,this.contactSections.push(a),console.log(`\u{1F4DE} Added contact section: ${t} with ${a.fields.length} fields`)):console.log(`\u{1F4DE} Skipping empty contact section: ${t}`)}),console.log(`\u{1F4DE} Created ${this.contactSections.length} contact sections with data`),this.hasContactFields=this.contactSections.length>0,this.contactSections.forEach((s,t)=>{console.log(`\u{1F4DE} Contact Section ${t+1}: ${s.sectionName}`,{fieldCount:s.fields.length,fields:s.fields.map(o=>({api:o.fieldApi,hasValue:o.hasValue,display:o.displayValue}))})})}catch(s){console.error("\u274C Error creating contact sections:",s)}}integrateContactSectionsIntoMainSections(){try{console.log("\u{1F4DE} Integrating Contact sections into main sections..."),this.sections||(this.sections=[]),this.contactSections.forEach(e=>{const s=e.fields.map(i=>{const a={...i};return a.isContactField=!0,a.isReadOnly=!0,a.isVisible=!0,a.isEmployeeDetails=!0,a.containerClass="field-container",a.fieldValueClass="field-value",a.fieldApi&&(this.formData[a.fieldApi]=a.displayValue||""),a}),t={name:e.sectionName,sectionName:e.sectionName,fields:s,isContactSection:!0,isEmployeeDetailsSection:!1,containerClass:"section-container",headerClass:"section-header"},o=this.sections.findIndex(i=>i.name&&i.name.toLowerCase().includes("employee")&&i.name.toLowerCase().includes("details"));o!==-1?(console.log("\u{1F4DE} Merging Contact fields into existing Employee Details section"),this.sections[o].fields.push(...s),console.log(`\u{1F4DE} Merged ${s.length} Contact fields into existing Employee Details section`)):(this.sections.push(t),console.log(`\u{1F4DE} Integrated Contact section "${e.sectionName}" with ${s.length} fields`))}),this.contactSections=[],this.hasContactFields=!1,this.setStandardSectionClasses(),console.log(`\u{1F4DE} Integration complete. Total sections: ${this.sections.length}`)}catch(e){console.error("\u274C Error integrating Contact sections:",e)}}setStandardSectionClasses(){try{if(!this.sections)return;this.sections.forEach(e=>{e.containerClass="section-container",e.headerClass="section-header",e.fields?.forEach(s=>{s.containerClass||(s.containerClass="field-container")})})}catch(e){console.error("\u274C Error setting standard section classes:",e)}}enhanceContactFieldUsingMainObjectLogic(e,s){try{const t=JSON.parse(JSON.stringify(e)),o=this.formData,i=this.recordData;this.formData={...s},this.recordData={...s};const a=this.enhanceFieldForRendering(t);return this.formData=o,this.recordData=i,a.isContactField=!0,a.isReadOnly=!0,a.isVisible=a.isVisible!==!1,["Id","IsDeleted","CreatedDate","CreatedById","LastModifiedDate","LastModifiedById","SystemModstamp","LastActivityDate","LastViewedDate","LastReferencedDate"].includes(e.fieldApi)&&(a.isVisible=!1),a}catch(t){return{...e,hasValue:!1,displayValue:"-",isVisible:!0,isReadOnly:!0,isContactField:!0,fieldValueClass:"field-value"}}}prepareContactFieldForDisplay(e,s){try{const t=JSON.parse(JSON.stringify(e)),o=s[e.fieldApi];(e.fieldApi==="Name"||e.fieldType==="REFERENCE")&&console.log(`\u{1F4DE} Preparing contact field ${e.fieldApi}:`,{fieldType:e.fieldType,fieldValue:o,hasValue:o!=null&&o!==""}),t.hasValue=o!=null&&o!=="",t.isReadOnly=!0;const i=["Id","IsDeleted","CreatedDate","CreatedById","LastModifiedDate","LastModifiedById","SystemModstamp","LastActivityDate","LastViewedDate","LastReferencedDate"];t.isVisible=!i.includes(e.fieldApi);let a="";if(e.fieldType&&e.fieldType.toUpperCase()==="BOOLEAN")a=o?"Yes":"No",t.isBoolean=!0,t.booleanValue=o===!0,t.fieldValueClass="field-value checkbox-field-value";else if(e.fieldType==="PICKLIST"&&e.picklistValues){const r=e.picklistValues.find(l=>l.value===o);a=r?r.label:o||"",t.isBoolean=!1,t.fieldValueClass="field-value"}else if(e.fieldType==="REFERENCE"){console.log(`\u{1F4DE} Processing reference field ${e.fieldApi}`);const r=`${e.fieldApi}.Name`,l=e.fieldApi.endsWith("__c")?`${e.fieldApi.replace("__c","__r")}.Name`:`${e.fieldApi}__r.Name`,c=e.fieldApi.endsWith("Id")?`${e.fieldApi.replace("Id","")}.Name`:null,d=e.fieldApi.endsWith("Id")?`${e.fieldApi.replace("Id","__r")}.Name`:null;let h=s[r]||s[l]||(c?s[c]:null)||(d?s[d]:null);const u=o;if(console.log(`\u{1F4DE} Reference field debug - ${e.fieldApi}:`,{nameField:r,relationshipNameField:l,standardNameField:c,standardRelNameField:d,nameFromData:h,idValue:u,contactRecordKeys:Object.keys(s||{})}),!h&&u){const f=[];e.fieldApi.endsWith("__c")?f.push(e.fieldApi.replace("__c","__r")):e.fieldApi.endsWith("Id")&&f.push(e.fieldApi.replace("Id","")),f.push(e.fieldApi);for(const g of f){const _=s[g];if(_&&typeof _=="object"&&_.Name){h=_.Name,console.log(`\u{1F4DE} Found name from reference object ${g}: ${h}`);break}}}if(h&&String(h).trim()!=="")a=String(h).trim();else if(u&&e.lookupOptions&&e.lookupOptions.length>0){const f=e.lookupOptions.find(g=>g.value===u);f&&f.label?a=String(f.label).trim():a=u}else u?a=u:a="";t.isBoolean=!1,t.fieldValueClass="field-value"}else a=o!=null?String(o):"",t.isBoolean=!1,t.fieldValueClass="field-value";return a&&a.trim()!==""?(t.displayValue=a,t.hasValue=!0):(t.displayValue="-",t.hasValue=!1),t.fieldValueClass="field-value",(e.fieldApi==="Name"||e.fieldType==="REFERENCE"||!t.hasValue)&&console.log(`\u{1F4DE} Contact field ${e.fieldApi} processed:`,{fieldType:e.fieldType,hasValue:t.hasValue,displayValue:t.displayValue}),t}catch(t){return console.error(`\u274C Error preparing contact field ${e.fieldApi}:`,t),null}}async loadContactFieldMetadata(e){try{console.log("\u{1F4CB} Loading Contact object metadata..."),console.log("\u{1F4CB} Requesting Contact metadata from cache...");const s=await H.getMetadata("Contact");if(console.log("\u{1F4CB} Contact metadata result:",{hasMetadata:!!s,hasFieldMetadata:!!s?.fieldMetadata,fieldCount:s?.fieldMetadata?.length||0,firstFewFields:s?.fieldMetadata?.slice(0,3)?.map(l=>({developerName:l.DeveloperName,fieldApi:l.Rhythm__Field_Api_Name__c,isActive:l.Rhythm__IsActive__c}))}),!s){console.error("\u274C Failed to load Contact metadata");return}(!s.fieldMetadata||s.fieldMetadata.length===0)&&(console.warn("\u26A0\uFE0F No Contact field metadata found in Rhythm__Fields_Level_Configuration__mdt"),console.log("\u{1F4CB} This likely means Contact object is not configured in the metadata."),console.log("\u{1F4CB} Consider adding Contact field configurations to Rhythm__Fields_Level_Configuration__mdt"),console.log("\u{1F4CB} Creating default Contact field metadata..."),s.fieldMetadata=[{DeveloperName:"Contact_Name",MasterLabel:"Name",Rhythm__Field_Api_Name__c:"Name",Rhythm__Section_Name__c:"Contact Information",Rhythm__Order__c:1,Rhythm__is_Mobile__c:!0,Rhythm__Required__c:!1,_fieldType:"TEXT"},{DeveloperName:"Contact_Email",MasterLabel:"Email",Rhythm__Field_Api_Name__c:"Email",Rhythm__Section_Name__c:"Contact Information",Rhythm__Order__c:2,Rhythm__is_Mobile__c:!0,Rhythm__Required__c:!1,_fieldType:"EMAIL"},{DeveloperName:"Contact_Phone",MasterLabel:"Phone",Rhythm__Field_Api_Name__c:"Phone",Rhythm__Section_Name__c:"Contact Information",Rhythm__Order__c:3,Rhythm__is_Mobile__c:!0,Rhythm__Required__c:!1,_fieldType:"PHONE"},{DeveloperName:"Contact_Title",MasterLabel:"Title",Rhythm__Field_Api_Name__c:"Title",Rhythm__Section_Name__c:"Contact Information",Rhythm__Order__c:4,Rhythm__is_Mobile__c:!0,Rhythm__Required__c:!1,_fieldType:"TEXT"}],console.log(`\u{1F4CB} Created ${s.fieldMetadata.length} default Contact field metadata records`)),console.log("\u{1F4CB} Processing Contact metadata...");const t=await this.processCachedMetadata(s,"Contact");if(console.log("\u{1F4CB} Processed Contact metadata result:",{hasProcessedData:!!t,hasFieldMetadata:!!t?.fieldMetadata,fieldMetadataType:typeof t?.fieldMetadata,fieldMetadataKeys:Object.keys(t?.fieldMetadata||{}),fieldCount:Object.keys(t?.fieldMetadata||{}).length}),!t||!t.fieldMetadata){console.error("\u274C Failed to process Contact metadata");return}let o;try{o=await ns("Contact")}catch(l){console.log("\u{1F4CB} Falling back to processed Contact metadata for field configurations..."),o={},Object.values(t.fieldMetadata).forEach(c=>{if(!c||!c.fieldApi){console.log("\u{1F4CB} Skipping null or invalid field in processed metadata");return}const d=c.sectionName||"General Information";o[d]||(o[d]={}),o[d][c.fieldApi]=c})}if(!o||Object.keys(o).length===0){console.error("\u274C Failed to load Contact field configurations");return}console.log("\u{1F4CB} Contact field configurations loaded:",Object.keys(o)),console.log("\u{1F4CB} Detailed contact field configurations:"),Object.keys(o).forEach(l=>{console.log(`  \u{1F4CB} Section: ${l}`);const c=o[l];Object.values(c).forEach((d,h)=>{console.log(`    \u{1F4CB} Field ${h+1}:`,{fieldApi:d?.fieldApi,label:d?.label,fieldType:d?.fieldType,isVisible:d?.isVisible,hasFieldApi:!!d?.fieldApi})})});const i=e.map(async({contactId:l,sectionName:c,fieldApi:d})=>{try{console.log(`\u{1F4DE} Loading contact data for ID: ${l}`);const h=["Id","Name"];console.log("\u{1F4DE} Starting field collection with base fields:",h),Object.keys(o).forEach(g=>{console.log(`\u{1F4DE} Processing section: ${g}`);const _=o[g];console.log(`\u{1F4DE} Section has ${Object.values(_).length} fields`),Object.values(_).forEach((m,x)=>{console.log(`\u{1F4DE} Processing field ${x+1}:`,{fieldApi:m?.fieldApi,hasField:!!m,hasFieldApi:!!m?.fieldApi,alreadyIncluded:m?.fieldApi?h.includes(m.fieldApi):!1}),m&&m.fieldApi&&!h.includes(m.fieldApi)?(h.push(m.fieldApi),console.log(`\u{1F4DE} Added field: ${m.fieldApi} (total: ${h.length})`)):console.log(`\u{1F4DE} Skipped field: ${m?.fieldApi||"NO_API"} - reason:`,{noField:!m,noFieldApi:!m?.fieldApi,alreadyIncluded:m?.fieldApi?h.includes(m.fieldApi):!1})})}),console.log(`\u{1F4DE} Final field list (${h.length} fields):`,h);const u=await is("Contact",l,h);console.log(`\u{1F4DE} getRecordWithFields raw result for ${l}:`,{isArray:Array.isArray(u),length:u?.length,recordsExist:!!u,firstRecord:u?.[0]?Object.keys(u[0]):null});const f=u&&u.length>0?u[0]:null;return console.log(`\u{1F4DE} Extracted contact record for ${l}:`,{recordExists:!!f,recordKeys:f?Object.keys(f):[],recordKeysLength:f?Object.keys(f).length:0}),f?(console.log(`\u{1F4DE} Successfully loaded contact record for ${l}:`,Object.keys(f)),{contactId:l,sectionName:c,fieldApi:d,contactRecord:f,metadata:s,fieldConfigs:o,processedMetadata:t}):(console.warn(`\u26A0\uFE0F No contact found for ID: ${l}`),null)}catch(h){return console.error(`\u274C Error loading contact ${l}:`,h),null}}),r=(await Promise.all(i)).filter(l=>l!==null);r.length>0?(console.log(`\u{1F4DE} Processing ${r.length} valid contact records`),this.processContactFieldSections(r)):console.warn("\u26A0\uFE0F No valid contact data found")}catch(s){console.error("\u274C Error loading contact field metadata:",s)}}processContactFieldSections(e){try{console.log("\u{1F504} Processing contact field sections...");const s=new Map;e.forEach(({sectionName:t,contactRecord:o,fieldConfigs:i})=>{s.has(t)||s.set(t,{name:t,fields:[],order:999});const a=s.get(t);let r=0;const l=20;Object.keys(i).forEach(c=>{if(r>=l)return;const d=i[c];Object.values(d).forEach(h=>{if(r>=l)return;if(!h||!h.fieldApi){console.log(`\u{1F4DE} Skipping null or invalid field in section ${c}`);return}const u=this.enhanceContactFieldForRendering(h,o);u&&u.isVisible?(console.log(`\u{1F4DE} Adding contact field: ${h.fieldApi} = ${u.displayValue||"(empty)"} (hasValue: ${u.hasValue})`),a.fields.push(u),r++):console.log(`\u{1F4DE} Skipping contact field: ${h.fieldApi} - not visible or invalid`)})}),a.fields.sort((c,d)=>{const h=["Name","Email","Phone","MobilePhone","Title","Department"],u=h.findIndex(g=>c.fieldApi.includes(g)),f=h.findIndex(g=>d.fieldApi.includes(g));return u!==-1&&f!==-1?u-f:u!==-1?-1:f!==-1?1:(c.fieldOrder||999)-(d.fieldOrder||999)})}),this.contactSections=Array.from(s.values()).filter(t=>t.fields.length>0),console.log(`\u2705 Created ${this.contactSections.length} contact sections:`),this.contactSections.forEach(t=>{console.log(`  \u{1F4DE} ${t.name}: ${t.fields.length} fields`),t.fields.forEach(o=>{console.log(`    - ${o.label} (${o.fieldApi}): ${o.displayValue}`)})}),e.forEach(({contactRecord:t})=>{Object.keys(t).forEach(o=>{this.contactFormData[o]=t[o]})})}catch(s){console.error("\u274C Error processing contact field sections:",s)}}enhanceContactFieldForRendering(e,s){try{if(!e||!e.fieldApi)return console.log("\u{1F4DE} Skipping field enhancement: field or fieldApi is null"),null;if(!s)return console.log(`\u{1F4DE} Skipping field enhancement for ${e.fieldApi}: contactRecord is null`),null;const t=JSON.parse(JSON.stringify(e)),o=s[e.fieldApi];t.hasValue=o!=null&&o!=="",t.displayValue=this.formatFieldValue(o,e),t.isBoolean=e.fieldType&&e.fieldType.toUpperCase()==="BOOLEAN",t.booleanValue=o===!0,t.fieldValueClass=t.isBoolean?"field-value checkbox-field-value":"field-value",t.isReadOnly=!0;const i=["Id","IsDeleted","CreatedDate","CreatedById","LastModifiedDate","LastModifiedById","SystemModstamp"];if(t.isVisible=!i.includes(e.fieldApi),!t.hasValue&&t.isVisible&&(t.displayValue="-"),t.hasValue)switch(e.fieldType){case"EMAIL":t.displayValue=o,t.isEmail=!0;break;case"PHONE":t.displayValue=o,t.isPhone=!0;break;case"URL":t.displayValue=o,t.isUrl=!0;break;case"REFERENCE":t.displayValue=o;break;default:t.displayValue=this.formatFieldValue(o,e)}return t}catch(t){return console.error(`\u274C Error enhancing contact field ${e.fieldApi}:`,t),null}}formatFieldValue(e,s){if(e==null||e==="")return"";switch(s.fieldType){case"DATE":try{return new Date(e).toLocaleDateString()}catch(t){return e}case"DATETIME":try{return new Date(e).toLocaleString()}catch(t){return e}case"BOOLEAN":return e?"Yes":"No";case"CURRENCY":case"NUMBER":return typeof e=="number"?e.toLocaleString():e;default:return e}}get attachmentSectionTitle(){switch(this.objectApiName){case"Rhythm__Hazard__c":return"Hazard Evidence";case"Rhythm__Incident_Injury__c":return"Incident Evidence";default:return"Attachments"}}restoreFieldValues(e){if(!e||!Array.isArray(e)||e.length===0){console.log("No previous sections to restore values from");return}console.log("Restoring field values from previous sections"),this.sections.forEach(s=>{s.fields.forEach(t=>{const o=t.fieldApi;for(const i of e){const a=i.fields.find(r=>r.fieldApi===o);if(a){t.displayValue=a.displayValue,t.hasValue=a.hasValue,t.value=a.value,t.inputValue=a.inputValue,t.checkedValue=a.checkedValue,t.booleanValue=a.booleanValue,a.options&&(t.options=a.options),a.lookupOptions&&(t.lookupOptions=a.lookupOptions),console.log(`Restored field values for ${o}`);break}}})}),console.log("Field value restoration complete")}}Ye.INVESTIGATION_ONLY_SECTIONS=["Investigation Team & Status","Investigation Questionnaire","Investigation Details"],Ye.BASE_DISALLOWED_SECTIONS=["RCA Summary"],Y(Ye,{publicProps:{objectApiName:{config:0},recordId:{config:0},isAttachment:{config:0},activeTab:{config:3}},publicMethods:["setEditMode"],track:{loading:1,error:1,isEditMode:1,showSpinner:1,isOfflineData:1,sections:1,formData:1,lookupOptionsMap:1,devNameToApi:1,allFieldsMap:1,controllingFieldsMap:1,objectSchema:1,picklistValues:1,fieldConfigurations:1,recordData:1,dependentPicklistMap:1,recordTypeId:1,selectedContractorId:1,contactAccountMap:1,selectedLocationId:1,defaultLocationId:1,workAreaLocationMap:1,assetLocationMap:1,contactLocationMap:1,originalRecordData:1,hasUnsavedChanges:1,changedFields:1,currentUserId:1,_activeTab:1,isDetailsTab:1,contactSections:1,contactFormData:1,hasContactFields:1,showAlertModal:1,alertTypeValue:1,immediateCorrectionFields:1,visibleCorrectionFields:1,showImmediateCorrectionSection:1,showMessageModal:1,messageModalTitle:1,messageModalText:1},fields:["isSubmitting","currentFieldApi","READ_ONLY_FIELDS","CONDITIONAL_EDITABLE_FIELDS","DISALLOWED_SECTIONS_FOR_INVESTIGATION"]});const Uo=z(Ye,{tmpl:su,sel:"c-cp-detail-page",apiVersion:63});function ou(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".generic-list-container",t,` {font-family:\r
 'Inter',\r
 -apple-system,\r
 BlinkMacSystemFont,\r
 'Segoe UI',\r
 Roboto,\r
 Arial,\r
 sans-serif;color: #1f2937;width: 100%;height: 100%;padding: 16px;margin: 0;box-sizing: border-box;display: flex;flex-direction: column;overflow: hidden;}.fab`,t," {position: fixed;bottom: 20px;right: 20px;width: 56px;height: 56px;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);border: none;border-radius: 50%;box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);cursor: pointer;display: flex;align-items: center;justify-content: center;z-index: 1001;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);color: white;}.fab:hover",t," {transform: translateY(-3px);box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);}.fab:active",t," {transform: translateY(-1px);}.fab",t," svg",t," {width: 24px;height: 24px;}.record-name-link",t," {text-decoration: none;color: #667eea;font-weight: 600;transition: color 0.2s ease;}.record-name-link:hover",t," {color: #5a67d8;}.list-content",t," {flex: 1;overflow-y: auto;overflow-x: hidden;scroll-behavior: smooth;padding-bottom: 80px;}.list-content",t,"::-webkit-scrollbar {width: 6px;}.list-content",t,"::-webkit-scrollbar-track {background: transparent;}.list-content",t,"::-webkit-scrollbar-thumb {background: rgba(0, 0, 0, 0.1);border-radius: 3px;}.list-content::-webkit-scrollbar-thumb:hover",t," {background: rgba(0, 0, 0, 0.15);}.desktop-view",t," {display: block;width: 100%;}.records-table",t," {width: 100%;border-collapse: collapse;background: #ffffff;border-radius: 16px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);overflow: hidden;border: 1px solid rgba(0, 0, 0, 0.06);}.records-table",t," thead",t," {background: #f8fafc;}.records-table",t," th",t," {padding: 20px 24px;text-align: left;font-weight: 600;font-size: 14px;color: #374151;border-bottom: 1px solid #e5e7eb;letter-spacing: 0.025em;}.records-table",t," td",t," {padding: 20px 24px;font-size: 14px;border-bottom: 1px solid #f3f4f6;vertical-align: middle;color: #6b7280;}.records-table",t," tr:last-child",t," td",t," {border-bottom: none;}.records-table",t," tr:hover",t," {background: #f9fafb;}.mobile-view",t," {display: none;width: 100%;}.record-card",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);margin: 12px 2px;overflow: hidden;padding: 16px;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.record-card:hover",t," {box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.status-pill",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 9999px;font-size: 12px;font-weight: 700;letter-spacing: 0.025em;}.status-pill--open",t," {background: rgba(16, 185, 129, 0.15);color: #065f46;}.status-pill--closed",t," {background: rgba(124, 58, 237, 0.15);color: #4c1d95;}.action-button-container",t," {padding: 16px 20px;border-bottom: 1px solid #e5e7eb;background: #ffffff;}.add-action-item-btn",t," {display: inline-flex;align-items: center;gap: 8px;background: #0891b2;color: #ffffff;border: none;border-radius: 8px;padding: 12px 20px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.3s ease;box-shadow: 0 2px 4px rgba(8, 145, 178, 0.2);}.add-action-item-btn:hover",t," {background: #0e7490;transform: translateY(-1px);box-shadow: 0 4px 8px rgba(8, 145, 178, 0.3);}.add-action-item-btn:active",t," {transform: translateY(0);box-shadow: 0 2px 4px rgba(8, 145, 178, 0.2);}.add-action-item-btn",t," svg",t," {flex-shrink: 0;}.card-content",t," {display: flex;align-items: flex-start;margin-bottom: 16px;}.card-icon",t," {background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);border-radius: 12px;width: 48px;height: 48px;display: flex;align-items: center;justify-content: center;margin-right: 16px;flex-shrink: 0;}.record-icon",t," {width: 24px;height: 24px;fill: #3b82f6;}.card-details",t," {flex: 1;}.card-title",t," {margin: 0 0 8px 0;font-size: 18px;font-weight: 600;color: #111827;line-height: 1.3;}.card-metadata",t," {display: flex;flex-direction: column;gap: 8px;}.card-field",t," {font-size: 14px;color: #6b7280;line-height: 1.5;}.card-footer",t," {display: flex;justify-content: space-between;align-items: center;margin-top: 16px;padding-top: 16px;border-top: 1px solid #f3f4f6;}.card-menu",t," {display: flex;align-items: center;position: relative;}.dropdown",t," {position: relative;display: inline-block;}.three-dots",t," {font-size: 20px;color: #9ca3af;cursor: pointer;padding: 8px;user-select: none;display: inline-flex;align-items: center;justify-content: center;border-radius: 8px;transition: all 0.2s ease;}.three-dots:hover",t," {color: #6b7280;background: #f3f4f6;}.dropdown-content",t," {display: none;position: absolute;right: 0;top: 100%;min-width: 140px;background: #ffffff;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);border-radius: 12px;z-index: 100;overflow: hidden;margin-top: 8px;border: 1px solid rgba(0, 0, 0, 0.06);}.dropdown-content.show",t," {display: block;}.dropdown-item",t," {padding: 12px 16px;font-size: 14px;color: #374151;cursor: pointer;transition: background-color 0.2s ease;font-weight: 500;}.dropdown-item:not(:last-child)",t," {border-bottom: 1px solid #f3f4f6;}.dropdown-item:hover",t," {background: #f9fafb;color: #111827;}.loading-spinner",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 60px 40px;color: #6b7280;}.spinner",t," {width: 48px;height: 48px;border: 4px solid #f3f4f6;border-top: 4px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 20px;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;}.error-message",t," {display: flex;align-items: center;padding: 20px 24px;background: #fef2f2;border: 1px solid #fecaca;border-radius: 16px;margin: 20px 0;color: #dc2626;}.error-icon",t," {margin-right: 16px;font-size: 20px;}.error-text",t," {font-size: 14px;font-weight: 500;line-height: 1.5;}.no-data",t," {padding: 40px 24px;text-align: center;color: #9ca3af;background: #f9fafb;border-radius: 16px;font-size: 16px;margin-top: 20px;font-weight: 500;}@media screen and (max-width: 768px) {.desktop-view",t," {display: none;}.mobile-view",t," {display: block;}.record-card",t," {margin-bottom: 12px;padding: 16px;}.card-icon",t," {width: 40px;height: 40px;margin-right: 12px;}.card-title",t," {font-size: 16px;}.card-metadata",t," {gap: 6px;}}.view-more-container",t," {display: flex;justify-content: center;margin: 24px 0;padding: 0 16px;flex-shrink: 0;}.view-more-button",t," {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: #ffffff;border: none;border-radius: 12px;padding: 12px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);}.view-more-button:hover",t," {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);}"].join("")}var Vo=[ou];const iu=p`<div class="loading-spinner${0}"${2}><div class="spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading records...</div></div>`,au=p`<div class="error-message${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-text${0}"${2}>${"t4"}</div></div>`,nu=p`<div class="action-button-container${0}"${2}><button class="add-action-item-btn${0}" title="Add Action Item"${2}><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18"${3}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"${3}/></svg>Add Action Item</button></div>`,ru=p`<div class="action-button-container${0}"${2}><button class="add-action-item-btn${0}"${"a1:title"}${2}><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18"${3}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"${3}/></svg>${"t4"}</button></div>`,lu=p`<th${3}>${"t1"}</th>`,cu=p`<th${3}>Actions</th>`,du=p`<td${3}>${"t1"}</td>`,hu=p`<td${3}><div class="dropdown${0}"${2}><div class="three-dots${0}"${"a2:data-id"}${2}>⋮</div><div class="dropdown-content${0}"${"a4:data-id"}${2}><div class="dropdown-item${0}" data-action="view"${"a5:data-id"}${2}>View</div><div class="dropdown-item${0}" data-action="edit"${"a7:data-id"}${2}>Edit</div><div class="dropdown-item${0}" data-action="delete"${"a9:data-id"}${2}>Delete</div></div></div></td>`,uu=p`<div class="no-data${0}"${2}>No records found</div>`,pu=p`<div class="card-icon${0}"${2}><svg class="record-icon${0}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"${2}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1v5h5v10H6V3h7z"${3}/></svg></div>`,fu=p`<h3 class="card-title${0}"${2}><a href="#" class="record-name-link${0}"${"a1:data-id"}${2}>${"t2"}</a></h3>`,mu=p`<div class="card-field${0}"${2}><strong${3}>${"t2"}</strong>${"t3"}</div>`,gu=p`<div class="no-data${0}"${2}>No records found</div>`,_u=p`<div class="view-more-container${0}"${2}><button class="view-more-button${0}"${2}>View More</button></div>`,bu={classMap:{"generic-list-container":!0},key:0},yu={classMap:{"list-content":!0},key:9},vu={classMap:{"desktop-view":!0},key:10},wu={classMap:{"records-table":!0},key:11},xu={key:12},ku={key:13},$u={key:18},Cu={classMap:{"mobile-view":!0},key:26},Su={"record-card":!0},Eu={classMap:{"card-content":!0},key:28},Ru={classMap:{"card-details":!0},key:31},Au={classMap:{"card-metadata":!0},key:34},Iu=[];function Ke(n,e,s,t){const{st:o,d:i,sp:a,b:r,k:l,i:c,f:d,h,c:u}=n,{_m0:f,_m1:g,_m2:_,_m3:m,_m4:x,_m5:k,_m6:$,_m7:S,_m8:O}=t;return[h("div",bu,[e.isLoading?o(iu,2):null,e.error?o(au,4,[a(4,null,i(e.error))]):null,e.isLoading||e.error?null:e.isTaskObject?o(nu,6,[a(1,{on:f||(t._m0={click:r(e.handlePlusClick)})},null)]):null,e.isLoading||e.error?null:e.showNewButton?o(ru,8,[a(1,{on:g||(t._m1={click:r(e.handlePlusClick)}),attrs:{title:e.addButtonLabel}},null),a(4,null,i(e.addButtonLabel))]):null,e.isLoading||e.error?null:h("div",yu,[h("div",vu,[e.filteredRecords.length?h("table",wu,[h("thead",xu,[h("tr",ku,d([c(e.columns,function(F){return o(lu,l(15,F.fieldName),[a(1,null,i(F.label))])}),o(cu,17)]))]),h("tbody",$u,c(e.visibleItems,function(F){return h("tr",{key:l(19,F.id)},d([c(F.fields,function(D){return o(du,l(21,D.name),[a(1,null,i(D.value))])}),o(hu,23,[a(2,{on:_||(t._m2={click:r(e.toggleDropdown)}),attrs:{"data-id":F.id}},null),a(4,{attrs:{"data-id":F.id}},null),a(5,{on:m||(t._m3={click:r(e.handleAction)}),attrs:{"data-id":F.id}},null),a(7,{on:x||(t._m4={click:r(e.handleAction)}),attrs:{"data-id":F.id}},null),a(9,{on:k||(t._m5={click:r(e.handleAction)}),attrs:{"data-id":F.id}},null)])]))}))]):null,e.filteredRecords.length?null:o(uu,25)]),h("div",Cu,d([e.filteredRecords.length?c(e.visibleItems,function(F){return h("div",{classMap:Su,key:l(27,F.id)},[h("div",Eu,[o(pu,30),h("div",Ru,[o(fu,33,[a(1,{on:$||(t._m6={click:r(e.handleRecordClick)}),attrs:{"data-id":F.id}},null),a(2,null,i(F.title))]),h("div",Au,c(F.displayFields,function(D){return o(mu,l(36,D.name),[a(2,null,i(D.label)+":"),a(3,null,i(D.value))])}))])])])}):Iu,e.filteredRecords.length?null:o(gu,38)])),e.showViewMoreButton?o(_u,40,[a(1,{on:S||(t._m7={click:r(e.handleViewMore)})},null)]):null]),e.showForm?u("c-safety-event-form",$s,{props:{objectApiName:e.formObjectApiName,isVisible:e.showForm,whatId:e.formWhatId,relatedId:e.recordId,relatedToApi:e.relatedToApiName,openedFromListView:e.showForm},key:41,on:O||(t._m8={cancel:r(e.handleFormCancel),success:r(e.handleFormSuccess)})}):null])]}var Fu=J(Ke);Ke.stylesheets=[],Ke.stylesheetToken="lwc-322hcrj9o3g",Ke.legacyStylesheetToken="c-cpExpListView_cpExpListView",Vo&&Ke.stylesheets.push.apply(Ke.stylesheets,Vo),Q(Ke);class qo extends K{constructor(...e){super(...e);this.recordId=void 0,this.objectApiName=void 0,this.componentDetail=void 0,this.records=[],this.processedRecords=[],this.filteredRecords=[],this.columns=[],this.isLoading=!1,this.error=null,this.viewConfig={},this.defaultFields=[],this.searchTerm="",this.visibleItemCount=5,this.isDeviceOnline=!0,this.showNewButton=!1,this.addButtonLabel="",this.relatedToApiName="",this.isAttachment=void 0,this.showForm=!1,this.formObjectApiName="",this.formWhatId=null}connectedCallback(){this.documentClickListener=this.handleDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener),this.searchListener=this.handleSearch.bind(this),this.addEventListener("search",this.searchListener),this.urlChangeListener=this.checkUrlForObjectApiName.bind(this),window.addEventListener("popstate",this.urlChangeListener),X.addListener("networkStatusChange",e=>{this.isDeviceOnline=e.connected,this.isDeviceOnline||this.checkUrlForObjectApiName()}),this.checkUrlForObjectApiName()}renderedCallback(){X.addListener("networkStatusChange",e=>{this.isDeviceOnline=e.connected,this.isDeviceOnline||this.checkUrlForObjectApiName()})}async checkUrlForObjectApiName(){const e=await X.getStatus();console.log("Network status:",JSON.stringify(e)),this.isDeviceOnline=e.connected,console.log("objectApiName",this.objectApiName),console.log("recordId",this.recordId),this.objectApiName&&(console.log("Found objectApiName in URL:",this.objectApiName),this.loadViewConfig())}disconnectedCallback(){document.removeEventListener("click",this.documentClickListener),this.removeEventListener("search",this.searchListener),window.removeEventListener("popstate",this.urlChangeListener)}refresh(){this.checkUrlForObjectApiName()}async loadViewConfig(){try{this.isLoading=!0,this.error=null,this.viewConfig={objectApiName:this.objectApiName,listViewObject:this.componentDetail.listViewObject},await this.loadFieldsConfig()}catch(e){console.error("Error loading view config:",e),this.error=e.message,this.isLoading=!1}}async loadFieldsConfig(){if(!(!this.viewConfig||!this.viewConfig.listViewObject))try{console.log("isDeviceOnline",this.isDeviceOnline);let e;if(this.isDeviceOnline)try{e=await ss(this.viewConfig.listViewObject,!1,!0)}catch(s){console.error("Error fetching field configs online:",s),e=await this.getLocalFieldConfigs(this.viewConfig.listViewObject)}else console.log("\u{1F4F1} Device is offline, retrieving cached field configurations"),e=await this.getLocalFieldConfigs(this.viewConfig.listViewObject),console.log("fieldConfigs",e);if(e&&e.length>0){const s=e[0];this.viewConfig.relatedToApiName=s.Rhythm__Related_To_Api_Name__c,this.viewConfig.listViewObject==="Rhythm__Permit_Extension__c"&&(this.isAttachment=!1),s.Rhythm__Default_Fields__c&&(this.defaultFields=s.Rhythm__Default_Fields__c.split(",").map(o=>o.trim()));let t=0;if(s.Rhythm__Fields_Limit__c&&(t=s.Rhythm__Fields_Limit__c,this.defaultFields&&this.defaultFields.length>t&&(this.defaultFields=this.defaultFields.slice(0,t))),s?.Label){const o=`Add ${s?.Label}`;this.addButtonLabel=o}if(s?.Rhythm__Related_To_Api_Name__c&&(this.relatedToApiName=s?.Rhythm__Related_To_Api_Name__c),s?.Rhythm__NewRequired__c&&this.viewConfig.listViewObject!=="Task"&&(this.showNewButton=!0),s.Rhythm__Field_Label__c&&s.Rhythm__Field_Name__c){const o=s.Rhythm__Field_Label__c.split(",").map(a=>a.trim());let i=s.Rhythm__Field_Name__c.split(",").map(a=>a.trim());i&&i.length>t&&(i=i.slice(0,t)),this.columns=i.map((a,r)=>{const l=a.includes(".");let c={fieldName:a,label:o[r]||this.formatFieldLabel(a),isRelationship:l};if(l){const d=a.split(".");c.relationshipField=d[0],c.relationshipAttribute=d[1]}return c}),this.viewConfig.fields=this.defaultFields}if(this.viewConfig.listViewObject==="Task"){console.log("\u{1F4CB} Overriding Task field configuration with hardcoded fields");const o=["Subject","ActivityDate","Rhythm__CAPA_Type__c","OwnerId","Description","Status"],i=["Action as per plan","Target Date","CAPA Type","Responsibility","Remarks","Status"];this.columns=o.map((a,r)=>({fieldName:a,label:i[r],isRelationship:!1})),this.viewConfig.fields=o,console.log("\u2705 Task configuration overridden with 6 hardcoded fields")}this.loadRecords()}else this.error=`No field configuration found for ${this.viewConfig.listViewObject}`,this.isLoading=!1}catch(e){console.error("Error loading field configurations:",e),this.error=e.message,this.isLoading=!1}}async getLocalFieldConfigs(e){try{const s=`field_config_${e}`,o=(await de(Z.FIELDS_CONFIG)).find(i=>i.id===s);return o&&o.fieldConfigs?(console.log(`\u{1F4F1} Retrieved cached field configuration for ${e}`),console.log("cachedConfig fieldConfigs",o.fieldConfigs),o.fieldConfigs):(console.log(`\u{1F4F1} No cached field configuration found for ${e}`),[])}catch(s){return console.error(`Error getting local field configs for ${e}:`,s),[]}}async loadRecords(){if(!this.viewConfig||!this.viewConfig.listViewObject||!this.viewConfig.fields||this.viewConfig.fields.length===0){this.error="Invalid configuration",this.isLoading=!1;return}try{this.isLoading=!0;let e;if(this.isDeviceOnline)try{let s=localStorage.getItem("sf_user_id");s||(s=sessionStorage.getItem("sf_user_id"));let t=this.viewConfig.fields.join(", ");if(this.viewConfig.listViewObject==="Task"){const i=["Subject","ActivityDate","Rhythm__CAPA_Type__c","OwnerId","Description","Status"].filter(c=>!this.viewConfig.fields.includes(c));i.length>0&&(t+=", "+i.join(", ")),t.includes("Owner.Name")||(t+=", Owner.Name");let r=await ls(this.viewConfig.listViewObject,t,this.recordId,this.viewConfig.relatedToApiName);try{r=r.replace(/\\"/g,'"')}catch(c){console.error("Error cleaning JSON:",c)}const l=JSON.parse(r);console.log("parsedData",l),e=l.records,console.log("records",e)}else{const o=`SELECT Id, ${t} FROM ${this.viewConfig.listViewObject} WHERE ${this.viewConfig.relatedToApiName} = '${this.recordId}' ORDER BY CreatedDate DESC`;e=await le(o)}}catch(s){console.error("Error fetching records online:",s),e=await this.getLocalRecords(this.viewConfig.listViewObject)}else console.log("\u{1F4F1} Device is offline, retrieving cached records"),e=await this.getLocalRecords(this.viewConfig.listViewObject),console.log("records",e);e&&e.length>0?(this.records=e,this.processRecords()):(this.records=[],this.processedRecords=[],this.filteredRecords=[])}catch(e){console.error("Error loading records:",e),this.error=e.message,this.records=[],this.processedRecords=[],this.filteredRecords=[]}finally{this.isLoading=!1}}async getLocalRecords(e){try{const s=`records_${e}`,o=(await de(Z.LIST_VIEW_RECORDS)).find(i=>i.id===s);return o&&o.records?(console.log(`\u{1F4F1} Retrieved ${o.records.length} cached records for ${e}`),console.log("cachedData records",o.records),o.records):(console.log(`\u{1F4F1} No cached records found for ${e}`),[])}catch(s){return console.error(`Error getting local records for ${e}:`,s),[]}}processRecords(){this.processedRecords=this.records.map(e=>{if(this.viewConfig.listViewObject==="Task")return this.processTaskRecord(e);const s={id:e.Id,fields:[]};return this.columns.forEach(t=>{let o="";if(t.isRelationship){const i=e[t.relationshipField];i&&(o=i[t.relationshipAttribute]||"")}else o=e[t.fieldName]||"";s.fields.push({name:t.fieldName,label:t.label,value:o})}),s.title=s.fields.length>0?s.fields[0].value:"Untitled",s.displayFields=s.fields.slice(1).map(t=>({name:t.name,label:t.label||this.formatFieldLabel(t.name),value:t.value})),s}),this.filteredRecords=[...this.processedRecords]}processTaskRecord(e){const s={Subject:"Action as per plan",ActivityDate:"Target Date",Rhythm__CAPA_Type__c:"CAPA Type",OwnerId:"Responsibility",Description:"Remarks",Status:"Status"},t=["Subject","ActivityDate","Rhythm__CAPA_Type__c","OwnerId","Description","Status"],o={id:e.Id,fields:[]};return t.forEach(i=>{const a=s[i];let r=e[i]||"";if(i==="OwnerId"&&e.Owner)r=e.Owner.Name||r;else if(i==="ActivityDate"&&r)try{r=new Date(r).toLocaleDateString()}catch(l){}o.fields.push({name:i,label:a,value:r})}),o.title=o.fields.length>0?o.fields[0].value:"Untitled Task",o.displayFields=o.fields.slice(1),o}formatFieldLabel(e){let s=e.replace("__c","");return s.includes("__r.")&&(s=s.replace("__r."," ")),s.replace(/_/g," ").split(" ").map(o=>this.capitalizeFirstLetter(o)).join(" ")}capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}handleSearch(e){e&&e.detail&&(this.searchTerm=e.detail.searchTerm||"",console.log("GenericListView received search term:",this.searchTerm)),this.applySearch()}applySearch(){if(!this.searchTerm||this.searchTerm.trim()==="")this.filteredRecords=[...this.processedRecords];else{const e=this.searchTerm.toLowerCase();this.filteredRecords=this.processedRecords.filter(s=>s.fields.some(t=>t.value&&t.value.toString().toLowerCase().includes(e)))}this.visibleItemCount=5}get visibleItems(){return this.filteredRecords.slice(0,this.visibleItemCount)}get showViewMoreButton(){return this.filteredRecords.length>this.visibleItemCount}get isTaskObject(){return this.viewConfig&&this.viewConfig.listViewObject==="Task"}handleViewMore(){this.visibleItemCount+=5}toggleDropdown(e){e.stopPropagation();const s=e.currentTarget.dataset.id,t=this.template.querySelector(`.dropdown-content[data-id="${s}"]`);this.template.querySelectorAll(".dropdown-content.show").forEach(o=>{o!==t&&o.classList.remove("show")}),t&&t.classList.toggle("show")}handleDocumentClick(e){this.template.contains(e.target)||this.template.querySelectorAll(".dropdown-content.show").forEach(s=>{s.classList.remove("show")})}handleRecordClick(e){e.preventDefault();const s=e.currentTarget.dataset.id,t=this.viewConfig.listViewObject,o=this.objectApiName;console.log("object1",JSON.stringify(t)),console.log("object2",JSON.stringify(o)),console.log(`Task clicked: ${s}, navigating to task detail from cpExpListView`);const i=new CustomEvent("navigate",{detail:{type:"detail",objectApiName:this.viewConfig.listViewObject,recordId:s,sourceContext:{type:"cpExpListView",sourceRecordId:this.recordId,sourceObjectApiName:this.objectApiName,listViewObject:this.viewConfig.listViewObject}},bubbles:!0,composed:!0});this.dispatchEvent(i),console.log("Navigation event dispatched:",{type:"detail",objectApiName:this.objectApiName,recordId:s}),this.dispatchEvent(new CustomEvent("recordselect",{detail:{recordId:s}}))}handleAction(e){e.stopPropagation();const s=e.currentTarget.dataset.action,t=e.currentTarget.dataset.id;s==="view"&&(console.log(`View action clicked for record: ${t}, navigating to detail view`),this.dispatchEvent(new CustomEvent("navigate",{detail:{type:"detail",objectApiName:this.viewConfig.listViewObject,recordId:t},bubbles:!0,composed:!0}))),this.dispatchEvent(new CustomEvent("recordaction",{detail:{action:s,recordId:t}})),this.template.querySelectorAll(".dropdown-content.show").forEach(o=>{o.classList.remove("show")})}handlePlusClick(){console.log("Plus button clicked in cpExpListView for:",this.viewConfig.listViewObject),this.formObjectApiName=this.viewConfig.listViewObject||this.objectApiName,this.formObjectApiName.toLowerCase()==="task"?(this.formWhatId=this.recordId,console.log("Setting whatId for Task:",this.formWhatId)):this.formWhatId=null,this.showForm=!0,console.log("Form opened with objectApiName:",this.formObjectApiName,"whatId:",this.formWhatId)}handleFormCancel(){console.log("Form cancelled in cpExpListView"),this.showForm=!1,this.formObjectApiName="",this.formWhatId=null}handleFormSuccess(e){console.log("Form submitted successfully in cpExpListView:",e.detail),this.showForm=!1,this.formObjectApiName="",this.formWhatId=null,this.loadRecords(),this.scrollToTop()}scrollToTop(){const e=this.template.querySelector(".list-content");e&&(e.scrollTop=0)}}Y(qo,{publicProps:{recordId:{config:0},objectApiName:{config:0},componentDetail:{config:0}},publicMethods:["refresh"],track:{records:1,processedRecords:1,filteredRecords:1,columns:1,isLoading:1,error:1,viewConfig:1,defaultFields:1,searchTerm:1,visibleItemCount:1,isDeviceOnline:1,addButtonLabel:1,relatedToApiName:1,isAttachment:1,showForm:1,formObjectApiName:1,formWhatId:1},fields:["showNewButton"]});const Ss=z(qo,{tmpl:Fu,sel:"c-cp-exp-list-view",apiVersion:63});function Du(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".status-container",t," {background-color: #ffffff;border-radius: 8px;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);padding: 16px;margin-bottom: 16px;}.file-upload-section",t," {margin-bottom: 24px;border-bottom: 1px solid #f0f0f0;padding-bottom: 16px;}.status-header",t," {margin-bottom: 12px;border-bottom: 1px solid #f0f0f0;padding-bottom: 8px;}.status-header",t," h3",t," {font-size: 16px;font-weight: 600;color: #333333;margin: 0;}.status-content",t," {padding: 8px 0;}.status-select-container",t," {margin-bottom: 16px;}.status-select-container",t," label",t," {display: block;font-size: 14px;font-weight: 500;margin-bottom: 8px;color: #555555;}.select-wrapper",t," {position: relative;width: 100%;}.status-select",t,` {width: 100%;padding: 10px 12px;font-size: 14px;border: 1px solid #d1d5db;border-radius: 6px;background-color: #ffffff;color: #374151;cursor: pointer;transition:\r
 border-color 0.2s ease,\r
 box-shadow 0.2s ease;box-sizing: border-box;font-family: inherit;}select.status-select`,t,` {appearance: none;-webkit-appearance: none;-moz-appearance: none;background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat: no-repeat;background-position: right 12px center;background-size: 16px;}textarea.status-select`,t," {resize: vertical;min-height: 80px;max-height: 120px;font-family: inherit;background-image: none;box-sizing: border-box;line-height: 1.4;}input.status-select",t," {background-image: none;box-sizing: border-box;height: auto;min-height: 42px;}input[type='date'].status-select",t," {background-image: none;box-sizing: border-box;height: auto;min-height: 42px;-webkit-appearance: none;-moz-appearance: none;appearance: none;}.status-select:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);}.status-select:disabled",t," {background-color: #f3f4f6;cursor: not-allowed;opacity: 0.7;}.save-button-container",t," {display: flex;justify-content: center;margin: 16px 0;}.save-button",t," {display: flex;align-items: center;justify-content: center;background-color: #3b82f6;color: white;border: none;border-radius: 6px;padding: 10px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: background-color 0.2s ease;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.save-button:hover",t," {background-color: #2563eb;}.save-button:active",t," {background-color: #1d4ed8;transform: translateY(1px);}.save-button:disabled",t," {background-color: #9ca3af;cursor: not-allowed;opacity: 0.7;}.save-icon",t,` {display: inline-block;width: 16px;height: 16px;margin-right: 8px;background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z'%3E%3C/path%3E%3Cpolyline points='17 21 17 13 7 13 7 21'%3E%3C/polyline%3E%3Cpolyline points='7 3 7 8 15 8'%3E%3C/polyline%3E%3C/svg%3E");background-repeat: no-repeat;background-position: center;}.status-display`,t," {margin-top: 16px;display: flex;justify-content: center;}.status-completed",t,",\r.status-done",t,",\r.status-finished",t,",\r.status-active",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(16, 185, 129, 0.15);color: #065f46;font-size: 14px;font-weight: 600;letter-spacing: 0.025em;}.status-in-progress",t,",\r.status-ongoing",t,",\r.status-started",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(234, 179, 8, 0.15);color: #92400e;font-size: 14px;font-weight: 600;letter-spacing: 0.025em;}.status-pending",t,",\r.status-not-started",t,",\r.status-todo",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(124, 58, 237, 0.15);color: #4c1d95;font-size: 14px;font-weight: 600;letter-spacing: 0.025em;}.status-blocked",t,",\r.status-stopped",t,",\r.status-halted",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(239, 68, 68, 0.15);color: #991b1b;font-size: 14px;font-weight: 600;letter-spacing: 0.025em;}.status-default",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);color: #6b7280;font-size: 14px;font-weight: 600;letter-spacing: 0.025em;}.error-message",t," {display: flex;align-items: center;padding: 10px;margin-top: 12px;background-color: #fee2e2;border: 1px solid #fecaca;border-radius: 6px;color: #b91c1c;font-size: 14px;}.error-icon",t," {margin-right: 8px;}.status-note",t," {margin-top: 8px;font-size: 12px;color: #6b7280;font-style: italic;}.spinner-container",t," {display: flex;justify-content: center;padding: 20px 0;}.spinner",t," {width: 30px;height: 30px;border: 3px solid rgba(59, 130, 246, 0.2);border-radius: 50%;border-top-color: #3b82f6;animation: spin",o," 1s linear infinite;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.section-container",t," {margin-bottom: 24px;background-color: #ffffff;border: 1px solid #e5e7eb;border-radius: 8px;overflow: hidden;}.section-header",t," {background-color: #f9fafb;border-bottom: 1px solid #e5e7eb;padding: 12px 16px;}.section-header",t," h3",t," {font-size: 16px;font-weight: 600;color: #111827;margin: 0;}.section-container",t," .file-upload-section",t,",\r.section-container",t," .status-select-container",t," {padding: 16px;margin-bottom: 0;border-bottom: none;}.closed-fields-container",t," {padding: 16px;margin-top: 16px;border-top: 1px solid #e5e7eb;background-color: #f8fafc;}.field-container",t," {margin-bottom: 16px;}.field-container:last-child",t," {margin-bottom: 0;}.field-container",t," label",t," {display: block;font-size: 14px;font-weight: 500;margin-bottom: 6px;color: #374151;}.field-select",t,",\r.field-input",t,` {width: 100%;padding: 8px 12px;font-size: 14px;border: 1px solid #d1d5db;border-radius: 6px;background-color: #ffffff;color: #374151;transition:\r
 border-color 0.2s ease,\r
 box-shadow 0.2s ease;}.field-select`,t,` {appearance: none;-webkit-appearance: none;-moz-appearance: none;background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat: no-repeat;background-position: right 12px center;background-size: 16px;cursor: pointer;}.field-textarea`,t,` {width: 100%;padding: 8px 12px;font-size: 14px;border: 1px solid #d1d5db;border-radius: 6px;background-color: #ffffff;color: #374151;resize: vertical;min-height: 80px;font-family: inherit;transition:\r
 border-color 0.2s ease,\r
 box-shadow 0.2s ease;}.field-select:focus`,t,",\r.field-input:focus",t,",\r.field-textarea:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);}.field-select:disabled",t,",\r.field-input:disabled",t,",\r.field-textarea:disabled",t," {background-color: #f3f4f6;cursor: not-allowed;opacity: 0.7;}"].join("")}var zo=[Du];const Tu=p`<div class="spinner-container${0}"${2}><div class="spinner${0}"${2}></div></div>`,Ou=p`<div class="section-header${0}"${2}><h3${3}>Closure Evidence</h3></div>`,Lu=p`<div class="error-message${0}"${2}><span class="error-icon${0}"${2}>⚠️</span><span${3}>${"t4"}</span></div>`,Nu=p`<div class="section-header${0}"${2}><h3${3}>Closure Details</h3></div>`,Mu=p`<label${"a0:for"}${3}>Status:</label>`,Pu=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,ju=p`<div class="status-note${0}"${2}><p${3}>Upload files to enable status updates</p></div>`,Uu=p`<label${"a0:for"}${3}>Closed By:</label>`,Vu=p`<option value${3}>--NONE--</option>`,qu=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,zu=p`<label${"a0:for"}${3}>Closed On:</label>`,Wu=p`<div class="status-select-container${0}"${2}><label${"a1:for"}${3}>Closure Comment:</label><textarea${"a3:id"} class="status-select${0}" rows="4" placeholder="Enter closure comment..."${"a3:disabled"}${2}></textarea></div>`,Bu=p`<div class="save-button-container${0}"${2}><button class="save-button${0}"${"a1:disabled"}${2}><span class="save-icon${0}"${2}></span>Save</button></div>`,Hu={classMap:{"status-container":!0},key:0},Ju={classMap:{"section-container":!0},key:3},Qu={classMap:{"file-upload-section":!0},key:6},Yu={classMap:{"section-container":!0},key:10},Ku={classMap:{"status-select-container":!0},key:13},Gu={classMap:{"select-wrapper":!0},key:16},Es={"status-select":!0},Xu={classMap:{"status-select-container":!0},key:22},Zu={classMap:{"select-wrapper":!0},key:25},ep={classMap:{"status-select-container":!0},key:31};function Ge(n,e,s,t){const{st:o,b:i,c:a,h:r,d:l,sp:c,gid:d,k:h,i:u,f}=n,{_m0:g,_m1:_,_m2:m,_m3:x,_m4:k}=t;return[r("div",Hu,[e.isLoading?o(Tu,2):null,e.isLoading?null:r("div",Ju,[o(Ou,5),r("div",Qu,[a("c-aws-s3-files",zt,{props:{recordId:e.recordId,objectApiName:e.objectApiName,type:"post-inspection"},key:7,on:g||(t._m0={filesuploaded:i(e.handleFilesUploaded),filesloaded:i(e.handleFilesLoaded)})})])]),e.isLoading?null:e.errorMessage?o(Lu,9,[c(4,null,l(e.errorMessage))]):null,e.isLoading?null:r("div",Yu,[o(Nu,12),r("div",Ku,[o(Mu,15,[c(0,{attrs:{for:d("status-select")}},null)]),r("div",Gu,[r("select",{classMap:Es,attrs:{id:d("status-select"),disabled:e.isStatusDisabled?"":null},key:17,on:_||(t._m1={change:i(e.handleStatusChange)})},u(e.statusOptions,function($){return o(Pu,h(19,$.value),[c(0,{attrs:{value:$.value,selected:$.selected?"":null}},null),c(1,null,l($.label))])}))]),e.hasFiles?null:o(ju,21)]),e.showClosedFields&&e.isIncidentObject?r("div",Xu,[o(Uu,24,[c(0,{attrs:{for:d("closed-by")}},null)]),r("div",Zu,[r("select",{classMap:Es,attrs:{id:d("closed-by"),disabled:e.areConditionalFieldsDisabled?"":null},key:26,on:m||(t._m2={change:i(e.handleClosedByChange)})},f([o(Vu,28),u(e.userOptions,function($){return o(qu,h(30,$.value),[c(0,{attrs:{value:$.value,selected:$.selected?"":null}},null),c(1,null,l($.label))])})]))])]):null,e.showClosedFields&&e.isIncidentObject?r("div",ep,[o(zu,33,[c(0,{attrs:{for:d("closed-on")}},null)]),r("input",{classMap:Es,attrs:{id:d("closed-on"),type:"date",disabled:e.isClosedOnReadOnly?"":null},props:{value:e.closedOnValue},key:34})]):null,e.showClosedFields&&e.isHazardObject?o(Wu,36,[c(1,{attrs:{for:d("closure-comment")}},null),c(3,{on:x||(t._m3={change:i(e.handleClosureCommentChange)}),attrs:{id:d("closure-comment"),disabled:e.areConditionalFieldsDisabled?"":null}},null)]):null,o(Bu,38,[c(1,{on:k||(t._m4={click:i(e.handleSave)}),attrs:{disabled:e.isSaveDisabled?"":null}},null)])])])]}var tp=J(Ge);Ge.stylesheets=[],Ge.stylesheetToken="lwc-241f6tjv2pv",Ge.legacyStylesheetToken="c-status_status",zo&&Ge.stylesheets.push.apply(Ge.stylesheets,zo),Q(Ge);class Wo extends K{constructor(...e){super(...e);this.recordId=void 0,this.objectApiName=void 0,this.filesUploaded=!1,this.statusOptions=[],this.currentStatus="",this.isLoading=!1,this.errorMessage="",this.selectedStatus="",this.statusChanged=!1,this.userOptions=[],this.closedByValue="",this.closedOnValue="",this.closureCommentValue="",this.currentUserId=null,this.closedFieldsChanged=!1,this.READ_ONLY_FIELDS=["Rhythm__Closed_on__c"]}connectedCallback(){this.recordId&&this.loadStatusData()}refreshStatus(){this.recordId&&this.loadStatusData()}setFilesUploaded(e){this.filesUploaded=e,e&&this.recordId&&this.loadStatusData()}handleFilesUploaded(e){this.currentStatus==="Closed"?this.filesUploaded=!1:this.filesUploaded=!0,this.dispatchEvent(new CustomEvent("filesuploaded",{detail:e.detail,bubbles:!0,composed:!0}))}handleFilesLoaded(e){console.log("\u{1F4C1} Files loaded event received:",e.detail),e.detail&&e.detail.hasFiles&&(this.currentStatus==="Closed"?this.filesUploaded=!1:this.filesUploaded=!0,console.log("\u{1F4C1} Files exist for this type, enabling status selection"))}async loadStatusData(){if(!(!this.recordId||!this.objectApiName)){this.isLoading=!0,this.errorMessage="";try{if(!await V()){this.errorMessage="Cannot update status while offline",this.isLoading=!1;return}const e=await Ja(this.objectApiName,this.recordId);e?(this.currentStatus=e.Rhythm__Status__c||"",this.selectedStatus=this.currentStatus,this.statusChanged=!1,e.Rhythm__Status__c==="Closed"&&(this.filesUploaded=!1),this.isIncidentObject?(this.closedByValue=e.Rhythm__Closed_by__c||"",this.closedOnValue=e.Rhythm__Closed_on__c||"",console.log("Loaded existing incident values:",{closedBy:this.closedByValue,closedOn:this.closedOnValue})):this.isHazardObject&&(this.closureCommentValue=e.Rhythm__Closure_Comment__c||"",console.log("Loaded existing hazard closure comment:",this.closureCommentValue)),await this.fetchStatusOptions(),await this.loadUserData(),console.log("Status data loading completed:",{currentStatus:this.currentStatus,selectedStatus:this.selectedStatus,currentUserId:this.currentUserId,userOptions:this.userOptions,showClosedFields:this.showClosedFields})):this.errorMessage="Record not found"}catch(e){console.error("Error loading status data:",e),this.errorMessage="Error loading status data: "+(e.message||e)}finally{this.isLoading=!1}}}async fetchStatusOptions(){try{const s=(await vt(this.objectApiName)).fields.find(t=>t.name==="Rhythm__Status__c");s&&s.picklistValues?(this.statusOptions=s.picklistValues.filter(t=>t.active).map(t=>({label:t.label,value:t.value,selected:t.value===this.currentStatus})),console.log("\u{1F4CB} Fetched picklist values for Rhythm__Status__c:",this.statusOptions)):console.warn("\u26A0\uFE0F Could not find Rhythm__Status__c field or its picklist values")}catch(e){console.error("Error fetching status options:",e),this.errorMessage="Error fetching status options: "+(e.message||e)}}async loadUserData(){try{let e=sessionStorage.getItem("sf_user_id");if(e||(e=localStorage.getItem("sf_user_id")),!e){console.error("Failed to get current user ID from storage");return}if(this.currentUserId=e,console.log("Current user ID:",this.currentUserId),this.isIncidentObject){try{const s=await this.getCurrentUserName();console.log("Current user name:",s),this.userOptions=[{label:s||"Current User",value:this.currentUserId,selected:this.closedByValue===this.currentUserId}],console.log("User options set:",this.userOptions)}catch(s){console.error("Error getting user name:",s),this.userOptions=[{label:"Current User",value:this.currentUserId,selected:this.closedByValue===this.currentUserId}]}if(!this.closedOnValue){const s=new Date,t=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");this.closedOnValue=`${t}-${o}-${i}`}}}catch(e){console.error("Error loading user data:",e)}}async getCurrentUserName(){try{const t=await(await ne("c/authUtils/v/1_0_0")).default.getConnectionForComponent("Status");if(!t)return console.error("No Salesforce connection available"),"Current User";const o=`SELECT Id, Name FROM User WHERE Id = '${this.currentUserId}' LIMIT 1`;console.log("Executing user query:",o);const i=await t.query(o);return console.log("User query result:",i),i&&i.records&&i.records.length>0?i.records[0].Name:"Current User"}catch(e){return console.error("Error querying current user name:",e),"Current User"}}handleStatusChange(e){const s=e.target.value;if(s===this.currentStatus){this.statusChanged=!1;return}if(this.selectedStatus=s,this.statusChanged=!0,s==="Closed"){if(this.isIncidentObject){this.closedByValue=this.currentUserId,console.log("Auto-populated Closed By with:",this.currentUserId),this.userOptions=this.userOptions.map(r=>({...r,selected:r.value===this.currentUserId}));const t=new Date,o=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");this.closedOnValue=`${o}-${i}-${a}`,console.log("Auto-populated Closed On with:",this.closedOnValue)}this.closedFieldsChanged=!0}}handleClosedByChange(e){this.closedByValue=e.target.value,this.closedFieldsChanged=!0}handleClosedOnChange(e){this.closedOnValue=e.target.value,this.closedFieldsChanged=!0}handleClosureCommentChange(e){this.closureCommentValue=e.target.value,this.closedFieldsChanged=!0}renderedCallback(){if(this.showClosedFields){if(this.isIncidentObject){const e=this.template.querySelector("#closed-by");e&&this.closedByValue&&(e.value=this.closedByValue,console.log("Set closed by value:",this.closedByValue));const s=this.template.querySelector("#closed-on");s&&this.closedOnValue&&(s.value=this.closedOnValue,console.log("Set closed on value:",this.closedOnValue))}if(this.isHazardObject){const e=this.template.querySelector("#closure-comment");e&&this.closureCommentValue&&(e.value=this.closureCommentValue,console.log("Set closure comment value:",this.closureCommentValue))}}}async handleSave(){if(!(!this.statusChanged&&!this.closedFieldsChanged||!this.selectedStatus)){this.isLoading=!0,this.errorMessage="";try{if(!await V()){this.errorMessage="Cannot update status while offline",this.isLoading=!1;return}const e={Id:this.recordId,Rhythm__Status__c:this.selectedStatus};this.selectedStatus==="Closed"&&(this.isIncidentObject?(this.closedByValue&&(e.Rhythm__Closed_by__c=this.closedByValue),this.closedOnValue&&(e.Rhythm__Closed_on__c=this.closedOnValue)):this.isHazardObject&&this.closureCommentValue&&(e.Rhythm__Closure_Comment__c=this.closureCommentValue)),console.log("Updating record with data:",e);const s=await oe(this.objectApiName,e);if(s&&s.success){const t=this.currentStatus;this.currentStatus=this.selectedStatus,this.statusOptions=this.statusOptions.map(o=>({...o,selected:o.value===this.selectedStatus})),this.statusChanged=!1,this.closedFieldsChanged=!1,this.dispatchEvent(new CustomEvent("statuschange",{detail:{recordId:this.recordId,objectApiName:this.objectApiName,status:this.currentStatus,previousStatus:t,updatedData:e},bubbles:!0,composed:!0})),console.log("Status updated successfully:",e)}else this.errorMessage="Failed to update status"}catch(e){console.error("Error updating status:",e),this.errorMessage="Error updating status: "+(e.message||e)}finally{this.isLoading=!1}}}get hasFiles(){return this._filesUploaded||this.filesUploaded}get isStatusDisabled(){return!this.hasFiles}get isSaveDisabled(){return!this.hasFiles||!this.statusChanged&&!this.closedFieldsChanged}get statusClass(){const e=this.currentStatus.toLowerCase();return["completed","done","finished","active"].includes(e)?"status-completed":["in progress","ongoing","started"].includes(e)?"status-in-progress":["pending","not started","todo"].includes(e)?"status-pending":["blocked","stopped","halted","rejected"].includes(e)?"status-blocked":"status-default"}get showClosedFields(){return this.selectedStatus==="Closed"||this.currentStatus==="Closed"}get isIncidentObject(){return this.objectApiName==="Rhythm__Incident_Injury__c"}get isHazardObject(){return this.objectApiName==="Rhythm__Hazard__c"}get areConditionalFieldsDisabled(){return this.isStatusDisabled}isFieldReadOnly(e){return this.READ_ONLY_FIELDS.includes(e)}get isClosedOnReadOnly(){return this.isFieldReadOnly("Rhythm__Closed_on__c")}}Y(Wo,{publicProps:{recordId:{config:0},objectApiName:{config:0}},publicMethods:["refreshStatus","setFilesUploaded"],track:{filesUploaded:1,statusOptions:1,currentStatus:1,isLoading:1,errorMessage:1,selectedStatus:1,statusChanged:1,userOptions:1,closedByValue:1,closedOnValue:1,closureCommentValue:1,currentUserId:1,closedFieldsChanged:1},fields:["READ_ONLY_FIELDS"]});const Bo=z(Wo,{tmpl:tp,sel:"c-status",apiVersion:63});function sp(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".training-attendance-container",t,` {font-family:\r
 'Inter',\r
 -apple-system,\r
 BlinkMacSystemFont,\r
 'Segoe UI',\r
 Roboto,\r
 Arial,\r
 sans-serif;color: #1f2937;width: 100%;padding: 0;background: #f8fafc;}.loading-spinner`,t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 60px 20px;color: #6b7280;}.spinner",t," {width: 48px;height: 48px;border: 4px solid #f3f4f6;border-top: 4px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 20px;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;}.error-message",t," {display: flex;flex-direction: column;align-items: center;padding: 40px 20px;background: #fef2f2;border: 1px solid #fecaca;border-radius: 16px;margin: 20px;color: #dc2626;text-align: center;}.error-icon",t," {font-size: 48px;margin-bottom: 16px;}.error-text",t," {font-size: 16px;font-weight: 500;margin-bottom: 20px;}.retry-button",t," {background: #dc2626;color: white;border: none;border-radius: 8px;padding: 12px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: background-color 0.2s;}.retry-button:hover",t," {background: #b91c1c;}.session-details-section",t," {padding: 20px;margin-bottom: 20px;}.section-title",t," {font-size: 20px;font-weight: 700;color: #1f2937;margin: 0 0 20px 0;text-align: center;}.info-tiles-grid",t," {display: grid;grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));gap: 16px;margin-bottom: 20px;}.info-tile",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);padding: 20px;display: flex;align-items: center;gap: 16px;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.info-tile:hover",t," {box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.tile-icon",t," {width: 48px;height: 48px;border-radius: 12px;display: flex;align-items: center;justify-content: center;flex-shrink: 0;}.tile-icon",t," svg",t," {width: 24px;height: 24px;}.site-icon",t," {background: rgba(16, 185, 129, 0.15);color: #065f46;}.date-icon",t," {background: rgba(139, 92, 246, 0.15);color: #4c1d95;}.topic-icon",t," {background: rgba(59, 130, 246, 0.15);color: #1e3a8a;}.trainer-icon",t," {background: rgba(245, 158, 11, 0.15);color: #92400e;}.participants-icon",t," {background: rgba(236, 72, 153, 0.15);color: #be185d;}.duration-icon",t," {background: rgba(34, 197, 94, 0.15);color: #14532d;}.tile-content",t," {flex: 1;}.tile-label",t," {font-size: 12px;font-weight: 600;color: #6b7280;letter-spacing: 0.05em;margin-bottom: 4px;}.tile-value",t," {font-size: 16px;font-weight: 600;color: #1f2937;line-height: 1.4;}.attendees-section",t," {padding: 0 20px 20px 20px;}.section-header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: 16px;}.section-header",t," .section-title",t," {font-size: 18px;margin: 0;text-align: left;}.attendee-count",t," {font-size: 14px;color: #6b7280;font-weight: 500;}.attendees-list",t," {display: flex;flex-direction: column;gap: 12px;}.attendee-card",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);padding: 16px;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.attendee-card:hover",t," {box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.card-content",t," {display: flex;align-items: flex-start;gap: 12px;}.card-icon",t," {width: 40px;height: 40px;background: rgba(99, 102, 241, 0.15);color: #4338ca;border-radius: 10px;display: flex;align-items: center;justify-content: center;flex-shrink: 0;}.card-icon",t," svg",t," {width: 20px;height: 20px;}.card-details",t," {flex: 1;}.card-header",t," {display: flex;justify-content: space-between;align-items: flex-start;margin-bottom: 8px;}.attendee-name",t," {font-size: 16px;font-weight: 600;color: #1f2937;line-height: 1.4;}.attendee-type-pill",t," {background: rgba(16, 185, 129, 0.15);color: #065f46;font-size: 12px;font-weight: 600;padding: 4px 8px;border-radius: 6px;letter-spacing: 0.025em;}.card-metadata",t," {display: flex;flex-direction: column;gap: 4px;}.metadata-item",t," {display: flex;gap: 8px;font-size: 14px;}.metadata-label",t," {color: #6b7280;font-weight: 500;min-width: 80px;}.metadata-value",t," {color: #374151;font-weight: 400;}.no-attendees",t," {text-align: center;padding: 40px 20px;background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);}.no-data-icon",t," {font-size: 48px;margin-bottom: 16px;opacity: 0.5;}.no-data-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;}.capture-button-container",t," {padding: 20px;background: #f8fafc;border-top: 1px solid rgba(0, 0, 0, 0.06);margin: 20px 0 60px 0;min-height: 60px;display: flex;align-items: center;padding-bottom: 40px;}.capture-attendance-btn",t," {width: 100%;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: #ffffff;border: none;border-radius: 16px;padding: 16px 24px;font-size: 16px;font-weight: 600;cursor: pointer;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);display: flex;align-items: center;justify-content: center;gap: 8px;}.capture-attendance-btn:hover",t," {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);}.capture-attendance-btn:disabled",t," {opacity: 0.6;cursor: not-allowed;transform: none;}.btn-icon",t," {width: 20px;height: 20px;}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0, 0, 0, 0.5);display: flex;align-items: center;justify-content: center;z-index: 1000;padding: 20px;}.modal-container",t," {background: #ffffff;border-radius: 20px;width: 100%;max-width: 500px;max-height: 90vh;overflow: hidden;box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);animation: modalSlideIn",o," 0.3s cubic-bezier(0.4, 0, 0.2, 1);}@keyframes modalSlideIn",o," {from {transform: translateY(30px);opacity: 0;}to {transform: translateY(0);opacity: 1;}}.modal-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 24px 24px 0 24px;border-bottom: 1px solid #f3f4f6;margin-bottom: 24px;}.modal-title",t," {font-size: 20px;font-weight: 700;color: #1f2937;margin: 0;}.close-button",t," {background: none;border: none;cursor: pointer;padding: 8px;border-radius: 8px;color: #6b7280;transition: all 0.2s;}.close-button:hover",t," {background: #f3f4f6;color: #374151;}.close-button",t," svg",t," {width: 20px;height: 20px;}.modal-content",t," {padding: 0 24px;max-height: 60vh;overflow-y: auto;position: relative;}.form-subtitle",t," {font-size: 14px;color: #6b7280;margin-bottom: 24px;text-align: center;}.session-selection-section",t," {margin-bottom: 24px;padding: 20px;background: #ffffff;border: 2px solid #e5e7eb;border-radius: 12px;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.session-selection-section",t," .form-group",t," {margin-bottom: 0;}.session-selection-section",t," .form-label",t," {font-size: 14px;font-weight: 600;color: #374151;margin-bottom: 8px;display: block;}.session-select",t," {width: 100%;padding: 12px 16px;border: 2px solid #d1d5db;border-radius: 8px;font-size: 14px;font-weight: 500;color: #374151;background: #ffffff;transition: all 0.2s ease;}.session-select:focus",t," {outline: none;border-color: #667eea;box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);}.help-text",t," {margin-top: 8px;font-size: 12px;color: #6b7280;font-style: italic;line-height: 1.4;}.grouped-attendance-container",t," {display: flex;flex-direction: column;gap: 24px;}.attendance-group",t," {background: #ffffff;border-radius: 12px;border: 1px solid #e5e7eb;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);overflow: hidden;}.group-header",t," {background: #f8fafc;padding: 16px 20px;border-bottom: 1px solid #e5e7eb;display: flex;justify-content: space-between;align-items: center;}.group-title",t," {display: flex;align-items: center;gap: 8px;font-weight: 600;color: #374151;}.attendance-id-icon",t," {font-size: 16px;}.attendance-id-prefix",t," {color: #2563eb;font-weight: 700;font-size: 14px;}.attendance-id-suffix",t," {color: #374151;font-weight: 500;font-size: 14px;}.group-count",t," {font-size: 12px;color: #6b7280;background: #e5e7eb;padding: 4px 8px;border-radius: 6px;}.participants-table",t," {background: #ffffff;}.table-header",t," {display: grid;grid-template-columns: 60px 120px 1fr 120px 80px;gap: 8px;padding: 12px 16px;background: #f9fafb;border-bottom: 1px solid #e5e7eb;}.header-cell",t," {font-size: 11px;font-weight: 600;color: #6b7280;text-transform: uppercase;letter-spacing: 0.5px;}.table-body",t," {display: flex;flex-direction: column;}.table-row",t," {display: grid;grid-template-columns: 60px 120px 1fr 120px 80px;gap: 8px;padding: 16px;border-bottom: 1px solid #f3f4f6;align-items: center;}.table-row:last-child",t," {border-bottom: none;}.table-row:hover",t," {background: #f9fafb;}.table-cell",t," {font-size: 13px;color: #374151;display: flex;align-items: center;}.sno-cell",t," {justify-content: center;font-weight: 600;color: #6b7280;}.type-cell",t," {justify-content: center;}.type-pill",t," {background: #eff6ff;color: #2563eb;padding: 4px 8px;border-radius: 6px;font-size: 11px;font-weight: 500;}.name-cell",t," {font-weight: 500;color: #111827;}.designation-cell",t," {color: #6b7280;font-size: 12px;}.signature-cell",t," {justify-content: center;}.signature-box",t," {width: 32px;height: 24px;border: 1px dashed #d1d5db;border-radius: 4px;display: flex;align-items: center;justify-content: center;background: #f9fafb;}.signature-box",t," svg",t," {width: 16px;height: 16px;color: #9ca3af;}@media (max-width: 768px) {.table-header",t,",\r .table-row",t," {grid-template-columns: 50px 80px 1fr 100px 60px;gap: 4px;padding: 12px 8px;}.header-cell",t,",\r .table-cell",t," {font-size: 11px;}.type-pill",t," {font-size: 10px;padding: 2px 6px;}.group-header",t," {padding: 12px 16px;flex-direction: column;align-items: flex-start;gap: 8px;}.group-count",t," {align-self: stretch;text-align: center;}}.form-rows-container",t," {display: flex;flex-direction: column;gap: 24px;max-height: 50vh;overflow-y: auto;}.form-row",t," {background: #f8fafc;border-radius: 12px;padding: 16px;border: 1px solid #e5e7eb;}.form-row-header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: 16px;}.row-number",t," {font-size: 14px;font-weight: 600;color: #374151;}.remove-row-btn",t," {background: #fee2e2;color: #dc2626;border: none;border-radius: 6px;padding: 6px;cursor: pointer;transition: all 0.2s;}.remove-row-btn:hover",t," {background: #fecaca;}.remove-row-btn",t," svg",t," {width: 14px;height: 14px;}.form-fields",t," {display: flex;flex-direction: column;gap: 16px;}.form-field",t," {display: flex;flex-direction: column;gap: 8px;position: relative;}.field-label",t," {font-size: 12px;font-weight: 600;color: #374151;letter-spacing: 0.05em;text-transform: uppercase;}.form-input",t,",\r.form-select",t," {width: 100%;padding: 12px 16px;border: 1px solid #d1d5db;border-radius: 12px;font-size: 16px;color: #1f2937;background: #ffffff;transition: all 0.2s;box-sizing: border-box;}.form-input[data-field='designation']",t," {background: #ffffff;color: #1f2937;transition: all 0.2s ease;}.designation-readonly",t," {background: #f9fafb !important;color: #6b7280 !important;cursor: not-allowed !important;border-color: #e5e7eb !important;}.form-input:focus",t,",\r.form-select:focus",t," {outline: none;border-color: #667eea;box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);}.input-with-search",t," {position: relative;display: flex;align-items: center;}.input-with-search",t," .form-input",t," {padding-right: 48px;}.search-button",t," {position: absolute;right: 12px;background: none;border: none;cursor: pointer;padding: 4px;color: #6b7280;transition: color 0.2s;}.search-button:hover",t," {color: #374151;}.search-button[data-person-type='Contractor']",t,",\r.search-button[data-person-type='Visitor']",t," {display: none;}.input-with-search",t," input[data-person-type='Contractor']",t,",\r.input-with-search",t," input[data-person-type='Visitor']",t," {padding-right: 16px;}.search-button",t," svg",t," {width: 16px;height: 16px;}.contact-options-dropdown",t," {position: absolute;top: 100%;left: 0;right: 0;background: #ffffff;border: 1px solid #d1d5db;border-radius: 8px;box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);z-index: 9999;max-height: 200px;overflow-y: auto;margin-top: 2px;}.contact-option",t," {padding: 12px 16px;cursor: pointer;border-bottom: 1px solid #f3f4f6;transition: background-color 0.2s;background: #ffffff;min-height: 40px;display: flex;flex-direction: column;justify-content: center;}.contact-option:hover",t," {background: #f0f9ff;border-left: 3px solid #667eea;}.contact-option:last-child",t," {border-bottom: none;}.contact-name",t," {font-size: 14px;font-weight: 600;color: #1f2937;margin-bottom: 2px;}.contact-details",t," {font-size: 12px;color: #6b7280;display: flex;gap: 8px;}.contact-title",t," {font-weight: 500;}.contact-company",t," {font-style: italic;}.loading-option",t,",\r.no-contacts-found",t," {padding: 12px 16px;text-align: center;color: #6b7280;font-size: 14px;font-style: italic;}.input-with-search",t," {position: relative;}.field-helper-text",t," {font-size: 12px;color: #6b7280;margin-top: 4px;font-style: italic;}.status-indicator",t," {display: flex;align-items: center;}.status-badge",t," {display: inline-flex;align-items: center;gap: 4px;padding: 6px 12px;border-radius: 20px;font-size: 12px;font-weight: 600;}.status-badge.recorded",t," {background: rgba(16, 185, 129, 0.15);color: #065f46;}.status-badge.new",t," {background: rgba(59, 130, 246, 0.15);color: #1e3a8a;}.add-more-container",t," {margin-top: 20px;text-align: center;}.add-more-btn",t," {background: none;border: 2px dashed #d1d5db;border-radius: 12px;padding: 12px 20px;color: #6b7280;font-size: 14px;font-weight: 500;cursor: pointer;transition: all 0.2s;display: inline-flex;align-items: center;gap: 8px;}.add-more-btn:hover",t," {border-color: #667eea;color: #667eea;}.add-more-btn",t," svg",t," {width: 16px;height: 16px;}.modal-footer",t," {display: flex;gap: 12px;padding: 24px;border-top: 1px solid #f3f4f6;margin-top: 24px;}.cancel-button",t,",\r.save-button",t," {flex: 1;padding: 12px 24px;border-radius: 12px;font-size: 16px;font-weight: 600;cursor: pointer;transition: all 0.2s;display: flex;align-items: center;justify-content: center;gap: 8px;}.cancel-button",t," {background: #f3f4f6;color: #374151;border: 1px solid #d1d5db;}.cancel-button:hover",t," {background: #e5e7eb;}.save-button",t," {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: #ffffff;border: none;box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);}.save-button:hover",t," {transform: translateY(-1px);box-shadow: 0 6px 16px rgba(102, 126, 234, 0.35);}.save-button:disabled",t,",\r.cancel-button:disabled",t," {opacity: 0.6;cursor: not-allowed;transform: none;}.button-spinner",t," {width: 16px;height: 16px;border: 2px solid rgba(255, 255, 255, 0.3);border-top: 2px solid #ffffff;border-radius: 50%;animation: spin",o," 1s linear infinite;}@media screen and (max-width: 768px) {.info-tiles-grid",t," {grid-template-columns: 1fr;gap: 12px;}.info-tile",t," {padding: 16px;}.tile-icon",t," {width: 40px;height: 40px;}.tile-icon",t," svg",t," {width: 20px;height: 20px;}.tile-value",t," {font-size: 14px;}.modal-overlay",t," {padding: 0;align-items: flex-start;}.modal-container",t," {max-width: 100%;max-height: none;border-radius: 0;border-top-left-radius: 20px;border-top-right-radius: 20px;margin-top: 10vh;}.modal-header",t," {padding: 20px 20px 0 20px;}.modal-content",t," {padding: 0 20px;}.modal-footer",t," {padding: 20px;flex-direction: column;}.cancel-button",t,",\r .save-button",t," {width: 100%;}.form-input",t,",\r .form-select",t," {font-size: 16px;}}@media screen and (max-width: 480px) {.session-details-section",t,",\r .attendees-section",t,",\r .capture-button-container",t," {padding: 16px;}.section-title",t," {font-size: 18px;}.attendee-card",t," {padding: 12px;}.card-icon",t," {width: 36px;height: 36px;}.attendee-name",t," {font-size: 14px;}.metadata-item",t," {font-size: 13px;}}"].join("")}var Ho=[sp];const op=p`<div class="loading-spinner${0}"${2}><div class="spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading training details...</div></div>`,ip=p`<div class="error-message${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-text${0}"${2}>${"t4"}</div><button class="retry-button${0}"${2}>Retry</button></div>`,ap=p`<div class="session-details-section${0}"${2}><h2 class="section-title${0}"${2}>Training Attendance Sheet</h2><div class="info-tiles-grid${0}"${2}><div class="info-tile${0}"${2}><div class="tile-icon site-icon${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"${3}/><circle cx="12" cy="10" r="3"${3}/></svg></div><div class="tile-content${0}"${2}><div class="tile-label${0}"${2}>SITE/PROJECT</div><div class="tile-value${0}"${2}>${"t13"}</div></div></div><div class="info-tile${0}"${2}><div class="tile-icon date-icon${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"${3}/><line x1="16" y1="2" x2="16" y2="6"${3}/><line x1="8" y1="2" x2="8" y2="6"${3}/><line x1="3" y1="10" x2="21" y2="10"${3}/></svg></div><div class="tile-content${0}"${2}><div class="tile-label${0}"${2}>TRAINING DATE</div><div class="tile-value${0}"${2}>${"t25"}</div></div></div><div class="info-tile${0}"${2}><div class="tile-icon topic-icon${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"${3}/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"${3}/></svg></div><div class="tile-content${0}"${2}><div class="tile-label${0}"${2}>TRAINING TOPIC</div><div class="tile-value${0}"${2}>${"t35"}</div></div></div><div class="info-tile${0}"${2}><div class="tile-icon trainer-icon${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"${3}/><circle cx="12" cy="7" r="4"${3}/></svg></div><div class="tile-content${0}"${2}><div class="tile-label${0}"${2}>CONDUCTED BY</div><div class="tile-value${0}"${2}>${"t45"}</div></div></div><div class="info-tile${0}"${2}><div class="tile-icon participants-icon${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"${3}/><circle cx="9" cy="7" r="4"${3}/><path d="M23 21v-2a4 4 0 0 0-3-3.87"${3}/><path d="M16 3.13a4 4 0 0 1 0 7.75"${3}/></svg></div><div class="tile-content${0}"${2}><div class="tile-label${0}"${2}>TOTAL PARTICIPANTS</div><div class="tile-value${0}"${2}>${"t57"}</div></div></div><div class="info-tile${0}"${2}><div class="tile-icon duration-icon${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><circle cx="12" cy="12" r="10"${3}/><polyline points="12,6 12,12 16,14"${3}/></svg></div><div class="tile-content${0}"${2}><div class="tile-label${0}"${2}>DURATION</div><div class="tile-value${0}"${2}>${"t67"}</div></div></div></div></div>`,np=p`<div class="section-header${0}"${2}><h3 class="section-title${0}"${2}>Attendance Records</h3><div class="attendee-count${0}"${2}>${"t4"}</div></div>`,rp=p`<div class="group-header${0}"${2}><div class="group-title${0}"${2}><span class="attendance-id-icon${0}"${2}>📝</span><span class="attendance-id-prefix${0}"${2}>${"t5"}</span><span class="attendance-id-suffix${0}"${2}>${"t7"}</span></div><div class="group-count${0}"${2}>${"t9"}</div></div>`,lp=p`<div class="table-header${0}"${2}><div class="header-cell sno-header${0}"${2}>S.NO</div><div class="header-cell type-header${0}"${2}>TYPE</div><div class="header-cell name-header${0}"${2}>NAME</div><div class="header-cell designation-header${0}"${2}>DESIGNATION</div><div class="header-cell signature-header${0}"${2}>SIGNATURE</div></div>`,cp=p`<div class="table-row${0}"${2}><div class="table-cell sno-cell${0}"${2}>${"t2"}</div><div class="table-cell type-cell${0}"${2}><span class="type-pill${0}"${2}>${"t5"}</span></div><div class="table-cell name-cell${0}"${2}>${"t7"}</div><div class="table-cell designation-cell${0}"${2}>${"t9"}</div><div class="table-cell signature-cell${0}"${2}><div class="signature-box${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"${3}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"${3}/><polyline points="14,2 14,8 20,8"${3}/><line x1="16" y1="13" x2="8" y2="13"${3}/><line x1="16" y1="17" x2="8" y2="17"${3}/><polyline points="10,9 9,9 8,9"${3}/></svg></div></div></div>`,dp=p`<div class="no-attendees${0}"${2}><div class="no-data-icon${0}"${2}>👥</div><div class="no-data-text${0}"${2}>No attendees registered yet</div></div>`,hp=p`<div class="capture-button-container${0}"${2}><button class="capture-attendance-btn${0}"${"a1:disabled"}${2}><svg class="btn-icon${0}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${2}><circle cx="12" cy="12" r="10"${3}/><line x1="12" y1="8" x2="12" y2="16"${3}/><line x1="8" y1="12" x2="16" y2="12"${3}/></svg>Capture Attendance</button></div>`,up=p`<div class="modal-header${0}"${2}><h2 class="modal-title${0}"${2}>Capture Training Attendance</h2><button class="close-button${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><line x1="18" y1="6" x2="6" y2="18"${3}/><line x1="6" y1="6" x2="18" y2="18"${3}/></svg></button></div>`,pp=p`<div class="form-subtitle${0}"${2}>${"t1"}</div>`,fp=p`<label class="form-label${0}"${2}>Session Option</label>`,mp=p`<option${"a0:value"}${3}>${"t1"}</option>`,gp=p`<div class="help-text${0}"${2}>${"t1"}</div>`,_p=p`<span class="row-number${0}"${2}>${"t1"}</span>`,bp=p`<button class="remove-row-btn${0}"${"a0:data-row-id"} type="button"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><line x1="18" y1="6" x2="6" y2="18"${3}/><line x1="6" y1="6" x2="18" y2="18"${3}/></svg></button>`,yp=p`<label class="field-label${0}"${2}>TYPE OF PERSON</label>`,vp=p`<option value${3}>Select Type</option>`,wp=p`<option${"a0:value"}${3}>${"t1"}</option>`,xp=p`<label class="field-label${0}"${2}>NAME</label>`,kp=p`<button class="search-button${0}" type="button"${"a0:data-row-id"}${"a0:data-person-type"}${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><circle cx="11" cy="11" r="8"${3}/><path d="M21 21l-4.35-4.35"${3}/></svg></button>`,$p=p`<div class="loading-option${0}"${2}>Searching...</div>`,Cp=p`<div class="contact-name${0}"${2}>${"t1"}</div>`,Sp=p`<span class="contact-title${0}"${2}>${"t1"}</span>`,Ep=p`<span class="contact-company${0}"${2}>${"t1"}</span>`,Rp=p`<div class="no-contacts-found${0}"${2}>No contacts found for this search</div>`,Ap=p`<label class="field-label${0}"${2}>DESIGNATION</label>`,Ip=p`<div class="form-field${0}"${2}><label class="field-label${0}"${2}>STATUS</label><div class="status-indicator${0}"${2}><span class="status-badge new${0}"${2}>New Entry</span></div></div>`,Fp=p`<div class="add-more-container${0}"${2}><button class="add-more-btn${0}" type="button"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><circle cx="12" cy="12" r="10"${3}/><line x1="12" y1="8" x2="12" y2="16"${3}/><line x1="8" y1="12" x2="16" y2="12"${3}/></svg>Add More Rows</button></div>`,Dp=p`<button class="cancel-button${0}"${"a0:disabled"}${2}>Cancel</button>`,Tp=p`<div class="button-spinner${0}"${2}></div>`,Op={classMap:{"training-attendance-container":!0},key:0},Lp={classMap:{"attendees-section":!0},key:7},Np={classMap:{"grouped-attendance-container":!0},key:10},Mp={"attendance-group":!0},Pp={classMap:{"participants-table":!0},key:14},jp={classMap:{"table-body":!0},key:17},Up={classMap:{"modal-overlay":!0},key:24},Vp={classMap:{"modal-container":!0},key:25},qp={classMap:{"modal-content":!0},key:28},zp={classMap:{"session-selection-section":!0},key:31},Wp={classMap:{"form-group":!0},key:32},Bp={"form-select":!0,"session-select":!0},Hp={classMap:{"form-rows-container":!0},key:40},Jp={"form-row":!0},Qp={classMap:{"form-row-header":!0},key:42},Yp={classMap:{"form-fields":!0},key:47},Kp={classMap:{"form-field":!0},key:48},Gp={"form-select":!0},Xp={classMap:{"form-field":!0},key:56},Zp={classMap:{"input-with-search":!0},key:59},Jo={"form-input":!0},ef={classMap:{"field-helper-text":!0},key:63},tf={classMap:{"contact-options-dropdown":!0},key:64},sf={"contact-option":!0},of={classMap:{"contact-details":!0},key:70},Qo=[],af={classMap:{"form-field":!0},key:77},nf={classMap:{"modal-footer":!0},key:85},rf={"save-button":!0};function Xe(n,e,s,t){const{st:o,d:i,b:a,sp:r,k:l,i:c,h:d,f:h,t:u}=n,{_m0:f,_m1:g,_m2:_,_m3:m,_m4:x,_m5:k,_m6:$,_m7:S,_m8:O,_m9:F,_m10:D,_m11:v,_m12:A,_m13:w}=t;return[d("div",Op,[e.isLoading?o(op,2):null,e.hasError?o(ip,4,[r(4,null,i(e.errorMessage)),r(5,{on:f||(t._m0={click:a(e.handleRefresh)})},null)]):null,e.isLoading||e.hasError?null:o(ap,6,[r(13,null,i(e.locationName)),r(25,null,i(e.formattedTrainingDate)),r(35,null,i(e.trainingTopic)),r(45,null,i(e.trainedBy)),r(57,null,i(e.totalParticipants)),r(67,null,i(e.duration))]),e.isLoading||e.hasError?null:d("div",Lp,[o(np,9,[r(4,null,i(e.attendanceSummaryText))]),e.hasGroupedAttendanceRecords?d("div",Np,c(e.groupedAttendanceRecords,function(y){return d("div",{classMap:Mp,key:l(11,y.attendanceId)},[o(rp,13,[r(5,null,i(y.attendanceIdPrefix)),r(7,null,i(y.attendanceIdSuffix)),r(9,null,i(y.count)+" participant(s) in this session")]),d("div",Pp,[o(lp,16),d("div",jp,c(y.attendees,function(C){return o(cp,l(19,C.Id),[r(2,null,i(C.serialNumber)),r(5,null,i(C.Rhythm__Type_of_Person__c)),r(7,null,i(C.Rhythm__Personnel_Name__c)),r(9,null,i(C.Rhythm__Designation__c))])}))])])})):null,e.hasAttendanceRecords?null:o(dp,21)]),e.isLoading||e.hasError?null:o(hp,23,[r(1,{on:g||(t._m1={click:a(e.handleCaptureAttendance)}),attrs:{disabled:e.isSubmitting?"":null}},null)]),e.showCaptureForm?d("div",Up,[d("div",Vp,[o(up,27,[r(3,{on:_||(t._m2={click:a(e.handleCloseForm)})},null)]),d("div",qp,[o(pp,30,[r(1,null,"Add participants for "+i(e.trainingTopic)+" - "+i(e.formattedTrainingDate))]),d("div",zp,[d("div",Wp,[o(fp,34),d("select",{classMap:Bp,key:35,on:m||(t._m3={change:a(e.handleSessionOptionChange)})},c(e.sessionOptions,function(y){return o(mp,l(37,y.value),[r(0,{attrs:{value:y.value}},null),r(1,null,i(y.label))])})),e.sessionSelectionHelpText?o(gp,39,[r(1,null,i(e.sessionSelectionHelpText))]):null])]),d("div",Hp,c(e.formRows,function(y){return d("div",{classMap:Jp,key:l(41,y.id)},[d("div",Qp,[o(_p,44,[r(1,null,"Participant "+i(y.id))]),e.formRows.length&&y.id&&e.formRows.length?o(bp,46,[r(0,{on:k||(t._m5={click:a(e.handleRemoveRow)}),attrs:{"data-row-id":y.id}},null)]):null]),d("div",Yp,[d("div",Kp,[o(yp,50),d("select",{classMap:Gp,attrs:{"data-row-id":y.id},key:51,on:$||(t._m6={change:a(e.handleTypeOfPersonChange)})},h([o(vp,53),c(e.typeOfPersonOptions,function(C){return o(wp,l(55,C.value),[r(0,{attrs:{value:C.value}},null),r(1,null,i(C.label))])})]))]),d("div",Xp,[o(xp,58),d("div",Zp,[d("input",{classMap:Jo,attrs:{type:"text",placeholder:"Enter name","data-field":"searchQuery","data-row-id":y.id,"data-person-type":y.typeOfPerson},props:{value:y.searchQuery},key:60,on:S||(t._m7={input:a(e.handleInputChange)})}),o(kp,62,[r(0,{attrs:{"data-row-id":y.id,"data-person-type":y.typeOfPerson}},null)])]),d("div",ef,[y.typeOfPerson&&y.typeOfPerson?u("Search for existing contacts to auto-fill designation"):null,y.typeOfPerson?y.typeOfPerson?null:u("Enter name and designation manually"):null,y.typeOfPerson?null:u("Select type of person first")]),y.showContactOptions?d("div",tf,h([e.isLoadingContacts?o($p,66):null,e.isLoadingContacts?Qo:h([y.contactOptions.length?c(y.contactOptions,function(C){return d("div",{classMap:sf,attrs:{"data-contact-id":C.id,"data-row-id":y.id},key:l(67,C.id),on:O||(t._m8={click:a(e.handleContactSelect)})},[o(Cp,69,[r(1,null,i(C.name))]),d("div",of,[C.title?o(Sp,72,[r(1,null,i(C.title))]):null,C.company?o(Ep,74,[r(1,null,"("+i(C.company)+")")]):null])])}):Qo,y.contactOptions.length?null:o(Rp,76)])])):null]),d("div",af,[o(Ap,79),d("input",{classMap:Jo,attrs:{type:"text",placeholder:"Enter designation","data-field":"designation","data-row-id":y.id,"data-person-type":y.typeOfPerson},props:{value:y.designation},key:80,on:F||(t._m9={input:a(e.handleInputChange)})})]),o(Ip,82)])])})),o(Fp,84,[r(1,{on:D||(t._m10={click:a(e.handleAddMoreRows)})},null)])]),d("div",nf,[o(Dp,87,[r(0,{on:A||(t._m12={click:a(e.handleCloseForm)}),attrs:{disabled:e.isSubmitting?"":null}},null)]),d("button",{classMap:rf,attrs:{disabled:e.isSubmitting?"":null},key:88,on:w||(t._m13={click:a(e.handleSaveAttendance)})},[e.isSubmitting?o(Tp,90):null,e.isSubmitting?u("Saving..."):null,e.isSubmitting?null:u("Save Attendance")])])])]):null])]}var lf=J(Xe);Xe.stylesheets=[],Xe.stylesheetToken="lwc-273r0haspke",Xe.legacyStylesheetToken="c-trainingAttendanceForm_trainingAttendanceForm",Ho&&Xe.stylesheets.push.apply(Xe.stylesheets,Ho),Q(Xe);class Yo extends K{constructor(...e){super(...e);this.recordId=void 0,this.objectApiName=void 0,this.isLoading=!0,this.hasError=!1,this.errorMessage="",this.sessionData=null,this.attendanceRecords=[],this.totalParticipants=0,this.groupedAttendanceRecords=[],this.showCaptureForm=!1,this.isSubmitting=!1,this.formRows=[{id:1,typeOfPerson:"",personnelName:"",personnelId:"",designation:"",searchQuery:"",showContactOptions:!1,contactOptions:[]}],this.typeOfPersonOptions=[],this.contactOptions=[],this.isLoadingContacts=!1,this.sessionOptions=[],this.sessionSelectionHelpText="",this.selectedSessionToExtend="new"}connectedCallback(){console.log("\u{1F3AF} TrainingAttendanceForm connected with recordId:",this.recordId),this.loadTrainingData()}renderedCallback(){try{this.showCaptureForm&&(this.updateDesignationFieldStyling(),this.updateSelectValues(),this.updateSessionDropdown(),console.log("\u{1F504} Form rendered with session options:",this.sessionOptions.map(e=>e.label).join(", ")))}catch(e){console.error("Error in renderedCallback:",e)}}async loadTrainingData(){try{this.isLoading=!0,this.hasError=!1,await this.loadSessionData(),await this.loadAttendanceRecords(),await this.loadPicklistOptions(),await this.loadContactOptions()}catch(e){console.error("\u274C Error loading training data:",e),this.hasError=!0,this.errorMessage=e.message||"Failed to load training data"}finally{this.isLoading=!1}}async loadSessionData(){const e=`
            SELECT 
                Id,
                Rhythm__DateOfTraining__c,
                Rhythm__Location__r.Name,
                Rhythm__Topic__c,
                Rhythm__Trained_By__c,
                Rhythm__DurationOfTraining__c
            FROM Rhythm__HFE_Session__c 
            WHERE Id = '${this.recordId}'
            LIMIT 1
        `;console.log("\u{1F50D} Loading session data with query:",e);const s=await le(e);if(s&&s.length>0)this.sessionData=s[0],console.log("\u2705 Session data loaded:",this.sessionData);else throw new Error("Training session not found")}async loadAttendanceRecords(){const e=`
            SELECT 
                Id,
                Rhythm__Date__c,
                Rhythm__Type_of_Person__c,
                Rhythm__Personnel_Name__c,
                Rhythm__Designation__c,
                Rhythm__Attendance_Id__c
            FROM Rhythm__HFE_Attendance__c 
            WHERE Rhythm__HFE_Session__c = '${this.recordId}'
            ORDER BY CreatedDate DESC
        `;console.log("\u{1F50D} Loading attendance records with query:",e);const s=await le(e);this.attendanceRecords=s||[],this.totalParticipants=this.attendanceRecords.length,console.log("\u2705 Attendance records loaded:",this.attendanceRecords.length,"records"),this.groupAttendanceRecords()}groupAttendanceRecords(){if(!this.attendanceRecords||this.attendanceRecords.length===0){this.groupedAttendanceRecords=[];return}console.log("\u{1F50D} Grouping attendance records, total:",this.attendanceRecords.length);const e={};this.attendanceRecords.forEach(s=>{const t=s.Rhythm__Attendance_Id__c||"Unknown";console.log(`\u{1F4DD} Record ${s.Id} has attendance ID: ${t}`),e[t]||(e[t]=[]);const o={...s,attendanceId:t};e[t].push(o)}),console.log("\u{1F4CA} Grouped by attendance ID:",Object.keys(e)),this.groupedAttendanceRecords=Object.keys(e).map(s=>{let t="",o="";if(s&&s!=="Unknown"){const a=s.match(/^(S-\d{4})(.*)/);a?(t=a[1],o=a[2]):o=s}else t="S-0000",o="-Unknown";const i={attendanceId:s,attendanceIdPrefix:t,attendanceIdSuffix:o,count:e[s].length,attendees:e[s].map((a,r)=>({...a,serialNumber:r+1}))};return console.log(`\u{1F4CA} Group ${s} has ${i.count} attendees`),i}),console.log("\u2705 Grouped attendance records:",this.groupedAttendanceRecords),this.updateSessionOptions()}updateSessionOptions(){console.log("\u{1F504} Updating session options");const e=[{label:"Create New Session",value:"new"}];this.groupedAttendanceRecords&&this.groupedAttendanceRecords.length>0?(console.log(`\u{1F4CA} Found ${this.groupedAttendanceRecords.length} attendance groups to add as options`),this.groupedAttendanceRecords.forEach(s=>{if(s.attendanceId&&s.attendanceId!=="Unknown"){const t={label:`Extend ${s.attendanceIdPrefix}${s.attendanceIdSuffix} (${s.count} existing)`,value:s.attendanceId};console.log(`\u{1F4CA} Adding session option: ${t.label}, value: ${t.value}`),e.push(t)}})):console.log("\u26A0\uFE0F No attendance groups found for session options"),console.log(`\u{1F4CA} Total session options: ${e.length}`),this.sessionOptions=e,(!this.selectedSessionToExtend||this.selectedSessionToExtend==="")&&(this.selectedSessionToExtend="new",console.log('\u{1F4CA} Set default session selection to "new"')),this.updateSessionSelectionHelpText(),this.updateSessionDropdown()}updateSessionDropdown(){try{const e=this.template.querySelector(".session-select");e?(e.value=this.selectedSessionToExtend,console.log(`\u{1F4CA} Updated session dropdown to ${this.selectedSessionToExtend}`)):console.log("\u26A0\uFE0F Session dropdown not found in DOM yet")}catch(e){console.error("\u274C Error updating session dropdown:",e)}}updateSessionSelectionHelpText(){this.selectedSessionToExtend==="new"?this.sessionSelectionHelpText="Creating a new attendance session with a new Attendance ID.":this.sessionSelectionHelpText=`Adding attendees to existing session: ${this.selectedSessionToExtend}`}handleSessionOptionChange(e){this.selectedSessionToExtend=e.target.value,console.log("Session option changed to:",this.selectedSessionToExtend),this.updateSessionSelectionHelpText()}async loadPicklistOptions(){try{console.log("\u{1F50D} Loading picklist options for Type of Person");const s=(await vt("Rhythm__HFE_Attendance__c")).fields.find(t=>t.name==="Rhythm__Type_of_Person__c");if(s&&s.picklistValues){if(this.typeOfPersonOptions=s.picklistValues.filter(t=>t.active).map(t=>({label:t.label,value:t.value})),this.formRows.length>0&&this.typeOfPersonOptions.length>0){const t=this.typeOfPersonOptions.find(o=>o.value.toLowerCase()==="employee");this.formRows[0].typeOfPerson=t?t.value:this.typeOfPersonOptions[0].value}console.log("\u2705 Type of Person options loaded:",this.typeOfPersonOptions)}else this.typeOfPersonOptions=[{label:"Employee",value:"Employee"},{label:"Contractor",value:"Contractor"},{label:"Visitor",value:"Visitor"}],this.formRows[0].typeOfPerson="Employee"}catch(e){console.error("\u274C Error loading picklist options:",e),this.typeOfPersonOptions=[{label:"Employee",value:"Employee"},{label:"Contractor",value:"Contractor"},{label:"Visitor",value:"Visitor"}],this.formRows[0].typeOfPerson="Employee"}}async loadContactOptions(e=""){try{this.isLoadingContacts=!0,console.log("\u{1F50D} Loading contact options with search term:",e);let s=`
                SELECT Id, Name, Rhythm__Job_Title__c, Account.Name, Email, Phone
                FROM Contact
                WHERE Name != null
                AND IsDeleted = false
            `;e&&(s+=` AND Name LIKE '%${e}%'`),s+=" ORDER BY Name LIMIT 50",console.log("\u{1F50D} Executing contact query:",s);const t=await le(s);console.log("\u{1F4CA} Raw contacts received:",t?.length||0,"search term:",e),console.log("\u{1F4CA} Contact details:",t),!t||t.length===0?(console.log("\u26A0\uFE0F No contacts found for search term:",e),this.contactOptions=[]):this.contactOptions=t.map(o=>{const i={id:o.Id,name:o.Name,title:o.Rhythm__Job_Title__c||"",company:o.Account?.Name||"",displayValue:`${o.Name}${o.Account?.Name?" ("+o.Account.Name+")":""}`};return console.log("\u{1F4DD} Processed contact option:",i),i}),console.log("\u2705 Final contact options:",this.contactOptions.length,this.contactOptions),console.log("\u2705 Contact options processed:",this.contactOptions.length,"contacts",this.contactOptions)}catch(s){console.error("\u274C Error loading contact options:",s),this.contactOptions=[]}finally{this.isLoadingContacts=!1}}get formattedTrainingDate(){return this.sessionData?.Rhythm__DateOfTraining__c?new Date(this.sessionData.Rhythm__DateOfTraining__c).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"}):""}get locationName(){return this.sessionData?.Rhythm__Location__r?.Name||""}get trainingTopic(){return this.sessionData?.Rhythm__Topic__c||""}get trainedBy(){return this.sessionData?.Rhythm__Trained_By__c||""}get duration(){return this.sessionData?.Rhythm__DurationOfTraining__c||""}get hasAttendanceRecords(){return this.attendanceRecords&&this.attendanceRecords.length>0}get hasGroupedAttendanceRecords(){return this.groupedAttendanceRecords&&this.groupedAttendanceRecords.length>0}get attendanceSummaryText(){const e=this.totalParticipants;return e===1?"1 participant":`${e} participants`}isEmployeeType(e){return e&&e.toLowerCase()==="employee"}getHelperText(e){return e.typeOfPerson?this.isEmployeeType(e.typeOfPerson)?"For employees: Search contacts to auto-fill designation":"Enter name and designation manually":""}isDesignationReadonly(e){return e.typeOfPerson&&this.isEmployeeType(e.typeOfPerson)}shouldShowSearch(e){return e.typeOfPerson&&this.isEmployeeType(e.typeOfPerson)}async handleCaptureAttendance(){try{console.log("\u{1F3AF} Opening capture attendance form"),this.resetFormData(),(!this.typeOfPersonOptions||this.typeOfPersonOptions.length===0)&&await this.loadPicklistOptions(),!this.attendanceRecords||this.attendanceRecords.length===0?(this.sessionOptions=[{label:"Create New Session",value:"new"}],await this.loadAttendanceRecords()):this.updateSessionOptions(),console.log("\u{1F4CA} Session options before showing form:",this.sessionOptions.map(e=>`${e.label} (${e.value})`).join(", ")),this.selectedSessionToExtend!=="new"&&(this.selectedSessionToExtend="new"),this.showCaptureForm=!0}catch(e){console.error("Error in handleCaptureAttendance:",e),this.showErrorToast("Failed to open attendance form. Please try again.")}}handleCloseForm(){this.showCaptureForm=!1,this.resetFormData()}handleInputChange(e){const s=e.target.dataset.field,t=parseInt(e.target.dataset.rowId,10),o=e.target.value;this.formRows=this.formRows.map(i=>{if(i.id===t){const a={...i,[s]:o};if(s==="searchQuery")console.log("\u{1F50D} Search query changed:",o,"for row type:",i.typeOfPerson),this.isEmployeeType(i.typeOfPerson)?o&&o.length>=2?this.handleContactSearch(t,o):(a.showContactOptions=!1,a.contactOptions=[]):(a.personnelName=o,a.showContactOptions=!1,a.contactOptions=[]);else if(s==="personnelName")a.personnelName=o,a.searchQuery=o;else if(s==="designation")if(!this.isEmployeeType(i.typeOfPerson))a.designation=o;else return console.log("\u{1F6AB} Designation editing blocked for employees"),i;return a}return i}),console.log("\u{1F4DD} Form row updated:",t,s,"=",o)}updateDesignationFieldStyling(){try{const e=this.template.querySelectorAll('input[data-field="designation"]');if(!e||e.length===0)return;e.forEach(s=>{if(!s||!s.dataset)return;const t=s.dataset.personType;t&&t.toLowerCase()==="employee"?(s.classList.add("designation-readonly"),s.readOnly=!0,s.placeholder="Auto-filled from Contact"):(s.classList.remove("designation-readonly"),s.readOnly=!1,s.placeholder="Enter designation")})}catch(e){console.error("Error in updateDesignationFieldStyling:",e)}}updateSelectValues(){try{const e=this.template.querySelectorAll("select[data-row-id]");if(!e||e.length===0)return;e.forEach(s=>{if(!s||!s.dataset)return;const t=parseInt(s.dataset.rowId,10);if(isNaN(t))return;const o=this.formRows.find(i=>i&&i.id===t);o&&o.typeOfPerson&&s.value!==o.typeOfPerson&&(s.value=o.typeOfPerson)})}catch(e){console.error("Error in updateSelectValues:",e)}}handleTypeOfPersonChange(e){const s=parseInt(e.target.dataset.rowId,10),t=e.target.value;this.formRows=this.formRows.map(o=>{if(o.id===s){const i={...o,typeOfPerson:t};return this.isEmployeeType(t)?(i.personnelName="",i.designation="",i.searchQuery="",i.personnelId=""):(i.personnelId="",i.showContactOptions=!1,i.contactOptions=[]),i}return o}),console.log("\u{1F4DD} Type of person updated for row:",s,"=",t)}async handleContactSearch(e,s){if(console.log("\u{1F50D} handleContactSearch called with:",{rowId:e,searchTerm:s}),s.length<2){this.formRows=this.formRows.map(t=>t.id===e?{...t,showContactOptions:!1,contactOptions:[]}:t);return}try{await this.loadContactOptions(s),console.log("\u{1F4CB} Contact options loaded:",this.contactOptions.length,"contacts"),this.formRows=this.formRows.map(t=>{if(t.id===e){const o={...t,showContactOptions:this.contactOptions.length>0,contactOptions:[...this.contactOptions]};return console.log("\u{1F4DD} Updated row with contacts:",o.showContactOptions,o.contactOptions.length),o}return t}),this.formRows=[...this.formRows]}catch(t){console.error("\u274C Error searching contacts:",t)}}handleContactSelect(e){console.log("\u{1F5B1}\uFE0F Contact select clicked:",e.target);let s=e.target,t=s.dataset.rowId,o=s.dataset.contactId;for(;(!t||!o)&&(s=s.parentElement,!(!s||s.classList.contains("contact-options-dropdown")));)t=s.dataset.rowId,o=s.dataset.contactId;if(console.log("\u{1F4CB} Extracted data:",{rowId:t,contactId:o}),!t||!o){console.error("\u274C Missing rowId or contactId in contact selection");return}t=parseInt(t,10);let i=null;const a=this.formRows.find(r=>r.id===t);a&&a.contactOptions&&(i=a.contactOptions.find(r=>r.id===o)),i||(i=this.contactOptions.find(r=>r.id===o)),console.log("\u{1F464} Selected contact:",i),i?(this.formRows=this.formRows.map(r=>r.id===t?{...r,personnelName:i.name,personnelId:i.id,designation:i.title||"",searchQuery:i.name,showContactOptions:!1,contactOptions:[]}:r),console.log("\u2705 Contact selected for row:",t,i.name)):console.error("\u274C Contact not found:",o)}handleAddMoreRows(){const e=Math.max(...this.formRows.map(o=>o.id))+1,s=this.typeOfPersonOptions.find(o=>o.value.toLowerCase()==="employee"),t=s?s.value:this.typeOfPersonOptions.length>0?this.typeOfPersonOptions[0].value:"";this.formRows=[...this.formRows,{id:e,typeOfPerson:t,personnelName:"",personnelId:"",designation:"",searchQuery:"",showContactOptions:!1,contactOptions:[]}],console.log("\u2795 Added new form row:",e)}handleRemoveRow(e){const s=parseInt(e.target.dataset.rowId,10);this.formRows.length>1&&(this.formRows=this.formRows.filter(t=>t.id!==s),console.log("\u2796 Removed form row:",s))}async handleSaveAttendance(){try{if(!this.validateForm())return;this.isSubmitting=!0;const e=this.formRows.filter(r=>r.personnelName?.trim()&&r.typeOfPerson);console.log("\u{1F4BE} Creating attendance records for",e.length,"rows");let s;!this.selectedSessionToExtend||this.selectedSessionToExtend==="new"?(s=this.generateAttendanceId(),console.log("\u{1F4DD} Generated new attendance ID:",s)):(s=this.selectedSessionToExtend,console.log("\u{1F4DD} Using existing attendance ID:",s)),console.log("\u{1F4CA} Available session options:",this.sessionOptions.map(r=>`${r.label} (${r.value})`).join(", "));const t=e.map(r=>{const l={Rhythm__HFE_Session__c:this.recordId,Rhythm__Type_of_Person__c:r.typeOfPerson,Rhythm__Personnel_Name__c:r.personnelName,Rhythm__Designation__c:r.designation||"",Rhythm__Attendance_Id__c:s};return $e("Rhythm__HFE_Attendance__c",l)}),o=await Promise.all(t),i=o.filter(r=>r.success).length,a=o.length-i;if(i>0)console.log("\u2705 Successfully created",i,"attendance records"),await this.loadAttendanceRecords(),this.showCaptureForm=!1,a>0?this.showSuccessToast(`${i} records saved successfully, ${a} failed`):this.showSuccessToast(`All ${i} attendance records saved successfully!`);else throw new Error("All attendance records failed to save")}catch(e){console.error("\u274C Error saving attendance:",e),this.showErrorToast(e.message||"Failed to save attendance")}finally{this.isSubmitting=!1}}generateAttendanceId(){const e=new Date,s=String(e.getDate()).padStart(2,"0"),o=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][e.getMonth()],i=e.getFullYear(),a=`${s}-${o}-${i}`;let r="0001";if(this.sessionData&&this.sessionData.name){const d=this.sessionData.name.match(/(\d+)/);if(d){const h=parseInt(d[1],10);r=String(h).padStart(4,"0")}}else this.recordId&&(r=this.recordId.substring(this.recordId.length-4).padStart(4,"0"));const l=this.getNextBatchNumber(),c=String(l).padStart(3,"0");return`S-${r}-${a}-SESSION-${c}`}getNextBatchNumber(){let e=0;return this.attendanceRecords.forEach(s=>{if(s.Rhythm__Attendance_Id__c){const t=s.Rhythm__Attendance_Id__c.match(/SESSION-(\d{3})/);if(t){const o=parseInt(t[1],10);o>e&&(e=o)}}}),e+1}validateForm(){return this.formRows.filter(t=>t.personnelName?.trim()&&t.typeOfPerson).length===0?(this.showErrorToast("Please fill in at least one attendance record"),!1):this.formRows.filter(t=>{const o=t.personnelName?.trim(),i=t.typeOfPerson;return(o||i)&&(!o||!i)}).length>0?(this.showErrorToast("Please complete all partially filled rows or remove them"),!1):!0}resetFormData(){const e=this.typeOfPersonOptions.find(t=>t.value.toLowerCase()==="employee"),s=e?e.value:this.typeOfPersonOptions.length>0?this.typeOfPersonOptions[0].value:"";this.formRows=[{id:1,typeOfPerson:s,personnelName:"",personnelId:"",designation:"",searchQuery:"",showContactOptions:!1,contactOptions:[]}]}showSuccessToast(e){console.log("\u2705 Success:",e)}showErrorToast(e){console.error("\u274C Error:",e)}handleRefresh(){this.loadTrainingData()}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}}Y(Yo,{publicProps:{recordId:{config:0},objectApiName:{config:0}},track:{isLoading:1,hasError:1,errorMessage:1,sessionData:1,attendanceRecords:1,totalParticipants:1,groupedAttendanceRecords:1,showCaptureForm:1,isSubmitting:1,formRows:1,typeOfPersonOptions:1,contactOptions:1,isLoadingContacts:1,sessionOptions:1,sessionSelectionHelpText:1,selectedSessionToExtend:1}});const Ko=z(Yo,{tmpl:lf,sel:"c-training-attendance-form",apiVersion:63});function cf(n,e,s){var t=n?"["+n+"]":"";return[".investigation-container",t," {padding: 0 0 200px 0;margin: 0;background: #f8fafc;min-height: calc(100vh + 200px);max-height: 100vh;width: 100%;box-sizing: border-box;overflow-y: auto;overflow-x: hidden;scroll-behavior: smooth;}.investigation-container",t,"::-webkit-scrollbar {width: 12px;}.investigation-container",t,"::-webkit-scrollbar-track {background: #f1f5f9;border-radius: 10px;}.investigation-container",t,"::-webkit-scrollbar-thumb {background: #cbd5e1;border-radius: 10px;border: 3px solid #f1f5f9;}.investigation-container::-webkit-scrollbar-thumb:hover",t," {background: #94a3b8;}.investigation-container",t," {scrollbar-width: thin;scrollbar-color: #cbd5e1 #f1f5f9;}.loading-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 40px 20px;text-align: center;}.error-container",t," {background: #fef2f2;border: 1px solid #fecaca;border-radius: 8px;padding: 16px;margin-bottom: 16px;display: flex;align-items: flex-start;justify-content: space-between;}.error-content",t," {display: flex;align-items: flex-start;gap: 12px;}.error-icon",t," {font-size: 20px;color: #dc2626;}.error-text",t," {color: #dc2626;font-size: 14px;line-height: 1.5;margin: 0;}.error-dismiss",t," {background: none;border: none;color: #dc2626;font-size: 18px;cursor: pointer;padding: 0;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;border-radius: 4px;}.error-dismiss:hover",t," {background: rgba(220, 38, 38, 0.1);}.toast-container",t," {position: fixed;top: 50px;right: 20px;z-index: 10000;max-width: 400px;min-width: 280px;border-radius: 12px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);backdrop-filter: blur(10px);transform: translateX(100%);transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);opacity: 0;}.toast-visible",t," {transform: translateX(0);opacity: 1;}.toast-hidden",t," {transform: translateX(100%);opacity: 0;}.toast-content",t," {display: flex;align-items: center;padding: 16px 20px;background: rgba(255, 255, 255, 0.95);border-radius: 12px;border: 1px solid rgba(255, 255, 255, 0.2);}.toast-icon",t," {font-size: 18px;margin-right: 12px;flex-shrink: 0;}.toast-message",t," {flex: 1;font-size: 14px;font-weight: 500;color: #374151;line-height: 1.4;}.toast-close",t," {background: none;border: none;font-size: 20px;color: #6b7280;cursor: pointer;margin-left: 12px;padding: 0;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;border-radius: 4px;transition: all 0.2s ease;}.toast-close:hover",t," {background: rgba(0, 0, 0, 0.05);color: #374151;}.toast-success",t," .toast-content",t," {background: rgba(16, 185, 129, 0.95);border-color: rgba(16, 185, 129, 0.3);}.toast-success",t," .toast-message",t," {color: white;}.toast-success",t," .toast-close",t," {color: rgba(255, 255, 255, 0.8);}.toast-success",t," .toast-close:hover",t," {background: rgba(255, 255, 255, 0.2);color: white;}.toast-error",t," .toast-content",t," {background: rgba(239, 68, 68, 0.95);border-color: rgba(239, 68, 68, 0.3);}.toast-error",t," .toast-message",t," {color: white;}.toast-error",t," .toast-close",t," {color: rgba(255, 255, 255, 0.8);}.toast-error",t," .toast-close:hover",t," {background: rgba(255, 255, 255, 0.2);color: white;}.toast-info",t," .toast-content",t," {background: rgba(59, 130, 246, 0.95);border-color: rgba(59, 130, 246, 0.3);}.toast-info",t," .toast-message",t," {color: white;}.toast-info",t," .toast-close",t," {color: rgba(255, 255, 255, 0.8);}.toast-info",t," .toast-close:hover",t," {background: rgba(255, 255, 255, 0.2);color: white;}.empty-state-text",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;height: 100%;}.empty-state-subtext",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;height: 100%;}@media (max-width: 640px) {.toast-container",t," {top: 50px;right: 10px;left: 10px;max-width: none;min-width: auto;transform: translateY(-100%);transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.toast-visible",t," {transform: translateY(0);opacity: 1;}.toast-hidden",t," {transform: translateY(-100%);opacity: 0;}.toast-content",t," {padding: 14px 16px;}.toast-message",t," {font-size: 13px;}}.edit-icon-button-container",t," {width: 100%;display: flex;justify-content: end;align-items: center;padding-right: 10px;margin: 10px 0;}.edit-icon-button",t," {width: 40px;height: 40px;color: #6a1b9a;display: flex;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s ease;z-index: 5;padding: 0;background: transparent;border: none;}.edit-icon-button:hover",t," {background: rgba(106, 27, 154, 0.1);border-radius: 50%;}.button-container",t," {display: flex;justify-content: center;gap: 12px;margin: 24px 0;padding: 16px;border-top: 1px solid #e5e5e5;}.save-button",t,",.cancel-button",t," {padding: 10px 20px;border-radius: 6px;font-size: 14px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;border: none;}.save-button",t," {background: #10b981;color: white;}.save-button:hover",t," {background: #059669;}.save-button:disabled",t," {background: #9ca3af;cursor: not-allowed;}.cancel-button",t," {background: #6b7280;color: white;}.cancel-button:hover",t," {background: #4b5563;}.cancel-button:disabled",t," {background: #9ca3af;cursor: not-allowed;}.root-cause-buttons",t," {display: flex;justify-content: center;gap: 12px;margin-top: 16px;padding: 16px;border-top: 1px solid #e5e5e5;background: #f8fafc;}.root-cause-save",t,",.root-cause-cancel",t," {padding: 8px 16px;border-radius: 6px;font-size: 13px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;border: none;}.root-cause-save",t," {background: #059669;color: white;}.root-cause-save:hover",t," {background: #047857;}.root-cause-cancel",t," {background: #6b7280;color: white;}.root-cause-cancel:hover",t," {background: #4b5563;}.main-buttons",t," {background: #f1f5f9;border-top: 2px solid #3b82f6;margin-top: 24px;}.main-save",t,",.main-cancel",t," {font-size: 15px;font-weight: 600;padding: 12px 24px;}.main-save",t," {background: #3b82f6;color: white;}.main-save:hover",t," {background: #2563eb;}.main-cancel",t," {background: #ef4444;color: white;}.main-cancel:hover",t," {background: #dc2626;}.section-container",t," {background: #ffffff;border-radius: 12px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);margin: 16px;margin-bottom: 20px;overflow: hidden;border: 1px solid #e5e7eb;width: calc(100% - 30px);box-sizing: border-box;}.section-header",t," {background: #f3ebff;padding: 16px 20px;border-bottom: 1px solid #e5e7eb;font-weight: 600;font-size: 16px;color: #1f2937;}.root-cause-section",t," {margin-top: 24px;}.root-cause-section",t," .section-header",t," {background: #f3ebff;color: #0a0909;border-bottom: 1px solid #f59e0b;font-weight: 600;display: flex;align-items: center;justify-content: space-between;}.root-cause-edit",t," {width: 32px;height: 32px;color: #6a1b9a;margin-left: auto;}.fishbone-section",t," {margin-top: 24px;}.fishbone-section",t," .section-header",t," {background: #f3ebff;color: #0a0909;border-bottom: 1px solid #f59e0b;font-weight: 600;}.why-why-section",t," {margin-top: 24px;}.why-why-section",t," .section-header",t," {background: #f3ebff;color: #0a0909;border-bottom: 1px solid #f59e0b;font-weight: 600;}.collapsible-header",t," {cursor: pointer;display: flex;align-items: center;gap: 12px;transition: background-color 0.2s ease;padding: 16px 20px;margin: 0;}.collapsible-header:hover",t," {background: #f3ebff;}.expand-icon",t," {font-size: 14px;font-weight: bold;transition: transform 0.3s ease;color: #ffffff;}.expand-icon.expanded",t," {transform: rotate(90deg);}.section-title",t," {font-weight: 600;font-size: 16px;color: #121213;}.root-cause-content",t," {padding: 20px;background: #ffffff;}.why-why-content",t," {padding: 20px;}.fishbone-content",t," {padding: 20px;}.root-cause-field",t," {background: #ffffff;border: 1px solid #e5e7eb;border-radius: 8px;padding: 16px;margin-bottom: 16px;transition: border-color 0.2s ease;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.root-cause-field:hover",t," {border-color: #fbbf24;box-shadow: 0 2px 6px rgba(251, 191, 36, 0.2);}.field-header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: 12px;}.field-label",t," {font-weight: 600;color: #374151;font-size: 14px;}.delete-button",t," {background: #ef4444;color: white;border: none;border-radius: 4px;padding: 4px 8px;cursor: pointer;font-size: 12px;transition: background-color 0.2s ease;}.delete-button:hover",t," {background: #dc2626;}.root-cause-textarea",t," {width: 100%;min-height: 100px;padding: 16px;border: none;border-radius: 0;font-size: 14px;font-family: inherit;resize: vertical;box-sizing: border-box;background: #ffffff;color: #374151;line-height: 1.5;}.root-cause-textarea:focus",t," {outline: none;background: #f9fafb;}.root-cause-textarea",t,"::placeholder {color: #9ca3af;font-style: italic;}.root-cause-field-container",t," {margin-bottom: 20px;border: 1px solid #e5e5e5;border-radius: 8px;overflow: hidden;background: #ffffff;}.root-cause-field-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 12px 16px;background: #f8fafc;border-bottom: 1px solid #e5e5e5;}.root-cause-label",t," {font-weight: 600;color: #374151;font-size: 14px;}.root-cause-display-value",t," {padding: 16px;background: #ffffff;font-size: 14px;line-height: 1.5;color: #374151;min-height: 60px;white-space: pre-wrap;}.root-cause-empty",t," {padding: 16px;color: #9ca3af;font-style: italic;background: #ffffff;text-align: center;}.add-root-cause-container",t," {display: flex;justify-content: center;margin: 20px 0;}.add-root-cause-button",t," {background: #10b981;color: white;border: none;border-radius: 8px;padding: 12px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.2s ease;display: flex;align-items: center;gap: 8px;}.add-root-cause-button:hover",t," {background: #059669;transform: translateY(-1px);box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);}.add-button",t," {background: #10b981;color: white;border: none;border-radius: 6px;padding: 12px 20px;font-size: 14px;font-weight: 500;cursor: pointer;transition: background-color 0.2s ease;display: flex;align-items: center;gap: 8px;}.add-button:hover",t," {background: #059669;}.fields-grid",t," {display: grid;grid-template-columns: 1fr;gap: 16px;padding: 20px;}@media (min-width: 768px) {.fields-grid",t," {grid-template-columns: repeat(2, 1fr);}}.field-container",t," {display: flex;flex-direction: column;gap: 8px;}.field-label",t," {font-weight: 500;color: #374151;font-size: 14px;}.required-field",t," {color: #ef4444;text-decoration: none;}.field-value",t," {padding: 10px 12px;background: #f9fafb;border-radius: 6px;font-size: 14px;color: #1f2937;min-height: 20px;}.field-display-value",t," {color: #1f2937;font-size: 14px;line-height: 1.5;}.empty-field",t," {color: #9ca3af;font-style: italic;}.empty-field-readonly",t," {color: #9ca3af;font-style: italic;}.readonly-field",t," {background: #f3f4f6;color: #6b7280;}.form-select",t,",.form-textarea",t,",.form-input",t," {width: 100%;padding: 12px 14px;border: 2px solid #e5e7eb;border-radius: 8px;font-size: 14px;font-family: inherit;transition: all 0.2s ease;background: #ffffff;color: #374151;line-height: 1.5;box-sizing: border-box;}.form-textarea",t," {min-height: 80px;resize: vertical;}.form-select",t," {cursor: pointer;}.form-select:focus",t,",.form-textarea:focus",t,",.form-input:focus",t," {outline: none;border-color: #3b82f6;box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);background: #f9fafb;}.form-select:hover",t,",.form-textarea:hover",t,",.form-input:hover",t," {border-color: #d1d5db;}.edit-mode-input",t," {background: #ffffff;}.edit-mode-input:disabled",t," {background: #f3f4f6;color: #6b7280;cursor: not-allowed;border-color: #e5e7eb;}.form-input",t,"::placeholder,.form-textarea",t,"::placeholder {color: #9ca3af;font-style: italic;}.checkbox-container",t," {display: flex;align-items: center;gap: 8px;}.form-checkbox",t," {width: 18px;height: 18px;accent-color: #3b82f6;}.checkbox-label",t," {font-size: 14px;color: #374151;}.related-tasks-section",t," {margin-top: 24px;}.related-tasks-section",t," .section-header",t," {background: #f3ebff;color: #f3ebff;border-bottom: 2px solid #2563eb;}.related-tasks-content",t," {padding: 0;background: #ffffff;}@media (max-width: 768px) {.investigation-container",t," {padding: 12px;padding-bottom: 150px;max-height: 100vh;overflow-y: auto;-webkit-overflow-scrolling: touch;}.investigation-container",t,"::-webkit-scrollbar {width: 8px;}.investigation-container",t,"::-webkit-scrollbar-thumb {border: 2px solid #f1f5f9;}.action-buttons",t," {flex-wrap: wrap;padding: 12px;}.section-container",t," {margin-bottom: 16px;}.section-header",t," {padding: 12px 16px;font-size: 15px;}.fields-grid",t," {grid-template-columns: 1fr;gap: 12px;padding: 16px;}.root-cause-content",t," {padding: 16px;}.root-cause-field",t," {padding: 12px;margin-bottom: 12px;}}"].join("")}var Go=[cf];function df(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".fishbone-container",t," {font-family: Arial, sans-serif;width: 100%;max-width: 800px;margin: 0 auto;}.loading",t,",\r.error",t," {text-align: center;padding: 20px;font-size: 16px;}.error",t," {color: #ff0000;}.fishbone-header",t," {text-align: center;margin-bottom: 30px;}.fishbone-header",t," h2",t," {font-size: 24px;color: #333;}.fishbone-vertical",t," {display: flex;flex-direction: column;gap: 40px;}.category-section",t," {border-bottom: 1px solid #eee;padding-bottom: 15px;}.category-section:last-child",t," {border-bottom: none;}.category-label",t," {font-size: 18px;font-weight: bold;color: #444;margin-bottom: 15px;padding-bottom: 5px;border-bottom: 2px solid #ff6b6b;}.category-selects",t," {display: flex;flex-direction: column;gap: 15px;}.select-row",t," {width: 100%;}.select-row",t," select",t,` {width: 100%;padding: 10px 15px;border: 1px solid #ccc;border-radius: 4px;background-color: white;font-size: 14px;cursor: pointer;appearance: none;-webkit-appearance: none;-moz-appearance: none;background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23444' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat: no-repeat;background-position: right 10px center;background-size: 14px;}.select-row`,t," select:hover",t," {border-color: #aaa;}.select-row",t," select:focus",t," {outline: none;border-color: #4a90e2;box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);}.select-row",t," option",t," {padding: 8px;}.category-section:nth-child(1)",t," .category-label",t," {border-color: #ff6b6b;}.category-section:nth-child(2)",t," .category-label",t," {border-color: #4a90e2;}.category-section:nth-child(3)",t," .category-label",t," {border-color: #5aaa95;}.category-section:nth-child(4)",t," .category-label",t," {border-color: #f5a623;}.category-section:nth-child(5)",t," .category-label",t," {border-color: #9b6dff;}.category-section:nth-child(6)",t," .category-label",t," {border-color: #ff9a3c;}.problem-statement",t," {display: flex;flex-direction: column;margin-bottom: 15px;}.problem-statement",t," label",t," {font-weight: bold;margin-bottom: 5px;font-size: 14px;color: #444;}.problem-statement",t," input",t," {width: 86%;padding: 10px;border: 1px solid #ccc;border-radius: 4px;font-size: 14px;}.problem-statement",t," input:focus",t," {outline: none;border-color: #4a90e2;box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);}.button-container",t," {display: flex;justify-content: flex-end;gap: 10px;width: 100%;}.cancel-button",t,",\r.save-button",t," {padding: 10px 20px;border-radius: 4px;font-size: 14px;font-weight: bold;cursor: pointer;transition: all 0.2s ease;}.cancel-button",t," {background-color: #f5f5f5;border: 1px solid #ccc;color: #444;}.save-button",t," {background-color: #4a90e2;border: 1px solid #3a80d2;color: white;}.cancel-button:hover",t," {background-color: #e5e5e5;}.save-button:hover",t," {background-color: #3a80d2;}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);display: flex;justify-content: center;align-items: center;z-index: 9999;backdrop-filter: blur(5px);-webkit-backdrop-filter: blur(5px);}.success-modal",t," {background-color: white;border-radius: 8px;box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);padding: 30px;width: 90%;max-width: 400px;text-align: center;animation: fadeIn",o," 0.3s ease-out;}@keyframes fadeIn",o," {from {opacity: 0;transform: translateY(-20px);}to {opacity: 1;transform: translateY(0);}}.success-icon",t," {width: 60px;height: 60px;background-color: #5aaa95;color: white;border-radius: 50%;display: flex;justify-content: center;align-items: center;font-size: 32px;margin: 0 auto 15px;}.success-title",t," {font-size: 24px;font-weight: bold;color: #333;margin-bottom: 10px;}.success-message",t," {font-size: 16px;color: #666;margin-bottom: 25px;}.dismiss-button",t," {background-color: #5aaa95;color: white;border: none;border-radius: 4px;padding: 10px 20px;font-size: 14px;font-weight: bold;cursor: pointer;transition: background-color 0.2s ease;}.dismiss-button:hover",t," {background-color: #4a9a85;}"].join("")}var Xo=[df];const hf=p`<div class="loading${0}"${2}>Loading...</div>`,uf=p`<div class="error${0}"${2}>${"t1"}</div>`,pf=p`<div class="fishbone-header${0}"${2}><h2${3}>Fishbone Analysis</h2></div>`,ff=p`<label${3}>Problem Statement</label>`,mf=p`<div class="category-label${0}"${2}>${"t1"}</div>`,gf=p`<option value${3}>--NONE--</option>`,_f=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,bf=p`<option value${3}>--NONE--</option>`,yf=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,vf=p`<option value${3}>--NONE--</option>`,wf=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,xf=p`<div class="button-container${0}"${2}><button class="cancel-button${0}"${2}>Cancel</button><button class="save-button${0}"${2}>Save</button></div>`,kf=p`<div class="modal-overlay${0}"${2}><div class="success-modal${0}"${2}><div class="success-icon${0}"${2}>✓</div><div class="success-title${0}"${2}>Success!</div><div class="success-message${0}"${2}>Changes saved successfully!</div></div></div>`,$f={classMap:{"fishbone-container":!0},key:0},Cf={classMap:{"fishbone-diagram":!0},key:5},Sf={classMap:{"fishbone-vertical":!0},key:8},Ef={classMap:{"problem-statement":!0},key:9},Rf={type:"text"},Af={"category-section":!0},If={classMap:{"category-selects":!0},key:16},Ff={classMap:{"select-row":!0},key:17},Df={classMap:{"select-row":!0},key:23},Tf={classMap:{"select-row":!0},key:29};function Ze(n,e,s,t){const{st:o,d:i,sp:a,b:r,h:l,k:c,i:d,f:h}=n,{_m0:u,_m1:f,_m2:g,_m3:_,_m4:m,_m5:x,_m6:k,_m7:$}=t;return[l("div",$f,[e.isLoading?o(hf,2):null,e.error?o(uf,4,[a(1,null,i(e.error))]):null,e.isLoading?null:l("div",Cf,[o(pf,7),l("div",Sf,h([l("div",Ef,[o(ff,11),l("input",{attrs:Rf,props:{value:e.problemStatement},key:12,on:u||(t._m0={change:r(e.handleProblemStatementChange)})})]),d(e.fishboneData,function(S,O){return l("div",{classMap:Af,key:c(13,S.name)},[o(mf,15,[a(1,null,i(S.name))]),l("div",If,[l("div",Ff,[l("select",{attrs:{"data-category":S.name,"data-index":"0"},key:18,on:f||(t._m1={change:r(e.handleSelectChange)})},h([o(gf,20),d(S.options,function(F){return o(_f,c(22,F.value),[a(0,{attrs:{value:F.value,selected:F.selected0?"":null}},null),a(1,null,i(F.label))])})]))]),l("div",Df,[l("select",{attrs:{"data-category":S.name,"data-index":"1"},key:24,on:g||(t._m2={change:r(e.handleSelectChange)})},h([o(bf,26),d(S.options,function(F){return o(yf,c(28,F.value),[a(0,{attrs:{value:F.value,selected:F.selected1?"":null}},null),a(1,null,i(F.label))])})]))]),l("div",Tf,[l("select",{attrs:{"data-category":S.name,"data-index":"2"},key:30,on:_||(t._m3={change:r(e.handleSelectChange)})},h([o(vf,32),d(S.options,function(F){return o(wf,c(34,F.value),[a(0,{attrs:{value:F.value,selected:F.selected2?"":null}},null),a(1,null,i(F.label))])})]))])])])}),o(xf,36,[a(1,{on:m||(t._m4={click:r(e.handleCancel)})},null),a(3,{on:x||(t._m5={click:r(e.handleSave)})},null)]),e.showSuccess?o(kf,38,[a(0,{on:$||(t._m7={click:r(e.handleModalClick)})},null)]):null]))])])]}var Of=J(Ze);Ze.stylesheets=[],Ze.stylesheetToken="lwc-64r2g0jtv4a",Ze.legacyStylesheetToken="c-fishboneAnalysis_fishboneAnalysis",Xo&&Ze.stylesheets.push.apply(Ze.stylesheets,Xo),Q(Ze);class Zo extends K{constructor(...e){super(...e);this.objectApiName="",this.recordId="",this.isLoading=!0,this.error=null,this.fishboneData=[],this.recordData={},this.problemStatement="",this.showSuccess=!1,this.originalData=null,this.fieldApis=[],this.fishBoneObjectApiName="Rhythm__Fishbone__c"}connectedCallback(){this.loadData()}async loadData(){try{this.isLoading=!0,await this.getFishBoneObjectData(),this.recordId&&await this.getRecordData(),this.storeOriginalData(),this.isLoading=!1}catch(e){this.error=e.message||"Unknown error occurred",this.isLoading=!1,console.error("Error loading fishbone data:",e)}}storeOriginalData(){this.originalData={fishboneData:JSON.parse(JSON.stringify(this.fishboneData)),problemStatement:this.problemStatement}}async getFishBoneObjectData(){const t=(await(await se.getValidConnection()).sobject(this.fishBoneObjectApiName).describe()).fields.filter(o=>o.type==="multipicklist");this.fishboneData=this.processCategories(t),console.log("fishboneData",JSON.stringify(this.fishboneData))}processCategories(e){const s=new Set,t=[];return this.fieldApis=[],e.forEach(o=>{if(o.picklistValues&&o.picklistValues.length>0){const i=o.label.split(" ")[0];s.add(i),this.fieldApis.push(o.name),o.picklistValues.forEach(a=>{t.push({label:a.label,value:a.value,category:i,selected0:!1,selected1:!1,selected2:!1})})}}),Array.from(s).map(o=>({name:o,fieldApi:this.fieldApis.find(i=>i.split("__")[1].split("_")[0]===o),options:t.filter(i=>i.category===o)}))}async getRecordData(){if(!!this.recordId)try{let e="SELECT Id, ";this.fieldApis.forEach(t=>{e+=`${t}, `}),e+=`Rhythm__Problem_Statement__c FROM ${this.fishBoneObjectApiName} WHERE ${this.objectApiName} = '${this.recordId}'`,console.log("query",e);const s=await le(e);this.recordData=s[0],console.log("recordData",JSON.stringify(this.recordData)),this.recordData.Rhythm__Problem_Statement__c&&(this.problemStatement=this.recordData.Rhythm__Problem_Statement__c),this.recordData.Id&&this.updateSelectedValues()}catch(e){console.error("Error fetching record data:",e)}}updateSelectedValues(){console.log("Updating selected values with recordData:",JSON.stringify(this.recordData)),Object.keys(this.recordData).forEach(e=>{if(!e.includes("__c")||e==="attributes")return;const s=this.recordData[e];if(!s)return;console.log(`Processing field ${e} with value ${s}`);const t=e.split("__")[1].split("_")[0],o=this.fishboneData.find(a=>a.name===t);if(!o){console.log(`Category ${t} not found`);return}const i=s.split(";");console.log(`Selected values for ${t}:`,i),i.forEach((a,r)=>{if(r>2)return;const l=o.options.find(c=>c.value===a.trim());l?(console.log(`Setting option ${l.label} as selected${r}`),l[`selected${r}`]=!0):console.log(`Option with value "${a}" not found in category ${t}`)})}),this.fishboneData=[...this.fishboneData],this.dispatchFishboneDataEvent()}handleSelectChange(e){const s=e.target.dataset.category,t=e.target.dataset.index,o=e.target.value,i=this.fishboneData.find(a=>a.name===s);if(!!i){if(!o||o==="")i.options.forEach(a=>{a[`selected${t}`]=!1});else{const a=i.options.find(r=>r.value===o);if(!a)return;i.options.forEach(r=>{r[`selected${t}`]=r===a})}this.fishboneData=[...this.fishboneData]}}handleProblemStatementChange(e){this.problemStatement=e.target.value}handleSave(){this.error=null,this.showSuccess=!1;const e=this.prepareRecordData();console.log("recordToSave",JSON.stringify(e)),this.recordData&&this.recordData.Id?this.updateRecord(e):this.createRecord(e)}prepareRecordData(){const e={};return this.recordData&&this.recordData.Id&&(e.Id=this.recordData.Id),this.recordId&&!e.Id&&(e[this.objectApiName]=this.recordId),e.Rhythm__Problem_Statement__c=this.problemStatement,this.fishboneData.forEach(s=>{const t=s.fieldApi;if(!t){console.error(`Field API name not found for category ${s.name}`);return}const o=[];for(let i=0;i<3;i++){const a=s.options.find(r=>r[`selected${i}`]);a&&o.push(a.value)}o.length>0?e[t]=o.join(";"):e[t]=null}),e}async createRecord(e){try{this.isLoading=!0;const s=await $e(this.fishBoneObjectApiName,e);s&&s.id?(this.recordData={...e,Id:s.id},this.showSuccess=!0,this.storeOriginalData(),this.dispatchFishboneDataEvent()):this.error="Failed to create record",this.isLoading=!1}catch(s){this.isLoading=!1,this.error=s.message||"Failed to create record",console.error("Error creating record:",s)}}async updateRecord(e){try{this.isLoading=!0;const s=await oe(this.fishBoneObjectApiName,e);console.log("result",JSON.stringify(s)),s&&s.success?(this.showSuccess=!0,this.recordData={...this.recordData,...e},this.storeOriginalData(),this.dispatchFishboneDataEvent()):this.error="Failed to update record",this.isLoading=!1}catch(s){this.isLoading=!1,this.error=s.message||"Failed to update record",console.error("Error updating record:",s)}}dispatchFishboneDataEvent(){const e={recordData:this.recordData,fishboneData:this.fishboneData,objectApiName:this.objectApiName,recordId:this.recordId,fishBoneObjectApiName:this.fishBoneObjectApiName,fieldApis:this.fieldApis},s=new CustomEvent("fishbonesaved",{detail:e,bubbles:!0,composed:!0});console.log("Dispatching fishbone data event:",JSON.stringify(e)),this.dispatchEvent(s)}handleCancel(){this.originalData?(this.fishboneData=JSON.parse(JSON.stringify(this.originalData.fishboneData)),this.problemStatement=this.originalData.problemStatement):(this.fishboneData.forEach(e=>{e.options.forEach(s=>{s.selected0=!1,s.selected1=!1,s.selected2=!1})}),this.problemStatement=""),this.error=null,this.showSuccess=!1}handleDismissSuccess(){this.showSuccess=!1}handleModalClick(e){e.target.classList.contains("modal-overlay")&&(this.showSuccess=!1),setTimeout(()=>{this.showSuccess=!1},3e3)}}Y(Zo,{publicProps:{objectApiName:{config:0},recordId:{config:0}},track:{isLoading:1,error:1,fishboneData:1,recordData:1,problemStatement:1,showSuccess:1,originalData:1,fieldApis:1,fishBoneObjectApiName:1}});const Lf=z(Zo,{tmpl:Of,sel:"c-fishbone-analysis",apiVersion:63});function Nf(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".why-why-container",t," {font-family: Arial, sans-serif;width: 100%;max-width: 800px;margin: 0 auto;}.loading",t,",\r.error",t," {text-align: center;padding: 20px;font-size: 16px;}.error",t," {color: #ff0000;}.why-why-header",t," {text-align: center;margin-bottom: 30px;}.why-why-header",t," h2",t," {font-size: 24px;color: #333;}.select-contributing-factor",t," {margin-bottom: 30px;padding: 20px;background-color: #f9f9f9;border-radius: 8px;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);}.select-contributing-factor",t," h3",t," {margin-top: 0;margin-bottom: 15px;color: #444;font-size: 18px;}.select-container",t," {position: relative;}.factor-select",t,` {width: 100%;padding: 12px 15px;border: 1px solid #ccc;border-radius: 4px;background-color: white;font-size: 16px;cursor: pointer;appearance: none;-webkit-appearance: none;-moz-appearance: none;background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23444' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat: no-repeat;background-position: right 15px center;background-size: 14px;}.factor-select:hover`,t," {border-color: #aaa;}.factor-select:focus",t," {outline: none;border-color: #4a90e2;box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);}.selected-factors",t," {display: flex;flex-direction: column;gap: 30px;margin-bottom: 30px;}.selected-factor",t," {background-color: #fff;border-radius: 8px;box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);padding: 20px;border-left: 4px solid #4a90e2;}.factor-header",t," {margin-bottom: 15px;padding-bottom: 10px;border-bottom: 1px solid #eee;}.factor-label",t," {font-weight: bold;font-size: 16px;color: #333;}.why-cause-list",t," {display: flex;flex-direction: column;gap: 15px;}.why-cause-pair",t," {display: flex;flex-direction: column;gap: 10px;border: 1px solid #e0e0e0;border-radius: 6px;padding: 15px;background-color: #f9f9f9;}.pair-header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: 10px;}.pair-header",t," label",t," {font-weight: bold;font-size: 16px;color: #444;}.input-fields-stack",t," {display: flex;flex-direction: column;gap: 10px;}.why-section",t,",\r.cause-section",t," {display: flex;flex-direction: column;width: 100%;}.why-section",t," input",t,",\r.cause-section",t," input",t," {padding: 10px;border: 1px solid #ddd;border-radius: 4px;font-size: 14px;}.why-section",t," input:focus",t,",\r.cause-section",t," input:focus",t," {outline: none;border-color: #4a90e2;box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);}.remove-button",t," {background: none;border: none;color: #ff6b6b;cursor: pointer;padding: 5px;border-radius: 50%;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;transition: background-color 0.2s;}.remove-button:hover",t," {background-color: #ffeeee;}.remove-button",t," svg",t," {width: 14px;height: 14px;}.add-why-container",t," {display: flex;justify-content: center;margin-top: 10px;}.add-why-button",t," {background-color: #f0f7ff;border: 1px dashed #4a90e2;color: #4a90e2;cursor: pointer;padding: 8px;border-radius: 50%;width: 40px;height: 40px;display: flex;align-items: center;justify-content: center;transition: all 0.2s;}.add-why-button:hover",t," {background-color: #e0f0ff;transform: scale(1.05);}.add-why-button",t," svg",t," {width: 20px;height: 20px;}.button-container",t," {display: flex;justify-content: flex-end;gap: 10px;margin-top: 30px;margin-bottom: 30px;padding-top: 20px;border-top: 1px solid #eee;}.existing-why-why-data",t," {margin-top: 40px;margin-bottom: 30px;border-top: 2px solid #eee;padding-top: 30px;}.desktop-view",t," {display: block;}.mobile-view",t," {display: none;}.why-why-table",t," {width: 100%;border-collapse: collapse;border: 1px solid #e0e0e0;border-radius: 8px;overflow: hidden;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);}.table-header",t," {display: flex;background-color: #1a3a5f;color: white;font-weight: bold;}.header-cell",t," {padding: 12px 15px;text-align: left;}.contributing-factor-header",t," {flex: 2;}.why-header",t,",\r.cause-header",t," {flex: 3;}.edit-header",t," {flex: 1;text-align: center;}.table-row",t," {display: flex;border-bottom: 1px solid #e0e0e0;}.table-row:nth-child(even)",t," {background-color: #f9f9f9;}.table-row:last-child",t," {border-bottom: none;}.cell",t," {padding: 12px 15px;display: flex;align-items: center;}.contributing-factor-cell",t," {flex: 2;font-weight: bold;}.why-cell",t,",\r.cause-cell",t," {flex: 3;display: flex;flex-direction: column;}.why-label",t,",\r.why-label-edit",t," {font-weight: bold;color: #1a3a5f;margin-bottom: 4px;font-size: 14px;}.edit-cell",t," {flex: 1;justify-content: center;}.why-text",t,",\r.cause-text",t," {width: 100%;}.edit-input",t," {width: 100%;padding: 8px;border: 1px solid #ddd;border-radius: 4px;}.edit-why-button",t,",\r.save-why-button",t," {background: none;border: none;cursor: pointer;padding: 5px;border-radius: 50%;width: 32px;height: 32px;display: flex;align-items: center;justify-content: center;transition: background-color 0.2s;}.edit-why-button",t," {color: #4a90e2;}.save-why-button",t," {color: #5aaa95;}.edit-why-button:hover",t," {background-color: #e0f0ff;}.save-why-button:hover",t," {background-color: #e0f5f0;}.edit-why-button",t," svg",t,",\r.save-why-button",t," svg",t," {width: 18px;height: 18px;}.cancel-button",t,",\r.save-button",t," {padding: 10px 20px;border-radius: 4px;font-size: 14px;font-weight: bold;cursor: pointer;transition: all 0.2s ease;}.cancel-button",t," {background-color: #f5f5f5;border: 1px solid #ccc;color: #444;}.save-button",t," {background-color: #4a90e2;border: 1px solid #3a80d2;color: white;}.cancel-button:hover",t," {background-color: #e5e5e5;}.save-button:hover",t," {background-color: #3a80d2;}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);display: flex;justify-content: center;align-items: center;z-index: 9999;backdrop-filter: blur(5px);-webkit-backdrop-filter: blur(5px);}.success-modal",t," {background-color: white;border-radius: 8px;box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);padding: 30px;width: 90%;max-width: 400px;text-align: center;animation: fadeIn",o," 0.3s ease-out;}@keyframes fadeIn",o," {from {opacity: 0;transform: translateY(-20px);}to {opacity: 1;transform: translateY(0);}}.success-icon",t," {width: 60px;height: 60px;background-color: #5aaa95;color: white;border-radius: 50%;display: flex;justify-content: center;align-items: center;font-size: 32px;margin: 0 auto 15px;}.success-title",t," {font-size: 24px;font-weight: bold;color: #333;margin-bottom: 10px;}.success-message",t," {font-size: 16px;color: #666;margin-bottom: 15px;}.why-why-cards",t," {display: flex;flex-direction: column;gap: 16px;}.why-why-card",t," {background-color: white;border-radius: 8px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);overflow: hidden;border: 1px solid #e0e0e0;}.card-header",t," {background-color: #1a3a5f;color: white;padding: 12px 15px;display: flex;justify-content: space-between;align-items: center;}.card-title",t," {font-weight: bold;font-size: 16px;}.card-body",t," {padding: 15px;}.card-field",t," {margin-bottom: 12px;}.card-field:last-child",t," {margin-bottom: 0;}.field-label",t," {font-weight: bold;margin-bottom: 5px;color: #1a3a5f;}.field-value",t," {color: #333;}@media screen and (max-width: 768px) {.desktop-view",t," {display: none;}.select-contributing-factor",t," {padding: 15px;}.selected-factor",t," {padding: 15px;}.why-cause-pair",t," {padding: 12px;}.button-container",t," {flex-direction: column;gap: 10px;}.cancel-button",t,",\r .save-button",t," {width: 100%;padding: 12px;}}"].join("")}var ei=[Nf];const Mf=p`<div class="loading${0}"${2}>Loading...</div>`,Pf=p`<div class="error${0}"${2}>${"t1"}</div>`,jf=p`<h3${3}>Select Contributing Factor</h3>`,Uf=p`<option value${3}>Select a contributing factor...</option>`,Vf=p`<option${"a0:value"}${3}>${"t1"}</option>`,qf=p`<div class="factor-header${0}"${2}><span class="factor-label${0}"${2}>${"t2"}</span></div>`,zf=p`<div class="pair-header${0}"${2}><label${3}>${"t2"}</label><button class="remove-button${0}"${"a3:data-index"}${"a3:data-factor"}${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M6 18L18 6M6 6l12 12"${3}/></svg></button></div>`,Wf=p`<div class="add-why-container${0}"${2}><button class="add-why-button${0}"${"a1:data-factor"}${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M12 5v14M5 12h14"${3}/></svg></button></div>`,Bf=p`<div class="button-container${0}"${2}><button class="save-button${0}"${2}>Save Analysis</button></div>`,Hf=p`<div class="table-header${0}"${2}><div class="header-cell contributing-factor-header${0}"${2}>Contributing Factor</div><div class="header-cell why-header${0}"${2}>Why</div><div class="header-cell cause-header${0}"${2}>Cause</div><div class="header-cell edit-header${0}"${2}>Edit</div></div>`,Jf=p`<div class="cell contributing-factor-cell${0}"${2}>${"t1"}</div>`,Qf=p`<div class="why-label-edit${0}"${2}>${"t1"}</div>`,Yf=p`<div class="why-label${0}"${2}>${"t1"}</div>`,Kf=p`<div class="why-text${0}"${2}>${"t1"}</div>`,Gf=p`<div class="cause-text${0}"${2}>${"t1"}</div>`,Xf=p`<div class="edit-buttons${0}"${2}><button class="cancel-edit-button${0}"${"a1:data-id"} title="Cancel"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M6 18L18 6M6 6l12 12"${3}/></svg></button><button class="save-why-button${0}"${"a4:data-id"} title="Save"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M5 13l4 4L19 7"${3}/></svg></button></div>`,Zf=p`<button class="edit-why-button${0}"${"a0:data-id"} title="Edit"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"${3}/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"${3}/></svg></button>`,em=p`<div class="card-title${0}"${2}>${"t1"}</div>`,tm=p`<div class="edit-buttons${0}"${2}><button class="cancel-edit-button${0}"${"a1:data-id"} title="Cancel"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M6 18L18 6M6 6l12 12"${3}/></svg></button><button class="save-why-button${0}"${"a4:data-id"} title="Save"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M5 13l4 4L19 7"${3}/></svg></button></div>`,sm=p`<button class="edit-why-button${0}"${"a0:data-id"} title="Edit"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"${3}/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"${3}/></svg></button>`,om=p`<div class="field-label${0}"${2}>${"t1"}</div>`,im=p`<div class="why-text${0}"${2}>${"t1"}</div>`,am=p`<div class="field-label${0}"${2}>Cause:</div>`,nm=p`<div class="cause-text${0}"${2}>${"t1"}</div>`,rm=p`<div class="modal-overlay${0}"${2}><div class="success-modal${0}"${2}><div class="success-icon${0}"${2}>✓</div><div class="success-title${0}"${2}>Success!</div><div class="success-message${0}"${2}>Analysis saved successfully!</div></div></div>`,lm={classMap:{"why-why-container":!0},key:0},cm={classMap:{"why-why-analysis":!0},key:5},dm={classMap:{"select-contributing-factor":!0},key:6},hm={classMap:{"select-container":!0},key:9},um={"factor-select":!0},pm={classMap:{"selected-factors":!0},key:15},fm={"selected-factor":!0},mm={classMap:{"why-cause-list":!0},key:19},gm={"why-cause-pair":!0},_m={classMap:{"input-fields-stack":!0},key:23},bm={classMap:{"why-section":!0},key:24},ym={classMap:{"cause-section":!0},key:26},vm={classMap:{"existing-why-why-data":!0},key:32},wm={classMap:{"why-why-table":!0,"desktop-view":!0},key:33},xm={"table-row":!0},km={classMap:{cell:!0,"why-cell":!0},key:39},Wt={"edit-input":!0},$m={classMap:{cell:!0,"cause-cell":!0},key:47},Cm={classMap:{cell:!0,"edit-cell":!0},key:51},Sm={classMap:{"why-why-cards":!0,"mobile-view":!0},key:56},Em={"why-why-card":!0},Rm={classMap:{"card-header":!0},key:58},Am={classMap:{"card-body":!0},key:65},Im={classMap:{"card-field":!0},key:66},Fm={classMap:{"field-value":!0},key:69},Dm={classMap:{"card-field":!0},key:73},Tm={classMap:{"field-value":!0},key:76};function et(n,e,s,t){const{st:o,d:i,sp:a,b:r,k:l,i:c,f:d,h}=n,{_m0:u,_m1:f,_m2:g,_m3:_,_m4:m,_m5:x,_m6:k,_m7:$,_m8:S,_m9:O,_m10:F,_m11:D,_m12:v,_m13:A,_m14:w,_m15:y,_m16:C,_m17:I,_m18:L,_m19:N}=t;return[h("div",lm,[e.isLoading?o(Mf,2):null,e.error?o(Pf,4,[a(1,null,i(e.error))]):null,e.isLoading?null:h("div",cm,[h("div",dm,[o(jf,8),h("div",hm,[h("select",{classMap:um,key:10,on:u||(t._m0={change:r(e.handleFactorChange)})},d([o(Uf,12),c(e.availableFactors,function(T){return o(Vf,l(14,T.value),[a(0,{attrs:{value:T.value}},null),a(1,null,i(T.label))])})]))])]),e.hasSelectedFactors?h("div",pm,c(e.selectedFactors,function(T){return h("div",{classMap:fm,key:l(16,T.value)},[o(qf,18,[a(2,null,i(T.label))]),h("div",mm,d([c(T.whys,function(q,te){return h("div",{classMap:gm,key:l(20,q.id)},[o(zf,22,[a(2,null,i(q.whyLabel)),a(3,{on:f||(t._m1={click:r(e.handleRemoveWhy)}),attrs:{"data-index":te,"data-factor":T.value}},null)]),h("div",_m,[h("div",bm,[h("input",{attrs:{type:"text",placeholder:q.whyPlaceholder,"data-index":te,"data-factor":T.value},props:{value:q.why},key:25,on:g||(t._m2={change:r(e.handleWhyChange)})})]),h("div",ym,[h("input",{attrs:{type:"text",placeholder:"Enter the corresponding cause","data-index":te,"data-factor":T.value},props:{value:q.cause},key:27,on:_||(t._m3={change:r(e.handleCauseChange)})})])])])}),T.canAddMore?o(Wf,29,[a(1,{on:m||(t._m4={click:r(e.handleAddWhy)}),attrs:{"data-factor":T.value}},null)]):null]))])})):null,e.hasSelectedFactors?o(Bf,31,[a(1,{on:x||(t._m5={click:r(e.handleSave)})},null)]):null,e.hasWhyWhyData?h("div",vm,[h("div",wm,d([o(Hf,35),c(e.whyWhyTableData,function(T){return h("div",{classMap:xm,key:l(36,T.id)},[o(Jf,38,[a(1,null,i(T.contributingFactor))]),h("div",km,[T.isEditing?o(Qf,41,[a(1,null,i(T.whyLabel)+":")]):null,T.isEditing?h("input",{classMap:Wt,attrs:{type:"text","data-id":T.id,"data-field":"why"},props:{value:T.why},key:42,on:k||(t._m6={change:r(e.handleTableWhyChange)})}):null,T.isEditing?null:o(Yf,44,[a(1,null,i(T.whyLabel)+":")]),T.isEditing?null:o(Kf,46,[a(1,null,i(T.why))])]),h("div",$m,[T.isEditing?h("input",{classMap:Wt,attrs:{type:"text","data-id":T.id,"data-field":"cause"},props:{value:T.cause},key:48,on:$||(t._m7={change:r(e.handleTableCauseChange)})}):null,T.isEditing?null:o(Gf,50,[a(1,null,i(T.cause))])]),h("div",Cm,[T.isEditing?o(Xf,53,[a(1,{on:S||(t._m8={click:r(e.handleCancelEdit)}),attrs:{"data-id":T.id}},null),a(4,{on:O||(t._m9={click:r(e.handleSaveTableRow)}),attrs:{"data-id":T.id}},null)]):null,T.isEditing?null:o(Zf,55,[a(0,{on:D||(t._m11={click:r(e.handleEditTableRow)}),attrs:{"data-id":T.id}},null)])])])})])),h("div",Sm,c(e.whyWhyTableData,function(T){return h("div",{classMap:Em,key:l(57,T.id)},[h("div",Rm,[o(em,60,[a(1,null,i(T.contributingFactor))]),T.isEditing?o(tm,62,[a(1,{on:v||(t._m12={click:r(e.handleCancelEdit)}),attrs:{"data-id":T.id}},null),a(4,{on:A||(t._m13={click:r(e.handleSaveTableRow)}),attrs:{"data-id":T.id}},null)]):null,T.isEditing?null:o(sm,64,[a(0,{on:y||(t._m15={click:r(e.handleEditTableRow)}),attrs:{"data-id":T.id}},null)])]),h("div",Am,[h("div",Im,[o(om,68,[a(1,null,i(T.whyLabel)+":")]),h("div",Fm,[T.isEditing?h("input",{classMap:Wt,attrs:{type:"text","data-id":T.id,"data-field":"why"},props:{value:T.why},key:70,on:C||(t._m16={change:r(e.handleTableWhyChange)})}):null,T.isEditing?null:o(im,72,[a(1,null,i(T.why))])])]),h("div",Dm,[o(am,75),h("div",Tm,[T.isEditing?h("input",{classMap:Wt,attrs:{type:"text","data-id":T.id,"data-field":"cause"},props:{value:T.cause},key:77,on:I||(t._m17={change:r(e.handleTableCauseChange)})}):null,T.isEditing?null:o(nm,79,[a(1,null,i(T.cause))])])])])])}))]):null,e.showSuccess?o(rm,81,[a(0,{on:N||(t._m19={click:r(e.handleModalClick)})},null)]):null])])]}var Om=J(et);et.stylesheets=[],et.stylesheetToken="lwc-68rj9v1e6ml",et.legacyStylesheetToken="c-whyWhyAnalysis_whyWhyAnalysis",ei&&et.stylesheets.push.apply(et.stylesheets,ei),Q(et);class ti extends K{constructor(...e){super(...e);this.objectApiName="Rhythm__Incident__c",this.recordId="",this.fishboneData=null,this.isLoading=!0,this.error=null,this.whyWhyData=[],this.recordData={},this.fishboneRecordData={},this.fishboneCategoriesData=[],this.showSuccess=!1,this.originalData=null,this.fieldApis=[],this.whyWhyObjectApiName="Rhythm__HFE_Why_Why__c",this.fishBoneObjectApiName="Rhythm__Fishbone__c",this.availableFactors=[],this.selectedFactors=[],this.whyWhyTableData=[]}connectedCallback(){this.loadData()}async loadData(){try{this.isLoading=!0,console.log("Fishbone data passed from parent:",JSON.stringify(this.fishboneData)),this.fishboneData?(console.log("Using passed fishbone data:",JSON.stringify(this.fishboneData)),this.fishBoneObjectApiName=this.fishboneData.fishBoneObjectApiName||this.fishBoneObjectApiName,this.fishboneRecordData=this.fishboneData.recordData||{},this.fishboneCategoriesData=this.fishboneData.fishboneData||[],this.processAvailableFactorsFromPassedData()):(console.log("No fishbone data passed, querying for it"),await this.queryFishboneData()),await this.getWhyWhyData(),this.storeOriginalData(),this.isLoading=!1}catch(e){this.error=e.message||"Unknown error occurred",this.isLoading=!1,console.error("Error loading Why Why Analysis data:",e)}}storeOriginalData(){this.originalData={selectedFactors:JSON.parse(JSON.stringify(this.selectedFactors)),availableFactors:JSON.parse(JSON.stringify(this.availableFactors))}}async queryFishboneData(){try{let e="SELECT Id, ";const o=(await(await se.getValidConnection()).sobject(this.fishBoneObjectApiName).describe()).fields.filter(a=>a.type==="multipicklist");this.fieldApis=o.map(a=>a.name),this.fieldApis.forEach(a=>{e+=`${a}, `}),e+=`Rhythm__Problem_Statement__c FROM ${this.fishBoneObjectApiName} WHERE ${this.objectApiName} = '${this.recordId}'`,console.log("Fishbone query:",e);const i=await le(e);if(i&&i.length>0){const a=i[0];console.log("Fishbone data from query:",JSON.stringify(a)),this.fishboneRecordData=a,this.processAvailableFactorsFromQuery(a)}else console.log("No fishbone data found")}catch(e){console.error("Error fetching fishbone data:",e),this.error=" please save fishbone data first."}}processAvailableFactorsFromPassedData(){const e=[];Object.keys(this.fishboneRecordData).forEach(s=>{if(!s.includes("__c")||s==="attributes"||s==="Id"||s==="Rhythm__Problem_Statement__c")return;const t=this.fishboneRecordData[s];if(!t)return;const o=s.split("__")[1].split("_")[0];t.split(";").forEach(a=>{e.push({value:`${s}:${a.trim()}`,label:`${o}: ${a.trim()}`,category:o,fieldName:s,factorValue:a.trim()})})}),this.availableFactors=e,console.log("Available factors from passed data:",JSON.stringify(this.availableFactors))}processAvailableFactorsFromQuery(e){const s=[];Object.keys(e).forEach(t=>{if(!t.includes("__c")||t==="attributes"||t==="Id"||t==="Rhythm__Problem_Statement__c")return;const o=e[t];if(!o)return;const i=t.split("__")[1].split("_")[0];o.split(";").forEach(r=>{s.push({value:`${t}:${r.trim()}`,label:`${i}: ${r.trim()}`,category:i,fieldName:t,factorValue:r.trim()})})}),this.availableFactors=s,console.log("Available factors from query:",JSON.stringify(this.availableFactors))}async getWhyWhyData(){if(!!this.recordId)try{const e=`SELECT Id, Rhythm__Contributing_Factor__c, ${this.objectApiName},
                           Rhythm__Why_1__c, Rhythm__Cause_1__c, 
                           Rhythm__Why_2__c, Rhythm__Cause_2__c, Rhythm__Why_3__c, Rhythm__Cause_3__c,
                           Rhythm__Why_4__c, Rhythm__Cause_4__c, Rhythm__Why_5__c, Rhythm__Cause_5__c
                           FROM ${this.whyWhyObjectApiName}`;console.log("Why Why query:",e);const s=await le(e);s&&s.length>0?(this.whyWhyData=s,console.log("Why Why data count:",this.whyWhyData.length),console.log("Why Why data sample:",JSON.stringify(this.whyWhyData.slice(0,3))),this.processWhyWhyData()):console.log("No Why Why data found")}catch(e){console.error("Error fetching Why Why data:",e)}}processWhyWhyData(){if(this.whyWhyData.length===0)return;const e=new Set,s=[];this.whyWhyData.forEach(o=>{const i=o.Rhythm__Contributing_Factor__c;if(!!i&&o[this.objectApiName]===this.recordId){e.add(i);for(let a=1;a<=5;a++){const r=`Rhythm__Why_${a}__c`,l=`Rhythm__Cause_${a}__c`;(o[r]||o[l])&&s.push({id:`${o.Id}-${a}`,recordId:o.Id,contributingFactor:i,whyNumber:a,whyLabel:`Why ${a}`,why:o[r]||"",cause:o[l]||"",isEditing:!1})}}}),this.whyWhyTableData=s;const t={};this.whyWhyData.forEach(o=>{const i=o.Rhythm__Contributing_Factor__c;i&&(t[i]||(t[i]=[]),o[this.objectApiName]&&t[i].push(o[this.objectApiName]))}),console.log("Incident factor map:",JSON.stringify(t)),this.availableFactors=this.availableFactors.filter(o=>t[o.factorValue]?!t[o.factorValue].includes(this.recordId):!0),console.log("Table data:",JSON.stringify(this.whyWhyTableData)),console.log("Available factors after filtering:",JSON.stringify(this.availableFactors)),this.selectedFactors.length===0&&console.log("No selected factors for active editing")}handleFactorChange(e){const s=e.target.value;if(!s)return;const t=this.availableFactors.find(i=>i.value===s);if(!t)return;const o={...t,whys:[{id:`new-why-${Date.now()}`,why:"",cause:"",whyLabel:"Why 1",whyPlaceholder:"Enter why 1"}],canAddMore:!0};this.selectedFactors.length>0&&([...this.selectedFactors].forEach(a=>{this.availableFactors=[...this.availableFactors,{value:a.value,label:a.label,category:a.category,fieldName:a.fieldName,factorValue:a.factorValue}]}),this.selectedFactors=[]),this.selectedFactors=[o],this.availableFactors=this.availableFactors.filter(i=>i.value!==s),e.target.value=""}handleWhyChange(e){const s=parseInt(e.target.dataset.index,10),t=e.target.dataset.factor,o=e.target.value;this.updateFactorWhy(t,s,"why",o)}handleCauseChange(e){const s=parseInt(e.target.dataset.index,10),t=e.target.dataset.factor,o=e.target.value;this.updateFactorWhy(t,s,"cause",o)}updateFactorWhy(e,s,t,o){const i=this.selectedFactors.findIndex(r=>r.value===e);if(i===-1)return;const a=JSON.parse(JSON.stringify(this.selectedFactors));a[i].whys[s]&&(a[i].whys[s][t]=o),this.selectedFactors=a}handleAddWhy(e){const s=e.currentTarget.dataset.factor,t=this.selectedFactors.findIndex(i=>i.value===s);if(t===-1)return;const o=JSON.parse(JSON.stringify(this.selectedFactors));if(o[t].whys.length<5){let a=o[t].whys.length+1;o[t].whys.push({id:`new-why-${Date.now()}-${s}`,why:"",cause:"",whyLabel:`Why ${a}`,whyPlaceholder:`Enter why ${a}`}),o[t].canAddMore=o[t].whys.length<5}this.selectedFactors=o}handleRemoveWhy(e){const s=parseInt(e.currentTarget.dataset.index,10),t=e.currentTarget.dataset.factor,o=this.selectedFactors.findIndex(a=>a.value===t);if(o===-1)return;const i=JSON.parse(JSON.stringify(this.selectedFactors));i[o].whys.length>1&&(i[o].whys.splice(s,1),i[o].whys.forEach((a,r)=>{let l=r+1;a.whyLabel=`Why ${l}`,a.whyPlaceholder=`Enter why ${l}`}),i[o].canAddMore=i[o].whys.length<5),this.selectedFactors=i}handleCancel(){this.originalData?(this.selectedFactors=JSON.parse(JSON.stringify(this.originalData.selectedFactors)),this.availableFactors=JSON.parse(JSON.stringify(this.originalData.availableFactors))):this.loadData(),this.error=null,this.showSuccess=!1}async handleSave(){this.error=null,this.showSuccess=!1;try{this.isLoading=!0;const e=[];let s=this.objectApiName;if(this.selectedFactors.forEach(t=>{const o={Rhythm__Contributing_Factor__c:t.factorValue,[s]:this.recordId};t.whys.forEach((i,a)=>{const r=a+1;o[`Rhythm__Why_${r}__c`]=i.why,o[`Rhythm__Cause_${r}__c`]=i.cause}),e.push(o)}),console.log("Create promises:",JSON.stringify(e)),e.length>0){const t=await $e(this.whyWhyObjectApiName,e);console.log("Result:",JSON.stringify(t)),t&&t[0].success&&(this.showSuccess=!0,this.selectedFactors=[],this.getWhyWhyData(),setTimeout(()=>{this.showSuccess=!1},3e3),this.storeOriginalData())}this.isLoading=!1}catch(e){this.isLoading=!1,this.error=e.message||"Failed to save analysis",console.error("Error saving Why Why Analysis:",e)}}handleModalClick(e){e.target.classList.contains("modal-overlay")&&(this.showSuccess=!1)}handleEditTableRow(e){const s=e.currentTarget.dataset.id,t=JSON.parse(JSON.stringify(this.whyWhyTableData)),o=t.findIndex(i=>i.id===s);o!==-1&&(t[o].originalWhy=t[o].why,t[o].originalCause=t[o].cause,t[o].isEditing=!0),this.whyWhyTableData=t}handleCancelEdit(e){const s=e.currentTarget.dataset.id,t=JSON.parse(JSON.stringify(this.whyWhyTableData)),o=t.findIndex(i=>i.id===s);o!==-1&&(t[o].originalWhy!==void 0&&(t[o].why=t[o].originalWhy),t[o].originalCause!==void 0&&(t[o].cause=t[o].originalCause),t[o].isEditing=!1),this.whyWhyTableData=t}handleTableWhyChange(e){const s=e.target.dataset.id,t=e.target.value,o=JSON.parse(JSON.stringify(this.whyWhyTableData)),i=o.findIndex(a=>a.id===s);i!==-1&&(o[i].why=t),this.whyWhyTableData=o}handleTableCauseChange(e){const s=e.target.dataset.id,t=e.target.value,o=JSON.parse(JSON.stringify(this.whyWhyTableData)),i=o.findIndex(a=>a.id===s);i!==-1&&(o[i].cause=t),this.whyWhyTableData=o}async handleSaveTableRow(e){const s=e.currentTarget.dataset.id;try{const t=this.whyWhyTableData.find(c=>c.id===s);if(console.log("Row in line 584:",JSON.stringify(t)),!t)return;const o=this.whyWhyTableData.filter(c=>c.recordId===t.recordId);console.log("Rows with same recordId:",JSON.stringify(o));const i={Id:t.recordId};console.log("Record in line 597:",JSON.stringify(i)),o.forEach(c=>{i[`Rhythm__Why_${c.whyNumber}__c`]=c.why,i[`Rhythm__Cause_${c.whyNumber}__c`]=c.cause}),console.log("Record in line 603:",JSON.stringify(o)),console.log("Record in line 603:",JSON.stringify(i));const a=await oe(this.whyWhyObjectApiName,i);console.log("Update result:",a);const r=JSON.parse(JSON.stringify(this.whyWhyTableData)),l=r.findIndex(c=>c.id===s);l!==-1&&(r[l].isEditing=!1),this.whyWhyTableData=r,this.showSuccess=!0,setTimeout(()=>{this.showSuccess=!1},3e3)}catch(t){this.error=t.message||"Failed to save changes",console.error("Error saving Why Why record:",t)}}get hasSelectedFactors(){return this.selectedFactors&&this.selectedFactors.length>0}get hasWhyWhyData(){return this.whyWhyTableData&&this.whyWhyTableData.length>0}}Y(ti,{publicProps:{objectApiName:{config:0},recordId:{config:0},fishboneData:{config:0}},track:{isLoading:1,error:1,whyWhyData:1,recordData:1,fishboneRecordData:1,fishboneCategoriesData:1,showSuccess:1,originalData:1,fieldApis:1,whyWhyObjectApiName:1,fishBoneObjectApiName:1,availableFactors:1,selectedFactors:1,whyWhyTableData:1}});const Lm=z(ti,{tmpl:Om,sel:"c-why-why-analysis",apiVersion:63}),Nm=p`<div class="error-container${0}"${2}><div class="error-content${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><p class="error-text${0}"${2}>${"t5"}</p></div><button class="error-dismiss${0}" title="Dismiss error"${2}>×</button></div>`,Mm=p`<div${"c0"}${2}><div class="toast-content${0}"${2}><span class="toast-icon${0}"${2}>${"t3"}</span><span class="toast-message${0}"${2}>${"t5"}</span><button class="toast-close${0}" aria-label="Close notification"${2}>×</button></div></div>`,Pm=p`<button type="button" title="Edit Investigation" class="edit-icon-button${0}"${2}><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"${3}><path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"${3}/></svg></button>`,jm=p`<div class="section-header${0}"${2}>${"t1"}</div>`,Um=p`<abbr class="required-field${0}"${2}>*</abbr>`,Vm=p`<span class="checkbox-label${0}"${2}>Yes</span>`,qm=p`<span class="field-display-value readonly-field${0}"${2}>${"t1"}</span>`,zm=p`<span class="empty-field${0}"${2}>--</span>`,Wm=p`<option value${3}>${"t1"}</option>`,Bm=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,Hm=p`<option value${3}>${"t1"}</option>`,Jm=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,Qm=p`<textarea${"a0:name"} class="form-textarea edit-mode-input${0}"${"a0:data-field"}${"a0:placeholder"} rows="3"${2}>${"t1"}</textarea>`,Ym=p`<span class="empty-field-readonly${0}"${2}>--</span>`,Km=p`<span class="empty-field${0}"${2}>--</span>`,Gm=p`<div class="section-header collapsible-header${0}"${2}><span${"c1"}${2}>&gt;</span><span class="section-title${0}"${2}>Fishbone Analysis</span></div>`,Xm=p`<div class="section-header collapsible-header${0}"${2}><span${"c1"}${2}>&gt;</span><span class="section-title${0}"${2}>Why Why Analysis</span></div>`,Zm=p`<div class="section-header collapsible-header${0}"${2}><span${"c1"}${2}>&gt;</span><span class="section-title${0}"${2}>Root Cause Analysis</span><button type="button" title="Edit Root Cause Analysis" class="edit-icon-button root-cause-edit${0}" data-stop-propagation="true"${2}><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"${3}><path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"${3}/></svg></button></div>`,eg=p`<div class="empty-state-message${0}"${2}><p class="empty-state-text${0}"${2}>No Root Causes Added</p><p class="empty-state-subtext${0}"${2}>Click &quot;Edit&quot; to start adding root causes.</p></div>`,tg=p`<span class="root-cause-label${0}"${2}>${"t1"}</span>`,sg=p`<button class="delete-button${0}"${"a0:data-index"} title="Delete this root cause"${2}>🗑️</button>`,og=p`<textarea${"a0:name"} class="root-cause-textarea${0}"${"a0:data-field"}${"a0:placeholder"} rows="4"${2}>${"t1"}</textarea>`,ig=p`<div class="root-cause-field-header${0}"${2}><span class="root-cause-label${0}"${2}>${"t2"}</span></div>`,ag=p`<div class="root-cause-display-value${0}"${2}>${"t1"}</div>`,ng=p`<div class="root-cause-empty${0}"${2}>--</div>`,rg=p`<div class="add-root-cause-container${0}"${2}><button type="button" class="add-root-cause-button${0}"${2}>+ Add Root Cause</button></div>`,lg=p`<div class="root-cause-buttons${0}"${2}><button type="button" title="Save Root Cause Analysis" class="save-button root-cause-save${0}"${"a1:disabled"}${2}>Save Root Cause</button><button type="button" title="Cancel Root Cause Changes" class="cancel-button root-cause-cancel${0}"${"a3:disabled"}${2}>Cancel</button></div>`,cg=p`<div class="section-header collapsible-header${0}"${2}><span${"c1"}${2}>&gt;</span><span class="section-title${0}"${2}>Related Action Item</span></div>`,dg=p`<div class="button-container main-buttons${0}"${2}><button type="button" title="Save Changes" class="save-button main-save${0}"${"a1:disabled"}${2}>Save</button><button type="button" title="Cancel Changes" class="cancel-button main-cancel${0}"${"a3:disabled"}${2}>Cancel</button></div>`,hg={classMap:{"investigation-container":!0},key:0},ug={classMap:{"loading-container":!0},key:1},pg={props:{alternativeText:"Loading investigation data...",size:"medium"},key:2},fg={classMap:{"edit-icon-button-container":!0},key:7},mg={"section-container":!0},gg={classMap:{"fields-grid":!0},key:13},_g={"field-container":!0},bg={classMap:{"field-label":!0},key:15},yg={classMap:{"checkbox-container":!0},key:19},vg={"form-checkbox":!0},si={"form-select":!0,"edit-mode-input":!0},tt={"form-input":!0,"edit-mode-input":!0},wg={classMap:{"field-display-value":!0,"readonly-field":!0},key:46},Ot=[],xg={classMap:{"section-container":!0,"fishbone-section":!0},key:51},kg={classMap:{"fishbone-content":!0},key:54},$g={classMap:{"section-container":!0,"why-why-section":!0},key:56},Cg={classMap:{"why-why-content":!0},key:59},Sg={classMap:{"section-container":!0,"root-cause-section":!0},key:61},Eg={classMap:{"root-cause-content":!0},key:64},oi={"root-cause-field-container":!0},Rg={classMap:{"root-cause-field-header":!0},key:68},Ag={classMap:{"section-container":!0,"related-tasks-section":!0},key:86},Ig={classMap:{"related-tasks-content":!0},key:89};function st(n,e,s,t){const{c:o,h:i,d:a,b:r,sp:l,st:c,ncls:d,k:h,t:u,i:f,f:g}=n,{_m0:_,_m1:m,_m2:x,_m3:k,_m4:$,_m5:S,_m6:O,_m7:F,_m8:D,_m9:v,_m10:A,_m11:w,_m12:y,_m13:C,_m14:I,_m15:L,_m16:N,_m17:T,_m18:q,_m19:te,_m20:pe,_m21:Ne,_m22:fe,_m23:Ce,_m24:_e,_m25:Se,_m26:xe,_m27:Ee,_m28:be,_m29:Re,_m30:ye,_m31:ke,_m32:M,_m33:ve,_m34:E}=t;return[i("div",hg,g([e.loading?i("div",ug,[o("lightning-spinner",To,pg)]):null,e.hasError?c(Nm,4,[l(5,null,a(e.error)),l(6,{on:_||(t._m0={click:r(e.dismissError)})},null)]):null,e.showToast?c(Mm,6,[l(0,{className:d(e.toastClasses)},null),l(3,null,a(e.toastIcon)),l(5,null,a(e.toastMessage)),l(6,{on:m||(t._m1={click:r(e.handleToastClose)})},null)]):null,e.loading?Ot:g([e.showSections?i("div",fg,[e.isEditMode?null:c(Pm,9,[l(0,{on:k||(t._m3={click:r(e.handleEdit)})},null)])]):null,e.showSections?f(e.sections,function(P){return i("div",{classMap:mg,key:h(10,P.name)},[c(jm,12,[l(1,null,a(P.name))]),i("div",gg,f(P.fields,function(b){return b.isVisible?i("div",{classMap:_g,key:h(14,b.fieldApi)},[i("div",bg,[u(a(b.label)),b.required?c(Um,17):null]),i("div",{className:d(b.fieldValueClass),key:18},[b.isCheckbox&&e.isEditMode&&b.isEditable?i("label",yg,[i("input",{classMap:vg,attrs:{type:"checkbox","data-field":b.fieldApi},props:{checked:b.checkedValue},key:20,on:$||(t._m4={change:r(e.handleFieldChange)})}),c(Vm,22)]):null,b.isCheckbox&&e.isEditMode?b.isEditable?null:c(qm,24,[l(1,null,a(b.displayValue))]):null,b.isCheckbox?e.isEditMode?null:b.hasValue?u(a(b.displayValue)):null:null,b.isCheckbox?e.isEditMode||b.hasValue?null:c(zm,26):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isSelect?i("select",{classMap:si,attrs:{name:b.fieldApi,"data-field":b.fieldApi},key:27,on:S||(t._m5={change:r(e.handleFieldChange)})},g([c(Wm,29,[l(1,null,"-- Select "+a(b.label)+" --")]),f(b.options,function(ee){return c(Bm,h(31,ee.value),[l(0,{attrs:{value:ee.value,selected:ee.selected?"":null}},null),l(1,null,a(ee.label))])})])):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isLookup?i("select",{classMap:si,attrs:{name:b.fieldApi,"data-field":b.fieldApi},key:32,on:O||(t._m6={change:r(e.handleFieldChange)})},g([c(Hm,34,[l(1,null,"-- Select "+a(b.label)+" --")]),f(b.lookupOptions,function(ee){return c(Jm,h(36,ee.value),[l(0,{attrs:{value:ee.value,selected:ee.selected?"":null}},null),l(1,null,a(ee.label))])})])):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isTextarea?c(Qm,38,[l(0,{on:D||(t._m8={change:r(e.handleFieldChange)}),attrs:{name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.label}},null),l(1,null,a(b.value))]):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isText?i("input",{classMap:tt,attrs:{type:b.inputType,name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.label},props:{value:b.value},key:39,on:v||(t._m9={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isNumber?i("input",{classMap:tt,attrs:{type:"number",name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.label},props:{value:b.value},key:40,on:A||(t._m10={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isDate?i("input",{classMap:tt,attrs:{type:"date",name:b.fieldApi,"data-field":b.fieldApi},props:{value:b.inputValue},key:41,on:w||(t._m11={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isDateTime?i("input",{classMap:tt,attrs:{type:"datetime-local",name:b.fieldApi,"data-field":b.fieldApi},props:{value:b.inputValue},key:42,on:y||(t._m12={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isEmail?i("input",{classMap:tt,attrs:{type:"email",name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.label},props:{value:b.value},key:43,on:C||(t._m13={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isPhone?i("input",{classMap:tt,attrs:{type:"tel",name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.label},props:{value:b.value},key:44,on:I||(t._m14={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode&&b.isEditable&&b.isUrl?i("input",{classMap:tt,attrs:{type:"url",name:b.fieldApi,"data-field":b.fieldApi,placeholder:b.label},props:{value:b.value},key:45,on:L||(t._m15={change:r(e.handleFieldChange)})}):null,b.isCheckbox?null:e.isEditMode?b.isEditable?null:i("span",wg,[b.hasValue?u(a(b.displayValue)):null,b.hasValue?null:c(Ym,48)]):null,b.isCheckbox||e.isEditMode?null:b.hasValue?u(a(b.displayValue)):null,b.isCheckbox||e.isEditMode||b.hasValue?null:c(Km,50)])]):null}))])}):Ot,i("div",xg,[c(Gm,53,[l(0,{on:T||(t._m17={click:r(e.toggleFishboneExpansion)})},null),l(1,{className:d(e.fishboneExpandIconClass)},null)]),e.isFishboneExpanded?i("div",kg,[o("c-fishbone-analysis",Lf,{props:{recordId:e.recordId,objectApiName:"Rhythm__Incident_Injury__c"},key:55,on:q||(t._m18={fishbonesaved:r(e.handleFishboneSaved)})})]):null]),i("div",$g,[c(Xm,58,[l(0,{on:pe||(t._m20={click:r(e.toggleWhyWhyExpansion)})},null),l(1,{className:d(e.whyWhyExpandIconClass)},null)]),e.isWhyWhyExpanded?i("div",Cg,[o("c-why-why-analysis",Lm,{props:{recordId:e.recordId,objectApiName:"Rhythm__Incident__c",fishboneData:e.fishboneDataForWhyWhy},key:60})]):null]),i("div",Sg,[c(Zm,63,[l(0,{on:fe||(t._m22={click:r(e.toggleRootCauseExpansion)})},null),l(1,{className:d(e.rootCauseExpandIconClass)},null),l(5,{on:Ce||(t._m23={click:r(e.handleEditRootCause)})},null)]),e.isRootCauseExpanded?i("div",Eg,g([e.isRootCauseEditMode||e.hasRootCauseData?null:c(eg,66),e.isRootCauseEditMode?f(e.visibleRootCauseFields,function(P){return i("div",{classMap:oi,key:h(67,P.index)},[i("div",Rg,[c(tg,70,[l(1,null,a(P.label))]),P.canDelete?c(sg,72,[l(0,{on:Se||(t._m25={click:r(e.handleDeleteRootCause)}),attrs:{"data-index":P.index}},null)]):null]),c(og,74,[l(0,{on:Ee||(t._m27={change:r(e.handleRootCauseFieldChange)}),attrs:{name:P.fieldApi,"data-field":P.fieldApi,placeholder:P.label}},null),l(1,null,a(P.value))])])}):Ot,e.isRootCauseEditMode?Ot:e.hasRootCauseData?f(e.visibleRootCauseFields,function(P){return i("div",{classMap:oi,key:h(75,P.index)},[c(ig,77,[l(2,null,a(P.label))]),P.value?c(ag,79,[l(1,null,a(P.value))]):null,P.value?null:c(ng,81)])}):Ot,e.canAddMoreRootCause?c(rg,83,[l(1,{on:be||(t._m28={click:r(e.handleAddRootCause)})},null)]):null,e.isRootCauseEditMode?c(lg,85,[l(1,{on:Re||(t._m29={click:r(e.handleSaveRootCause)}),attrs:{disabled:e.isSubmitting?"":null}},null),l(3,{on:ye||(t._m30={click:r(e.handleCancelRootCause)}),attrs:{disabled:e.isSubmitting?"":null}},null)]):null])):null]),i("div",Ag,[c(cg,88,[l(0,{on:M||(t._m32={click:r(e.toggleActionItemsExpansion)})},null),l(1,{className:d(e.actionItemsExpandIconClass)},null)]),e.isActionItemsExpanded?i("div",Ig,[o("c-cp-exp-list-view",Ss,{props:{recordId:e.recordId,objectApiName:"Task",componentDetail:e.taskComponentDetail},key:90})]):null]),e.isEditMode?c(dg,92,[l(1,{on:ve||(t._m33={click:r(e.handleSave)}),attrs:{disabled:e.isSubmitting?"":null}},null),l(3,{on:E||(t._m34={click:r(e.handleCancel)}),attrs:{disabled:e.isSubmitting?"":null}},null)]):null])]))]}var Fg=J(st);st.stylesheets=[],st.stylesheetToken="lwc-2kjrd2cb5qo",st.legacyStylesheetToken="c-tabInvestigation_tabInvestigation",Go&&st.stylesheets.push.apply(st.stylesheets,Go),Q(st);class Lt extends K{constructor(...e){super(...e);this.objectApiName="Rhythm__Incident_injury__c",this.recordId=void 0,this.loading=!0,this.error=void 0,this.isEditMode=!1,this.showSpinner=!1,this.isOfflineData=!1,this.sections=[],this.formData={},this.devNameToApi={},this.allFieldsMap={},this.controllingFieldsMap={},this.objectSchema={},this.picklistValues={},this.lookupOptionsMap={},this.fieldConfigurations=[],this.recordData={},this.selectedContractorId=null,this.contactAccountMap={},this.selectedLocationId=null,this.workAreaLocationMap={},this.originalRecordData={},this.hasUnsavedChanges=!1,this.changedFields={},this.currentUserId=null,this.currentFieldApi=null,this.isSubmitting=!1,this.showToast=!1,this.toastMessage="",this.toastType="info",this.rootCauseData={},this.isRootCauseExpanded=!1,this.visibleRootCauseCount=1,this.maxRootCauseCount=7,this.isFishboneExpanded=!0,this.fishboneDataForWhyWhy=null,this.isWhyWhyExpanded=!1,this.isActionItemsExpanded=!1,this.originalRootCauseData={},this.isRootCauseEditMode=!1,this.allowedSections=Lt.ALLOWED_INVESTIGATION_SECTIONS,this.rootCauseFields=["Rhythm__Root_Cause_1__c","Rhythm__Root_Cause_2__c","Rhythm__Root_Cause_3__c","Rhythm__Root_Cause_4__c","Rhythm__Root_Cause_5__c","Rhythm__Root_Cause_6__c","Rhythm__Root_Cause_7__c"],this.taskComponentDetail={objectApiName:"Task",listViewObject:"Task"}}connectedCallback(){if(console.log("\u{1F680} TabInvestigation connected with:"),console.log(`   - objectApiName: ${this.objectApiName}`),console.log(`   - recordId: ${this.recordId}`),!this.objectApiName){console.error("\u274C objectApiName is required but not provided"),this.error="Object API Name is required. Please ensure the component is properly configured.",this.loading=!1;return}if(!this.recordId){console.error("\u274C recordId is required but not provided"),this.error="Record ID is required. Please ensure you have a valid record to view/edit.",this.loading=!1;return}this.loadFieldConfigurations()}async loadFieldConfigurations(){this.loading=!0,this.error=null;try{console.log(`Loading field configurations for ${this.objectApiName}...`);let e,s=!1;try{const t=await H.getMetadata(this.objectApiName);if(t&&t.fieldMetadata&&t.fieldMetadata.length>0){console.log("\u{1F4F1} Using cached metadata first (offline-first approach)");const[o,i,a]=await Promise.all([H.getCachedObjectSchema(this.objectApiName).catch(()=>null),H.getCachedLookupOptions(this.objectApiName).catch(()=>null),H.getCachedControllingFields(this.objectApiName).catch(()=>null)]),r=await this.processCachedMetadataLegacy(t.fieldMetadata,a?.records||[],o||{},i||{});r&&Object.keys(r).length>0&&(e=r,s=!0)}}catch(t){console.warn("\u26A0\uFE0F Failed to check offline field configurations:",t)}(!e||Object.keys(e).length===0)&&(e=await this.js_getDynamicFieldConfig(this.objectApiName)),e&&Object.keys(e).length>0?(console.log(`Field configurations loaded (${s?"offline":"online"}):`,e),this.fieldConfigurations=e,this.buildDevNameToApi(),this.organizeFieldsBySection(),await this.loadRecordData()):(console.warn(`No field configurations found for ${this.objectApiName}`),this.sections=[])}catch(e){console.error("Error loading field configurations:",e),this.error=e?.message||"Failed to load field configurations",this.loading=!1,this.scrollToTop()}}async processCachedMetadata(e){const s=e.fieldMetadata||[];let t=e.controllingFields||[];try{const o=await H.getCachedControllingFields(this.objectApiName);o&&Array.isArray(o.records)&&o.records.length>0?(t=o.records,console.log(`\u{1F4E6} Loaded ${t.length} controlling fields from cache`)):(!t||t.length===0)&&(console.log("\u26A0\uFE0F No controlling fields found in cache, using empty structure"),t=[])}catch(o){console.warn("\u26A0\uFE0F Error loading controlling fields from cache:",o.message),t=t||[]}return console.log(`\u{1F50D} Controlling fields available: ${t.length}`),this.lookupOptionsMap={...this.lookupOptionsMap||{}},this.picklistValues={},e.objectSchema&&(this.objectSchema=e.objectSchema),Object.keys(this.objectSchema).forEach(o=>{const i=this.objectSchema[o];(i.type==="picklist"||i.type==="multipicklist")&&i.picklistValues&&i.picklistValues.length>0&&(this.picklistValues[o]=i.picklistValues.map(a=>({label:a.label,value:a.value,active:a.active!==!1,defaultValue:a.defaultValue||!1})))}),s.filter(o=>o.Rhythm__is_Mobile__c===!0).forEach(o=>{const i=o.Rhythm__Field_Api_Name__c;if(o._lookupOptions&&o._lookupOptions.length>0&&(this.lookupOptionsMap[i]=o._lookupOptions,console.log(`\u{1F517} Found cached lookup options for ${i}:`,o._lookupOptions.length)),o._fieldType==="picklist"||o._fieldType==="multipicklist"){if(o._picklistValues&&o._picklistValues.length>0)this.picklistValues[i]=o._picklistValues,console.log(`\u{1F4CB} Found enhanced cached picklist values for ${i}:`,o._picklistValues.length);else if(!this.picklistValues[i]){const a=this.objectSchema[i];a&&a.picklistValues&&a.picklistValues.length>0&&(this.picklistValues[i]=a.picklistValues.map(r=>({label:r.label,value:r.value,active:r.active!==!1,defaultValue:r.defaultValue||!1})),console.log(`\u{1F4CB} Using schema picklist values for ${i}:`,this.picklistValues[i].length))}}}),console.log("\u{1F517} Final lookup options map:",Object.keys(this.lookupOptionsMap).length,"fields with options"),console.log("\u{1F4CB} Final picklist values map:",Object.keys(this.picklistValues).length,"fields with values"),{fieldMetadata:s,controllingFields:t,objectSchema:this.objectSchema}}async processCachedMetadataLegacy(e,s,t,o){try{console.log("Processing cached metadata (legacy wrapper):",{fields:e.length,controllingFields:s.length,schemaFields:Object.keys(t).length,lookupFields:Object.keys(o).length});const i={fieldMetadata:e,controllingFields:s,objectSchema:t};this.lookupOptionsMap=o||{},await this.processCachedMetadata(i);const a={};return e.filter(r=>r.Rhythm__is_Mobile__c===!0).forEach(r=>{const l=r.Rhythm__Section_Name__c||"General Information",c=l.split(",").map(g=>g.trim()).filter(g=>g);console.log(`\u{1F4CB} Processing field ${r.Rhythm__Field_Api_Name__c}:`),console.log(`\u{1F4CB}   Raw section name: "${l}"`),console.log(`\u{1F4CB}   Split sections: [${c.map(g=>`"${g}"`).join(", ")}]`),console.log(`\u{1F4CB}   Number of sections: ${c.length}`);const d=r.Rhythm__Field_Api_Name__c,h=t[d],u=r._fieldType||(h?h.type:"TEXT"),f={};s.forEach(g=>{if(g.Rhythm__Fields_Level_Configuration__r?.DeveloperName===r.DeveloperName){const _=g.MasterLabel,m=g.Rhythm__Value__c;f[_]||(f[_]=[]),f[_].push(m)}}),c.forEach(g=>{a[g]||(a[g]={}),a[g][d]={fieldApi:d,label:r._label||r.MasterLabel||d,fieldType:(u||"").toUpperCase(),required:r.Rhythm__Required__c||!1,section:g,fieldOrder:r.Rhythm__Order__c||0,developerName:r.DeveloperName||d,visibleWhenValues:f,picklistValues:r._picklistValues||[],lookupOptions:r._lookupOptions||o[d]||[],referenceToObject:h?.referenceTo||[]},console.log(`\u2705 Added field ${d} to section "${g}"`)})}),a}catch(i){return console.error("Error processing cached metadata:",i),null}}async js_getDynamicFieldConfig(){try{return console.log("Fetching fresh metadata from Salesforce..."),{}}catch(e){throw console.error("Error fetching dynamic field config:",e),e}}buildDevNameToApi(){this.devNameToApi={},this.allFieldsMap={},Object.keys(this.fieldConfigurations).forEach(e=>{const s=this.fieldConfigurations[e];Object.values(s).forEach(t=>{t.developerName&&t.fieldApi&&(this.devNameToApi[t.developerName]=t.fieldApi),this.allFieldsMap[t.fieldApi]=t})}),console.log("\u2705 Built field mappings")}organizeFieldsBySection(){console.log("\u{1F504} Organizing fields by section (cpDetailPage approach) with filtering..."),this.sections=[],console.log("\u{1F50D} Available sections in fieldConfigurations:",Object.keys(this.fieldConfigurations)),console.log("\u{1F50D} Allowed sections:",this.allowedSections),Object.keys(this.fieldConfigurations).forEach(e=>{if(console.log(`\u{1F50D} Evaluating section: "${e}"`),!this.allowedSections.some(a=>{const r=e.toLowerCase().includes(a.toLowerCase())||a.toLowerCase().includes(e.toLowerCase()),l=e.replace(/[^\w\s]/g,"").toLowerCase(),c=a.replace(/[^\w\s]/g,"").toLowerCase(),d=l.includes(c)||c.includes(l);return r||d?(console.log(`\u2705 Section "${e}" matches allowed section "${a}"`),!0):!1})){console.log(`\u274C Section "${e}" not in allowed list - SKIPPING`),console.log(`   - Available sections: ${Object.keys(this.fieldConfigurations).join(", ")}`),console.log(`   - Allowed sections: ${this.allowedSections.join(", ")}`);return}console.log(`\u2705 Section "${e}" is allowed - including`);const t=this.fieldConfigurations[e],o=Object.values(t).map(a=>{const r=a.fieldType&&a.fieldType.toUpperCase()==="BOOLEAN",l=JSON.parse(JSON.stringify(a));return l.hasValue=!1,l.displayValue="",l.isBoolean=r,l.booleanValue=!1,l.fieldValueClass=r?"field-value checkbox-field-value":"field-value",console.log(`\u{1F4CB} Added field to section ${e}: ${a.fieldApi} (${a.label})`),l});if(o.length===0){console.log(`\u23ED\uFE0F Skipping empty section: ${e}`);return}o.sort((a,r)=>a.fieldOrder-r.fieldOrder);const i=Math.min(...o.map(function(a){return a&&a.fieldOrder?a.fieldOrder:0}));this.sections.push({name:e,fields:o,order:i}),console.log(`\u2705 Added allowed section ${e} with ${o.length} fields`)}),this.sections.sort((e,s)=>e.order-s.order),console.log(`\u2705 Organized ${this.sections.length} allowed sections for display`)}async loadRecordData(){if(!this.recordId){console.error("\u274C No recordId provided, cannot load record data"),this.error="Record ID is required to load investigation data. Please ensure you have a valid record.",this.loading=!1;return}if(!this.objectApiName){console.error("\u274C No objectApiName provided, cannot load record data"),this.error="Object API Name is required to load investigation data. Please ensure the component is properly configured.",this.loading=!1;return}try{console.log("\u{1F504} Loading record data using cpDetailPage approach...");const e=[];if(this.sections.forEach(o=>{o.fields?.forEach(i=>{i.fieldApi&&e.push(i.fieldApi)})}),e.push(...this.rootCauseFields),console.log(`\u{1F4CB} Fields to query (${e.length}):`,JSON.stringify(e)),e.length===0){console.log("No fields to query"),this.loading=!1;return}let s,t=!1;if(await V()){console.log("\u{1F310} Online mode: Attempting to fetch fresh data from Salesforce");try{s=await this.js_getRecordData({objectApiName:this.objectApiName,recordId:this.recordId,fieldApiNames:e,contactFieldApiNames:[]}),console.log("\u2705 Retrieved fresh data from Salesforce")}catch(o){if(console.warn("\u274C Online query failed:",o),s=await this.tryOfflineFallback(),s)t=!0,console.log("\u2705 Retrieved data from cache (online fallback)");else throw new Error("Unable to fetch data from Salesforce and no cached data available")}}else console.log("\u{1F4F1} Offline mode: Using cached data"),s=await this.tryOfflineFallback(),s&&(t=!0,console.log("\u2705 Retrieved data from cache (offline mode)"));if(s&&s.length>0)this.recordData=s[0],this.formData={...this.recordData},this.originalRecordData={...this.recordData},this.isOfflineData=t,console.log("\u{1F4BE} Record data loaded:",this.recordData),this.prepareFieldsForDisplay(),await this.loadRootCauseData();else throw new Error("No record data found")}catch(e){console.error("Error loading record data:",e),this.error=e.message}finally{this.loading=!1}}async js_getRecordData({objectApiName:e,recordId:s,fieldApiNames:t}){try{const o=await se.getValidConnection();console.log("\u{1F4CB} Building query for record data...");const a=`SELECT ${t.join(", ")} FROM ${e} WHERE Id = '${s}' LIMIT 1`;console.log(`\u{1F50D} Executing query: ${a}`);const r=await o.query(a);return console.log("\u{1F4E6} Query result:",r),r.records}catch(o){throw console.error("\u274C Error in js_getRecordData:",o),o}}async tryOfflineFallback(){console.log("\u{1F50D} Trying offline fallback...");try{const e=await de(Z.LIST_VIEW_RECORDS);console.log(`\u{1F4E6} Found ${e.length} cached records in storage`);for(const s of e){const t=s.records||s.data;if(Array.isArray(t)){const o=t.find(i=>i.Id===this.recordId);if(o)return console.log(`\u2705 Found record in cache item: ${s.id}`),[o]}}return console.log("\u274C No cached data found"),null}catch(e){return console.error("\u274C Error during offline fallback:",e),null}}prepareFieldsForDisplay(){if(!this.sections||this.sections.length===0){console.log("\u274C No sections to prepare for display");return}this.prepopulateFormDataFromRecord(),console.log("\u{1F504} Preparing fields for display with formData:",this.formData),this.sections.forEach(e=>{e.fields.forEach(s=>{this.currentFieldApi=s.fieldApi,this.prepareFieldForDisplay(s)})}),this.updateFieldVisibility(),console.log("\u2705 Fields prepared for display")}prepopulateFormDataFromRecord(){if(!this.recordData){console.log("\u26A0\uFE0F No recordData available for prepopulation");return}console.log("\u{1F4DD} Prepopulating formData from recordData for edit mode..."),Object.keys(this.recordData).forEach(e=>{this.formData[e]===void 0&&this.recordData[e]!==void 0&&(this.formData[e]=this.recordData[e],console.log(`\u{1F4DD} Prepopulated formData[${e}] = ${this.formData[e]}`))}),console.log("\u2705 FormData prepopulation complete")}prepareFieldForDisplay(e){try{this.currentFieldApi=e.fieldApi;const s=this.enhanceFieldForRendering(e);Object.assign(e,s),console.log(`\u2705 Prepared field ${e.fieldApi}: ${e.displayValue}`)}catch(s){console.error(`\u274C Error preparing field ${e.fieldApi}:`,s),e.hasValue=!1,e.displayValue=""}}enhanceFieldForRendering(e){const s=this.formData[e.fieldApi]!==void 0?this.formData[e.fieldApi]:e.defaultValue!==void 0?e.defaultValue:"",t=String(e.fieldType||"").toLowerCase(),o=e.fieldApi||"";this.currentFieldApi=o;const i=this.objectSchema[o],a=t==="boolean"||i&&i.type==="boolean",r=t==="picklist"||t==="multipicklist"||i&&["picklist","multipicklist"].includes(i.type)||e.picklistValues&&e.picklistValues.length>0||this.picklistValues[o]&&this.picklistValues[o].length>0,l=t==="reference"||i&&i.type==="reference"||e.referenceTo&&e.referenceTo.length>0||e.referenceToObject&&e.referenceToObject.length>0||this.lookupOptionsMap[o]&&this.lookupOptionsMap[o].length>0,c=t==="reference"||i&&i.type==="reference"||e.referenceTo&&e.referenceTo.length>0||this.lookupOptionsMap[o]&&this.lookupOptionsMap[o].length>0,d=t==="textarea"||t==="longtextarea"||i&&["textarea","longtextarea"].includes(i.type)||o.toLowerCase().includes("description")||o.toLowerCase().includes("comment"),h=i?.type?.toLowerCase()||"",u=t.toLowerCase(),f=o.toLowerCase(),g=h==="datetime"||u==="datetime"||f.includes("datetime")&&!h&&!u,_=!g&&(h==="time"||u==="time"||f.includes("time")&&!f.includes("date")&&!h&&!u),m=!g&&!_&&(h==="date"||u==="date"||f.includes("date")&&!f.includes("time")&&!h&&!u),x=t==="email"||i&&i.type==="email",k=t==="phone"||i&&i.type==="phone",$=t==="url"||i&&i.type==="url",S=["double","integer","currency","percent"].includes(t)||i&&["double","integer","currency","percent"].includes(i.type),O=!(a||r||c||d||m||g||_||x||k||$||S);e.defaultValue&&!this.formData[e.fieldApi]&&(this.formData={...this.formData,[e.fieldApi]:a?e.defaultValue===!0||e.defaultValue==="true":e.defaultValue});let F=[];r?(F=this.getPicklistOptions(e),F=F.map(w=>({...w,selected:w.value===s}))):c&&(F=this.getLookupOptions(e),F=F.map(w=>({...w,selected:w.value===s})));let D="";if(a)D=s?"Yes":"No";else if(r&&F.length>0){const w=F.find(y=>y.value===s);D=w?w.label:s||""}else if(l){const w=`${o}.Name`,y=o.endsWith("__c")?`${o.replace("__c","__r")}.Name`:`${o}__r.Name`;let C=this.formData[w]||this.recordData[w]||this.formData[y]||this.recordData[y];const I=this.getFieldIdValue(e);if(!C){const L=o.endsWith("__c")?o.replace("__c","__r"):`${o}__r`,N=this.formData[L]||this.recordData[L];N&&typeof N=="object"&&N.Name&&(C=N.Name,this.formData[w]=C,this.formData[y]=C)}if(C&&String(C).trim()!=="")D=String(C).trim();else if(I&&F.length>0){const L=F.find(N=>N.value===I);L&&L.label?D=String(L.label).trim():D=I}else{const L=this.formData[o]||this.recordData[o];L&&typeof L=="object"&&L.Name?D=String(L.Name).trim():L&&typeof L=="object"&&L.attributes?D=L.Name?String(L.Name).trim():s||"":I?D=I:D=""}}else D=this.formatDisplayValue(s,e.fieldType);let v;_?v=!0:v=D!=null&&D!=="";let A=s;if(this.isFieldReadOnly&&this.isFieldReadOnly(e.fieldApi)&&this.READ_ONLY_FIELDS&&this.READ_ONLY_FIELDS.includes(e.fieldApi)){const w=new Date;let y=null;if(e.fieldApi==="Rhythm__Date_and_Time_of_Observation__c"){const C=w.getFullYear(),I=String(w.getMonth()+1).padStart(2,"0"),L=String(w.getDate()).padStart(2,"0"),N=String(w.getHours()).padStart(2,"0"),T=String(w.getMinutes()).padStart(2,"0"),q=String(w.getSeconds()).padStart(2,"0");y=`${C}-${I}-${L}T${N}:${T}:${q}`}else if(e.fieldApi==="Rhythm__Date_Time_Reported__c"){const C=w.getFullYear(),I=String(w.getMonth()+1).padStart(2,"0"),L=String(w.getDate()).padStart(2,"0"),N=String(w.getHours()).padStart(2,"0"),T=String(w.getMinutes()).padStart(2,"0"),q=String(w.getSeconds()).padStart(2,"0");y=`${C}-${I}-${L}T${N}:${T}:${q}`}y&&(A=y,this.formData[e.fieldApi]=y)}return{...e,value:A,displayValue:D,hasValue:v,isCheckbox:a,isSelect:r,isLookup:c,isTextarea:d,isDate:m,isDateTime:g,isTime:_,isEmail:x,isPhone:k,isUrl:$,isNumber:S,isText:O,isEditable:!a&&e.fieldApi!=="OwnerId"&&!this.isFieldNonEditable(e.fieldApi),isVisible:this.isFieldVisible(e),inputType:this.getInputType(e.fieldType),inputValue:this.getInputValue(e),checkedValue:a?s===!0||s==="true":!1,options:F,lookupOptions:c?F:[]}}getPicklistOptions(e){let s=[];return this.picklistValues&&this.picklistValues[e.fieldApi]&&Array.isArray(this.picklistValues[e.fieldApi])&&this.picklistValues[e.fieldApi].length>0?(s=this.picklistValues[e.fieldApi],console.log(`\u{1F4CB} Using cached picklist values for ${e.fieldApi}: ${s.length} options`)):e.picklistValues&&Array.isArray(e.picklistValues)&&e.picklistValues.length>0?(s=e.picklistValues,console.log(`\u{1F4CB} Using field's own picklist values for ${e.fieldApi}: ${s.length} options`)):e._picklistValues&&Array.isArray(e._picklistValues)&&e._picklistValues.length>0?(s=e._picklistValues,console.log(`\u{1F4CB} Using _picklistValues for ${e.fieldApi}: ${s.length} options`)):e.picklistOptions&&Array.isArray(e.picklistOptions)&&e.picklistOptions.length>0&&(s=e.picklistOptions,console.log(`\u{1F4CB} Using picklistOptions for ${e.fieldApi}: ${s.length} options`)),s}getLookupOptions(e){let s=[];console.log(`\u{1F50D} Getting lookup options for field: ${e.fieldApi}`),console.log("\u{1F50D} Available lookup options map keys:",Object.keys(this.lookupOptionsMap||{})),console.log(`\u{1F50D} Specific lookup options for ${e.fieldApi}:`,this.lookupOptionsMap?.[e.fieldApi]),this.lookupOptionsMap&&this.lookupOptionsMap[e.fieldApi]&&Array.isArray(this.lookupOptionsMap[e.fieldApi])&&this.lookupOptionsMap[e.fieldApi].length>0?(s=this.lookupOptionsMap[e.fieldApi],console.log(`\u{1F517} Using cached lookup options for ${e.fieldApi}: ${s.length} options`)):e.lookupOptions&&Array.isArray(e.lookupOptions)&&e.lookupOptions.length>0?(s=e.lookupOptions,console.log(`\u{1F4CB} Using field's own lookup options for ${e.fieldApi}: ${s.length} options`)):e._lookupOptions&&Array.isArray(e._lookupOptions)&&e._lookupOptions.length>0&&(s=e._lookupOptions,console.log(`\u{1F517} Using _lookupOptions for ${e.fieldApi}: ${s.length} options`));const t=this.formData[e.fieldApi]||this.recordData[e.fieldApi],o=s.map(i=>{const a=i.value||i.Id;return{label:i.label||i.displayValue||i.Name||i.value||"Unknown",value:a,selected:a===t}}).filter(i=>i.value);return o.length===0&&console.log(`\u{1F50D} No lookup options found for ${e.fieldApi}:`,{fieldLookupOptions:e.lookupOptions?.length||0,mapOptions:this.lookupOptionsMap[e.fieldApi]?.length||0,fieldMetadataOptions:e._lookupOptions?.length||0,referenceTo:e.referenceToObject,availableInMap:Object.keys(this.lookupOptionsMap||{})}),o}getFieldIdValue(e){const s=e?.fieldApi;return s?this.formData?.[s]??this.recordData?.[s]??"":""}updateFieldVisibility(){console.log("\u{1F504} Updating field visibility based on controlling fields..."),this.sections.forEach(e=>{e.fields.forEach(s=>{s.isVisible=this.isFieldVisible(s),console.log(`\u{1F50D} Field ${s.fieldApi}: isVisible=${s.isVisible}`)})}),console.log("\u2705 Field visibility updated - sections re-rendered")}isFieldVisible(e){if(!e.visibleWhenValues||Object.keys(e.visibleWhenValues).length===0)return!0;console.log(`\u{1F50D} Checking visibility for field: ${e.fieldApi} (${e.label})`);for(const[s,t]of Object.entries(e.visibleWhenValues)){const o=this.devNameToApi[s];if(!o)return console.log(`\u274C No API name found for controlling field: ${s}`),!1;const i=this.formData[o];let a=i;if((o==="Rhythm__Assets__c"||o==="Rhythm__Asset_Equipment__c")&&i){console.log(`\u{1F50D} Debug: Looking for asset options for ${o} with value: ${i}`);const h=this.formData[`${o}_DisplayName`];if(h)a=h,console.log(`\u{1F3D7}\uFE0F Asset field: Using stored display name "${a}" instead of ID "${i}" for controlling logic`);else{const u=this.allFieldsMap[o];if(u&&u.lookupOptions){const f=u.lookupOptions.find(g=>g.value===i);f&&(a=f.label||f.displayValue||f.Name,console.log(`\u{1F3D7}\uFE0F Asset field: Using display name "${a}" instead of ID "${i}" for controlling logic`))}else{const f=this.lookupOptionsMap[o];if(f){const g=f.find(_=>_.value===i);g&&(a=g.label||g.displayValue||g.Name,console.log(`\u{1F3D7}\uFE0F Asset field (fallback): Using display name "${a}" instead of ID "${i}" for controlling logic`))}}}console.log(`\u{1F50D} Debug: Final comparison value: ${a}`)}const l=this.findFieldByApi(o)?.fieldType||"TEXT",c=Array.isArray(t)?t:t!=null?[t]:[];if(console.log(`\u{1F50D} Controlling field: ${o}`),console.log(`   Expected values: [${c.join(", ")}]`),console.log(`   Actual: ${i}`),console.log(`   Comparison: ${a}`),c.length===0){console.log(`\u26A0\uFE0F No expected values for controller ${o}, skipping`);continue}let d=!1;for(const h of c){const u=this.normalizeValue(a,l),f=this.normalizeValue(h,l);if(console.log(`\u{1F50D}   Comparing: comparison="${u}" vs expected="${f}" ${o==="Rhythm__Assets__c"||o==="Rhythm__Asset_Equipment__c"?"(using display name)":"(using direct value)"}`),u===f){d=!0,console.log(`\u2705 Controller ${o} matched value: ${h}`);break}}if(!d)return console.log(`\u{1F50D} Field ${e.fieldApi} hidden: controller ${o} didn't match any expected values`),!1}return!0}findFieldByApi(e){for(const s of this.sections){const t=s.fields.find(o=>o.fieldApi===e);if(t)return t}return null}normalizeValue(e,s){if(console.log("\u{1F50D} normalizeValue called",{value:e,fieldType:s}),e==null)return console.log("\u27A1\uFE0F Returning null (value is null/undefined)"),null;switch(s?.toUpperCase()){case"BOOLEAN":{if(typeof e=="string"){const o=e.trim().toLowerCase(),i=o==="true"||o==="yes"||o==="1";return console.log("\u27A1\uFE0F BOOLEAN string normalized:",{input:e,output:i}),i}const t=Boolean(e);return console.log("\u27A1\uFE0F BOOLEAN normalized:",{input:e,output:t}),t}case"DOUBLE":case"CURRENCY":case"INTEGER":case"PERCENT":{const t=isNaN(Number(e))?null:Number(e);return console.log("\u27A1\uFE0F Number-like normalized:",{input:e,output:t}),t}case"DATE":case"DATETIME":return console.log("\u27A1\uFE0F Returning DATE/DATETIME as-is:",e),e;case"TIME":{if(typeof e=="string"&&e.includes(":")){const[t,o]=e.split(":"),i=`${t.padStart(2,"0")}:${o.padStart(2,"0")}:00.000Z`;return console.log("\u27A1\uFE0F TIME string normalized to ISO:",i),i}if(typeof e=="number")try{const t=new Date(e);if(!isNaN(t.getTime())){const o=t.toISOString().substring(11,23)+"Z";return console.log("\u27A1\uFE0F TIME from ms \u2192 ISO:",{input:e,output:o}),o}return console.log("\u27A1\uFE0F Invalid date from number:",e),"00:00:00.000Z"}catch(t){return console.error("Error converting time value:",t),"00:00:00.000Z"}return typeof e=="string"&&!e.includes(":")?(console.log("\u27A1\uFE0F Invalid time string format:",e),"00:00:00.000Z"):(console.log("\u27A1\uFE0F Returning TIME as-is (unrecognized type):",e),e||"00:00:00.000Z")}default:{const t=e.toString();return console.log("\u27A1\uFE0F Default normalization (stringify):",{input:e,output:t}),t}}}isFieldNonEditable(e){return["Rhythm__Date_Time_of_Incident__c","Rhythm__Investigation_Due_Date_Time_Auto__c"].includes(e)}getInputType(e){switch(e){case"EMAIL":return"email";case"PHONE":return"tel";case"URL":return"url";case"DATE":return"date";case"DATETIME":return"datetime-local";case"TIME":return"time";case"NUMBER":case"DOUBLE":case"INTEGER":case"CURRENCY":return"number";default:return"text"}}getInputValue(e,s=null){const t=s!==null?s:this.formData[e.fieldApi];return t?e.fieldType==="DATE"?this.formatDateForInput(t):e.fieldType==="DATETIME"?this.formatDateTimeForInput(t):t:""}formatDisplayValue(e,s,t=null){if(e==null||e==="")return"";switch(s){case"BOOLEAN":return e===!0||e==="true"?"Yes":"No";case"DATE":return this.formatDate(e);case"DATETIME":return this.formatDateTime(e);case"CURRENCY":case"DOUBLE":case"INTEGER":return this.formatNumber(e);case"PICKLIST":case"MULTIPICKLIST":if(t&&this.picklistValues[t]){const o=this.picklistValues[t].find(i=>i.value===e);return o?o.label:String(e)}return String(e);case"REFERENCE":if(t&&this.lookupOptionsMap[t]){const o=this.lookupOptionsMap[t].find(i=>(i.value||i.Id)===e);return o?o.label||o.Name:String(e)}return String(e);default:return String(e)}}formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString()}catch(s){return e}}formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString()}catch(s){return e}}formatDateForInput(e){if(!e)return"";try{return new Date(e).toISOString().split("T")[0]}catch(s){return e}}formatDateTimeForInput(e){if(!e)return"";try{return new Date(e).toISOString().slice(0,16)}catch(s){return e}}formatNumber(e){return e==null?"":Number(e).toLocaleString()}async loadRootCauseData(){if(!this.recordId){console.log("\u{1F50D} No recordId available for loading root cause data");return}try{console.log("\u{1F50D} Loading root cause data from formData:",this.formData),console.log("\u{1F50D} Root cause fields to check:",this.rootCauseFields),console.log("\u{1F50D} Object API Name:",this.objectApiName),console.log("\u{1F50D} Record ID:",this.recordId),console.log("\u{1F50D} Available formData keys:",Object.keys(this.formData)),this.rootCauseData={};let e=0;for(let s=0;s<this.maxRootCauseCount;s++){const t=this.rootCauseFields[s],o=this.formData[t];console.log(`\u{1F50D} Checking root cause field ${t}:`),console.log(`  - formData value: "${o}" (type: ${typeof o})`),console.log(`  - recordData value: "${this.recordData[t]}" (type: ${typeof this.recordData[t]})`),console.log(`  - hasValue: ${!!o}`),console.log(`  - trimmedValue: "${String(o||"").trim()}"`),o&&String(o).trim()?(this.rootCauseData[t]=o,e++,console.log(`\u2705 Found root cause data for ${t}: "${o}"`)):console.log(`\u274C No data found for ${t}`)}this.visibleRootCauseCount=Math.min(e,this.maxRootCauseCount),console.log(`\u{1F50D} Root cause summary (VIEW mode): dataCount=${e}, visibleCount=${this.visibleRootCauseCount}`),console.log("\u{1F50D} Root cause data loaded:",this.rootCauseData),this.originalRootCauseData={...this.rootCauseData}}catch(e){console.error("Error loading Root Cause data:",e),this.rootCauseData={},this.visibleRootCauseCount=1}}handleEdit(){this.isEditMode=!0}handleCancel(){this.isEditMode=!1,this.loadFieldConfigurations()}async handleSave(){try{if(this.isSubmitting=!0,this.showSpinner=!0,console.log("\u{1F4BE} Starting save operation..."),console.log("\u{1F50D} Current recordId:",this.recordId),console.log("\u{1F50D} Current objectApiName:",this.objectApiName),!this.recordId)throw new Error("Record ID is required for saving. Please ensure you have a valid record to update.");const e={Id:this.recordId,...this.formData};this.rootCauseFields.forEach(t=>{this.rootCauseData[t]!==void 0&&(e[t]=this.rootCauseData[t])}),console.log("\u{1F4BE} Saving main record with data:",e),console.log("\u{1F50D} Fields being updated:",Object.keys(e));const s=await oe(this.objectApiName,e);console.log("\u2705 Main record saved successfully"),console.log("\u{1F50D} Save result:",s),this.isEditMode=!1,this.showSuccessMessage("Investigation data updated successfully!"),this.dispatchEvent(new CustomEvent("saveevent",{detail:{success:!0,message:"Investigation data updated successfully!",recordId:this.recordId,hasChanges:!0}})),await this.loadFieldConfigurations(),console.log("\u2705 Save operation completed successfully"),console.log("\u{1F50D} Form data after save:",this.formData),console.log("\u{1F50D} Root cause data after save:",this.rootCauseData)}catch(e){console.error("\u274C Error saving record:",e),console.error("\u{1F50D} Error details:",{message:e.message,stack:e.stack,recordId:this.recordId,objectApiName:this.objectApiName}),this.showToastMessage(`Error saving record: ${e.message}`,"error"),this.scrollToTop()}finally{this.isSubmitting=!1,this.showSpinner=!1}}handleFieldChange(e){const s=e.target.dataset.field,t=e.target.type==="checkbox"?e.target.checked:e.target.value;if(console.log(`\u{1F504} Field changed: ${s} = ${t}`),this.formData={...this.formData,[s]:t},(s==="Rhythm__Assets__c"||s==="Rhythm__Asset_Equipment__c")&&t){const o=e.target,i=o.options[o.selectedIndex],a=i?i.text:null;a&&(this.formData={...this.formData,[`${s}_DisplayName`]:a},console.log(`\u{1F3D7}\uFE0F Stored asset display name: ${s}_DisplayName = "${a}"`))}(s==="Rhythm__Contractor__c"||s==="Rhythm__Contractor_Account__c")&&(this.selectedContractorId=t,console.log(`\u{1F3E2} Updated selectedContractorId to: ${t}`)),(s==="Rhythm__Location__c"||s==="Rhythm__Site__c")&&(this.selectedLocationId=t,console.log(`\u{1F3E2} Updated selectedLocationId to: ${t}`)),this.sections=this.sections.map(o=>({...o,fields:o.fields?.map(i=>i.fieldApi===s?this.enhanceFieldForRendering({...i,value:t}):i)||[]})),this.updateFieldVisibility()}handleRootCauseFieldChange(e){const s=e.target.dataset.field,t=e.target.value;console.log(`\u{1F504} Root cause field changed: ${s} = ${t}`),this.rootCauseData={...this.rootCauseData,[s]:t},this.formData={...this.formData,[s]:t},this.updateFieldVisibility()}toggleRootCauseExpansion(){this.isRootCauseExpanded=!this.isRootCauseExpanded}toggleFishboneExpansion(){this.isFishboneExpanded=!this.isFishboneExpanded}toggleWhyWhyExpansion(){this.isWhyWhyExpanded=!this.isWhyWhyExpanded}toggleActionItemsExpansion(){this.isActionItemsExpanded=!this.isActionItemsExpanded}handleSaveRootCause(){try{if(console.log("\u{1F4BE} Saving Root Cause Analysis only..."),!this.recordId)throw new Error("Record ID is required for saving root cause data.");const e={Id:this.recordId};this.rootCauseFields.forEach(s=>{const t=this.rootCauseData[s];t&&String(t).trim()?e[s]=t:e[s]=null}),console.log("\u{1F4BE} Saving root cause data:",e),oe(this.objectApiName,e).then(()=>{console.log("\u2705 Root Cause Analysis saved successfully"),this.rootCauseFields.forEach(t=>{e[t]===null?(delete this.formData[t],delete this.rootCauseData[t]):this.formData[t]=e[t]}),this.originalRootCauseData={...this.rootCauseData};const s=Object.values(this.rootCauseData).filter(t=>t&&String(t).trim()).length;this.visibleRootCauseCount=s,this.isRootCauseEditMode=!1,this.showToastMessage("Root Cause Analysis saved successfully!","success")}).catch(s=>{console.error("\u274C Error saving root cause:",s),this.showToastMessage(`Error saving root cause: ${s.message}`,"error")})}catch(e){console.error("\u274C Error in handleSaveRootCause:",e),this.showToastMessage(`Error: ${e.message}`,"error")}}handleCancelRootCause(){console.log("\u{1F504} Canceling Root Cause Analysis changes..."),this.rootCauseData={...this.originalRootCauseData},this.isRootCauseEditMode=!1,this.showToastMessage("Root Cause Analysis changes canceled","info"),console.log("\u2705 Root Cause Analysis changes canceled")}handleEditRootCause(e){console.log("\u270F\uFE0F Entering Root Cause edit mode..."),e&&e.stopPropagation(),console.log("\u{1F504} Reloading root cause data before entering edit mode"),this.rootCauseData={};let s=0;for(let t=0;t<this.maxRootCauseCount;t++){const o=this.rootCauseFields[t],i=this.formData[o];i&&String(i).trim()&&(this.rootCauseData[o]=i,s++,console.log(`\u2705 Found root cause data for ${o}: "${i}"`))}this.visibleRootCauseCount=Math.max(s,1),console.log(`\u{1F4CA} Edit mode - showing ${this.visibleRootCauseCount} root cause fields (existing data only)`),console.log("\u{1F4CA} Root cause data:",this.rootCauseData),this.isRootCauseEditMode=!0,this.isRootCauseExpanded=!0,this.originalRootCauseData={...this.rootCauseData}}handleAddRootCause(){this.isRootCauseEditMode||this.handleEditRootCause(),this.visibleRootCauseCount<this.maxRootCauseCount&&this.visibleRootCauseCount++}handleDeleteRootCause(e){const s=parseInt(e.target.dataset.index,10),t=this.rootCauseFields[s];this.rootCauseData={...this.rootCauseData,[t]:""},this.formData={...this.formData,[t]:""};for(let i=s;i<this.maxRootCauseCount-1;i++){const a=this.rootCauseFields[i],r=this.rootCauseFields[i+1],l=this.rootCauseData[r]||"";this.rootCauseData[a]=l,this.formData[a]=l}const o=this.rootCauseFields[this.maxRootCauseCount-1];this.rootCauseData[o]="",this.formData[o]="",this.visibleRootCauseCount=Math.max(1,this.visibleRootCauseCount-1)}get hasError(){return!!this.error}get toastClasses(){const e="toast-container",s=`toast-${this.toastType}`,t=this.showToast?"toast-visible":"toast-hidden";return`${e} ${s} ${t}`}get toastIcon(){switch(this.toastType){case"success":return"\u2705";case"error":return"\u274C";case"info":default:return"\u2139\uFE0F"}}get showSections(){return!this.loading&&!this.hasError&&this.sections.length>0}get visibleRootCauseFields(){const e=[];for(let s=0;s<this.visibleRootCauseCount;s++)e.push({index:s,fieldApi:this.rootCauseFields[s],value:this.rootCauseData[this.rootCauseFields[s]]||"",label:`Root Cause ${s+1}`,canDelete:this.visibleRootCauseCount>1});return e}get canAddMoreRootCause(){return this.visibleRootCauseCount<this.maxRootCauseCount}get hasRootCauseData(){return Object.values(this.rootCauseData).some(e=>e&&String(e).trim())}get rootCauseExpandIconClass(){return this.isRootCauseExpanded?"expand-icon expanded":"expand-icon"}get fishboneExpandIconClass(){return this.isFishboneExpanded?"expand-icon expanded":"expand-icon"}get whyWhyExpandIconClass(){return this.isWhyWhyExpanded?"expand-icon expanded":"expand-icon"}get actionItemsExpandIconClass(){return this.isActionItemsExpanded?"expand-icon expanded":"expand-icon"}dismissError(){this.error=null}showSuccessMessage(e){console.log("\u2705 Form submitted successfully:",e),this.dispatchEvent(new CustomEvent("success",{detail:{message:e}})),this.showToastMessage(e,"success")}showToastMessage(e,s="info"){console.log("\u{1F4E2} Setting toast properties:",{message:e,type:s,showToast:!0}),this.toastMessage=e,this.toastType=s,this.showToast=!0,console.log("\u{1F4E2} Toast state after setting:",{toastMessage:this.toastMessage,toastType:this.toastType,showToast:this.showToast,toastClasses:this.toastClasses,toastIcon:this.toastIcon}),this.autoHideToast()}autoHideToast(){let e=Date.now();const s=3e3,t=()=>{const o=Date.now()-e;o>=s?(this.showToast=!1,this.toastMessage="",this.toastType="info",console.log("\u{1F4E2} Toast auto-hidden after",o,"ms")):Promise.resolve().then(()=>{new Promise(a=>{a()}).then(t)})};t()}handleToastClose(){this.showToast=!1,this.toastMessage="",this.toastType="info"}scrollToTop(){const e=this.template.querySelector(".investigation-container");e&&e.scrollTo({top:0,behavior:"smooth"});let s=this.template.host;for(;s&&s.parentElement;){const t=s.parentElement;if(t.tagName&&t.tagName.toLowerCase()==="c-dynamic-host"){console.log("\u{1F4DA} Found dynamic-host container, scrolling parent component-content");const o=t.parentElement;if(o&&o.classList&&o.classList.contains("component-content")){console.log("\u{1F4DA} Scrolling to top of component-content container"),o.scrollTo({top:0,behavior:"smooth"});return}}s=t}try{window.scrollTo({top:0,behavior:"smooth"})}catch(t){window.scrollTo(0,0)}}handleFishboneSaved(e){console.log("Fishbone saved event received:",e.detail),this.isWhyWhyExpanded=!1,this.fishboneDataForWhyWhy=e.detail,setTimeout(()=>{this.isWhyWhyExpanded=!0},100)}}Lt.ALLOWED_INVESTIGATION_SECTIONS=["Investigation Team & Status","Investigation Questionnaire","Investigation Details"],Y(Lt,{publicProps:{objectApiName:{config:0},recordId:{config:0}},track:{loading:1,error:1,isEditMode:1,showSpinner:1,isOfflineData:1,sections:1,formData:1,devNameToApi:1,allFieldsMap:1,controllingFieldsMap:1,objectSchema:1,picklistValues:1,lookupOptionsMap:1,fieldConfigurations:1,recordData:1,selectedContractorId:1,contactAccountMap:1,selectedLocationId:1,workAreaLocationMap:1,originalRecordData:1,hasUnsavedChanges:1,changedFields:1,currentUserId:1,showToast:1,toastMessage:1,toastType:1,rootCauseData:1,isRootCauseExpanded:1,visibleRootCauseCount:1,maxRootCauseCount:1,isFishboneExpanded:1,fishboneDataForWhyWhy:1,isWhyWhyExpanded:1,isActionItemsExpanded:1,originalRootCauseData:1,isRootCauseEditMode:1},fields:["currentFieldApi","isSubmitting","allowedSections","rootCauseFields","taskComponentDetail"]});const ii=z(Lt,{tmpl:Fg,sel:"c-tab-investigation",apiVersion:63});function Dg(n,e,s){var t=n?"["+n+"]":"",o=n?"["+n+"-host]":"",i=n?"-"+n:"";return[e?":host {":o+" {","--primary-color: #1a73e8;--border-color: #e0e0e0;--text-color: #333;--background-color: #fff;--input-bg: #fff;--shadow-color: rgba(0, 0, 0, 0.1);--border-radius: 10px;--spacing-sm: 8px;--spacing-md: 16px;--spacing-lg: 24px;}.mock-drill-container",t," {font-family: Arial, sans-serif;color: var(--text-color);background-color: var(--background-color);padding: var(--spacing-md) var(--spacing-md) 0 var(--spacing-md);max-width: 100%;margin: 0 auto;height: 100%;}.header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: var(--spacing-lg);border-bottom: 1px solid var(--border-color);padding-bottom: var(--spacing-md);}.header",t," h1",t," {font-size: 1.5rem;margin: 0;font-weight: bold;color: var(--text-color);}.download-btn",t," {background-color: var(--primary-color);color: white;border: none;border-radius: 50%;width: 40px;height: 40px;display: flex;justify-content: center;align-items: center;cursor: pointer;box-shadow: 0 2px 5px var(--shadow-color);}.form-section",t," {display: flex;flex-direction: column;gap: var(--spacing-md);}.form-row",t," {display: flex;flex-direction: column;gap: var(--spacing-md);}.form-group",t," {display: flex;flex-direction: column;gap: var(--spacing-sm);width: 100%;}.form-group",t," label",t," {font-weight: 500;font-size: 13px;color: #333;}.form-group",t," input",t,",.form-group",t," textarea",t," {padding: 8px 10px;border: 1px solid #e0e0e0;border-radius: 4px;font-size: 14px;background-color: white;color: #333;}.form-group",t," input",t,"::placeholder,.form-group",t," textarea",t,"::placeholder {color: #999;}.form-group",t," textarea",t," {min-height: 80px;resize: vertical;}.date-input-container",t,",.time-input-container",t," {display: flex;position: relative;width: 100%;}.date-input-container",t," input",t,",.time-input-container",t," input",t," {flex: 1;}.calendar-btn",t,",.time-btn",t," {position: absolute;right: 0;top: 0;height: 100%;background: none;border: none;display: flex;align-items: center;justify-content: center;padding: 0 8px;cursor: pointer;color: #1a73e8;}.time-input-container",t," .time-btn",t," {color: #1a73e8;}.full-width",t," {width: 100%;}.numbered-inputs",t," {display: flex;flex-direction: column;gap: var(--spacing-md);}.numbered-input",t," {display: flex;align-items: center;gap: var(--spacing-md);}.number",t," {font-weight: bold;min-width: 20px;}.numbered-input",t," input",t," {flex: 1;padding: 10px;border: 1px solid var(--border-color);border-radius: var(--border-radius);}.collapsible-sections",t," {margin-top: var(--spacing-lg);display: flex;flex-direction: column;gap: var(--spacing-md);}.collapsible-section",t," {border: 1px solid #e0e0e0;border-radius: 8px;overflow: hidden;margin-bottom: 12px;}.collapsible-btn",t," {width: 100%;text-align: left;padding: 12px 16px;background-color: #f8f9fa;border: none;font-weight: 600;font-size: 15px;color: #1a365d;cursor: pointer;display: flex;align-items: center;gap: 8px;}.arrow",t," {display: flex;align-items: center;transition: transform 0.3s ease;}.arrow",t," svg",t," {width: 12px;height: 12px;color: #1a73e8;transition: transform 0.3s ease;}.collapsible-btn[aria-expanded='true']",t," .arrow",t," {transform: rotate(90deg);}.collapsible-content",t," {padding: var(--spacing-md);max-height: 0;overflow: hidden;transition: max-height 0.3s ease-out;opacity: 0;}.collapsible-content.active",t,` {overflow: scroll;max-height: 500px;opacity: 1;transition:
 max-height 0.5s ease-in,
 opacity 0.3s ease-in;}.collapsible-content-display-none`,t," {display: none;}.collapsible-content-display-block",t," {display: block;}.observers-container",t," {width: 100%;margin-bottom: var(--spacing-md);}.observers-heading",t," {margin-top: 0;margin-bottom: 15px;color: #444;font-size: 18px;}.observer-cards-list",t," {display: flex;flex-direction: column;gap: 15px;margin-bottom: var(--spacing-lg);}.observer-card",t," {display: flex;flex-direction: column;gap: 10px;border: 1px solid #e0e0e0;border-radius: 8px;padding: 15px;background-color: white;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.observer-card-header",t," {display: flex;justify-content: space-between;align-items: center;margin-bottom: 8px;padding-bottom: 8px;border-bottom: 1px solid #f0f0f0;}.observer-number",t," {font-weight: 600;font-size: 15px;color: #1a365d;}.remove-observer-button",t," {background: none;border: none;color: #ff6b6b;cursor: pointer;padding: 5px;border-radius: 50%;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;transition: background-color 0.2s;}.remove-observer-button:hover",t," {background-color: #ffeeee;}.remove-observer-button",t," svg",t," {width: 14px;height: 14px;}.observer-card-content",t," {display: flex;flex-direction: column;gap: 10px;}.observer-field",t," {display: flex;flex-direction: column;gap: 4px;}.observer-field",t," label",t," {font-weight: 500;font-size: 13px;color: #333;}.observer-field",t," input",t," {padding: 8px 10px;border: 1px solid #e0e0e0;border-radius: 4px;font-size: 14px;color: #333;}.observer-field",t," input",t,"::placeholder {color: #999;}.observer-field",t," input:focus",t," {outline: none;border-color: #1a73e8;box-shadow: 0 0 0 1px rgba(26, 115, 232, 0.2);}.add-observer-container",t," {display: flex;justify-content: center;margin-top: 10px;margin-bottom: 20px;}.add-observer-button",t," {background-color: #f0f7ff;border: 1px dashed #4a90e2;color: #4a90e2;cursor: pointer;padding: 8px;border-radius: 50%;width: 40px;height: 40px;display: flex;align-items: center;justify-content: center;transition: all 0.2s;}.add-observer-button:hover",t," {background-color: #e0f0ff;transform: scale(1.05);}.add-observer-button",t," svg",t," {width: 20px;height: 20px;}.saved-observers-section",t," {display: block;}.saved-observers-header",t," {display: flex;align-items: center;gap: var(--spacing-sm);margin-bottom: var(--spacing-md);font-weight: bold;color: var(--primary-color);}.saved-observers-header",t," svg",t," {color: var(--primary-color);}.saved-observers-container",t," {display: flex;flex-direction: column;gap: 15px;}.saved-observer-card",t," {background-color: white;border-radius: 8px;border: 1px solid #e0e0e0;padding: 15px;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.saved-observer-header",t," {margin-bottom: 8px;padding-bottom: 8px;border-bottom: 1px solid #f0f0f0;}.saved-observer-content",t," {display: flex;flex-direction: column;gap: 15px;}.saved-observer-field",t," {display: flex;flex-direction: column;gap: 7px;}.field-label",t," {font-weight: 500;color: #333;font-size: 13px;}.saved-value",t," {font-weight: normal;color: #1a365d;font-size: 14px;}.select-container",t," {position: relative;width: 100%;}.custom-select",t," {display: flex;justify-content: space-between;align-items: center;padding: 8px;border: 1px solid var(--border-color);border-radius: var(--border-radius);background-color: white;cursor: pointer;}.dropdown-arrow",t," {font-size: 10px;transition: transform 0.3s;}.custom-select.active",t," .dropdown-arrow",t," {transform: rotate(180deg);}.select-dropdown",t," {position: absolute;top: 100%;left: 0;width: 100%;background-color: white;border: 1px solid var(--border-color);border-top: none;border-radius: 0 0 var(--border-radius) var(--border-radius);z-index: 10;max-height: 200px;overflow-y: auto;display: none;box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);}.select-dropdown.show",t," {display: block;}.select-option",t," {padding: 8px 12px;cursor: pointer;}.select-option:hover",t," {background-color: #f5f5f5;}.native-select",t,` {width: 100%;padding: 8px 10px;border: 1px solid #e0e0e0;border-radius: 4px;background-color: white;font-size: 14px;color: #333;appearance: none;-webkit-appearance: none;-moz-appearance: none;background-image: url("data:image/svg+xml;utf8,<svg fill='%23555555' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat: no-repeat;background-position: right 8px center;background-size: 16px;cursor: pointer;}.native-select:focus`,t," {outline: none;border-color: #1a73e8;box-shadow: 0 0 0 1px rgba(26, 115, 232, 0.2);}.native-select",t," option",t," {padding: 8px;font-size: 14px;}.action-btn",t," {width: 36px;height: 36px;border-radius: 50%;border: none;display: flex;align-items: center;justify-content: center;cursor: pointer;color: white;padding: 0;}.add-btn",t," {background-color: var(--primary-color);box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);}.card-header",t," {display: flex;align-items: center;margin-bottom: 10px;}.delete-btn",t," {background-color: #dc3545;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);}.observers-info-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: var(--spacing-lg);text-align: center;color: #666;}.info-icon",t," {margin-bottom: var(--spacing-md);color: #999;}.info-title",t," {font-weight: bold;margin-bottom: var(--spacing-sm);}.info-subtitle",t," {font-size: 0.9rem;}@media (max-width: 767px) {.observer-card",t," {padding: 12px;}.observer-card-header",t," {padding-bottom: 8px;margin-bottom: 8px;}.observer-field",t," {gap: 4px;}.observer-field",t," input",t," {padding: 8px;}.saved-observers-header",t," {padding: 0 var(--spacing-sm);margin-top: var(--spacing-md);}.saved-observer-card",t," {padding: 12px;}.saved-observer-header",t," {padding-bottom: 6px;margin-bottom: 6px;}.saved-observer-field",t," {gap: 7px;}.field-label",t," {font-size: 13px;}.add-observer-button",t," {width: 36px;height: 36px;}.add-observer-button",t," svg",t," {width: 18px;height: 18px;}.activity-card",t," {padding: 12px;}.activity-card-header",t," {padding-bottom: 8px;margin-bottom: 8px;}.activity-field",t," {gap: 4px;}.activity-field",t," input",t," {padding: 8px;}.activity-title",t," {font-size: 15px;margin-bottom: 8px;}.activity-checkbox",t," label",t," {font-size: 13px;}.activities-td.complete",t," {position: absolute;top: 8px;right: 8px;width: auto;height: auto;padding: 0;}.activity-row",t," {background-color: #f8f9ff;padding-top: var(--spacing-md);}.activities-td.activity",t," {font-weight: bold;padding-right: 40px;}.activities-td.information",t,", .activities-td.exact-time",t,", .activities-td.other-info",t," {display: flex;flex-direction: column;}.recommendations-table-header",t," {display: none;}.recommendation-row",t," {flex-direction: column;margin-bottom: var(--spacing-md);border: 1px solid var(--border-color);border-radius: var(--border-radius);padding: var(--spacing-sm);background-color: #f8f9ff;box-shadow: 0 2px 4px var(--shadow-color);}.recommendations-td",t," {width: 100%;padding: 8px 0;}.recommendations-td.recommendations-col",t," {font-weight: bold;border-bottom: 1px solid var(--border-color);padding-bottom: 12px;margin-bottom: 8px;}.recommendation-card",t," {padding: 12px;}.recommendation-card-content",t," {gap: 15px;}.recommendation-field",t," {gap: 8px;}.recommendation-field",t," label",t," {font-size: 13px;}.recommendation-value",t," {font-size: 14px;}.recommendation-form-row",t," {flex-direction: column;padding: var(--spacing-md);border: 1px solid var(--border-color);border-radius: var(--border-radius);background-color: white;margin-bottom: var(--spacing-md);}.recommendation-form-actions",t," {position: absolute;top: 8px;right: 8px;transform: none;}.recommendation-form-field",t," {margin-bottom: var(--spacing-sm);}.recommendation-form-buttons",t," {flex-direction: column;gap: var(--spacing-md);align-items: stretch;}.form-action-buttons",t," {flex-direction: column;gap: var(--spacing-sm);}.add-row-btn",t," {align-self: center;margin-bottom: var(--spacing-sm);}}.activities-cards-container",t," {width: 100%;margin-bottom: var(--spacing-md);}.activities-cards-list",t," {display: flex;flex-direction: column;gap: 15px;margin-bottom: var(--spacing-lg);}.activity-card",t," {display: flex;flex-direction: column;gap: 10px;border: 1px solid #e0e0e0;border-radius: 8px;padding: 15px;background-color: white;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.activity-card-header",t," {display: flex;justify-content: flex-end;margin-bottom: 8px;padding-bottom: 8px;border-bottom: 1px solid #f0f0f0;}.activity-checkbox",t," {display: flex;align-items: center;gap: 5px;}.activity-checkbox",t," input[type='checkbox']",t," {width: 16px;height: 16px;cursor: pointer;accent-color: #1a73e8;}.activity-checkbox",t," label",t," {font-size: 14px;color: #333;cursor: pointer;font-weight: 500;}.activity-card-content",t," {display: flex;flex-direction: column;gap: 10px;}.activity-title",t," {font-weight: 600;font-size: 15px;color: #1a365d;margin-bottom: 10px;}.activity-field",t," {display: flex;flex-direction: column;gap: 4px;}.activity-field",t," label",t," {font-weight: 500;font-size: 13px;color: #333;}.activity-field",t," input",t," {padding: 8px 10px;border: 1px solid #e0e0e0;border-radius: 4px;font-size: 14px;width: calc(100% - 22px);color: #333;}.activity-field",t," input",t,"::placeholder {color: #999;}.activity-field",t," input:focus",t," {outline: none;border-color: #1a73e8;box-shadow: 0 0 0 1px rgba(26, 115, 232, 0.2);}.activities-table-container",t," {width: 100%;margin-bottom: var(--spacing-md);overflow-x: auto;display: none;}.activities-table-header",t," {display: flex;background-color: #1e3a8a;color: white;font-weight: bold;border-radius: var(--border-radius) var(--border-radius) 0 0;}.activities-table-body",t," {display: flex;flex-direction: column;}.activity-row",t," {display: flex;border-bottom: 1px solid var(--border-color);background-color: #f0f7ff;}.activity-row:nth-child(odd)",t," {background-color: white;}.activities-th",t,",.activities-td",t," {padding: 12px 8px;display: flex;align-items: center;}.activities-th.complete",t,",.activities-td.complete",t," {flex: 0 0 80px;justify-content: center;}.activities-td.complete",t," input[type='checkbox']",t," {width: 20px;height: 20px;cursor: pointer;}.activities-th.activity",t,",.activities-td.activity",t," {flex: 1;}.activities-th.information",t,",.activities-td.information",t," {flex: 1;}.activities-th.exact-time",t,",.activities-td.exact-time",t," {flex: 0 0 120px;}.activities-th.other-info",t,",.activities-td.other-info",t," {flex: 1;}.activities-td",t," input",t," {width: 100%;padding: 8px;border: 1px solid var(--border-color);border-radius: var(--border-radius);background-color: white;}.recommendations-container",t," {display: flex;flex-direction: column;gap: var(--spacing-md);width: 100%;}.recommendations-header",t," {display: flex;justify-content: center;margin-bottom: var(--spacing-md);}.add-recommendations-btn",t," {display: flex;align-items: center;gap: var(--spacing-sm);background-color: var(--primary-color);color: white;border: none;border-radius: var(--border-radius);padding: 8px 16px;font-weight: bold;cursor: pointer;box-shadow: 0 2px 4px var(--shadow-color);}.recommendations-cards-container",t," {width: 100%;margin-bottom: var(--spacing-md);}.recommendations-cards-list",t," {display: flex;flex-direction: column;gap: 15px;margin-bottom: var(--spacing-lg);}.recommendation-card",t," {display: flex;flex-direction: column;gap: 10px;border: 1px solid #e0e0e0;border-radius: 8px;padding: 15px;background-color: white;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);}.recommendation-card-content",t," {display: flex;flex-direction: column;gap: 15px;}.recommendation-field",t," {display: flex;flex-direction: column;gap: 8px;}.recommendation-field",t," label",t," {font-weight: 500;font-size: 13px;color: #333;}.recommendation-value",t," {font-weight: normal;color: #1a365d;font-size: 14px;}.recommendations-table-container",t," {width: 100%;margin-bottom: var(--spacing-md);overflow-x: auto;display: none;}.recommendations-table-header",t," {display: flex;background-color: #1e3a8a;color: white;font-weight: bold;border-radius: var(--border-radius) var(--border-radius) 0 0;}.recommendations-table-body",t," {display: flex;flex-direction: column;}.recommendation-row",t," {display: flex;border-bottom: 1px solid var(--border-color);background-color: #f0f7ff;}.recommendation-row:nth-child(odd)",t," {background-color: white;}.recommendations-th",t,",.recommendations-td",t," {padding: 12px 8px;display: flex;align-items: center;}.recommendations-th.recommendations-col",t,",.recommendations-td.recommendations-col",t," {flex: 2;}.recommendations-th.responsibility-col",t,",.recommendations-td.responsibility-col",t," {flex: 1;}.recommendations-th.by-when-col",t,",.recommendations-td.by-when-col",t," {flex: 0.8;}.recommendations-th.status-col",t,",.recommendations-td.status-col",t," {flex: 0.8;}.add-recommendations-form",t," {border: 1px solid var(--border-color);border-radius: var(--border-radius);padding: 10px;background-color: #f9f9f9;margin-top: var(--spacing-md);}.recommendations-forms-rows",t," {display: flex;flex-direction: column;gap: var(--spacing-md);}.recommendation-form-row",t," {display: flex;flex-wrap: wrap;gap: var(--spacing-md);position: relative;}.recommendation-form-field",t," {display: flex;flex-direction: column;gap: 4px;}.recommendation-form-field",t," label",t," {font-weight: 500;font-size: 13px;color: #333;}.recommendation-form-field",t," input",t," {padding: 8px 10px;border: 1px solid #e0e0e0;border-radius: 4px;width: calc(100% - 22px);font-size: 14px;color: #333;}.recommendation-form-field",t," input",t,"::placeholder {color: #999;}.recommendation-form-field",t," input:focus",t," {outline: none;border-color: #1a73e8;box-shadow: 0 0 0 1px rgba(26, 115, 232, 0.2);}.recommendation-form-field.recommendations-col",t," {flex: 2;}.recommendation-form-field.responsibility-col",t," {flex: 1;}.recommendation-form-field.by-when-col",t," {flex: 0.8;}.recommendation-form-field.status-col",t," {flex: 0.8;}.recommendation-form-actions",t," {position: absolute;right: 0;top: 50%;transform: translateY(-50%);}.recommendation-form-buttons",t," {display: flex;justify-content: space-between;align-items: center;margin-top: var(--spacing-md);}.add-row-btn",t," {width: 36px;height: 36px;border-radius: 50%;border: none;background-color: var(--primary-color);color: white;display: flex;align-items: center;justify-content: center;cursor: pointer;box-shadow: 0 2px 4px var(--shadow-color);}.form-action-buttons",t," {display: flex;gap: var(--spacing-md);}.cancel-btn",t," {padding: 8px 16px;border: 1px solid var(--border-color);border-radius: var(--border-radius);background-color: white;cursor: pointer;}.save-recommendations-btn",t," {padding: 8px 16px;border: none;border-radius: var(--border-radius);background-color: var(--primary-color);color: white;font-weight: bold;cursor: pointer;box-shadow: 0 2px 4px var(--shadow-color);}.signature-section",t," {display: flex;flex-direction: column;width: 100%;margin-top: var(--spacing-lg);padding-bottom: var(--spacing-lg);}.signature-row",t," {display: flex;flex-direction: column;gap: var(--spacing-lg);}.signature-column",t," {flex: 1;display: flex;flex-direction: column;gap: var(--spacing-md);}.signature-placeholder",t," {height: 60px;border: 1px dashed var(--border-color);border-radius: var(--border-radius);margin-top: var(--spacing-sm);background-color: #f9f9f9;}.signature-designation",t," {font-size: 0.8rem;color: #666;margin-top: var(--spacing-sm);font-style: italic;}.save-button-container",t," {display: flex;justify-content: center;margin-top: var(--spacing-lg);width: 100%;padding: 20px 0;position: relative;z-index: 10;}.save-report-btn",t," {background-color: var(--primary-color);color: white;border: none;padding: 12px 24px;border-radius: var(--border-radius);font-weight: bold;font-size: 1.1rem;cursor: pointer;box-shadow: 0 3px 6px var(--shadow-color);transition: all 0.3s ease;display: inline-block;min-width: 180px;text-align: center;}.save-report-btn:hover",t," {background-color: #0d5bba;transform: translateY(-2px);box-shadow: 0 4px 8px var(--shadow-color);}.main-spinner-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(255, 255, 255, 0.85);display: flex;align-items: center;justify-content: center;z-index: 9999;backdrop-filter: blur(2px);}.spinner-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 30px 0;}.spinner",t," {width: 60px;height: 60px;position: relative;margin-bottom: 15px;}.spinner-circle",t," {width: 100%;height: 100%;border: 4px solid rgba(0, 0, 0, 0.1);border-top-color: var(--primary-color);border-radius: 50%;animation: spin",i," 1s linear infinite;}.spinner-text",t," {color: var(--primary-color);font-size: 16px;font-weight: 500;}@keyframes spin",i," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}@media (min-width: 768px) {.mock-drill-container",t," {padding: var(--spacing-lg) var(--spacing-lg) 0 var(--spacing-lg);max-width: 1200px;height: 100%;}.header",t," h1",t," {font-size: 2rem;}.form-row",t," {flex-direction: row;gap: var(--spacing-lg);}.form-group",t," {flex: 1;}.signature-row",t," {flex-direction: row;gap: var(--spacing-lg);}}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);display: flex;align-items: center;justify-content: center;z-index: 1000;backdrop-filter: blur(3px);}.success-modal",t,",.error-modal",t," {background-color: white;border-radius: 8px;padding: 24px;width: 90%;max-width: 400px;text-align: center;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);animation: fadeIn",i," 0.3s ease-out;}.success-icon",t,",.error-icon",t," {font-size: 48px;margin-bottom: 16px;width: 64px;height: 64px;border-radius: 50%;display: flex;align-items: center;justify-content: center;margin: 0 auto 16px;}.success-icon",t," {background-color: #e6f7ed;color: #28a745;}.error-icon",t," {background-color: #fdf1f2;color: #dc3545;}.success-title",t,",.error-title",t," {font-size: 24px;font-weight: bold;margin-bottom: 8px;}.success-title",t," {color: #28a745;}.error-title",t," {color: #dc3545;}.success-message",t,",.error-message",t," {color: #333;margin-bottom: 16px;line-height: 1.5;}.error-close-btn",t," {background-color: #dc3545;color: white;border: none;border-radius: 4px;padding: 8px 24px;font-weight: bold;cursor: pointer;transition: background-color 0.2s;}.error-close-btn:hover",t," {background-color: #c82333;}@keyframes fadeIn",i," {from {opacity: 0;transform: translateY(-20px);}to {opacity: 1;transform: translateY(0);}}"].join("")}var ai=[Dg];const Tg=p`<div class="main-spinner-overlay${0}"${2}><div class="spinner-container${0}"${2}><div class="spinner${0}"${2}><div class="spinner-circle${0}"${2}></div></div></div></div>`,Og=p`<label${"a0:for"}${3}>Location:</label>`,Lg=p`<label${"a0:for"}${3}>Project/Site:</label>`,Ng=p`<label${"a0:for"}${3}>Mock drill No:</label>`,Mg=p`<label${"a0:for"}${3}>Date:</label>`,Pg=p`<label${"a0:for"}${3}>Time:</label>`,jg=p`<div class="form-group full-width${0}"${2}><label${"a1:for"}${3}>Description of Emergency scenario:</label><textarea${"a3:id"} name="scenario"${3}>${"t4"}</textarea></div>`,Ug=p`<label${3}>Objective of Mock drill planned:</label>`,Vg=p`<span class="number${0}"${2}>1.</span>`,qg=p`<span class="number${0}"${2}>2.</span>`,zg=p`<span class="number${0}"${2}>3.</span>`,Wg=p`<button class="collapsible-btn${0}" aria-expanded="false"${2}><span class="arrow${0}"${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="1em" width="1em"${3}><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"${3}/></svg></span>List of Observers &amp; their location at the time of emergency</button>`,Bg=p`<h3 class="observers-heading${0}"${2}>List of Observers</h3>`,Hg=p`<div class="observer-card-header${0}"${2}><div class="observer-number${0}"${2}>${"t2"}</div><button class="remove-observer-button${0}"${"a3:data-id"}${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M6 18L18 6M6 6l12 12"${3}/></svg></button></div>`,Jg=p`<div class="observer-field type-field${0}"${2}><label${3}>Type of Person</label><div class="select-container${0}"${2}><select class="native-select${0}" data-field="Rhythm__Type_of_Person__c"${"a4:data-id"}${2}><option value${3}>Select type</option><option value="Employee"${3}>Employee</option><option value="Non Employee"${3}>Non Employee</option></select></div></div>`,Qg=p`<label${3}>Name of the Person</label>`,Yg=p`<option value${3}>Select an employee</option>`,Kg=p`<option${"a0:value"}${"a0:data-name"}${"a0:data-job-title"}${3}>${"t1"}</option>`,Gg=p`<label${3}>Designation</label>`,Xg=p`<label${3}>Location</label>`,Zg=p`<div class="add-observer-container${0}"${2}><button class="add-observer-button${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M12 5v14M5 12h14"${3}/></svg></button></div>`,e_=p`<div class="saved-observers-header${0}"${2}><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${3}><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"${3}/></svg><span${3}>${"t4"}</span></div>`,t_=p`<div class="saved-observer-header${0}"${2}><div class="observer-number${0}"${2}>${"t2"}</div></div>`,s_=p`<div class="saved-observer-field${0}"${2}><span class="field-label${0}"${2}>Type of Person:</span><span class="saved-value${0}"${2}>${"t4"}</span></div>`,o_=p`<span class="field-label${0}"${2}>Name of the Person:</span>`,i_=p`<div class="saved-observer-field${0}"${2}><span class="field-label${0}"${2}>Designation:</span><span class="saved-value${0}"${2}>${"t4"}</span></div>`,a_=p`<div class="saved-observer-field${0}"${2}><span class="field-label${0}"${2}>Location:</span><span class="saved-value${0}"${2}>${"t4"}</span></div>`,n_=p`<div class="observers-info-container${0}"${"a0:id"}${2}><div class="info-icon${0}"${2}><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${3}><circle cx="12" cy="12" r="10"${3}/><line x1="12" y1="16" x2="12" y2="12"${3}/><line x1="12" y1="8" x2="12.01" y2="8"${3}/></svg></div><div class="info-text${0}"${2}><p class="info-title${0}"${2}>No Saved Observers</p><p class="info-subtitle${0}"${2}>Add observers above and click &quot;Save Report&quot; to save them.</p></div></div>`,r_=p`<button class="collapsible-btn${0}" aria-expanded="false"${2}><span class="arrow${0}"${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="1em" width="1em"${3}><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"${3}/></svg></span>Activities Checklist</button>`,l_=p`<div class="spinner-container${0}"${2}><div class="spinner${0}"${2}><div class="spinner-circle${0}"${2}></div></div><div class="spinner-text${0}"${2}>Loading activities...</div></div>`,c_=p`<label${3}>Complete</label>`,d_=p`<div class="activity-title${0}"${2}>${"t1"}</div>`,h_=p`<label${3}>Information</label>`,u_=p`<label${3}>Exact Time</label>`,p_=p`<label${3}>Any Other Info</label>`,f_=p`<button class="collapsible-btn${0}" aria-expanded="false"${2}><span class="arrow${0}"${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="1em" width="1em"${3}><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"${3}/></svg></span>Recommendations of Observers &amp; CAPA</button>`,m_=p`<div class="recommendations-header${0}"${2}><button class="add-recommendations-btn${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${3}><circle cx="12" cy="12" r="10"${3}/><line x1="12" y1="8" x2="12" y2="16"${3}/><line x1="8" y1="12" x2="16" y2="12"${3}/></svg>Add Recommendations</button></div>`,g_=p`<div class="spinner-container${0}"${2}><div class="spinner${0}"${2}><div class="spinner-circle${0}"${2}></div></div><div class="spinner-text${0}"${2}>Saving recommendations...</div></div>`,__=p`<button class="action-btn delete-btn${0}"${"a0:data-id"}${2}><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${3}><line x1="18" y1="6" x2="6" y2="18"${3}/><line x1="6" y1="6" x2="18" y2="18"${3}/></svg></button>`,b_=p`<label${3}>* Recommendations</label>`,y_=p`<label${3}>* Responsibility</label>`,v_=p`<option value${3}>Select a User</option>`,w_=p`<option${"a0:value"}${3}>${"t1"}</option>`,x_=p`<label${3}>* By When</label>`,k_=p`<label${3}>* Status</label>`,$_=p`<option${"a0:value"}${3}>${"t1"}</option>`,C_=p`<div class="recommendation-form-actions${0}"${2}></div>`,S_=p`<div class="recommendation-form-buttons${0}"${2}><button class="add-row-btn${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"${3}><circle cx="12" cy="12" r="10"${3}/><line x1="12" y1="8" x2="12" y2="16"${3}/><line x1="8" y1="12" x2="16" y2="12"${3}/></svg></button><div class="form-action-buttons${0}"${2}><button class="cancel-btn${0}"${2}>Cancel</button><button class="save-recommendations-btn${0}"${2}>Save Recommendations</button></div></div>`,E_=p`<div class="recommendation-card${0}"${2}><div class="recommendation-card-content${0}"${2}><div class="recommendation-field${0}" data-label="RECOMMENDATIONS"${2}><label${3}>Recommendations</label><div class="recommendation-value${0}"${2}>${"t6"}</div></div><div class="recommendation-field${0}" data-label="RESPONSIBILITY"${2}><label${3}>Responsibility</label><div class="recommendation-value${0}"${2}>${"t11"}</div></div><div class="recommendation-field${0}" data-label="BY WHEN"${2}><label${3}>By When</label><div class="recommendation-value${0}"${2}>${"t16"}</div></div><div class="recommendation-field${0}" data-label="STATUS"${2}><label${3}>Status</label><div class="recommendation-value${0}"${2}>${"t21"}</div></div></div></div>`,R_=p`<label${"a0:for"}${3}>Prepared by:</label>`,A_=p`<label${"a0:for"}${3}>Date:</label>`,I_=p`<div class="form-group${0}"${2}><label${"a1:for"}${3}>Signature:</label><div class="signature-designation${0}"${2}>(Project/O&amp;M HSE Officer/ Contractor HSE officer)</div></div>`,F_=p`<label${"a0:for"}${3}>Reviewed by:</label>`,D_=p`<label${"a0:for"}${3}>Date:</label>`,T_=p`<div class="form-group${0}"${2}><label${"a1:for"}${3}>Signature:</label><div class="signature-designation${0}"${2}>(HFE Project/O&amp;M Site Head)</div></div>`,O_=p`<div class="save-button-container${0}"${2}><button class="save-report-btn${0}"${2}>Save Report</button></div>`,L_=p`<div class="modal-overlay${0}"${2}><div class="success-modal${0}"${2}><div class="success-icon${0}"${2}>✓</div><div class="success-title${0}"${2}>Success!</div><div class="success-message${0}"${2}>${"t7"}</div></div></div>`,N_=p`<div class="modal-overlay${0}"${2}><div class="error-modal${0}"${2}><div class="error-icon${0}"${2}>!</div><div class="error-title${0}"${2}>Error</div><div class="error-message${0}"${2}>${"t7"}</div><button class="error-close-btn${0}"${2}>OK</button></div></div>`,M_={classMap:{"mock-drill-container":!0},key:2},P_={classMap:{"form-section":!0},key:3},j_={classMap:{"form-row":!0},key:4},U_={classMap:{"form-group":!0},key:5},V_={classMap:{"form-group":!0},key:9},q_={classMap:{"form-group":!0},key:13},z_={classMap:{"form-row":!0},key:17},W_={classMap:{"form-group":!0,"date-group":!0},key:18},B_={classMap:{"date-input-container":!0},key:21},H_={classMap:{"form-group":!0,"time-group":!0},key:23},J_={classMap:{"time-input-container":!0},key:26},Q_={classMap:{"form-group":!0,"full-width":!0},key:30},Y_={classMap:{"numbered-inputs":!0},key:33},K_={classMap:{"numbered-input":!0},key:34},G_={type:"text",name:"objective1"},X_={classMap:{"numbered-input":!0},key:38},Z_={type:"text",name:"objective2"},eb={classMap:{"numbered-input":!0},key:42},tb={type:"text",name:"objective3"},sb={classMap:{"collapsible-sections":!0},key:46},ob={classMap:{"collapsible-section":!0},key:47},ib={classMap:{"collapsible-content":!0,"collapsible-content-display-none":!0},key:50},ab={classMap:{"observers-container":!0},key:51},nb={"observer-cards-list":!0},rb={"observer-card":!0},lb={classMap:{"observer-card-content":!0},key:58},cb={classMap:{"observer-field":!0,"name-field":!0},key:61},db={classMap:{"select-container":!0},key:64},Rs={"native-select":!0},hb={classMap:{"observer-field":!0,"designation-field":!0},key:71},ub={classMap:{"observer-field":!0,"location-field":!0},key:75},pb={"saved-observers-section":!0},fb={classMap:{"saved-observers-container":!0},key:84},mb={"saved-observer-card":!0},gb={classMap:{"saved-observer-content":!0},key:88},_b={classMap:{"saved-observer-field":!0},key:91},bb={classMap:{"saved-value":!0},key:94},yb={classMap:{"collapsible-section":!0},key:101},vb={classMap:{"collapsible-content":!0,"collapsible-content-display-none":!0},key:104},wb={classMap:{"activities-cards-container":!0},key:105},xb={classMap:{"activities-cards-list":!0},key:108},kb={"activity-card":!0},$b={classMap:{"activity-card-header":!0},key:110},Cb={classMap:{"activity-checkbox":!0},key:111},Sb={classMap:{"activity-card-content":!0},key:115},Eb={classMap:{"activity-field":!0},key:118},Rb={classMap:{"activity-field":!0},key:122},Ab={classMap:{"time-input-container":!0},key:125},Ib={"time-input":!0},Fb={classMap:{"activity-field":!0},key:127},Db={classMap:{"collapsible-section":!0},key:131},Tb={classMap:{"collapsible-content":!0,"collapsible-content-display-none":!0},key:134},Ob={classMap:{"recommendations-container":!0},key:135},Lb={"add-recommendations-form":!0},Nb=[["display","none",!1]],Mb={"recommendations-forms-rows":!0},Pb={"recommendation-form-row":!0},jb={classMap:{"recommendation-form-field":!0},attrs:{"data-label":"RECOMMENDATIONS"},key:145},Ub={classMap:{"recommendation-form-field":!0},attrs:{"data-label":"RESPONSIBILITY"},key:149},Vb={classMap:{"select-container":!0},key:152},qb={classMap:{"recommendation-form-field":!0},attrs:{"data-label":"BY WHEN"},key:158},zb={classMap:{"date-input-container":!0},key:161},Wb={classMap:{"recommendation-form-field":!0},attrs:{"data-label":"STATUS"},key:163},Bb={classMap:{"select-container":!0},key:166},Hb={classMap:{"recommendations-cards-container":!0},key:174},Jb={"recommendations-cards-list":!0},Qb={classMap:{"signature-section":!0},key:178},Yb={classMap:{"signature-row":!0},key:179},Kb={classMap:{"signature-column":!0},key:180},Gb={classMap:{"form-group":!0},key:181},Xb={classMap:{"form-group":!0,"date-group":!0},key:185},Zb={classMap:{"date-input-container":!0},key:188},ey={classMap:{"signature-column":!0},key:192},ty={classMap:{"form-group":!0},key:193},sy={classMap:{"form-group":!0,"date-group":!0},key:197},oy={classMap:{"date-input-container":!0},key:200};function ot(n,e,s,t){const{st:o,gid:i,sp:a,b:r,h:l,d:c,k:d,i:h,f:u,t:f}=n,{_m0:g,_m1:_,_m2:m,_m3:x,_m4:k,_m5:$,_m6:S,_m7:O,_m8:F,_m9:D,_m10:v,_m11:A,_m12:w,_m13:y,_m14:C,_m15:I,_m16:L,_m17:N,_m18:T,_m19:q,_m20:te,_m21:pe,_m22:Ne,_m23:fe,_m24:Ce,_m25:_e,_m26:Se,_m27:xe,_m28:Ee,_m29:be,_m30:Re,_m31:ye,_m32:ke,_m33:M,_m34:ve,_m35:E,_m36:P,_m37:b,_m38:ee}=t;return[e.isLoading?o(Tg,1):null,l("div",M_,[l("div",P_,[l("div",j_,[l("div",U_,[o(Og,7,[a(0,{attrs:{for:i("location")}},null)]),l("input",{attrs:{type:"text",id:i("location"),name:"location"},props:{value:e.formData.location},key:8,on:g||(t._m0={change:r(e.handleInputChange)})})]),l("div",V_,[o(Lg,11,[a(0,{attrs:{for:i("project")}},null)]),l("input",{attrs:{type:"text",id:i("project"),name:"project",readonly:""},props:{value:e.formData.project},key:12})]),l("div",q_,[o(Ng,15,[a(0,{attrs:{for:i("drillNo")}},null)]),l("input",{attrs:{type:"text",id:i("drillNo"),name:"drillNo"},props:{value:e.formData.drillNo},key:16,on:_||(t._m1={change:r(e.handleInputChange)})})])]),l("div",z_,[l("div",W_,[o(Mg,20,[a(0,{attrs:{for:i("date")}},null)]),l("div",B_,[l("input",{attrs:{type:"date",id:i("date"),name:"date"},props:{value:e.formData.dateForInput},key:22,on:m||(t._m2={change:r(e.handleInputChange)})})])]),l("div",H_,[o(Pg,25,[a(0,{attrs:{for:i("time")}},null)]),l("div",J_,[l("input",{attrs:{type:"time",id:i("time"),name:"time"},props:{value:e.formData.timeForInput},key:27,on:x||(t._m3={change:r(e.handleInputChange)})})])])]),o(jg,29,[a(1,{attrs:{for:i("scenario")}},null),a(3,{on:k||(t._m4={change:r(e.handleInputChange)}),attrs:{id:i("scenario")}},null),a(4,null,c(e.formData.scenario))]),l("div",Q_,[o(Ug,32),l("div",Y_,[l("div",K_,[o(Vg,36),l("input",{attrs:G_,props:{value:e.formData.objective1},key:37,on:$||(t._m5={change:r(e.handleInputChange)})})]),l("div",X_,[o(qg,40),l("input",{attrs:Z_,props:{value:e.formData.objective2},key:41,on:S||(t._m6={change:r(e.handleInputChange)})})]),l("div",eb,[o(zg,44),l("input",{attrs:tb,props:{value:e.formData.objective3},key:45,on:O||(t._m7={change:r(e.handleInputChange)})})])])]),l("div",sb,[l("div",ob,[o(Wg,49),l("div",ib,[l("div",ab,[o(Bg,53),l("div",{classMap:nb,attrs:{id:i("observer-cards-list")},key:54},h(e.formData.observers,function(j,_t){return l("div",{classMap:rb,attrs:{"data-id":j.id},key:d(55,j.id)},[o(Hg,57,[a(2,null,"Observer "+c(j.id)),a(3,{on:F||(t._m8={click:r(e.handleDeleteObserverRow)}),attrs:{"data-id":j.id}},null)]),l("div",lb,[o(Jg,60,[a(4,{on:D||(t._m9={change:r(e.handleSelectChange)}),attrs:{"data-id":j.id}},null)]),l("div",cb,[o(Qg,63),j.isEmployeeType?l("div",db,[l("select",{classMap:Rs,attrs:{"data-field":"employeeName","data-id":j.id},key:65,on:v||(t._m10={change:r(e.handleEmployeeSelectChange)})},u([o(Yg,67),h(e.employeeData,function(ce){return o(Kg,d(69,ce.Id),[a(0,{attrs:{value:ce.Id,"data-name":ce.Name,"data-job-title":ce.Rhythm__Job_Title__c}},null),a(1,null,c(ce.Name))])})]))]):null,j.isEmployeeType?null:l("input",{attrs:{type:"text","data-field":"Rhythm__Personnel_Name_In_Text__c","data-id":j.id,placeholder:"Enter name"},props:{value:j.Rhythm__Personnel_Name_In_Text__c},key:70,on:A||(t._m11={change:r(e.handleInputChange)})})]),l("div",hb,[o(Gg,73),l("input",{attrs:{type:"text","data-field":"Rhythm__Designation__c","data-id":j.id,placeholder:"Enter designation",readonly:j.isEmployeeType?"":null},props:{value:j.Rhythm__Designation__c},key:74,on:w||(t._m12={change:r(e.handleInputChange)})})]),l("div",ub,[o(Xg,77),l("input",{attrs:{type:"text","data-field":"Rhythm__Location__c","data-id":j.id,placeholder:"Enter location"},props:{value:j.Rhythm__Location__c},key:78,on:y||(t._m13={change:r(e.handleInputChange)})})])])])})),o(Zg,80,[a(1,{on:C||(t._m14={click:r(e.handleAddObserverRow)})},null)]),l("div",{classMap:pb,attrs:{id:i("saved-observers-section")},key:81},[o(e_,83,[a(4,null,"Saved Observers ("+c(e.formData.savedObservers.length)+")")]),l("div",fb,h(e.formData.savedObservers,function(j,_t){return l("div",{classMap:mb,key:d(85,j.Id)},[o(t_,87,[a(2,null,"Observer "+c(j.index))]),l("div",gb,[o(s_,90,[a(4,null,c(j.Rhythm__Type_of_Person__c))]),l("div",_b,[o(o_,93),l("span",bb,[j.isEmployee?f(c(j.displayName)):null,j.isEmployee?null:f(c(j.Rhythm__Personnel_Name_In_Text__c))])]),o(i_,96,[a(4,null,c(j.Rhythm__Designation__c))]),o(a_,98,[a(4,null,c(j.Rhythm__Location__c))])])])}))]),o(n_,100,[a(0,{attrs:{id:i("observers-info")}},null)])])])]),l("div",yb,[o(r_,103),l("div",vb,[l("div",wb,[e.isLoading?o(l_,107):null,e.isLoading?null:l("div",xb,h(e.formData.activities,function(j,_t){return l("div",{classMap:kb,key:d(109,j.Id)},[l("div",$b,[l("div",Cb,[l("input",{attrs:{type:"checkbox","data-id":j.Id},props:{checked:j.Rhythm__Is_Completed__c},key:112,on:I||(t._m15={change:r(e.handleActivityCheckboxChange)})}),o(c_,114)])]),l("div",Sb,[o(d_,117,[a(1,null,c(j.Rhythm__Activities__c))]),l("div",Eb,[o(h_,120),l("input",{attrs:{type:"text","data-field":"Rhythm__Information__c","data-id":j.Id,placeholder:"Enter information"},props:{value:j.Rhythm__Information__c},key:121,on:L||(t._m16={change:r(e.handleActivityInputChange)})})]),l("div",Rb,[o(u_,124),l("div",Ab,[l("input",{classMap:Ib,attrs:{type:"time","data-field":"Rhythm__Exact_Time__c","data-id":j.Id,placeholder:"Enter time"},props:{value:j.Rhythm__Exact_Time__c},key:126,on:N||(t._m17={change:r(e.handleActivityInputChange)})})])]),l("div",Fb,[o(p_,129),l("input",{attrs:{type:"text","data-field":"Rhythm__Any_Other_Information__c","data-id":j.Id,placeholder:"Enter other info"},props:{value:j.Rhythm__Any_Other_Information__c},key:130,on:T||(t._m18={change:r(e.handleActivityInputChange)})})])])])}))])])]),l("div",Db,[o(f_,133),l("div",Tb,[l("div",Ob,[o(m_,137,[a(1,{on:q||(t._m19={click:r(e.handleAddRecommendationsClick)})},null)]),e.isSaving?o(g_,139):null,l("div",{classMap:Lb,styleDecls:Nb,attrs:{id:i("add-recommendations-form")},key:140},[l("div",{classMap:Mb,attrs:{id:i("recommendations-form-rows")},key:141},h(e.formData.newRecommendations,function(j,_t){return l("div",{classMap:Pb,attrs:{"data-id":j.id},key:d(142,j.id)},[o(__,144,[a(0,{on:pe||(t._m21={click:r(e.handleDeleteRecommendationRow)}),attrs:{"data-id":j.id}},null)]),l("div",jb,[o(b_,147),l("input",{attrs:{type:"text","data-field":"Subject","data-id":j.id,placeholder:"Enter recommendation",required:""},props:{value:j.Subject},key:148,on:Ne||(t._m22={change:r(e.handleRecommendationInputChange)})})]),l("div",Ub,[o(y_,151),l("div",Vb,[l("select",{classMap:Rs,attrs:{"data-field":"OwnerId","data-id":j.id},key:153,on:fe||(t._m23={change:r(e.handleRecommendationSelectChange)})},u([o(v_,155),h(e.users,function(ce){return o(w_,d(157,ce.value),[a(0,{attrs:{value:ce.value}},null),a(1,null,c(ce.label))])})]))])]),l("div",qb,[o(x_,160),l("div",zb,[l("input",{attrs:{type:"date","data-field":"ActivityDate","data-id":j.id,placeholder:"Select date",required:""},props:{value:j.ActivityDate},key:162,on:Ce||(t._m24={change:r(e.handleRecommendationInputChange)})})])]),l("div",Wb,[o(k_,165),l("div",Bb,[l("select",{classMap:Rs,attrs:{"data-field":"Status","data-id":j.id},key:167,on:_e||(t._m25={change:r(e.handleRecommendationSelectChange)})},h(e.statusOptions,function(ce){return o($_,d(169,ce.value),[a(0,{attrs:{value:ce.value}},null),a(1,null,c(ce.label))])}))])]),o(C_,171)])})),o(S_,173,[a(1,{on:Se||(t._m26={click:r(e.handleAddRecommendationRow)})},null),a(7,{on:xe||(t._m27={click:r(e.handleCancelRecommendations)})},null),a(9,{on:Ee||(t._m28={click:r(e.handleSaveRecommendations)})},null)])]),l("div",Hb,[l("div",{classMap:Jb,attrs:{id:i("recommendations-table-body")},key:175},u([h(e.formData.recommendations,function(j,_t){return o(E_,d(177,j.id),[a(6,null,c(j.Subject)),a(11,null,c(j.ownerName)),a(16,null,c(j.ActivityDate)),a(21,null,c(j.statusLabel))])})]))])])])])]),l("div",Qb,[l("div",Yb,[l("div",Kb,[l("div",Gb,[o(R_,183,[a(0,{attrs:{for:i("preparedBy")}},null)]),l("input",{attrs:{type:"text",id:i("preparedBy"),name:"preparedBy",placeholder:"Enter name"},props:{value:e.formData.preparedBy},key:184,on:be||(t._m29={change:r(e.handleInputChange)})})]),l("div",Xb,[o(A_,187,[a(0,{attrs:{for:i("preparedDate")}},null)]),l("div",Zb,[l("input",{attrs:{type:"date",id:i("preparedDate"),name:"preparedDate"},props:{value:e.formData.preparedDateForInput},key:189,on:Re||(t._m30={change:r(e.handleInputChange)})})])]),o(I_,191,[a(1,{attrs:{for:i("preparedSignature")}},null)])]),l("div",ey,[l("div",ty,[o(F_,195,[a(0,{attrs:{for:i("reviewedBy")}},null)]),l("input",{attrs:{type:"text",id:i("reviewedBy"),name:"reviewedBy",placeholder:"Enter name"},props:{value:e.formData.reviewedBy},key:196,on:ye||(t._m31={change:r(e.handleInputChange)})})]),l("div",sy,[o(D_,199,[a(0,{attrs:{for:i("reviewedDate")}},null)]),l("div",oy,[l("input",{attrs:{type:"date",id:i("reviewedDate"),name:"reviewedDate"},props:{value:e.formData.reviewedDateForInput},key:201,on:ke||(t._m32={change:r(e.handleInputChange)})})])]),o(T_,203,[a(1,{attrs:{for:i("reviewedSignature")}},null)])])]),o(O_,205,[a(1,{on:M||(t._m33={click:r(e.handleSaveReport)})},null)])])])]),e.showSuccess?o(L_,207,[a(0,{on:E||(t._m35={click:r(e.handleModalClick)})},null),a(7,null,c(e.successMessage))]):null,e.showError?o(N_,209,[a(0,{on:b||(t._m37={click:r(e.handleModalClick)})},null),a(7,null,c(e.errorMessage)),a(8,{on:ee||(t._m38={click:r(e.hideErrorModal)})},null)]):null]}var iy=J(ot);ot.stylesheets=[],ot.stylesheetToken="lwc-3kt1oc3cv07",ot.legacyStylesheetToken="c-mockDrillReport_mockDrillReport",ai&&ot.stylesheets.push.apply(ot.stylesheets,ai),Q(ot);class ni extends K{constructor(...e){super(...e);this.objectApiName="Rhythm__HFE_Session__c",this.recordId="",this.listObserversObjectApiName="Rhythm__HFE_Observers__c",this.activitesCheckListObjectApiName="Rhythm__HFE_Mockdrills__c",this.isLoading=!1,this.isSaving=!1,this.users=[],this.statusOptions=[],this.sessionData={},this.showSuccess=!1,this.showError=!1,this.errorMessage="",this.successMessage="Changes saved successfully!",this.collapsibleListenersInitialized=!1,this.formData={Id:"",location:"",project:"",drillNo:"",date:"",time:"",dateForInput:"",timeForInput:"",scenario:"",objectives:["","",""],objective1:"",objective2:"",objective3:"",observers:[{id:1,Rhythm__Type_of_Person__c:"",Rhythm__Name_of_the_Person__c:"",Rhythm__Designation__c:"",Rhythm__Location__c:"",Rhythm__Personnel_Name_In_Text__c:"",Rhythm__session__c:"",displayName:""}],savedObservers:[],activities:[],recommendations:[],newRecommendations:[{id:1,Subject:"",OwnerId:"",ActivityDate:"",Status:"Open",WhatId:""}],preparedBy:"",preparedDate:"",preparedDateForInput:"",reviewedBy:"",reviewedDate:"",reviewedDateForInput:""},this.employeeData=[],this.savedObservers=[{id:1,type:"Employee",name:"Anshika Sah",designation:"Manager",location:"2w2w2w2"}],this._boundCollapsibleClickHandler=null}renderedCallback(){this.setupCollapsibleSections(),this.setupAddObserverButton(),this.updateSelectValues()}updateSelectValues(){this.formData.observers.forEach(e=>{const s=this.template.querySelector(`select[data-field="type"][data-id="${e.id}"]`);s&&e.type&&(s.value=e.type)}),this.updateRecommendationSelects()}updateRecommendationSelects(){this.formData.newRecommendations.forEach(e=>{const s=this.template.querySelector(`select[data-field="responsibility"][data-id="${e.id}"]`);s&&e.responsibility&&(s.value=e.responsibility);const t=this.template.querySelector(`select[data-field="status"][data-id="${e.id}"]`);t&&e.status&&(t.value=e.status)})}setupCollapsibleSections(){if(this.collapsibleListenersInitialized)return;const e=this.template.querySelectorAll(".collapsible-btn");this._boundCollapsibleClickHandler||(this._boundCollapsibleClickHandler=this.handleCollapsibleClick.bind(this)),e.forEach(s=>{s.removeEventListener("click",this._boundCollapsibleClickHandler),s.addEventListener("click",this._boundCollapsibleClickHandler)}),this.collapsibleListenersInitialized=!0}handleCollapsibleClick(e){const s=e.currentTarget,t=s.nextElementSibling,o=s.getAttribute("aria-expanded")==="true";s.setAttribute("aria-expanded",!o),o?(t.classList.add("collapsible-content-display-none"),t.classList.remove("collapsible-content-display-block"),t.classList.remove("active")):(t.classList.remove("collapsible-content-display-none"),t.classList.add("collapsible-content-display-block"),t.classList.add("active")),e.stopPropagation()}setupAddObserverButton(){this.template.querySelectorAll(".observer-row").forEach(i=>{this.setupObserverRowLabels(i)}),this.setupSavedObservers(),this.updateObserversInfoVisibility(),this.template.querySelectorAll(".custom-select").forEach(i=>{i.addEventListener("click",this.togglePersonTypeDropdown.bind(this))}),this.template.querySelectorAll(".select-option").forEach(i=>{i.addEventListener("click",this.handlePersonTypeSelect.bind(this))}),this.template.querySelectorAll(".action-btn.add-btn").forEach(i=>{i.addEventListener("click",this.handleAddObserverRow.bind(this))})}setupSavedObservers(){const e=this.template.querySelector("#saved-observers-section");this.formData.savedObservers&&this.formData.savedObservers.length>0?(e&&(e.style.display="block"),Promise.resolve().then(()=>{this.template.querySelectorAll(".saved-observer-card").forEach(t=>{this.setupObserverRowLabels(t)})})):e&&(e.style.display="none")}handleSelectChange(e){const s=e.target.dataset.field,t=e.target.dataset.id,o=e.target.value;if(s==="Rhythm__Type_of_Person__c"){const i=parseInt(t,10),a=this.formData.observers.find(r=>r.id===i);if(a){a.Rhythm__Type_of_Person__c=o,a.isEmployeeType=o==="Employee",o==="Employee"?(a.Rhythm__Personnel_Name_In_Text__c="",a.Rhythm__Designation__c=""):a.Rhythm__Name_of_the_Person__c="",this.formData={...this.formData,observers:[...this.formData.observers]};const r=e.target;r&&(r.value=o)}console.log("Updated observer type:",this.formData.observers)}}toggleEmployeeNameDropdown(e){const s=e.currentTarget.getAttribute("data-id"),t=this.template.querySelector(`#employeeName-dropdown-${s}`),o=e.currentTarget;this.template.querySelectorAll(".select-dropdown").forEach(a=>{a.id!==`employeeName-dropdown-${s}`&&a.classList.remove("show")}),t.classList.toggle("show"),o.classList.toggle("active"),window.addEventListener("click",this.closeDropdowns.bind(this),{once:!0})}handleEmployeeNameSelect(e){const s=e.currentTarget.getAttribute("data-id"),t=e.currentTarget.getAttribute("data-value"),o=e.currentTarget.getAttribute("data-designation"),i=e.currentTarget.closest(".custom-select"),a=e.currentTarget.closest(".select-dropdown");if(i){const l=i.querySelector(".selected-option");l&&(l.textContent=t)}a&&a.classList.remove("show"),i&&i.classList.remove("active");const r=parseInt(s,10)-1;if(this.formData.observers[r]){this.formData.observers[r].name=t,this.formData.observers[r].designation=o;const l=this.template.querySelector(`input[name="observer${s}_designation"]`);l&&(l.value=o)}console.log("Updated observer name and designation:",this.formData.observers)}handleEmployeeSelectChange(e){const s=e.target.dataset.id,t=e.target.options[e.target.selectedIndex],o=e.target.value,i=t.getAttribute("data-name"),a=t.getAttribute("data-job-title"),r=parseInt(s,10),l=this.formData.observers.find(c=>c.id===r);l&&(l.Rhythm__Name_of_the_Person__c=o,l.displayName=i,l.Rhythm__Designation__c=a||"",this.formData={...this.formData,observers:[...this.formData.observers]},console.log("Updated observer with employee data:",l))}getObserverFieldName(e,s){return`observer${e}_${s}`}handleAddObserverRow(){const s={id:this.formData.observers.length+1,Rhythm__Type_of_Person__c:"",Rhythm__Name_of_the_Person__c:"",Rhythm__Personnel_Name_In_Text__c:"",Rhythm__Designation__c:"",Rhythm__Location__c:"",Rhythm__session__c:this.recordId,isEmployeeType:!1,displayName:""};this.formData={...this.formData,observers:[...this.formData.observers,s]},this.updateObserversInfoVisibility(),console.log("Added new observer:",this.formData.observers)}handleDeleteObserverRow(e){const s=parseInt(e.currentTarget.getAttribute("data-id"),10);if(this.formData.observers.length<=1){const t=this.formData.observers[0];t.Rhythm__Type_of_Person__c="",t.Rhythm__Name_of_the_Person__c="",t.Rhythm__Personnel_Name_In_Text__c="",t.Rhythm__Designation__c="",t.Rhythm__Location__c="",t.isEmployeeType=!1,t.displayName="",this.formData={...this.formData,observers:[t]}}else{const t=this.formData.observers.filter(o=>o.id!==s);this.formData={...this.formData,observers:t},this.renumberObservers()}this.updateObserversInfoVisibility(),console.log("Deleted observer, remaining:",this.formData.observers)}renumberObserverRows(){this.renumberObservers()}renumberObserverCards(){this.renumberObservers()}renumberObservers(){const e=this.formData.observers.map((s,t)=>({...s,id:t+1}));this.formData={...this.formData,observers:e}}setupObserverRowLabels(e){const s=e.querySelector(".observers-td.type"),t=e.querySelector(".observers-td.name"),o=e.querySelector(".observers-td.designation"),i=e.querySelector(".observers-td.location");s&&!s.hasAttribute("data-label")&&s.setAttribute("data-label","TYPE OF PERSON"),t&&!t.hasAttribute("data-label")&&t.setAttribute("data-label","NAME OF THE PERSON"),o&&!o.hasAttribute("data-label")&&o.setAttribute("data-label","DESIGNATION"),i&&!i.hasAttribute("data-label")&&i.setAttribute("data-label","LOCATION")}updateObserversInfoVisibility(){const e=this.template.querySelector(".observers-info-container");e&&(this.formData.observers.length===0&&(!this.formData.savedObservers||this.formData.savedObservers.length===0)?e.style.display="flex":e.style.display="none")}handleActivityCheckboxChange(e){const s=e.target.dataset.id,t=e.target.checked,o=this.formData.activities.find(i=>i.id===s||i.Id===s);if(o){if(o.Rhythm__Is_Completed__c=t,t){const i=new Date,a=i.getHours(),r=i.getMinutes(),l=a.toString().padStart(2,"0"),c=r.toString().padStart(2,"0"),d=`${l}:${c}`;o.Rhythm__Exact_Time__c=d,console.log("Setting time to:",d)}this.formData={...this.formData,activities:[...this.formData.activities]},Promise.resolve().then(()=>{const i=this.template.querySelector(`input[data-field="Rhythm__Exact_Time__c"][data-id="${s}"]`);i&&t&&(console.log("Found time input, current value:",i.value),i.value||(i.value=o.Rhythm__Exact_Time__c,console.log("Manually set input value to:",o.Rhythm__Exact_Time__c)))})}else console.warn(`Activity not found for ID: ${s}`);console.log("Updated activity:",s,o)}handleActivityInputChange(e){const{value:s}=e.target,t=e.target.dataset.field,o=e.target.dataset.id,i=this.formData.activities.find(a=>a.id===o||a.Id===o);i&&t?(i[t]=s,t==="Rhythm__Exact_Time__c"&&console.log("Time input changed to:",s),this.formData={...this.formData,activities:[...this.formData.activities]},console.log("Updated activity field:",o,t,s)):console.warn(`Activity not found for ID: ${o}`)}handleInputChange(e){const{name:s,value:t}=e.target,o=e.target.dataset.field,i=e.target.dataset.id;if(s&&s.startsWith("objective")){const a=parseInt(s.replace("objective",""),10)-1;this.formData[s]=t,this.formData.objectives[a]=`${a+1}. ${t}`,console.log("Updated objectives:",JSON.stringify(this.formData.objectives))}else if(o&&i){const a=parseInt(i,10),r=this.formData.observers.find(l=>l.id===a);if(r&&(r[o]=t,o==="designation"&&r.type==="Employee")){e.target.value=r.designation;return}}else if(s&&s.startsWith("observer")){const a=s.split("_"),r=parseInt(a[0].replace("observer",""),10)-1,l=a[1];if(this.formData.observers[r]&&(this.formData.observers[r][l]=t,l==="designation"&&this.formData.observers[r].type==="Employee")){e.target.value=this.formData.observers[r].designation;return}}else if(s&&s.includes("_")){const a=s.split("_"),r=a[0],l=a[1];if(r.startsWith("activity")){const c=parseInt(r.replace("activity",""),10),d=this.formData.activities.find(h=>h.id===c);d&&(d[l]=t,this.formData={...this.formData,activities:[...this.formData.activities]})}}else if(s==="recommendations"||s==="capa")this.formData[s]=t;else if(s==="date"||s==="preparedDate"||s==="reviewedDate"){if(s==="date"?this.formData.dateForInput=t:s==="preparedDate"?this.formData.preparedDateForInput=t:s==="reviewedDate"&&(this.formData.reviewedDateForInput=t),t)try{const a=t.split("-");if(a.length===3){const r=a[0],l=parseInt(a[1],10),c=parseInt(a[2],10),d=new Date(r,l-1,c),u=`${c}-${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][d.getMonth()]}-${r}`;this.formData[s]=u}}catch(a){console.error(`Error converting ${s}:`,a)}}else if(s==="time"){if(this.formData.timeForInput=t,t)try{const a=t.split(":");if(a.length===2){const r=parseInt(a[0],10),l=a[1],c=r>=12?"pm":"am",h=`${r%12||12}:${l} ${c}`;this.formData.time=h}}catch(a){console.error("Error converting time:",a)}}else s&&(this.formData[s]=t);console.log("Updated form data:",this.formData)}async handleSaveReport(){try{const e=this.validateForm();if(console.log("log in handleSaveReport",JSON.stringify(this.formData)),e){this.isLoading=!0;const s=this.formData.activities.filter(l=>l.Rhythm__Exact_Time__c&&(!l.Rhythm__Information__c||l.Rhythm__Information__c.trim()==="")&&(!l.Rhythm__Any_Other_Information__c||l.Rhythm__Any_Other_Information__c.trim()===""));if(s.length>0){const l=s.map(c=>c.Rhythm__Activities__c).join(", ");this.showErrorModal(`Please fill in Information or Any Other Info for activities with time: ${l}`),this.isLoading=!1;return}const t={Id:this.recordId,Rhythm__Project_Site__c:this.formData.location,Rhythm__Location__c:this.sessionData.Rhythm__Location__c,Rhythm__Mock_drill_No__c:this.formData.drillNo,Rhythm__Date_Time_of_MOCK_DRILL__c:this.combineDateAndTimeForSalesforce(this.formData.dateForInput,this.convertInputTimeToSalesforceFormat(this.formData.timeForInput)),Rhythm__Description_of_Emergency_scenario__c:this.formData.scenario,Rhythm__Objective_of_Mock_drill_planned__c:this.formData.objectives.join(`
`),Rhythm__Prepared_by__c:this.formData.preparedBy,Rhythm__Prepared_by_Date__c:this.formData.preparedDateForInput,Rhythm__Reviewed_by__c:this.formData.reviewedBy,Rhythm__Reviewed_by_Date__c:this.formData.reviewedDateForInput};console.log("Session data to save:",JSON.stringify(t));const o=this.formData.observers.filter(l=>l.Rhythm__Type_of_Person__c&&l.Rhythm__Type_of_Person__c.trim()!==""||l.Rhythm__Location__c&&l.Rhythm__Location__c.trim()!=="").map(l=>{const{id:c,isEmployeeType:d,displayName:h,...u}=l;return u.Rhythm__session__c=this.recordId,u});console.log("Observers to save:",JSON.stringify(o));let i=[],a=[];const r=this.formData.activities.map(l=>{const c={Rhythm__Activities__c:l.Rhythm__Activities__c,Rhythm__Is_Completed__c:l.Rhythm__Is_Completed__c,Rhythm__Information__c:l.Rhythm__Information__c,Rhythm__Exact_Time__c:this.convertInputTimeToSalesforceFormat(l.Rhythm__Exact_Time__c),Rhythm__Any_Other_Information__c:l.Rhythm__Any_Other_Information__c};return l.isTemplate?(c.Rhythm__Mock_Drill__c=this.recordId,i.push(c)):(c.Id=l.Id,a.push(c)),c});console.log("Activities to save:",JSON.stringify(r));try{const l=await oe(this.objectApiName,[t]);if(console.log("Session update result:",l),l[0].success){if(o.length>0){const c=await $e(this.listObserversObjectApiName,o);if(c[0].success){console.log("Observers save result:",c);const d=c.map((h,u)=>{if(h.success){const f=o[u];return{Id:h.id,Rhythm__Type_of_Person__c:f.Rhythm__Type_of_Person__c,Rhythm__Personnel_Name_In_Text__c:f.Rhythm__Personnel_Name_In_Text__c,Rhythm__Name_of_the_Person__c:f.Rhythm__Name_of_the_Person__c,Rhythm__Location__c:f.Rhythm__Location__c,Rhythm__Designation__c:f.Rhythm__Designation__c,index:this.formData.savedObservers.length+u+1,isEmployee:f.Rhythm__Type_of_Person__c==="Employee",displayName:this.formData.observers.find(g=>g.Rhythm__Name_of_the_Person__c===f.Rhythm__Name_of_the_Person__c)?.displayName||""}}return null}).filter(h=>h!==null);this.formData.savedObservers=[...this.formData.savedObservers,...d],this.setupSavedObservers(),this.formData.observers=[{id:1,Rhythm__Type_of_Person__c:"",Rhythm__Name_of_the_Person__c:"",Rhythm__Designation__c:"",Rhythm__Location__c:"",Rhythm__Personnel_Name_In_Text__c:"",Rhythm__session__c:this.recordId,displayName:""}]}}if(i.length>0){const c=await $e(this.activitesCheckListObjectApiName,i);console.log("Activities create result:",c)}if(a.length>0){const c=await oe(this.activitesCheckListObjectApiName,a);console.log("Activities save result:",c)}}this.showSuccessModal("Report saved successfully!")}catch(l){console.error("Error saving data:",l),this.showErrorModal("Failed to save report: "+(l.message||"Unknown error"))}this.isLoading=!1}else this.showErrorModal("Please fill in all required fields.")}catch(e){console.error("Error in handleSaveReport:",e),this.showErrorModal("An unexpected error occurred: "+(e.message||"Unknown error")),this.isLoading=!1}}validateForm(){return!(!this.formData.location||!this.formData.drillNo)}showToast(e,s){console.log(`${e}: ${s}`),e==="Success"?this.showSuccessModal(s):this.showErrorModal(s)}showSuccessModal(e){e?this.successMessage=e:this.successMessage="Changes saved successfully!",this.showSuccess=!0,setTimeout(()=>{this.hideSuccessModal()},3e3)}hideSuccessModal(){this.showSuccess=!1}showErrorModal(e){this.errorMessage=e,this.showError=!0}hideErrorModal(){this.showError=!1}handleModalClick(e){e.target===e.currentTarget&&(this.hideSuccessModal(),this.hideErrorModal())}handleAddRecommendationsClick(){const e=this.template.querySelector("#add-recommendations-form");e&&(e.style.display="block")}toggleResponsibilityDropdown(e){const s=e.currentTarget.getAttribute("data-id"),t=this.template.querySelector(`#responsibility-dropdown-${s}`),o=e.currentTarget;this.template.querySelectorAll(".select-dropdown").forEach(a=>{a.id!==`responsibility-dropdown-${s}`&&a.classList.remove("show")}),t.classList.toggle("show"),o.classList.toggle("active"),window.addEventListener("click",this.closeDropdowns.bind(this),{once:!0})}handleResponsibilitySelect(e){const s=e.currentTarget.getAttribute("data-id"),t=e.currentTarget.getAttribute("data-value"),o=this.template.querySelector(`.custom-select[data-id="${s}"][onclick*="toggleResponsibility"]`),i=this.template.querySelector(`#responsibility-dropdown-${s}`),a=o.querySelector(".selected-option");a.textContent=t,i.classList.remove("show"),o.classList.remove("active");const r=parseInt(s,10)-1;this.formData.newRecommendations[r]&&(this.formData.newRecommendations[r].responsibility=t),console.log("Updated recommendation responsibility:",this.formData.newRecommendations)}toggleStatusDropdown(e){const s=e.currentTarget.getAttribute("data-id"),t=this.template.querySelector(`#status-dropdown-${s}`),o=e.currentTarget;this.template.querySelectorAll(".select-dropdown").forEach(a=>{a.id!==`status-dropdown-${s}`&&a.classList.remove("show")}),t.classList.toggle("show"),o.classList.toggle("active"),window.addEventListener("click",this.closeDropdowns.bind(this),{once:!0})}handleStatusSelect(e){const s=e.currentTarget.getAttribute("data-id"),t=e.currentTarget.getAttribute("data-value"),o=this.template.querySelector(`.custom-select[data-id="${s}"][onclick*="toggleStatus"]`),i=this.template.querySelector(`#status-dropdown-${s}`),a=o.querySelector(".selected-option");a.textContent=t,i.classList.remove("show"),o.classList.remove("active");const r=parseInt(s,10)-1;this.formData.newRecommendations[r]&&(this.formData.newRecommendations[r].status=t),console.log("Updated recommendation status:",this.formData.newRecommendations)}handleRecommendationDateClick(e){e.preventDefault();const s=e.currentTarget.getAttribute("data-id"),t=new Date,o=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getFullYear(),r=`${o}/${i}/${a}`,l=this.template.querySelector(`input[data-field="ActivityDate"][data-id="${s}"]`);if(l){l.value=r;const c=parseInt(s,10),d=this.formData.newRecommendations.find(h=>h.id===c);d&&(d.ActivityDate=r,this.formData={...this.formData,newRecommendations:[...this.formData.newRecommendations]})}console.log("Set recommendation date:",r)}handleRecommendationInputChange(e){const{value:s}=e.target,t=e.target.dataset.field,o=e.target.dataset.id;if(t&&o){const i=parseInt(o,10),a=this.formData.newRecommendations.find(r=>r.id===i);a&&(a[t]=s,this.formData={...this.formData,newRecommendations:[...this.formData.newRecommendations]})}console.log("Updated recommendation data:",this.formData.newRecommendations)}handleRecommendationSelectChange(e){const s=e.target.dataset.field,t=e.target.dataset.id,o=e.target.value;if(s&&t){const i=parseInt(t,10),a=this.formData.newRecommendations.find(r=>r.id===i);a&&(a[s]=o,this.formData={...this.formData,newRecommendations:[...this.formData.newRecommendations]})}console.log("Updated recommendation select:",this.formData.newRecommendations)}handleAddRecommendationRow(){const e=this.formData.newRecommendations.length+1;let s="";const t=this.statusOptions.find(i=>i.selected);t?s=t.value:this.statusOptions.length>0&&(s=this.statusOptions[0].value);const o={id:e,Subject:"",OwnerId:"",ActivityDate:"",Status:s,WhatId:this.recordId};this.formData={...this.formData,newRecommendations:[...this.formData.newRecommendations,o]},this.updateRecommendationSelects(),console.log("Added new recommendation:",this.formData.newRecommendations)}handleDeleteRecommendationRow(e){const s=parseInt(e.currentTarget.getAttribute("data-id"),10);if(this.formData.newRecommendations.length>1){const t=this.formData.newRecommendations.filter(o=>o.id!==s);this.formData={...this.formData,newRecommendations:t},this.renumberRecommendations(),console.log("Deleted recommendation, remaining:",this.formData.newRecommendations)}else{const t={id:1,Subject:"",OwnerId:"",ActivityDate:"",Status:"Open",WhatId:this.recordId};this.formData={...this.formData,newRecommendations:[t]},console.log("Cleared recommendation fields:",this.formData.newRecommendations)}}renumberRecommendations(){const e=this.formData.newRecommendations.map((s,t)=>({...s,id:t+1}));this.formData={...this.formData,newRecommendations:e}}renumberRecommendationRows(){this.renumberRecommendations()}handleCancelRecommendations(){const e=this.template.querySelector("#add-recommendations-form");if(e){e.style.display="none";let s="";const t=this.statusOptions.find(o=>o.selected);t?s=t.value:this.statusOptions.length>0&&(s=this.statusOptions[0].value),this.formData={...this.formData,newRecommendations:[{id:1,Subject:"",OwnerId:"",ActivityDate:"",Status:s,WhatId:this.recordId}]},console.log("Cancelled recommendations form")}}async handleSaveRecommendations(){if(console.log("this.formData.newRecommendations in line 1202",JSON.stringify(this.formData.newRecommendations)),this.validateRecommendationsForm())try{this.isLoading=!0,this.isSaving=!0;const s=this.formData.newRecommendations.map(r=>{const{id:l,...c}=r;return c.WhatId||(c.WhatId=this.recordId),c});console.log("Recommendations to save:",JSON.stringify(s));const t=await $e("Task",s);console.log("Create record result:",JSON.stringify(t)),await this.getTasks();const o=this.template.querySelector("#add-recommendations-form");o&&(o.style.display="none");let i="";const a=this.statusOptions.find(r=>r.selected);a?i=a.value:this.statusOptions.length>0&&(i=this.statusOptions[0].value),this.formData.newRecommendations=[{id:1,Subject:"",OwnerId:"",ActivityDate:"",Status:i,WhatId:this.recordId}],this.showToast("Success","Recommendations saved successfully!"),this.isSaving=!1,this.isLoading=!1}catch(s){console.error("Error saving recommendations:",s),this.showToast("Error","Failed to save recommendations: "+(s.message||"Unknown error")),this.isSaving=!1,this.isLoading=!1}else this.showToast("Error","Please fill in all required fields."),this.isLoading=!1}validateRecommendationsForm(){let e=!0;return this.formData.newRecommendations.forEach(s=>{(!s.Subject||!s.OwnerId||!s.ActivityDate||!s.Status)&&(e=!1)}),e}updateRecommendationsTable(){const e=this.formData.recommendations.map((s,t)=>({...s,id:s.id||t+1,statusLabel:this.getStatusLabel(s.Status)}));this.formData={...this.formData,recommendations:e}}async connectedCallback(){try{this.isLoading=!0,this.initializeDefaultDateTimeValues(),this.formData.Id=this.recordId,this.formData.newRecommendations[0].WhatId=this.recordId,(!this.formData.observers||this.formData.observers.length===0)&&(this.formData.observers=[{id:1,Rhythm__Type_of_Person__c:"",Rhythm__Name_of_the_Person__c:"",Rhythm__Designation__c:"",Rhythm__Location__c:"",Rhythm__Personnel_Name_In_Text__c:"",Rhythm__session__c:this.recordId,displayName:""}]);const e=this.getUsers(),s=this.getTaskStatus();await this.getSessionData(),await Promise.all([this.getActivitesValues(),this.getTasks(),this.getEmployees(),this.getSavedObservers()]),await this.getActivitesData(),await Promise.all([e,s])}catch(e){console.error("Error loading data in connectedCallback:",e),this.showErrorModal("Error loading data. Please try refreshing the page.")}finally{this.isLoading=!1}}initializeDefaultDateTimeValues(){const e=new Date,s=e.getDate(),t=e.toLocaleString("default",{month:"short"}),o=e.getFullYear(),i=`${s}-${t}-${o}`;this.formData.date=i;const a=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),l=`${o}-${a}-${r}`;this.formData.dateForInput=l;const c=e.getHours().toString().padStart(2,"0"),d=e.getMinutes().toString().padStart(2,"0");this.formData.timeForInput=`${c}:${d}`;const h=e.getHours()>=12?"pm":"am",u=e.getHours()%12||12;this.formData.time=`${u}:${d} ${h}`,this.formData.preparedDateForInput=l,this.formData.reviewedDateForInput=l}disconnectedCallback(){this.collapsibleListenersInitialized=!1;const e=this.template.querySelectorAll(".collapsible-btn");e&&this._boundCollapsibleClickHandler&&e.forEach(s=>{s.removeEventListener("click",this._boundCollapsibleClickHandler)})}getUsers(){os("User").then(e=>{this.users=e}).catch(e=>{console.error("Error loading users:",e)})}async getActivitesValues(){try{const s=await le("SELECT Rhythm__Activities__c, DeveloperName, QualifiedApiName FROM Rhythm__HFE_Mockdrill__mdt");if(s&&s.length>0){const o=[...s].sort((i,a)=>{const r=parseInt(i.DeveloperName.replace(/\D/g,""),10)||0,l=parseInt(a.DeveloperName.replace(/\D/g,""),10)||0;return r-l}).map((i,a)=>({Id:a+1,Rhythm__Activities__c:i.Rhythm__Activities__c,Rhythm__Is_Completed__c:!1,Rhythm__Information__c:"",Rhythm__Exact_Time__c:"",Rhythm__Any_Other_Information__c:"",Rhythm__Mock_Drill__c:this.recordId,developerName:i.DeveloperName,qualifiedApiName:i.QualifiedApiName,isTemplate:!0}));return this.formData={...this.formData,activities:o},console.log("Template activities loaded:",JSON.stringify(o)),o}return[]}catch(e){throw console.error("Error fetching template activities:",e),e}}async getTaskStatus(){const s=(await vt("Task")).fields.find(t=>t.name==="Status");this.statusOptions=s.picklistValues.map(t=>({label:t.label,value:t.value,selected:t.defaultValue})),this.statusOptions=this.statusOptions.reverse()}getStatusLabel(e){if(!e)return"";const s=this.statusOptions.find(t=>t.value===e);return s?s.label:e}updateRecommendationStatusLabels(){if(this.formData.recommendations&&this.formData.recommendations.length>0){const e=this.formData.recommendations.map(s=>({...s,statusLabel:this.getStatusLabel(s.Status)}));this.formData={...this.formData,recommendations:e}}}async getTasks(){try{const s=["Subject","ActivityDate","OwnerId","Status","Owner.Name"].join(", ");let o=await ls("Task",s,this.recordId,"Rhythm__HFE_Session__c");try{o=o.replace(/\\"/g,'"')}catch(l){console.error("Error cleaning JSON:",l)}const i=JSON.parse(o);console.log("parsedData",i);const r=i.records.map((l,c)=>{if(l.id||(l.id=c+1),l.statusLabel=this.getStatusLabel(l.Status),l.Owner&&l.Owner.Name)l.ownerName=l.Owner.Name;else{const d=this.users.find(h=>h.value===l.OwnerId);l.ownerName=d?d.label:l.OwnerId}return l});return console.log("Processed tasks:",JSON.stringify(r)),this.formData.recommendations=r,r}catch(e){throw console.error("Error fetching tasks:",e),e}}async getEmployees(){const e=await hn(this.sessionData.Rhythm__Location__c);console.log("Employees loaded:",JSON.stringify(e)),this.employeeData=e}async getSessionData(){try{const e=`SELECT Id, Rhythm__Project_Site__c, Rhythm__Date_Time_of_MOCK_DRILL__c, Rhythm__Description_of_Emergency_scenario__c, Rhythm__Location__c, Rhythm__Location__r.Name,
            Rhythm__Mock_drill_No__c, Rhythm__Objective_of_Mock_drill_planned__c, Rhythm__Prepared_by__c, Rhythm__Prepared_by_Date__c, Rhythm__Reviewed_by__c, Rhythm__Reviewed_by_Date__c  FROM ${this.objectApiName} WHERE Id = '${this.recordId}'`,s=await le(e);if(s&&s.length>0){const t=s[0];if(this.sessionData=t,console.log("Session data loaded:",JSON.stringify(t)),t.Rhythm__Location__r&&t.Rhythm__Location__r.Name&&(this.formData.project=t.Rhythm__Location__r.Name),t.Rhythm__Project_Site__c&&(this.formData.location=t.Rhythm__Project_Site__c),t.Rhythm__Mock_drill_No__c&&(this.formData.drillNo=t.Rhythm__Mock_drill_No__c),t.Rhythm__Description_of_Emergency_scenario__c&&(this.formData.scenario=t.Rhythm__Description_of_Emergency_scenario__c),t.Rhythm__Date_Time_of_MOCK_DRILL__c){const o=new Date(t.Rhythm__Date_Time_of_MOCK_DRILL__c),i=o.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][o.getMonth()],l=o.getFullYear();this.formData.date=`${i}-${r}-${l}`;const c=(o.getMonth()+1).toString().padStart(2,"0"),d=o.getDate().toString().padStart(2,"0");this.formData.dateForInput=`${l}-${c}-${d}`;const h=o.getHours(),u=o.getMinutes().toString().padStart(2,"0"),f=h>=12?"pm":"am",g=h%12||12;this.formData.time=`${g}:${u} ${f}`;const _=h.toString().padStart(2,"0");this.formData.timeForInput=`${_}:${u}`}if(t.Rhythm__Objective_of_Mock_drill_planned__c){const i=t.Rhythm__Objective_of_Mock_drill_planned__c.split(`
`),a=[];i.forEach((r,l)=>{if(l<3){const c=r.replace(/^\d+\.\s*/,"").trim();this.formData[`objective${l+1}`]=c,a[l]=r.trim()}}),this.formData.objectives=a}if(this.formData.observers&&this.formData.observers.length>0&&(this.formData.observers=this.formData.observers.map(o=>({...o,isEmployeeType:o.Rhythm__Type_of_Person__c==="Employee"}))),t.Rhythm__Prepared_by__c&&(this.formData.preparedBy=t.Rhythm__Prepared_by__c),t.Rhythm__Prepared_by_Date__c){const o=new Date(t.Rhythm__Prepared_by_Date__c),i=o.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][o.getMonth()],l=o.getFullYear();this.formData.preparedDate=`${i}-${r}-${l}`,this.formData.preparedDateForInput=t.Rhythm__Prepared_by_Date__c}if(t.Rhythm__Reviewed_by__c&&(this.formData.reviewedBy=t.Rhythm__Reviewed_by__c),t.Rhythm__Reviewed_by_Date__c){const o=new Date(t.Rhythm__Reviewed_by_Date__c),i=o.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][o.getMonth()],l=o.getFullYear();this.formData.reviewedDate=`${i}-${r}-${l}`,this.formData.reviewedDateForInput=t.Rhythm__Reviewed_by_Date__c}}return s}catch(e){throw console.error("Error fetching session data:",e),e}}async getSavedObservers(){try{let e=`SELECT Id, Rhythm__Type_of_Person__c, Rhythm__Personnel_Name_In_Text__c, Rhythm__Name_of_the_Person__c, Rhythm__Location__c, Rhythm__Designation__c FROM ${this.listObserversObjectApiName} WHERE Rhythm__session__c = '${this.recordId}'`;const s=await le(e);if(console.log("Saved observers loaded:",JSON.stringify(s)),s&&s.length>0){const t=await Promise.all(s.map(async(o,i)=>{if(o.index=i+1,o.isEmployee=o.Rhythm__Type_of_Person__c==="Employee",o.isEmployee&&o.Rhythm__Name_of_the_Person__c){const a=this.employeeData.find(r=>r.Id===o.Rhythm__Name_of_the_Person__c);a&&(o.displayName=a.Name)}return o}));return this.formData.savedObservers=t,this.setupSavedObservers(),t}return this.formData.savedObservers=[],this.setupSavedObservers(),[]}catch(e){throw console.error("Error fetching saved observers:",e),this.formData.savedObservers=[],this.setupSavedObservers(),e}}convertSalesforceTimeToInputFormat(e){if(!e)return"";try{const s=e.split(":");if(s.length>=2){const t=s[0].padStart(2,"0"),o=s[1].padStart(2,"0");return`${t}:${o}`}return""}catch(s){return console.error("Error converting time format:",s),""}}convertInputTimeToSalesforceFormat(e){if(!e)return null;try{const s=e.split(":");if(s.length>=2){const t=s[0].padStart(2,"0"),o=s[1].padStart(2,"0");return`${t}:${o}:00`}return null}catch(s){return console.error("Error converting time format:",s),null}}combineDateAndTimeForSalesforce(e,s){if(!e)return null;try{return`${e}T${s||"00:00:00"}.000Z`}catch(t){return console.error("Error combining date and time:",t),null}}async getActivitesData(){try{let e=`SELECT Id, Rhythm__Activities__c, Rhythm__Exact_Time__c, Rhythm__Information__c, Rhythm__Is_Completed__c, Rhythm__Any_Other_Information__c FROM ${this.activitesCheckListObjectApiName} WHERE Rhythm__Mock_Drill__c = '${this.recordId}'`;const s=await le(e);if(console.log("Saved activities data loaded:",JSON.stringify(s)),s&&s.length>0){const t=s.map(r=>({...r,Rhythm__Exact_Time__c:this.convertSalesforceTimeToInputFormat(r.Rhythm__Exact_Time__c)})),o=this.formData.activities||[],i={};t&&t.length>0&&t.forEach(r=>{r.Rhythm__Activities__c&&(i[r.Rhythm__Activities__c]=r)});const a=o.map(r=>{const l=r.Rhythm__Activities__c;if(i[l]){const c=i[l];return{...r,...c,Id:c.Id,isTemplate:!1}}return{...r}});return t&&t.length>0&&t.forEach(r=>{!a.some(c=>c.Rhythm__Activities__c===r.Rhythm__Activities__c)&&r.Rhythm__Activities__c&&a.push({...r,Id:r.Id})}),this.formData={...this.formData,activities:a},console.log("Merged activities:",JSON.stringify(a)),a}return[]}catch(e){throw console.error("Error merging activities data:",e),e}}}Y(ni,{publicProps:{objectApiName:{config:0},recordId:{config:0}},track:{isLoading:1,isSaving:1,users:1,statusOptions:1,sessionData:1,showSuccess:1,showError:1,errorMessage:1,successMessage:1,formData:1,employeeData:1},fields:["listObserversObjectApiName","activitesCheckListObjectApiName","collapsibleListenersInitialized","savedObservers","_boundCollapsibleClickHandler"]});const ri=z(ni,{tmpl:iy,sel:"c-mock-drill-report",apiVersion:63});function ay(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".cad-cardbase",t," {background-color: #ffffff;border-radius: 0.25rem;box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.1);display: flex;flex-direction: column;height: 100%;width: 95%;}.cad-tbl",t," {display: flex;flex-direction: column;width: 99%;height: 100%;}.cad-row",t," {display: flex;flex: 1;width: 100%;}.cad-cel",t," {display: flex;flex-direction: column;vertical-align: top;}.cad-w230",t," {width: 230px;min-width: 230px;flex: 0 0 230px;}.cad-w300",t," {width: 300px;min-width: 300px;flex: 0 0 300px;}.cad-auto",t," {flex: 0.97;min-width: 0;}.cad-pr8",t," {padding-right: 0.5rem;}.cad-pl8",t," {padding-left: 0.5rem;}.cad-sec_container",t," {display: flex;flex-direction: column;height: 100%;width: 100%;border: 1px solid #d8dde6;border-radius: 0.25rem;overflow: hidden;}.cad-sec_header",t," {padding: 0.5rem;background-color: #f3f2f2;border-bottom: 1px solid #d8dde6;border-radius: 0.25rem 0.25rem 0 0;display: flex;align-items: center;justify-content: space-between;height: 42px;box-sizing: border-box;}.hide-timeline",t," {display: none;}.cad-sec_bodyfull1",t," {flex: 1;display: flex;flex-direction: column;position: relative;}.assessment-timeline-container",t," {flex: 1;display: flex;flex-direction: column;overflow: scroll;position: relative;}.cad-timeline_header",t," {width: 100%;}.timeline-header-content",t," {display: flex;align-items: center;width: 100%;}.timeline-title",t," {margin-left: 0.5rem;font-weight: bold;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}.timeline-actions",t," {margin-left: auto;}.cad-timeline_progressline",t," {position: absolute;left: 18px;top: 0;bottom: 0;width: 2px;height: calc(100% - 20px);background-color: #dddbda;z-index: 1;}.cad-sec_vcontainer2_1",t," {position: relative;flex: 1;padding: 1rem 0.5rem 1rem 2rem;overflow-y: auto;width: 100%;box-sizing: border-box;display: flex;flex-direction: column;}.cad-timeline_dot",t," {position: absolute;left: -24px;width: 12px;height: 12px;border-radius: 50%;z-index: 2;margin-top: 5px;}.cad-timeline_datetime",t," {font-size: 0.75rem;color: #706e6b;margin-bottom: 0.25rem;}.cad-timeline_content",t," {margin-bottom: 1rem;word-break: break-word;overflow-wrap: break-word;max-width: 100%;}.cad-timeline_title",t," {font-weight: bold;font-size: 0.875rem;}.cad-header_title",t," {display: flex;align-items: center;}.cad-header-titlebutton_more",t," {display: flex;justify-content: space-between;}.cad-sec_header-icons",t," {display: flex;align-items: center;}.follow-ups-title",t," {padding-left: 0.5rem;}.follow-ups-actions",t," {display: flex;align-items: center;}.cad-items_header",t," {display: flex;align-items: center;justify-content: space-between;}.blink-icon",t," {background: none;border: none;color: #0176d3;cursor: pointer;padding: 0.25rem;}.filter-dropdown",t," {position: relative;display: inline-block;}.filter-dropdown-content",t," {position: absolute;top: 100%;left: -88px;z-index: 1000;min-width: 120px;background-color: #ffffff;box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);border-radius: 4px;border: 1px solid #d8dde6;}.filter-option",t," {padding: 8px 12px;cursor: pointer;color: #333;transition: background-color 0.2s ease;}.filter-option:hover",t," {background-color: #f4f6f9;}.currentColor",t," {background-color: rgb(107, 56, 136);}.filter-option.active",t," {background-color: rgb(107, 56, 136);color: white;}.filter-option[data-active='true']",t," {background-color: rgb(107, 56, 136);color: white;}.button-group",t," {display: flex;}.btn",t," {border-radius: 0.25rem;padding: 0.5rem;cursor: pointer;font-size: 0.875rem;border: 1px solid #d8dde6;}.btn-icon",t," {width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;}.btn-first",t," {border-radius: 0.25rem 0 0 0.25rem;}.btn-middle",t," {border-radius: 0;border-left: none;color: rgb(107, 56, 136);}.btn-last",t," {border-radius: 0 0.25rem 0.25rem 0;border-left: none;}.btn-neutral",t," {background-color: #ffffff;color: #0176d3;}.btn-brand",t," {background-color: #0176d3;color: #ffffff;}.margin-right",t," {margin-right: 0.5rem;}.cad-sec_vcontainer2_2",t," {flex: 1;overflow: hidden;padding: 0.5rem;display: flex;flex-direction: column;}.scrollable-y",t," {overflow-y: auto;height: 100%;flex: 1;display: flex;flex-direction: column;}.content-container",t," {width: 100%;height: 100%;flex: 1;display: flex;flex-direction: column;}.spinner-container",t," {position: relative;height: 3rem;width: 100%;display: flex;align-items: center;justify-content: center;}.spinner",t," {height: 2rem;width: 2rem;border: 0.25rem solid #d8dde6;border-radius: 50%;border-top-color: #0176d3;animation: spin",o," 1s linear infinite;}.sr-only",t," {position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0, 0, 0, 0);border: 0;}@keyframes spin",o," {to {transform: rotate(360deg);}}@media (max-width: 768px) {.cad-row",t," {flex-direction: column;}.cad-cel",t," {width: 100%;}.cad-w230",t,",\r .cad-w300",t," {width: 100%;min-width: 100%;}.cad-pr8",t,",\r .cad-pl8",t," {padding: 0;margin-bottom: 0.5rem;}.hidden",t," {display: none;}}.cad-timeline-item",t," {padding: 0.75rem;border-radius: 0.25rem;position: relative;margin-bottom: 1rem;margin-left: 6px;width: calc(100% - 6px);box-sizing: border-box;overflow-wrap: break-word;display: flex;flex-direction: column;}.cad-timeline-item-review-completed",t," .cad-timeline_dot",t," {background-color: #2e844a;}.cad-timeline-item-in-review",t," .cad-timeline_dot",t," {background-color: #f5a623;}.cad-timeline-item-submitted",t," .cad-timeline_dot",t," {background-color: #2e844a;}.cad-timeline-item-need-more-information",t," .cad-timeline_dot",t," {background-color: #c9191b;}.cad-timeline-item-inprogress",t," .cad-timeline_dot",t," {background-color: #f5a623;}.cad-timeline-item-start-date",t," .cad-timeline_dot",t," {background-color: #706e6b;}.cad-timeline-item-review-completed",t," {background-color: #ebf7ee;}.cad-timeline-item-in-review",t," {background-color: #fff7e6;}.cad-timeline-item-submitted",t," {background-color: #ebf7ee;}.cad-timeline-item-need-more-information",t," {background-color: #fce5e5;}.cad-timeline-item-inprogress",t," {background-color: #fff7e6;}.cad-timeline-item-start-date",t," {background-color: #f3f2f2;}"].join("")}var li=[ay];function ny(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".scrollable-container",t," {height: calc(100vh - 150px);max-height: 600px;overflow-y: scroll;overflow-x: hidden;padding-right: 10px;position: relative;-webkit-overflow-scrolling: touch;}.section-container",t," {margin-bottom: 10px;border: 1px solid #e0e0e0;border-radius: 4px;background-color: #f8f8f8;}.section-header",t," {display: flex;justify-content: space-between;align-items: center;padding: 10px 15px;background-color: #f0f0ff;cursor: pointer;}.section-header-left",t," {display: flex;align-items: center;}.section-toggle-button",t," {background: none;border: none;cursor: pointer;padding: 0;margin-right: 8px;display: flex;align-items: center;justify-content: center;color: #444;}.section-toggle-button",t," svg",t," {transition: transform 0.2s ease;}.section-toggle-button.expanded",t," svg",t," {transform: rotate(90deg);}.section-title",t," {font-weight: bold;color: #333;}.section-stats",t," {display: flex;flex: 1;justify-content: flex-end;}.stats-container",t," {display: flex;flex-wrap: wrap;justify-content: flex-end;}.stat-item",t," {display: flex;flex-direction: column;align-items: center;margin-left: 20px;min-width: 60px;}.stat-label",t," {font-size: 0.75rem;color: #666;text-align: center;}.stat-value",t," {font-weight: bold;color: #333;}.questions-container",t," {padding: 15px;background-color: #fff;display: none;}.questions-container.visible",t," {display: block;}.question-item",t," {display: flex;margin-bottom: 15px;padding: 15px 10px;border-bottom: 1px solid #eaeaea;background-color: #ffffff;}.question-number",t," {flex: 0 0 20px;font-weight: bold;color: #444;margin-right: 10px;}.question-content",t," {flex: 1;}.question-text",t," {margin-bottom: 10px;font-weight: 500;font-size: 14px;color: #333;}.question-answer",t," {margin-bottom: 5px;margin-top: 10px;}.question-actions",t," {display: flex;align-items: center;}.required-indicator",t," {color: red;margin-right: 3px;display: inline-block;}.help-text-icon",t," {margin-left: 5px;color: #0070d2;cursor: help;}.assessment-wrapper",t," {display: flex;flex-direction: column;height: 100%;max-height: 100vh;position: relative;overflow: hidden;}.action-buttons",t," {display: flex;justify-content: flex-end;padding: 10px;margin-top: 10px;border-top: 1px solid #eaeaea;background-color: #ffffff;position: sticky;bottom: 0;z-index: 10;box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);}.margin-right",t," {margin-right: 10px;}.icon-small",t," {font-size: 0.8rem;}.icon-right-margin",t," {margin-right: 5px;display: inline-flex;align-items: center;}.icon-right-margin",t," svg",t," {color: #444;}.btn",t," {padding: 8px 16px;border-radius: 4px;font-weight: bold;cursor: pointer;border: none;}.btn-brand",t," {background-color: #0070d2;color: white;}.btn-neutral",t," {background-color: #f4f6f9;color: #16325c;border: 1px solid #d8dde6;}.btn-icon",t," {padding: 4px 8px;display: inline-flex;align-items: center;justify-content: center;}.btn-bare",t," {background: transparent;border: none;}.score-indicator",t," {display: inline-block;width: 20px;height: 20px;border-radius: 50%;background-color: #f0f0f0;color: #444;text-align: center;line-height: 20px;font-size: 0.8rem;margin-left: 5px;}.modal-overlay",t," {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);display: flex;justify-content: center;align-items: center;z-index: 9000;backdrop-filter: blur(4px);-webkit-backdrop-filter: blur(4px);}.modal-container",t," {background-color: white;border-radius: 4px;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);width: 90%;max-width: 400px;overflow: hidden;}.modal-header",t," {background-color: #f4f6f9;padding: 12px 20px;border-bottom: 1px solid #e0e0e0;}.error-header",t," {background-color: #ffdede;color: #c23934;text-align: center;}.error-modal",t," {border: 1px solid #c23934;}.modal-header",t," h2",t," {margin: 0;font-size: 18px;color: #16325c;}.modal-body",t," {padding: 20px;text-align: center;}.modal-footer",t," {padding: 12px 20px;border-top: 1px solid #e0e0e0;display: flex;justify-content: center;gap: 10px;}.loading-container",t," {display: flex;justify-content: center;align-items: center;height: 100%;min-height: 200px;}.loading-spinner",t," {border: 4px solid #f3f3f3;border-top: 4px solid #0070d2;border-radius: 50%;width: 40px;height: 40px;animation: spin",o," 1s linear infinite;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}@media (max-width: 768px) {.scrollable-container",t," {height: 90%;padding-right: 5px;}.section-header",t," {flex-direction: column;align-items: flex-start;}.section-header-left",t," {width: 100%;margin-bottom: 10px;}.section-stats",t," {width: 100%;overflow-x: auto;margin-top: 8px;}.stats-container",t," {width: 100%;display: grid;grid-template-columns: repeat(3, 1fr);gap: 8px;margin-left: 25px;padding-right: 10px;}.stat-item",t," {margin-left: 0;margin-bottom: 8px;}.question-item",t," {flex-direction: column;}.question-number",t," {margin-bottom: 5px;}.action-buttons",t," {padding: 8px;}.btn",t," {padding: 6px 12px;font-size: 0.85rem;}}"].join("")}var ci=[ny];function ry(n,e,s){var t=n?"["+n+"]":"";return[".temp_question_border-bottom",t," {margin-bottom: 15px;}.qactivelabelcont",t," {position: relative;}.question-grid",t," {display: flex;text-align: left;padding: 8px 12px 12px 12px;}.questionary-width",t," {width: 50px;text-align: right;flex-shrink: 0;}.questionary-number-grid",t," {flex: 1;}.question-wrap",t," {display: flex;flex-wrap: wrap;}.question-full-width",t," {width: 100%;}.question-form",t," {font-weight: 500;float: left;font-size: 14px;color: #333;}.no-wordbreak",t," {white-space: nowrap;}.help-text-icon",t," {display: inline-block;margin-left: 5px;color: #706e6b;cursor: pointer;}.score-indicator",t," {float: right;text-align: right;padding-left: 4px;margin-right: 4px;font-size: 12px;font-weight: bold;color: #0070d2;}.question-box",t," {display: flex;flex-wrap: wrap;}.questionary-variables-box-supplier",t," {display: flex;width: 100%;margin-top: 8px;justify-content: space-between;}.dx-customfix",t," {padding-top: 4px;}.questionary-capa-actions-box-supplier",t," {display: flex;width: 100%;margin-top: 8px;}.questionary-capa-actions",t," {align-items: center;}.questionary-capaAction",t," {display: flex;width: 100%;}.questionary-variables-box",t," {margin-left: 8px;}.input-field",t,",\r.textarea-field",t,",\r.select-field",t,",\r.combobox-field",t," {width: 100%;padding: 8px 12px;border: 1px solid #d8dde6;border-radius: 4px;font-size: 14px;height: 38px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);}.textarea-field",t," {min-height: 80px;height: auto;resize: vertical;}.input-field:focus",t,",\r.textarea-field:focus",t,",\r.select-field:focus",t,",\r.combobox-field:focus",t," {outline: none;border-color: #0070d2;box-shadow: 0 0 3px #0070d2;}.dual-listbox",t," {display: flex;flex-direction: row;border: 1px solid #d8dde6;border-radius: 4px;padding: 10px;gap: 10px;}.dual-listbox-column",t," {flex: 1;display: flex;flex-direction: column;}.dual-listbox-title",t," {font-size: 12px;font-weight: 500;margin-bottom: 5px;color: #514f4d;}.dual-listbox",t," select",t," {height: 150px;margin-bottom: 10px;border: 1px solid #d8dde6;border-radius: 4px;}.dual-listbox-controls",t," {display: flex;flex-direction: column;justify-content: center;gap: 8px;}.dual-listbox-button",t," {padding: 6px;border-radius: 4px;cursor: pointer;border: 1px solid #d8dde6;background-color: #fff;color: #0070d2;width: 32px;height: 32px;display: flex;align-items: center;justify-content: center;}.mobile-button",t," {display: none;}@media (max-width: 768px) {.desktop-button",t," {display: none;}.mobile-button",t," {display: flex;}}.dual-listbox-button:hover",t," {background-color: #f4f6f9;}.dual-listbox-button:disabled",t," {color: #d8dde6;cursor: not-allowed;}@media (max-width: 768px) {.dual-listbox",t," {flex-direction: column;}.dual-listbox-controls",t," {flex-direction: row;margin: 10px 0;}}.checkbox-container",t,",\r.radio-container",t," {display: flex;align-items: center;margin-bottom: 8px;}.checkbox-label",t,",\r.radio-label",t," {margin-left: 8px;font-size: 14px;}.button",t," {padding: 8px 12px;border-radius: 4px;cursor: pointer;border: 1px solid transparent;font-size: 13px;display: inline-flex;align-items: center;justify-content: center;margin-right: 4px;}.button-neutral",t," {background-color: #fff;border-color: #d8dde6;color: #0070d2;}.button-brand",t," {background-color: #0070d2;color: white;}.button-destructive",t," {background-color: #c23934;color: white;}.button-icon",t," {padding: 6px;width: 50px;height: 32px;display: flex;align-items: center;justify-content: center;}.button-group",t," {display: flex;align-items: center;width: 100%;justify-content: space-evenly;}.icon",t," {width: 16px;height: 16px;display: inline-block;}.icon-close",t,"::before {content: '\u2715';}.icon-check",t,"::before {content: '\u2713';}.icon-comments",t," {display: inline-flex;align-items: center;justify-content: center;width: 16px;height: 16px;}.button-chat-colored",t," {background-color: rgb(107, 56, 136);color: white;border-color: rgb(107, 56, 136);}.button-chat-colored",t," .icon-comments",t," svg",t," {fill: white;}.icon-file",t," {display: inline-flex;align-items: center;justify-content: center;width: 16px;height: 16px;vertical-align: middle;}.icon-paperclip",t," {display: inline-flex;align-items: center;justify-content: center;width: 16px;height: 16px;vertical-align: middle;}.icon-paperclip-required",t," {display: inline-flex;align-items: center;justify-content: center;width: 16px;height: 16px;vertical-align: middle;color: #c23934;}.icon-paperclip-present",t," {display: inline-flex;align-items: center;justify-content: center;width: 16px;height: 16px;vertical-align: middle;color: #706e6b;}.icon-paperclip-optional",t," {display: inline-flex;align-items: center;justify-content: center;width: 16px;height: 16px;vertical-align: middle;color: #706e6b;}.flag-icon",t," {cursor: pointer;}.flag-icon-red",t," {color: red;}.flag-icon-normal",t," {color: #5c5c5c;}.icon-help",t,"::before {content: '?';}.icon-gauge",t," {display: inline-flex;width: 16px;height: 16px;vertical-align: middle;align-items: center;justify-content: center;margin-right: 2px;}.icon-count",t," {font-size: 10px;background: #f2f2f2;border-radius: 50%;width: 16px;height: 16px;display: inline-flex;align-items: center;justify-content: center;margin-left: 2px;}.required-indicator",t," {color: red;margin-right: 3px;display: inline-block;}.cib-flag",t," {color: #c23934;}.cib-forward",t," {color: #706e6b;}.cib-forward:hover",t," {color: #c23934;}.cib-score",t," {font-size: 12px;font-weight: bold;color: #1b2d4f;margin-left: 2px;}.status-icon",t," {display: flex;align-items: center;justify-content: center;width: 35px;height: 30px;border-radius: 50%;margin: 4px 0;}.status-success",t," {background-color: rgb(129 251 133);color: rgb(107, 56, 136);}.status-reject",t," {background-color: rgb(251 129 129);color: rgb(107, 56, 136);}.temp_dashed-border-top",t," {margin-top: 10px;padding-top: 10px;}.child-questions-container",t," {margin-top: 15px;max-height: 600px;overflow-y: auto;padding-left: 50px;}@media (max-width: 1024px) {.question-grid",t," {flex-direction: column;padding: 8px 8px 12px 8px;}.questionary-width",t," {width: 100%;text-align: left;margin-bottom: 5px;}.questionary-number-grid",t," {width: 100%;}.question-full-width",t," {width: 100%;}.input-field",t,",\r .textarea-field",t,",\r .select-field",t,",\r .combobox-field",t," {width: calc(100% - 16px);margin: 0px;box-sizing: border-box;}.dual-listbox",t," {flex-direction: column;}.dual-listbox-controls",t," {flex-direction: row;justify-content: center;margin: 10px 0;}.questionary-variables-box-supplier",t," {flex-direction: column;width: calc(100% - 16px);margin: 0px;}.questionary-capaAction",t," {margin-top: 10px;}.button-group",t," {flex-wrap: wrap;justify-content: flex-start;margin-top: 10px;}.button",t," {margin-bottom: 8px;}.child-questions-container",t," {padding-left: 20px;}.col-bump-left",t," {margin-top: 10px;width: 100%;}}"].join("")}var di=[ry];const ly=p`<div class="questionary-width${0}"${2}><span class="question-form no-wordbreak${0}"${2}>${"t2"}</span></div>`,cy=p`<span class="required-indicator${0}"${2}>*</span>`,dy=p`<span class="help-text-icon${0}"${"a0:title"}${2}><svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor"${3}><path d="M7 1.1c3.3 0 5.9 2.6 5.9 5.9s-2.6 5.9-5.9 5.9S1.1 10.3 1.1 7 3.7 1.1 7 1.1zM7 0C3.1 0 0 3.1 0 7s3.1 7 7 7 7-3.1 7-7-3.1-7-7-7z"${3}/><path d="M7 9.8c-.4 0-.7-.3-.7-.7V7.7c0-.4.3-.7.7-.7.4 0 .7.3.7.7v1.4c0 .4-.3.7-.7.7zM7 5.6c-.4 0-.7-.3-.7-.7v-.1c0-.4.3-.7.7-.7.4 0 .7.3.7.7v.1c0 .4-.3.7-.7.7z"${3}/></svg></span>`,hy=p`<textarea class="textarea-field${0}"${"a0:name"}${"a0:data-key"}${"a0:data-con"}${"a0:disabled"}${"a0:value"}${2}>${"t1"}</textarea>`,uy=p`<option value${3}>--Select--</option>`,py=p`<option${"a0:value"}${3}>${"t1"}</option>`,fy=p`<div class="dual-listbox-title${0}"${2}>Available Options</div>`,my=p`<option${"a0:value"}${3}>${"t1"}</option>`,gy=p`<div class="dual-listbox-controls${0}"${2}><button type="button" class="dual-listbox-button desktop-button${0}"${"a1:data-key"} data-action="moveToSelected"${"a1:disabled"}${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="16px" width="16px"${3}><path d="M192 128l128 128-128 128z"${3}/></svg></button><button type="button" class="dual-listbox-button mobile-button${0}"${"a4:data-key"} data-action="moveToSelected"${"a4:disabled"}${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="16px" width="16px"${3}><path d="M128 192l128 128 128-128z"${3}/></svg></button><button type="button" class="dual-listbox-button desktop-button${0}"${"a7:data-key"} data-action="moveToAvailable"${"a7:disabled"}${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="16px" width="16px"${3}><path d="M320 128L192 256l128 128z"${3}/></svg></button><button type="button" class="dual-listbox-button mobile-button${0}"${"a10:data-key"} data-action="moveToAvailable"${"a10:disabled"}${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="16px" width="16px"${3}><path d="M128 320l128-128 128 128z"${3}/></svg></button></div>`,_y=p`<div class="dual-listbox-title${0}"${2}>Selected Options</div>`,by=p`<option${"a0:value"}${3}>${"t1"}</option>`,yy=p`<label class="radio-label${0}"${"a0:for"}${2}>${"t1"}</label>`,vy=p`<div class="status-icon status-reject${0}"${2}><svg viewBox="0 0 128 128" width="128px" height="128px"${3}><path d="M 64 6 C 48.5 6 33.9 12 23 23 C 12 33.9 6 48.5 6 64 C 6 79.5 12 94.1 23 105 C 34 116 48.5 122 64 122 C 79.5 122 94.1 116 105 105 C 116 94 122 79.5 122 64 C 122 48.5 116 33.9 105 23 C 94.1 12 79.5 6 64 6 z M 64 12 C 77.9 12 90.900781 17.399219 100.80078 27.199219 C 110.70078 36.999219 116 50.1 116 64 C 116 77.9 110.60078 90.900781 100.80078 100.80078 C 90.900781 110.60078 77.9 116 64 116 C 50.1 116 37.099219 110.60078 27.199219 100.80078 C 17.299219 91.000781 12 77.9 12 64 C 12 50.1 17.399219 37.099219 27.199219 27.199219 C 36.999219 17.299219 50.1 12 64 12 z M 50.5625 47.5 C 49.8 47.5 49.05 47.800391 48.5 48.400391 C 47.3 49.600391 47.3 51.499609 48.5 52.599609 L 59.800781 64 L 48.400391 75.300781 C 47.200391 76.500781 47.200391 78.4 48.400391 79.5 C 49.000391 80.1 49.8 80.400391 50.5 80.400391 C 51.2 80.400391 51.999609 80.1 52.599609 79.5 L 64 68.199219 L 75.300781 79.5 C 75.900781 80.1 76.700391 80.400391 77.400391 80.400391 C 78.100391 80.400391 78.9 80.1 79.5 79.5 C 80.7 78.3 80.7 76.400781 79.5 75.300781 L 68.199219 64 L 79.5 52.699219 C 80.7 51.499219 80.699609 49.600391 79.599609 48.400391 C 78.399609 47.200391 76.500391 47.200391 75.400391 48.400391 L 64 59.800781 L 52.699219 48.400391 C 52.099219 47.800391 51.325 47.5 50.5625 47.5 z"${3}/></svg></div>`,wy=p`<div class="status-icon status-success${0}"${2}><svg viewBox="0 0 128 128" width="128px" height="128px"${3}><path d="M 64 6 C 32 6 6 32 6 64 C 6 96 32 122 64 122 C 96 122 122 96 122 64 C 122 32 96 6 64 6 z M 64 12 C 92.7 12 116 35.3 116 64 C 116 92.7 92.7 116 64 116 C 35.3 116 12 92.7 12 64 C 12 35.3 35.3 12 64 12 z M 85.037109 48.949219 C 84.274609 48.974219 83.500391 49.300391 82.900391 49.900391 L 62 71.599609 L 51.099609 59.900391 C 49.999609 58.700391 48.100391 58.599219 46.900391 59.699219 C 45.700391 60.799219 45.599219 62.700391 46.699219 63.900391 L 59.800781 78 C 60.400781 78.6 61.1 79 62 79 C 62.8 79 63.599219 78.699609 64.199219 78.099609 L 87.199219 54 C 88.299219 52.8 88.299609 50.900781 87.099609 49.800781 C 86.549609 49.200781 85.799609 48.924219 85.037109 48.949219 z"${3}/></svg></div>`,xy=p`<button class="button button-icon button-chat-colored${0}" title="Comments"${"a0:data-id"}${2}><span class="icon icon-comments${0}"${2}><svg width="16" height="16" viewBox="0 0 32 32" fill="white" stroke-width="0"${3}><path d="M 2 5 L 2 21 L 6 21 L 6 26.09375 L 7.625 24.78125 L 12.34375 21 L 22 21 L 22 5 Z M 4 7 L 20 7 L 20 19 L 11.65625 19 L 11.375 19.21875 L 8 21.90625 L 8 19 L 4 19 Z M 24 9 L 24 11 L 28 11 L 28 23 L 24 23 L 24 25.90625 L 20.34375 23 L 12.84375 23 L 10.34375 25 L 19.65625 25 L 26 30.09375 L 26 25 L 30 25 L 30 9 Z"${3}/></svg></span></button>`,ky=p`<button class="button button-neutral button-icon${0}" title="Comments"${"a0:data-id"}${2}><span class="icon icon-comments${0}"${2}><svg width="16" height="16" viewBox="0 0 32 32" fill="#1b2d4f" stroke-width="0"${3}><path d="M 2 5 L 2 21 L 6 21 L 6 26.09375 L 7.625 24.78125 L 12.34375 21 L 22 21 L 22 5 Z M 4 7 L 20 7 L 20 19 L 11.65625 19 L 11.375 19.21875 L 8 21.90625 L 8 19 L 4 19 Z M 24 9 L 24 11 L 28 11 L 28 23 L 24 23 L 24 25.90625 L 20.34375 23 L 12.84375 23 L 10.34375 25 L 19.65625 25 L 26 30.09375 L 26 25 L 30 25 L 30 9 Z"${3}/></svg></span></button>`,$y=p`<button class="button button-chat-colored button-icon${0}" title="Action Item"${"a0:data-id"}${2}><span class="icon icon-file${0}"${2}><svg width="16" height="16" viewBox="0 0 32 32" fill="white" stroke-width="0"${3}><path d="M 6 3 L 6 29 L 26 29 L 26 9.5996094 L 25.699219 9.3007812 L 19.699219 3.3007812 L 19.400391 3 L 6 3 z M 8 5 L 18 5 L 18 11 L 24 11 L 24 27 L 8 27 L 8 5 z M 20 6.4003906 L 22.599609 9 L 20 9 L 20 6.4003906 z M 10 13 L 10 15 L 22 15 L 22 13 L 10 13 z M 10 18 L 10 20 L 17 20 L 17 18 L 10 18 z M 19 18 L 19 20 L 22 20 L 22 18 L 19 18 z M 10 22 L 10 24 L 17 24 L 17 22 L 10 22 z M 19 22 L 19 24 L 22 24 L 22 22 L 19 22 z"${3}/></svg></span></button>`,Cy=p`<button class="button button-neutral button-icon${0}" title="Action Item"${"a0:data-id"}${2}><span class="icon icon-file${0}"${2}><svg width="16" height="16" viewBox="0 0 32 32" fill="#1b2d4f" stroke-width="0"${3}><path d="M 6 3 L 6 29 L 26 29 L 26 9.5996094 L 25.699219 9.3007812 L 19.699219 3.3007812 L 19.400391 3 L 6 3 z M 8 5 L 18 5 L 18 11 L 24 11 L 24 27 L 8 27 L 8 5 z M 20 6.4003906 L 22.599609 9 L 20 9 L 20 6.4003906 z M 10 13 L 10 15 L 22 15 L 22 13 L 10 13 z M 10 18 L 10 20 L 17 20 L 17 18 L 10 18 z M 19 18 L 19 20 L 22 20 L 22 18 L 19 18 z M 10 22 L 10 24 L 17 24 L 17 22 L 10 22 z M 19 22 L 19 24 L 22 24 L 22 22 L 19 22 z"${3}/></svg></span></button>`,Sy=p`<button class="button button-chat-colored button-icon${0}" title="Attachments (Present)"${"a0:data-id"}${2}><span class="icon icon-paperclip-present${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" fill="white" stroke-width="0"${3}><path d="M19.187 3.588a2.75 2.75 0 0 0-3.889 0L5.575 13.31a4.5 4.5 0 0 0 6.364 6.364l8.662-8.662a.75.75 0 0 1 1.061 1.06L13 20.735a6 6 0 0 1-8.485-8.485l9.723-9.723a4.247 4.247 0 0 1 4.124-1.139a4.247 4.247 0 0 1 3.025 3.025 4.247 4.247 0 0 1-1.139 4.124l-9.193 9.193a2.64 2.64 0 0 1-1.858.779 2.626 2.626 0 0 1-1.854-.779c-.196-.196-.338-.47-.43-.726a2.822 2.822 0 0 1-.168-.946c0-.7.284-1.373.775-1.864l8.132-8.131a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734l-8.131 8.132a1.148 1.148 0 0 0-.336.803c.003.204.053.405.146.587.01.018.018.028.02.032.22.215.501.332.786.332.29 0 .58-.121.798-.34l9.192-9.192a2.75 2.75 0 0 0 0-3.89Z"${3}/></svg></span></button>`,Ey=p`<button class="button button-neutral button-icon${0}" title="Attachments (Required)"${"a0:data-id"}${2}><span class="icon icon-paperclip-required${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" fill="#c23934" stroke-width="0"${3}><path d="M19.187 3.588a2.75 2.75 0 0 0-3.889 0L5.575 13.31a4.5 4.5 0 0 0 6.364 6.364l8.662-8.662a.75.75 0 0 1 1.061 1.06L13 20.735a6 6 0 0 1-8.485-8.485l9.723-9.723a4.247 4.247 0 0 1 4.124-1.139a4.247 4.247 0 0 1 3.025 3.025 4.247 4.247 0 0 1-1.139 4.124l-9.193 9.193a2.64 2.64 0 0 1-1.858.779 2.626 2.626 0 0 1-1.854-.779c-.196-.196-.338-.47-.43-.726a2.822 2.822 0 0 1-.168-.946c0-.7.284-1.373.775-1.864l8.132-8.131a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734l-8.131 8.132a1.148 1.148 0 0 0-.336.803c.003.204.053.405.146.587.01.018.018.028.02.032.22.215.501.332.786.332.29 0 .58-.121.798-.34l9.192-9.192a2.75 2.75 0 0 0 0-3.89Z"${3}/></svg></span></button>`,Ry=p`<button class="button button-neutral button-icon${0}" title="Attachments (Optional)"${"a0:data-id"}${2}><span class="icon icon-paperclip-optional${0}"${2}><svg width="16" height="16" viewBox="0 0 24 24" fill="#706e6b" stroke-width="0"${3}><path d="M19.187 3.588a2.75 2.75 0 0 0-3.889 0L5.575 13.31a4.5 4.5 0 0 0 6.364 6.364l8.662-8.662a.75.75 0 0 1 1.061 1.06L13 20.735a6 6 0 0 1-8.485-8.485l9.723-9.723a4.247 4.247 0 0 1 4.124-1.139 4.247 4.247 0 0 1 3.025 3.025 4.247 4.247 0 0 1-1.139 4.124l-9.193 9.193a2.64 2.64 0 0 1-1.858.779 2.626 2.626 0 0 1-1.854-.779c-.196-.196-.338-.47-.43-.726a2.822 2.822 0 0 1-.168-.946c0-.7.284-1.373.775-1.864l8.132-8.131a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734l-8.131 8.132a1.148 1.148 0 0 0-.336.803c.003.204.053.405.146.587.01.018.018.028.02.032.22.215.501.332.786.332.29 0 .58-.121.798-.34l9.192-9.192a2.75 2.75 0 0 0 0-3.89Z"${3}/></svg></span></button>`,Ay=p`<button class="button button-neutral button-icon${0}" title="Score"${"a0:data-id"}${2}><span class="icon icon-gauge${0}"${2}><svg width="16" height="16" viewBox="0 0 32 32" fill="#1b2d4f" stroke-width="0"${3}><path d="M 16 6 C 9.382813 6 4 11.382813 4 18 C 4 20.894531 5.035156 23.550781 6.75 25.625 L 7.03125 26 L 24.96875 26 L 25.25 25.625 C 26.964844 23.550781 28 20.894531 28 18 C 28 11.382813 22.617188 6 16 6 Z M 16 8 C 21.535156 8 26 12.464844 26 18 C 26 20.265625 25.207031 22.324219 23.9375 24 L 8.0625 24 C 6.792969 22.324219 6 20.265625 6 18 C 6 12.464844 10.464844 8 16 8 Z M 16 9 C 15.449219 9 15 9.449219 15 10 C 15 10.550781 15.449219 11 16 11 C 16.550781 11 17 10.550781 17 10 C 17 9.449219 16.550781 9 16 9 Z M 12 10.0625 C 11.449219 10.0625 11 10.511719 11 11.0625 C 11 11.613281 11.449219 12.0625 12 12.0625 C 12.550781 12.0625 13 11.613281 13 11.0625 C 13 10.511719 12.550781 10.0625 12 10.0625 Z M 20 10.0625 C 19.449219 10.0625 19 10.511719 19 11.0625 C 19 11.613281 19.449219 12.0625 20 12.0625 C 20.550781 12.0625 21 11.613281 21 11.0625 C 21 10.511719 20.550781 10.0625 20 10.0625 Z M 9.0625 13 C 8.511719 13 8.0625 13.449219 8.0625 14 C 8.0625 14.550781 8.511719 15 9.0625 15 C 9.613281 15 10.0625 14.550781 10.0625 14 C 10.0625 13.449219 9.613281 13 9.0625 13 Z M 22.65625 13.03125 L 17 16.28125 C 16.707031 16.109375 16.363281 16 16 16 C 14.894531 16 14 16.894531 14 18 C 14 19.105469 14.894531 20 16 20 C 17.09375 20 17.984375 19.121094 18 18.03125 C 18 18.019531 18 18.011719 18 18 L 23.65625 14.78125 Z M 8 17 C 7.449219 17 7 17.449219 7 18 C 7 18.550781 7.449219 19 8 19 C 8.550781 19 9 18.550781 9 18 C 9 17.449219 8.550781 17 8 17 Z M 24 17 C 23.449219 17 23 17.449219 23 18 C 23 18.550781 23.449219 19 24 19 C 24.550781 19 25 18.550781 25 18 C 25 17.449219 24.550781 17 24 17 Z M 9.0625 21 C 8.511719 21 8.0625 21.449219 8.0625 22 C 8.0625 22.550781 8.511719 23 9.0625 23 C 9.613281 23 10.0625 22.550781 10.0625 22 C 10.0625 21.449219 9.613281 21 9.0625 21 Z M 22.9375 21 C 22.386719 21 21.9375 21.449219 21.9375 22 C 21.9375 22.550781 22.386719 23 22.9375 23 C 23.488281 23 23.9375 22.550781 23.9375 22 C 23.9375 21.449219 23.488281 21 22.9375 21 Z"${3}/></svg></span><span class="cib-score${0}"${2}>${"t5"}</span></button>`,Iy=p`<svg class="flag-icon flag-icon-red${0}" width="16" height="16" viewBox="0 0 24 24" fill="red" stroke="red" stroke-width="2"${2}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"${3}/><line x1="4" y1="22" x2="4" y2="15"${3}/></svg>`,Fy=p`<svg class="flag-icon flag-icon-normal${0}" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#5c5c5c" stroke-width="2"${2}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"${3}/><line x1="4" y1="22" x2="4" y2="15"${3}/></svg>`,Dy={"temp_question_border-bottom":!0},Ty={qactivelabelcont:!0},Oy={classMap:{"question-grid":!0},key:2},Ly={classMap:{"questionary-number-grid":!0},key:5},Ny={classMap:{"question-wrap":!0},key:6},My={"question-full-width":!0},Py={classMap:{"question-form":!0},key:8},jy={classMap:{"question-full-width":!0,"dx-customfix":!0},key:13},Uy={classMap:{"question-box":!0},key:14},Vy={classMap:{"questionary-variables-box-supplier":!0},key:15},qy={key:16},Oe={"input-field":!0},zy={classMap:{"select-container":!0},key:20},As={"select-field":!0},Wy={classMap:{"dual-listbox":!0},key:26},By={classMap:{"dual-listbox-column":!0},key:27},Is=[],Hy={classMap:{"dual-listbox-column":!0},key:35},Jy={classMap:{"checkbox-container":!0},key:41},Qy={"radio-container":!0},Yy={classMap:{"input-with-addon":!0},key:51},Ky={classMap:{"input-with-addon":!0},key:54},Gy={classMap:{"col-bump-left":!0},key:56},Xy={classMap:{"button-group":!0},key:57},Zy={classMap:{"question-full-width":!0},key:58},e0={classMap:{"questionary-capaAction":!0},key:63},t0={classMap:{"button-group":!0},key:64},s0={classMap:{"question-full-width":!0},key:81},o0={classMap:{"temp_dashed-border-top":!0},key:86};function it(n,e,s,t){const{k:o,b:i,d:a,sp:r,st:l,t:c,h:d,i:h,f:u,gid:f,c:g}=n,{_m0:_,_m1:m,_m2:x,_m3:k,_m4:$,_m5:S,_m6:O,_m7:F,_m8:D,_m9:v,_m10:A,_m11:w,_m12:y,_m13:C,_m14:I,_m15:L,_m16:N,_m17:T,_m18:q,_m19:te,_m20:pe,_m21:Ne,_m22:fe,_m23:Ce,_m24:_e,_m25:Se,_m26:xe,_m27:Ee,_m28:be,_m29:Re,_m30:ye,_m31:ke,_m32:M,_m33:ve}=t;return h(e.questionsList,function(E){return E.isDisplay?d("div",{classMap:Dy,key:o(0,E.id)},[d("div",{classMap:Ty,attrs:{"data-id":E.id,"data-disable":E.isNoEditable,"data-response":E.responseId,"data-showupload":E.showUpload},key:1,on:_||(t._m0={mousedown:i(e.handleQuestionHighlight)})},[d("div",Oy,[l(ly,4,[r(2,null,a(E.number)+".")]),d("div",Ly,[d("div",Ny,[d("div",{classMap:My,attrs:{"data-id":E.id},key:7,on:m||(t._m1={click:i(e.handleQuestionClick)})},[d("span",Py,[E.required?l(cy,10):null,c(a(E.text))]),E.helpText?l(dy,12,[r(0,{attrs:{title:E.helpText}},null)]):null]),d("div",jy,[d("div",Uy,[d("div",Vy,[d("div",qy,u([E.isText?d("input",{classMap:Oe,attrs:{type:"text",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:17,on:x||(t._m2={change:i(e.handleTextChange)})}):null,E.isTextArea?l(hy,19,[r(0,{on:$||(t._m4={change:i(e.handleTextChange)}),attrs:{name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null,value:E.response}},null),r(1,null,a(E.response))]):null,E.isPicklist?d("div",zy,[d("select",{classMap:As,attrs:{name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null,value:E.response},key:21,on:S||(t._m5={change:i(e.handleTextChange)})},u([l(uy,23),h(E.options,function(P){return l(py,o(25,P),[r(0,{attrs:{value:P}},null),r(1,null,a(P))])})]))]):null,E.isMultiPicklist?d("div",Wy,[d("div",By,[l(fy,29),d("select",{classMap:As,attrs:{multiple:"",name:E.id,"data-key":E.id,"data-type":"available",disabled:E.isNoEditable?"":null},key:30},E.availableOptions?h(E.availableOptions,function(P){return l(my,o(32,P),[r(0,{attrs:{value:P}},null),r(1,null,a(P))])}):Is)]),l(gy,34,[r(1,{on:O||(t._m6={click:i(e.handleMoveToSelected)}),attrs:{"data-key":E.id,disabled:E.isNoEditable?"":null}},null),r(4,{on:F||(t._m7={click:i(e.handleMoveToSelected)}),attrs:{"data-key":E.id,disabled:E.isNoEditable?"":null}},null),r(7,{on:D||(t._m8={click:i(e.handleMoveToAvailable)}),attrs:{"data-key":E.id,disabled:E.isNoEditable?"":null}},null),r(10,{on:v||(t._m9={click:i(e.handleMoveToAvailable)}),attrs:{"data-key":E.id,disabled:E.isNoEditable?"":null}},null)]),d("div",Hy,[l(_y,37),d("select",{classMap:As,attrs:{multiple:"",name:E.id,"data-key":E.id,"data-type":"selected","data-con":E.conditional,disabled:E.isNoEditable?"":null},key:38},E.selectedOptions?h(E.selectedOptions,function(P){return l(by,o(40,P),[r(0,{attrs:{value:P}},null),r(1,null,a(P))])}):Is)])]):null,E.isCheckbox?d("div",Jy,[d("input",{attrs:{type:"checkbox",id:f(E.id),name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{checked:E.response,value:E.response},key:42,on:A||(t._m10={change:i(e.handleCheckboxChange)})})]):null,E.isRadio?h(E.options,function(P){return d("div",{classMap:Qy,key:o(43,P)},[d("input",{attrs:{type:"radio",id:f(P),name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:44,on:w||(t._m11={change:i(e.handleRadioChange)})}),l(yy,46,[r(0,{attrs:{for:f(P)}},null),r(1,null,a(P))])])}):Is,E.isDate?d("input",{classMap:Oe,attrs:{type:"date",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:47,on:y||(t._m12={change:i(e.handleDateChange)})}):null,E.isDateTime?d("input",{classMap:Oe,attrs:{type:"datetime-local",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:48,on:C||(t._m13={change:i(e.handleDateTimeChange)})}):null,E.isEmail?d("input",{classMap:Oe,attrs:{type:"email",placeholder:"Enter email",pattern:".+@example\\.com",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:49,on:I||(t._m14={change:i(e.handleTextChange)})}):null,E.isNumber?d("input",{classMap:Oe,attrs:{type:"number",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:50,on:L||(t._m15={change:i(e.handleTextChange)})}):null,E.isCurrency?d("div",Yy,[d("input",{classMap:Oe,attrs:{type:"number",step:"0.01",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:52,on:N||(t._m16={change:i(e.handleTextChange)})})]):null,E.isPhone?d("input",{classMap:Oe,attrs:{type:"tel",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:53,on:T||(t._m17={change:i(e.handleTextChange)})}):null,E.isPercent?d("div",Ky,[d("input",{classMap:Oe,attrs:{type:"number",step:"0.01",name:E.id,"data-key":E.id,"data-con":E.conditional,disabled:E.isNoEditable?"":null},props:{value:E.response},key:55,on:q||(t._m18={change:i(e.handleTextChange)})})]):null])),d("div",Gy,[d("div",Xy,[E.showRejectFlag?d("div",Zy,[E.isRejected?l(vy,60):null,E.isRejected?null:l(wy,62)]):null,d("div",e0,[d("div",t0,[E.showCapaActions&&E.showConversationHistoryChatColor?l(xy,66,[r(0,{on:pe||(t._m20={click:i(e.handleCommentsClick)}),attrs:{"data-id":E.id}},null)]):null,E.showCapaActions?E.showConversationHistoryChatColor?null:l(ky,68,[r(0,{on:fe||(t._m22={click:i(e.handleCommentsClick)}),attrs:{"data-id":E.id}},null)]):null,E.isFinding?l($y,70,[r(0,{on:_e||(t._m24={click:i(e.handleActionItemsClick)}),attrs:{"data-id":E.id}},null)]):null,E.isFinding?null:l(Cy,72,[r(0,{on:xe||(t._m26={click:i(e.handleActionItemsClick)}),attrs:{"data-id":E.id}},null)]),E.isFilePresent?l(Sy,74,[r(0,{on:be||(t._m28={click:i(e.handleAttachmentsClick)}),attrs:{"data-id":E.id}},null)]):null,E.isFilePresent?null:E.isFileRequired?l(Ey,76,[r(0,{on:ye||(t._m30={click:i(e.handleAttachmentsClick)}),attrs:{"data-id":E.id}},null)]):null,E.isFilePresent||E.isFileRequired?null:E.isOptionalFileUpload?l(Ry,78,[r(0,{on:M||(t._m32={click:i(e.handleAttachmentsClick)}),attrs:{"data-id":E.id}},null)]):null,l(Ay,80,[r(0,{attrs:{"data-id":E.id}},null),r(5,null,a(E.score))])])]),d("div",s0,[E.isFlagged?l(Iy,83):null,E.isFlagged?null:l(Fy,85)])])])])])])])])])]),E.children&&E.isShowChildQuestions?d("div",o0,[g("c-rtmvpc-render-question-template",ui,{props:{questionsList:E.children,visibleChildQuestions:e.visibleChildQuestions,responseData:e.responseData,recordId:e.recordId,responseAttributes:e.responseAttributes},key:87,on:ve||(t._m33={responsechange:i(e.handleResponseChange),fileclick:i(e.handleFileClick),commentclick:i(e.handleCommentClick),optionsmove:i(e.handleResponseChange)})})]):null]):null})}var i0=J(it);it.stylesheets=[],it.stylesheetToken="lwc-792bt581ogu",it.legacyStylesheetToken="c-rtmvpcRenderQuestionTemplate_rtmvpcRenderQuestionTemplate",di&&it.stylesheets.push.apply(it.stylesheets,di),Q(it);class hi extends K{constructor(...e){super(...e);this.questionData=void 0,this.questionsList=void 0,this.visibleChildQuestions={},this.responses=void 0,this.responseData=void 0,this.recordId=void 0,this.responseAttributes=void 0,this.showDropdown=!1,this.questionResponses={},this.selectedMultiOptions={},this.availableOptionsMap={},this.dateValues={},this.dateTimeValues={},this.isChecked=!1}get isBooleanCheckbox(){const e=this.questionData||{};return e.isCheckbox&&e.options&&Array.isArray(e.options)&&e.options.includes("true")}get hasChildQuestions(){return this.questionData&&this.questionData.children&&this.questionData.children.length>0}get visibleChildQuestionsList(){return this.hasChildQuestions?this.questionData.children.filter(e=>this.visibleChildQuestions[e.id]===!0):[]}connectedCallback(){try{this.initializeValues()}catch(e){console.error("Error in connectedCallback:",e),this.selectedOption="",this.selectedMultiOptions=[],this.dateValue="",this.dateTimeValue=""}}initializeValues(){this.questionsList&&Array.isArray(this.questionsList)&&this.questionsList.forEach(e=>{this.initializeQuestionValue(e)}),this.questionData&&this.initializeQuestionValue(this.questionData)}initializeQuestionValue(e){if(!e)return;const s=e.id;if(console.log("Initializing values for question:",s,"type:",e.type),e.response||e.value){const t=e.response||e.value;if(e.isMultiPicklist)this.initializeMultiSelect(s,t);else if(e.isDate){const o=t;if(o&&o.includes("/")){const i=o.split("/");this.dateValues[s]=`${i[2]}-${i[0].padStart(2,"0")}-${i[1].padStart(2,"0")}`}else this.dateValues[s]=o;console.log("Set date value for",s,":",this.dateValues[s])}else if(e.isDateTime){const o=t;try{const i=new Date(o);isNaN(i.getTime())?this.dateTimeValues[s]=o:this.dateTimeValues[s]=i.toISOString().slice(0,16)}catch(i){this.dateTimeValues[s]=o}console.log("Set datetime value for",s,":",this.dateTimeValues[s])}else this.questionResponses[s]=t}else this.questionResponses[s]="",this.selectedMultiOptions[s]=[],this.dateValues[s]="",this.dateTimeValues[s]=""}initializeMultiSelect(e,s){const t=this.findQuestionById(e);if(!!t){if(this.selectedMultiOptions[e]||(this.selectedMultiOptions[e]=[]),t.selectedOptions&&Array.isArray(t.selectedOptions))this.selectedMultiOptions[e]=t.selectedOptions,this.questionResponses[e]=t.selectedOptions.join(",");else{let o=[];Array.isArray(s)?o=s:typeof s=="string"&&(s.includes(",")?o=s.split(","):s&&(o=[s])),this.selectedMultiOptions[e]=o,this.questionResponses[e]=o.join(",")}console.log("Initialized multi-select for",e,"with options:",this.selectedMultiOptions[e])}}handleQuestionClick(e){const s=e.currentTarget.dataset.id;console.log("Question clicked:",s),this.dispatchEvent(new CustomEvent("questionclick",{detail:{questionId:s},bubbles:!0}))}handleQuestionHighlight(e){const s=e.currentTarget.dataset.id,t=e.currentTarget.dataset.disable==="true",o=e.currentTarget.dataset.response,i=e.currentTarget.dataset.showupload==="true";console.log("Question highlight:",s,t,o,i),this.dispatchEvent(new CustomEvent("questionhighlight",{detail:{questionId:s,isDisabled:t,responseId:o,showUpload:i},bubbles:!0}))}handleTextChange(e){const s=e.target.value,t=e.target.dataset.key,o=e.target.dataset.con;console.log("Text changed:",s,t,o),this.questionResponses[t]=s,this.dispatchResponseChange(s,t,o)}handleCheckboxChange(e){const s=e.target.dataset.key,t=e.target.dataset.con,o=e.target.value;console.log("Checkbox value changed:",e.target.checked);const i=e.target.checked;console.log("Checkbox value changed:",o),this.dispatchResponseChange(i,s,t)}handleRadioChange(e){const s=e.target.dataset.key,t=e.target.dataset.con,o=e.target.id;this.questionResponses[s]=o,this.dispatchResponseChange(o,s,t)}handleMoveToSelected(e){const s=e.currentTarget.dataset.key,t=this.template.querySelector(`select[data-key="${s}"][data-type="available"]`);if(console.log("availableSelect",t),!t||!t.selectedOptions||t.selectedOptions.length===0)return;const o=Array.from(t.selectedOptions).map(a=>a.value);if(console.log("optionsToMove",o),!!this.findQuestionById(s))try{this.dispatchEvent(new CustomEvent("optionsmove",{detail:{questionId:s,optionsToMove:o,moveDirection:"toSelected"},bubbles:!0}))}catch(a){console.error("Error in handleMoveToSelected:",a)}}handleMoveToAvailable(e){const s=e.currentTarget.dataset.key,t=this.template.querySelector(`select[data-key="${s}"][data-type="selected"]`);if(!t||!t.selectedOptions||t.selectedOptions.length===0)return;const o=Array.from(t.selectedOptions).map(a=>a.value);if(console.log("optionsToMove",o),!!this.findQuestionById(s))try{this.dispatchEvent(new CustomEvent("optionsmove",{detail:{questionId:s,optionsToMove:o,moveDirection:"toAvailable"},bubbles:!0}))}catch(a){console.error("Error in handleMoveToAvailable:",a)}}updateSelectedOptions(e){const s=this.findQuestionById(e);if(!s||!s.selectedOptions)return;const t=s.selectedOptions;this.selectedMultiOptions[e]=t,this.questionResponses[e]=t.join(","),s.response=t.join(","),this.dispatchResponseChange(t.join(","),e,s.conditionalResponse)}handleDateChange(e){const s=e.target.value,t=e.target.dataset.key,o=e.target.dataset.con;this.dateValues[t]=s,this.dispatchResponseChange(s,t,o)}handleDateTimeChange(e){const s=e.target.value,t=e.target.dataset.key,o=e.target.dataset.con;this.dateTimeValues[t]=s,this.dispatchResponseChange(s,t,o)}isChildVisible(e){return!e||!this.visibleChildQuestions?!1:this.visibleChildQuestions[e]===!0}dispatchResponseChange(e,s,t){try{const o=`${s}_last_value`;if(this[o]===e)return;this[o]=e,this.questionResponses[s]=e,this.updateResponseData(s,e),this.dispatchEvent(new CustomEvent("responsechange",{detail:{questionId:s,value:e,conditional:t},bubbles:!0}))}catch(o){console.error("Error in dispatchResponseChange:",o)}}handleAttachmentsClick(e){try{const s=e.currentTarget.dataset.id,t=this.findQuestionById(s),o=this.responseData.find(i=>i.Rhythm__Question__c===s);this.dispatchEvent(new CustomEvent("openattachments",{detail:{questionId:s,question:t,isRequired:t?.isFileRequired||!1,response:o},bubbles:!0,composed:!0}))}catch(s){console.error("Error in handleAttachmentsClick:",s)}}handleCommentsClick(e){try{const s=e.currentTarget.dataset.id,t=this.findQuestionById(s),o=this.responseData.find(i=>i.Rhythm__Question__c===s);this.dispatchEvent(new CustomEvent("opencomments",{detail:{questionId:s,question:t,questionText:t?.text||"",response:o},bubbles:!0,composed:!0}))}catch(s){console.error("Error in handleCommentsClick:",s)}}handleResponseChange(e){this.updateResponseData(e.detail.questionId,e.detail.value),this.dispatchEvent(new CustomEvent("responsechange",{detail:e.detail,bubbles:!0}))}handleActionItemsClick(e){try{const s=e.currentTarget.dataset.id,t=this.findQuestionById(s),o=this.responseData.find(i=>i.Rhythm__Question__c===s);this.dispatchEvent(new CustomEvent("openactionitems",{detail:{questionId:s,question:t,questionText:t?.text||"",response:o}}))}catch(s){console.error("Error in handleActionItemsClick:",s)}}updateResponseData(e,s){try{let t=s;const o=this.findQuestionById(e);if(Array.isArray(s))t=JSON.stringify(s);else if(typeof s=="string"&&s.includes(",")&&o&&o.isMultiPicklist){const l=s.split(",");t=JSON.stringify(l)}let i=null,a=0;o&&o.isPicklist?(i=this.responseAttributes.find(l=>l.Rhythm__Response_value__c===s),i&&(a=i.Rhythm__Score__c*i.Rhythm__Weight__c)):!o.isPicklist&&!o.isMultiPicklist&&this.responseAttributes&&Array.isArray(this.responseAttributes)&&(i=this.responseAttributes.find(l=>l.Rhythm__QuestionId__c===e),i&&(a=i.Rhythm__Score__c*i.Rhythm__Weight__c));const r=new CustomEvent("responsedataupdate",{detail:{questionId:e,value:t,recordId:this.recordId,responseAttribute:i,score:a},bubbles:!0});this.dispatchEvent(r),console.log("Dispatched responseDataUpdate event for question:",e)}catch(t){console.error("Error in updateResponseData:",t)}}findQuestionById(e){if(this.questionData&&this.questionData.id===e)return this.questionData;if(this.questionsList&&Array.isArray(this.questionsList))for(const s of this.questionsList){if(s.id===e)return s;if(s.children&&s.children.length>0){const t=this.findQuestionInChildren(s.children,e);if(t)return t}}return null}findQuestionInChildren(e,s){if(!e||!Array.isArray(e))return null;for(const t of e){if(t.id===s)return t;if(t.children&&t.children.length>0){const o=this.findQuestionInChildren(t.children,s);if(o)return o}}return null}renderedCallback(){this.setSelectValues()}setSelectValues(){if(this.questionsList&&Array.isArray(this.questionsList)&&this.questionsList.forEach(e=>{if(e.isPicklist){const s=this.template.querySelector(`select[data-key="${e.id}"]`);if(s&&e.response){if(s.value=e.response,s.value!==e.response){for(let t=0;t<s.options.length;t++)if(s.options[t].value===e.response){s.selectedIndex=t;break}}console.log("Setting select value for question",e.id,"to",e.response,"result:",s.value)}}}),this.questionData&&this.questionData.isPicklist){const e=this.template.querySelector(`select[data-key="${this.questionData.id}"]`);if(e&&this.questionData.response){if(e.value=this.questionData.response,e.value!==this.questionData.response){for(let s=0;s<e.options.length;s++)if(e.options[s].value===this.questionData.response){e.selectedIndex=s;break}}console.log("Setting select value for single question",this.questionData.id,"to",this.questionData.response,"result:",e.value)}}}}Y(hi,{publicProps:{questionData:{config:0},questionsList:{config:0},visibleChildQuestions:{config:0},responses:{config:0},responseData:{config:0},recordId:{config:0},responseAttributes:{config:0}},track:{showDropdown:1,questionResponses:1,selectedMultiOptions:1,availableOptionsMap:1,dateValues:1,dateTimeValues:1,isChecked:1}});const ui=z(hi,{tmpl:i0,sel:"c-rtmvpc-render-question-template",apiVersion:63}),a0=p`<div class="section-header${0}"${"a0:data-section-id"}${2}><div class="section-header-left${0}"${2}><button${"a2:data-section-id"} class="section-toggle-button${0}"${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 256 512" height="16" width="16"${3}><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"${3}/></svg></button><span class="section-title${0}"${2}>${"t6"}</span></div><div class="section-stats${0}"${2}><div class="stats-container${0}"${2}><div class="stat-item${0}"${2}><span class="stat-label${0}"${2}>Total Count</span><span class="stat-value${0}"${2}>${"t13"}</span></div><div class="stat-item${0}"${2}><span class="stat-label${0}"${2}>%Completed</span><span class="stat-value${0}"${2}>${"t18"}</span></div><div class="stat-item${0}"${2}><span class="stat-label${0}"${2}>Score</span><span class="stat-value${0}"${2}>${"t23"}</span></div><div class="stat-item${0}"${2}><span class="stat-label${0}"${2}>Follow-Ups</span><span class="stat-value${0}"${2}>${"t28"}</span></div><div class="stat-item${0}"${2}><span class="stat-label${0}"${2}>Findings</span><span class="stat-value${0}"${2}>${"t33"}</span></div><div class="stat-item${0}"${2}><span class="stat-label${0}"${2}>Tasks</span><span class="stat-value${0}"${2}>${"t38"}</span></div></div></div></div>`,n0=p`<div class="action-buttons${0}"${2}><button class="btn btn-neutral margin-right${0}"${2}>Save</button><button class="btn btn-brand${0}"${2}>Submit</button></div>`,r0=p`<div class="loading-container${0}"${2}><div class="loading-spinner${0}"${2}></div></div>`,l0=p`<div class="modal-overlay${0}"${2}><div class="modal-container${0}"${2}><div class="modal-header${0}"${2}><h2${3}>Success</h2></div><div class="modal-body${0}"${2}><p${3}>Responses Saved Successfully</p></div><div class="modal-footer${0}"${2}><button class="btn btn-brand${0}"${2}>OK</button></div></div></div>`,c0=p`<div class="modal-overlay${0}"${2}><div class="modal-container${0}"${2}><div class="modal-header${0}"${2}><h2${3}>Confirm</h2></div><div class="modal-body${0}"${2}><p${3}>Do you want to Submit the Assessment?</p></div><div class="modal-footer${0}"${2}><button class="btn btn-brand${0}"${2}>Yes</button><button class="btn btn-neutral${0}"${2}>No</button></div></div></div>`,d0=p`<div class="modal-overlay${0}"${2}><div class="modal-container${0}"${2}><div class="modal-header${0}"${2}><h2${3}>Success</h2></div><div class="modal-body${0}"${2}><p${3}>Assessment Submitted Successfully</p></div><div class="modal-footer${0}"${2}><button class="btn btn-brand${0}"${2}>OK</button></div></div></div>`,h0=p`<div class="modal-overlay${0}"${2}><div class="modal-container error-modal${0}"${2}><div class="modal-header error-header${0}"${2}><h2${3}>Error</h2></div><div class="modal-body${0}"${2}><p${3}>${"t7"}</p></div><div class="modal-footer${0}"${2}><button class="btn btn-brand${0}"${2}>OK</button></div></div></div>`,u0={classMap:{"assessment-wrapper":!0},key:0},p0={classMap:{"assessment-container":!0,"scrollable-container":!0},key:1},f0={"section-container":!0},m0={classMap:{"questions-container":!0},key:5};function at(n,e,s,t){const{k:o,b:i,d:a,sp:r,st:l,c,h:d,i:h,f:u}=n,{_m0:f,_m1:g,_m2:_,_m3:m,_m4:x,_m5:k,_m6:$,_m7:S,_m8:O,_m9:F,_m10:D}=t;return[e.isLoading?null:d("div",u0,[d("div",p0,u([h(e.filteredQuestionsAndAnswers,function(v){return d("div",{classMap:f0,attrs:{"data-section-id":v.id},key:o(2,v.id)},[l(a0,4,[r(0,{on:g||(t._m1={click:i(e.toggleSection)}),attrs:{"data-section-id":v.id}},null),r(2,{on:_||(t._m2={click:i(e.toggleSection)}),attrs:{"data-section-id":v.id}},null),r(6,null,a(v.name)),r(13,null,a(v.totalCount)),r(18,null,a(v.completedPercentage)+"%"),r(23,null,a(v.totalScore)),r(28,null,a(v.followUpsCount)),r(33,null,a(v.findingsCount)),r(38,null,a(v.tasksCount))]),d("div",m0,[c("c-rtmvpc-render-question-template",ui,{props:{questionsList:v.questions,visibleChildQuestions:e.visibleChildQuestions,responseData:e.responseData,recordId:e.recordId,responseAttributes:e.responseAttributes},key:6,on:m||(t._m3={responsechange:i(e.handleResponseChange),responsedataupdate:i(e.handleResponseDataUpdate),optionsmove:i(e.handleOptionsMove),openattachments:i(e.handleOpenAttachments),opencomments:i(e.handleOpenComments),openactionitems:i(e.handleOpenActionItems)})})])])}),e.showButtons?l(n0,8,[r(1,{on:x||(t._m4={click:i(e.handleSave)})},null),r(3,{on:k||(t._m5={click:i(e.handleSubmitClick)})},null)]):null]))]),e.isLoading?l(r0,10):null,e.showSaveSuccessModal?l(l0,12,[r(9,{on:$||(t._m6={click:i(e.handleCloseModal)})},null)]):null,e.showSubmitConfirmModal?l(c0,14,[r(9,{on:S||(t._m7={click:i(e.handleSubmit)})},null),r(11,{on:O||(t._m8={click:i(e.handleSubmitCancel)})},null)]):null,e.showSubmitSuccessModal?l(d0,16,[r(9,{on:F||(t._m9={click:i(e.handleCloseModal)})},null)]):null,e.showErrorModal?l(h0,18,[r(7,null,a(e.errorMessage)),r(9,{on:D||(t._m10={click:i(e.handleCloseModal)})},null)]):null]}var g0=J(at);at.stylesheets=[],at.stylesheetToken="lwc-jtn548k3sk",at.legacyStylesheetToken="c-questionnaire_questionnaire",ci&&at.stylesheets.push.apply(at.stylesheets,ci),Q(at);class pi extends K{constructor(...e){super(...e);this.recordId=void 0,this.objectApiName=void 0,this.accountAssessmentData=void 0,this.isLoading=!0,this.questionsAndAnswers=[],this.responses={},this.visibleChildQuestions={},this.responseData=[],this.responseAttributes=[],this.requiredQuestions=[],this.requiredFileUploads=[],this.assessmentFinding=[],this.tasks=[],this.showButtons=!1,this.filteredQuestionsAndAnswers=[],this.currentFilter="All",this.showSaveSuccessModal=!1,this.showSubmitConfirmModal=!1,this.showSubmitSuccessModal=!1,this.showErrorModal=!1,this.errorMessage="",this.questionCount=0,this.responseCount=0,this.totalScore=0,this.attributeCount=0,this.maxPossibleScore=0,this.nonPreferredCount=0,this.totalPreferredCount=0}connectedCallback(){this.loadAssessmentData()}renderedCallback(){}async loadAssessmentData(){try{let e=this.accountAssessmentData[0].Rhythm__Assessment__r.Rhythm__Template__c;(this.accountAssessmentData[0].Rhythm__Status__c==="New"||this.accountAssessmentData[0].Rhythm__Status__c==="In Progress"||this.accountAssessmentData[0].Rhythm__Status__c==="Need More Information")&&(this.showButtons=!0);let s=await an(e);console.log("questions",JSON.stringify(s));let t=await nn(this.recordId),o=[];t.forEach(c=>{o.some(h=>h.Rhythm__Question__c===c.Rhythm__Question__c)||o.push(c)}),console.log("supplierResponse",JSON.stringify(o));let i=s.map(c=>c.Id),a=await rn(i);this.responseAttributes=a,console.log("questionRespAttributes",JSON.stringify(a));let r=await ln(i,this.recordId);this.assessmentFinding=r,console.log("assessmentFinding",JSON.stringify(r));let l=r.map(c=>c.Id);if(!l||l.length===0)console.log("No assessment findings found, skipping task retrieval"),this.tasks=[];else try{let d=await cn("Task","Id,Subject,Description,ActivityDate,Priority,Status,OwnerId, Owner.Name, WhatId",l,"WhatId");console.log("listRecords",JSON.stringify(d));let h=d;console.log("cleanedJson",JSON.stringify(h));try{typeof h=="string"&&(h=h.replace(/\\"/g,'"'));const u=typeof h=="string"?JSON.parse(h):h;console.log("parsedData",JSON.stringify(u)),this.tasks=u.records||[]}catch(u){console.error("Error parsing task data:",u),this.tasks=[]}}catch(c){console.error("Error retrieving tasks:",c),this.tasks=[]}this.buildQuestionTree(s,o,a),this.processFileUploadRequirements(o,a),this.isLoading=!1}catch(e){console.error("Error loading assessment data:",e);let s=e.message;e.message&&e.message.includes("match for URL")?s="Unable to connect to the server. This may be due to network issues or an invalid endpoint. Please try again or contact support.":e.message&&(e.message.includes("Session expired")||e.message.includes("Not authenticated")||e.message.includes("INVALID_SESSION_ID"))?s="Your session has expired. Please refresh the page and log in again.":e.message&&(e.message.includes("NetworkError")||e.message.includes("Failed to fetch"))&&(s="Network connection issue. Please check your internet connection and try again."),this.showErrorModal=!0,this.errorMessage=s,this.isLoading=!1}}processFileUploadRequirements(e,s){if(!e||!s)return;const t=new Map;e.forEach(i=>{t.set(i.Rhythm__Question__c,i)});const o=new Map;s.forEach(i=>{o.has(i.Rhythm__QuestionId__c)||o.set(i.Rhythm__QuestionId__c,[]),o.get(i.Rhythm__QuestionId__c).push(i)}),this.questionsAndAnswers.forEach(i=>{this.processQuestionsForFileRequirements(i.questions,t,o)})}processQuestionsForFileRequirements(e,s,t){!e||!Array.isArray(e)||e.forEach(o=>{const i=o.id,a=s.get(i);if(a&&a.Rhythm__Response__c){const r=t.get(i)||[];if(o.isMultiPicklist&&o.selectedOptions&&o.selectedOptions.length>0){let l=0,c=0;o.selectedOptions.forEach(d=>{const h=r.find(u=>u.Rhythm__Option_Value__c===d);h&&h.Rhythm__Upload_Required__c&&(h.Rhythm__Upload_Required__c==="Yes"?l++:h.Rhythm__Upload_Required__c==="Optional"&&c++)}),l>0?(o.isFileRequired=!0,o.isOptionalFileUpload=!1,this.requiredFileUploads.includes(i)||this.requiredFileUploads.push(i)):c>0?(o.isFileRequired=!1,o.isOptionalFileUpload=!0,this.requiredFileUploads=this.requiredFileUploads.filter(d=>d!==i)):(o.isFileRequired=!1,o.isOptionalFileUpload=!1,this.requiredFileUploads=this.requiredFileUploads.filter(d=>d!==i))}else{const l=a.Rhythm__Response__c,c=r.find(d=>d.Rhythm__Response_value__c===l);if(c&&c.Rhythm__Upload_Required__c){const d=c.Rhythm__Upload_Required__c;d==="Yes"?(o.isFileRequired=!0,o.isOptionalFileUpload=!1,this.requiredFileUploads.includes(i)||this.requiredFileUploads.push(i)):d==="Optional"?(o.isFileRequired=!1,o.isOptionalFileUpload=!0,this.requiredFileUploads=this.requiredFileUploads.filter(h=>h!==i)):d==="No"&&(o.isFileRequired=!1,o.isOptionalFileUpload=!1,this.requiredFileUploads=this.requiredFileUploads.filter(h=>h!==i))}}}o.children&&o.children.length>0&&this.processQuestionsForFileRequirements(o.children,s,t)})}buildQuestionTree(e,s,t){const o=new Map,i=new Map,a=new Map,r=new Map,l=new Set;if(e.forEach(d=>{o.set(d.Id,d)}),this.responseData=[],t.forEach(d=>{a.has(d.Rhythm__QuestionId__c)||a.set(d.Rhythm__QuestionId__c,[]),a.get(d.Rhythm__QuestionId__c).push(d)}),e.forEach(d=>{const h=d.Rhythm__Section__c;r.has(h)||d.Rhythm__Section__r.Rhythm__Internal_Use_Only__c||r.set(h,{id:h,name:d.Rhythm__Section__r.Name,sequenceNumber:d.Rhythm__Section__r.Rhythm__Section_Sequence_Number__c,questions:[],totalQuestions:0,answeredQuestions:0,findingsCount:0,tasksCount:0,followUpsCount:0,totalScore:0,internalUseOnly:d.Rhythm__Section__r.Rhythm__Internal_Use_Only__c||!1})}),s.forEach(d=>{const h=i.get(d.Rhythm__Question__c);if(!h||new Date(d.LastModifiedDate)>new Date(h.LastModifiedDate)){if(i.set(d.Rhythm__Question__c,d),d.isUpdated=!1,d.isCreated=!1,this.responseData.push(d),d.Rhythm__Response__c&&(this.responses[d.Rhythm__Question__c]=d.Rhythm__Response__c),d.Rhythm__Conversation_History__c&&d.Rhythm__Conversation_History__c.length>0){const u=o.get(d.Rhythm__Question__c);if(u&&u.Rhythm__Section__c){const f=r.get(u.Rhythm__Section__c);if(f)try{const g=JSON.parse(d.Rhythm__Conversation_History__c);Array.isArray(g)&&g.length>0&&(f.followUpsCount+=g.length)}catch(g){console.error("Error parsing conversation history:",g)}}}if(d.Rhythm__Score__c&&!isNaN(d.Rhythm__Score__c)&&this.accountAssessmentData[0].Rhythm__Status__c!=="New"&&this.accountAssessmentData[0].Rhythm__Status__c!=="In Progress"){const u=o.get(d.Rhythm__Question__c);if(u&&u.Rhythm__Section__c){const f=r.get(u.Rhythm__Section__c);f&&(f.totalScore+=Number(d.Rhythm__Score__c))}}}}),this.assessmentFinding&&this.assessmentFinding.length>0&&this.assessmentFinding.forEach(d=>{if(d.Rhythm__Assessment_Question__c){const h=o.get(d.Rhythm__Assessment_Question__c);if(h&&h.Rhythm__Section__c){const u=r.get(h.Rhythm__Section__c);u&&u.findingsCount++}}}),this.tasks&&this.tasks.length>0){const d=new Map;this.assessmentFinding&&this.assessmentFinding.length>0&&this.assessmentFinding.forEach(h=>{if(h.Rhythm__Assessment_Question__c){const u=o.get(h.Rhythm__Assessment_Question__c);u&&u.Rhythm__Section__c&&d.set(h.Id,u.Rhythm__Section__c)}}),this.tasks.forEach(h=>{const u=h.WhatId;if(u&&d.has(u)){const f=d.get(u),g=r.get(f);g&&g.tasksCount++}})}e.filter(d=>!d.Rhythm__Parent_Question__c&&!d.Rhythm__Section__r.Rhythm__Internal_Use_Only__c).forEach(d=>{const h=this.createQuestionNode(d,o,i,a,l,0),u=r.get(d.Rhythm__Section__c);u.questions.push(h);const f=g=>{let _=1;return i.has(g.id)&&u.answeredQuestions++,g.children&&g.children.length>0&&g.children.forEach(m=>{_+=f(m)}),_};u.totalQuestions+=f(h)}),this.questionsAndAnswers=Array.from(r.values()).sort((d,h)=>d.sequenceNumber-h.sequenceNumber),this.questionsAndAnswers.length>0&&(this.questionsAndAnswers[0].isExpanded=!0),this.questionsAndAnswers.forEach(d=>{d.totalCount=d.answeredQuestions+"/"+d.totalQuestions,d.completedPercentage=d.totalQuestions>0?Math.round(d.answeredQuestions/d.totalQuestions*100):"0"}),this.questionsAndAnswers.forEach(d=>{this.initialzeChildVisibility(d.questions)}),this.filteredQuestionsAndAnswers=[...this.questionsAndAnswers]}initialzeChildVisibility(e){e.forEach(s=>{s.children&&s.children.length>0?(s.isShowChildQuestions=!0,s.children.forEach(t=>{s.response!==""&&s.response!==null&&s.response!==void 0?(t.isDisplay=this.shouldShowChildQuestion(t,s.response),!t.isDisplay&&t.children&&t.children.length>0&&this.hideAllChildrenRecursively(t)):(t.isDisplay=!1,this.hideAllChildrenRecursively(t))}),this.initialzeChildVisibility(s.children)):s.isShowChildQuestions=!1})}hideAllChildrenRecursively(e){e.children&&e.children.length>0?e.children.forEach(s=>{s.isDisplay=!1,this.visibleChildQuestions[s.id]=!1,this.updateRequiredLists(s,!1),this.hideAllChildrenRecursively(s)}):this.updateRequiredLists(e,!1)}updateRequiredLists(e,s){if(!e)return;const t=e.id;s?(e.required&&!this.requiredQuestions.includes(t)&&this.requiredQuestions.push(t),e.isFileRequired&&!this.requiredFileUploads.includes(t)&&this.requiredFileUploads.push(t)):(this.requiredQuestions=this.requiredQuestions.filter(o=>o!==t),this.requiredFileUploads=this.requiredFileUploads.filter(o=>o!==t))}createQuestionNode(e,s,t,o,i,a,r=""){if(i.has(e.Id)||a>10)return null;let l=!1;i.add(e.Id);const c=e.Rhythm__Question_Type__c;let d;r?d=`${r}.${e.Rhythm__Question_Sequence_Number__c}`:d=`${e.Rhythm__Question_Sequence_Number__c}`,this.accountAssessmentData[0].Rhythm__Status__c==="New"||this.accountAssessmentData[0].Rhythm__Status__c==="In Progress"?l=!1:l=!0,e.Rhythm__Requires_File_Upload__c&&this.requiredFileUploads.push(e.Id);let h=!1;this.assessmentFinding&&this.assessmentFinding.length>0&&(h=this.assessmentFinding.some(k=>k.Rhythm__Assessment_Question__c===e.Id));let u=!1;this.accountAssessmentData[0].Rhythm__Status__c!=="New"&&this.accountAssessmentData[0].Rhythm__Status__c!=="In Progress"&&this.accountAssessmentData[0].Rhythm__Status__c!=="Submitted"&&(u=!0);let f=!1;this.accountAssessmentData[0].Rhythm__Status__c!=="New"&&this.accountAssessmentData[0].Rhythm__Status__c!=="In Progress"&&this.accountAssessmentData[0].Rhythm__Status__c!=="Submitted"&&this.accountAssessmentData[0].Rhythm__Status__c!=="In Review"&&(f=!0);const g={id:e.Id,number:d,originalNumber:e.Rhythm__Question_Sequence_Number__c,text:e.Rhythm__Question__c,type:c,required:e.Rhythm__Required__c,isFileRequired:e.Rhythm__Requires_File_Upload__c,isOptionalFileUpload:!1,helpText:e.Rhythm__HelpText__c,level:a,parentQuestionId:e.Rhythm__Parent_Question__c,conditionalResponse:e.Rhythm__Conditional_Response__c,children:[],options:this.parseOptions(e.Rhythm__OptionValueSet__c),attributes:o.get(e.Id)||[],isDisplay:!0,isShowChildQuestions:a===0,isText:c==="Text",isRadio:c==="Radio",isPicklist:c==="Picklist",isMultiPicklist:c==="Picklist (Multi-Select)",isDate:c==="Date",isDateTime:c==="Date/Time",isCheckbox:c==="Checkbox",isNumber:c==="Number",isCurrency:c==="Currency",isPhone:c==="Phone",isPercent:c==="Percent",isEmail:c==="Email",isTextArea:c==="Text Area (Rich)",showCapaActions:u,isNoEditable:l,totalFiles:0,sectionName:e.Rhythm__Section__r.Name,isFinding:h,showRejectFlag:f},_=t.get(e.Id);let m="";if(_){if(_.Rhythm__Response__c&&_.Rhythm__Response__c.startsWith("[")&&_.Rhythm__Response__c.endsWith("]"))try{g.response=JSON.parse(_.Rhythm__Response__c),m=g.response}catch(k){g.response=_.Rhythm__Response__c,m=_.Rhythm__Response__c}else g.response=_.Rhythm__Response__c,m=_.Rhythm__Response__c;this.accountAssessmentData[0].Rhythm__Status__c!=="New"&&this.accountAssessmentData[0].Rhythm__Status__c!=="In Progress"?g.score=_.Rhythm__Score__c:g.score=0,g.isRejected=_.Rhythm__Reject__c!=="Approved",g.isFlagged=_.Rhythm__Flag__c,_.Rhythm__Flag__c&&this.accountAssessmentData[0].Rhythm__Status__c==="Need More Information"&&(g.isNoEditable=!1),g.totalFiles=_.Rhythm__Files__c,g.isFilePresent=_.Rhythm__Files__c>0,g.rejectedStatus=_.Rhythm__Reject__c,_?.Rhythm__Conversation_History__c?.length>0?(g.showConversationHistoryChatColor=!0,g.conversationHistory=_.Rhythm__Conversation_History__c?JSON.parse(_.Rhythm__Conversation_History__c):[]):(g.showConversationHistoryChatColor=!1,g.conversationHistory=[])}else g.response="",g.score=0,g.isRejected=!1,g.isFlagged=!1,g.totalFiles=0,g.showConversationHistoryChatColor=!1,e.Rhythm__Required__c&&this.requiredQuestions.push(e.Id),g.conversationHistory=[],g.rejectedStatus="";if(this.accountAssessmentData[0].Rhythm__Status__c==="Review Completed"&&(g.isNoEditable=!0),c==="Picklist (Multi-Select)"&&g.options){let k=[];Array.isArray(m)?k=m:typeof m=="string"&&(m.includes(",")?k=m.split(","):m&&(k=[m])),g.selectedOptions=[],g.availableOptions=[],g.options.forEach($=>{k.includes($)?g.selectedOptions.push($):g.availableOptions.push($)})}return Array.from(s.values()).filter(k=>k.Rhythm__Parent_Question__c===e.Id).forEach(k=>{const $=this.createQuestionNode(k,s,t,o,i,a+1,d);$&&g.children.push($)}),g}parseOptions(e){return e?e.split(`\r
`).filter(s=>s.trim()!==""):[]}toggleSection(e){try{const s=e.currentTarget.dataset.sectionId,t=this.template.querySelector(`.section-container[data-section-id="${s}"]`);if(t){const o=t.querySelector(".questions-container"),i=t.querySelector(".section-toggle-button");o.classList.toggle("visible"),i.classList.toggle("expanded")}}catch(s){console.error("Error in toggleSection:",s)}}toggleSections(e){try{this.template.querySelectorAll(".section-container").forEach(t=>{const o=t.querySelector(".questions-container"),i=t.querySelector(".section-toggle-button");e?(o.classList.add("visible"),i.classList.add("expanded")):(o.classList.remove("visible"),i.classList.remove("expanded"))})}catch(s){console.error("Error in toggleSections:",s)}}handleResponseChange(e){const{questionId:s,value:t}=e.detail;this.responses[s]=t,this.updateChildQuestionsVisibility(s,t)}handleResponseDataUpdate(e){try{const{questionId:s,value:t,recordId:o,responseAttribute:i,score:a}=e.detail,r=this.findQuestionById(s),l=this.responseData.findIndex(c=>c.Rhythm__Question__c===s);if(l>=0)r&&r.isPicklist?(this.responseData[l].Rhythm__Response__c=t,i&&a&&(this.responseData[l].Rhythm__Score__c=a,this.responseData[l].isUpdated=!0,this.responseData[l].isCreated=!1,this.responseData=[...this.responseData])):(this.responseData[l].Rhythm__Response__c=t,i&&a&&(this.responseData[l].Rhythm__Score__c=this.responseData[l].Rhythm__Score__c+a),this.responseData[l].isUpdated=!0,this.responseData[l].isCreated=!1,this.responseData=[...this.responseData]);else{let c={};i?c={Rhythm__Question__c:s,Rhythm__Response__c:t,Rhythm__AccountAssessmentRelation__c:o,Rhythm__preferred_Non_preferred__c:i.Rhythm__preferred_Not_preferred__c,Rhythm__Is_Latest_Response__c:!0,Rhythm__Score__c:a,isUpdated:!1,isCreated:!0}:c={Rhythm__Question__c:s,Rhythm__Response__c:t,Rhythm__AccountAssessmentRelation__c:o,Rhythm__Is_Latest_Response__c:!0,isUpdated:!1,isCreated:!0},this.responseData=[...this.responseData,c]}i&&i?.Rhythm__Upload_Required__c&&this.updateFileUploadRequirements(s,t,i),r&&(r.response=t,this.accountAssessmentData[0].Rhythm__Status__c!=="New"&&this.accountAssessmentData[0].Rhythm__Status__c!=="In Progress"?r.score=a:r.score=0,this.responses[s]=t)}catch(s){console.error("Error in handleResponseDataUpdate:",s)}}updateChildQuestionsVisibility(e,s){try{const t={...this.visibleChildQuestions};let o=!1;const a=(r=>{const l={foundQuestion:null};for(let c=0;c<this.questionsAndAnswers.length;c++){const d=this.questionsAndAnswers[c];if(this.searchInQuestions(d.questions,r,l),l.foundQuestion)break}return l.foundQuestion})(e);if(!a){console.error("Parent question not found:",e);return}a.children&&a.children.length>0&&a.children.forEach(r=>{const l=this.shouldShowChildQuestion(r,s);if(t[r.id]=l,r.isDisplay=l,a.response=s,o=!0,this.updateRequiredLists(r,l),!l&&r.children&&r.children.length>0&&this.hideAllChildrenRecursively(r),l&&r.children&&r.children.length>0){const c=this.responses[r.id]||r.response;c&&this.updateChildrenVisibilityRecursively(r,c,t)}}),o&&(this.visibleChildQuestions={...t})}catch(t){console.error("Error in updateChildQuestionsVisibility:",t)}}updateChildrenVisibilityRecursively(e,s,t){!e.children||!Array.isArray(e.children)||e.children.length===0||e.children.forEach(o=>{const i=this.shouldShowChildQuestion(o,s);if(t[o.id]=i,o.isDisplay=i,this.updateRequiredLists(o,i),i&&o.children&&o.children.length>0){const a=this.responses[o.id]||o.response;a&&this.updateChildrenVisibilityRecursively(o,a,t)}else!i&&o.children&&o.children.length>0&&this.hideAllChildrenRecursively(o)})}shouldShowChildQuestion(e,s){return!e.conditionalResponse||s==null||s===""?!1:e.conditionalResponse==="true"||e.conditionalResponse==="false"?s:s&&typeof s=="string"&&s.includes(",")?s.split(",").includes(e.conditionalResponse):e.conditionalResponse===s}handleOpenAttachments(e){this.dispatchEvent(new CustomEvent("openattachments",{detail:e.detail,bubbles:!0,composed:!0}))}handleOpenComments(e){this.dispatchEvent(new CustomEvent("opencomments",{detail:e.detail,bubbles:!0,composed:!0}))}handleOpenActionItems(e){const s=e.detail.questionId;let t=null;this.assessmentFinding&&this.assessmentFinding.length>0&&(t=this.assessmentFinding.find(a=>a.Rhythm__Assessment_Question__c===s));let o=[];t&&this.tasks&&this.tasks.length>0&&(o=this.tasks.filter(a=>a.WhatId===t.Id));const i={...e.detail,assessmentFinding:t,relatedTasks:o};this.dispatchEvent(new CustomEvent("openactionitems",{detail:i,bubbles:!0,composed:!0}))}updateQuestionFileCount(e,s){const t=this.findQuestionById(e);t&&(t.totalFiles=s);const o=this.responseData.findIndex(i=>i.Rhythm__Question__c===e);o>=0&&(this.responseData[o].Rhythm__Files__c=s)}updateQuestionConversationIndicator(e,s){const t=this.findQuestionById(e);if(t){t.showConversationHistoryChatColor=s;const o=this.findSectionForQuestion(e);o&&(o.followUpsCount=(parseInt(o.followUpsCount,10)||0)+1)}}updateQuestionConversationHistory(e,s){try{const t=this.findQuestionById(e);if(t){let o=s;if(typeof s=="string")try{o=JSON.parse(s)}catch(a){console.error("Error parsing conversation history JSON:",a);return}t.conversationHistory=Array.isArray(o)?o:[];const i=this.responseData.findIndex(a=>a.Rhythm__Question__c===e);i>=0&&(this.responseData[i].Rhythm__Conversation_History__c=typeof s=="string"?s:JSON.stringify(s)),console.log(`Conversation history updated for question ${e}`)}else console.warn(`Question ${e} not found for conversation history update`)}catch(t){console.error("Error updating question conversation history:",t)}}findSectionIdForQuestion(e){const s=this.findQuestionById(e);if(!s)return null;const t=this.questionsAndAnswers.find(o=>o.name===s.sectionName);return t?t.id:null}findSectionForQuestion(e){const s=this.findQuestionById(e);return s?this.questionsAndAnswers.find(t=>t.name===s.sectionName):null}updateSectionFindingsCount(e){const s=this.findSectionForQuestion(e);s&&(s.findingsCount=(parseInt(s.findingsCount,10)||0)+1)}updateSectionTasksCount(e){const s=this.findSectionForQuestion(e);s&&(s.tasksCount=(parseInt(s.tasksCount,10)||0)+1)}calculateAssessmentStatistics(){this.questionCount=0,this.responseCount=0,this.totalScore=0,this.attributeCount=0,this.maxPossibleScore=0,this.nonPreferredCount=0,this.totalPreferredCount=0,this.questionsAndAnswers.forEach(e=>{e.totalQuestions&&(this.questionCount+=e.totalQuestions),e.answeredQuestions&&(this.responseCount+=e.answeredQuestions),e.totalScore&&(this.totalScore+=e.totalScore)}),this.responseAttributes&&Array.isArray(this.responseAttributes)&&(this.attributeCount=this.responseAttributes.length,this.responseAttributes.forEach(e=>{e.Rhythm__Score__c&&e.Rhythm__Weight__c&&(this.maxPossibleScore+=e.Rhythm__Score__c*e.Rhythm__Weight__c),e.Rhythm__preferred_Not_preferred__c==="Non Preferred"&&this.nonPreferredCount++,this.totalPreferredCount++}))}async handleSave(){try{if(this.isLoading=!0,!this.responseData||!this.responseData.length){this.isLoading=!1;return}this.calculateAssessmentStatistics();const e=[],s=[];if(this.responseData.forEach(c=>{if(c.Id){if(c.isUpdated){const d={Id:c.Id,Rhythm__Response__c:c.Rhythm__Response__c,Rhythm__Is_Latest_Response__c:!0};c.Rhythm__Score__c!==void 0&&c.Rhythm__Score__c!==null&&c.Rhythm__Score__c!==0&&c.Rhythm__Score__c!==""&&(d.Rhythm__Score__c=c.Rhythm__Score__c),s.push(d)}}else if(c.isCreated){const{...d}=c;delete d.isUpdated,delete d.isCreated,e.push(d)}}),e.length>0)try{const c=await $e("Rhythm__Response__c",e);Array.isArray(c)&&c.forEach((d,h)=>{if(d.success&&d.id){const u=this.responseData.findIndex(f=>!f.Id&&f.Rhythm__Question__c===e[h].Rhythm__Question__c);u>=0&&(this.responseData[u].Id=d.id)}})}catch(c){console.error("Error creating response records:",c)}if(s.length>0)try{await oe("Rhythm__Response__c",s)}catch(c){console.error("Error updating response records:",c)}const t=this.questionCount>0?Math.floor(Number(this.responseCount/this.questionCount)*100):0,o=this.nonPreferredCount||0,i=this.totalPreferredCount||0,a=o/i,r=new Date().toISOString();let l=!0;if(this.accountAssessmentData[0].Rhythm__Status__c==="New"){const c={Id:this.accountAssessmentData[0].Id,Rhythm__Status__c:"In Progress",Rhythm__Response_Percentage__c:t,Rhythm__Score__c:this.totalScore||0,Rhythm__Number_of_Questions__c:this.questionCount||0,Rhythm__countAttributes__c:this.attributeCount||0,Rhythm__maxPossibleScore__c:this.maxPossibleScore||0,Rhythm__NonPrefferedCount__c:a,Rhythm__Submission_Date__c:r};try{const d=await oe("Rhythm__AccountAssessmentRelation__c",c);console.log("assessmentResult",JSON.stringify(d)),d&&d.success?(this.accountAssessmentData=[{...this.accountAssessmentData[0],Rhythm__Status__c:"In Progress"}],console.log("Assessment status updated successfully to In Progress"),this.dispatchEvent(new CustomEvent("statuschange",{detail:{accountAssessmentData:this.accountAssessmentData},bubbles:!0,composed:!0}))):(l=!1,console.error("Failed to update assessment status:",d))}catch(d){l=!1,console.error("Error updating assessment status:",d)}}this.isLoading=!1,l?(this.showSaveSuccessModal=!0,setTimeout(()=>{this.showSaveSuccessModal=!1},5e3),this.dispatchEvent(new CustomEvent("save",{detail:{success:!0,responses:this.responses,responseData:this.responseData}}))):(this.errorMessage="Failed to update assessment status. Please try again.",this.showErrorModal=!0,setTimeout(()=>{this.showErrorModal=!1},5e3))}catch(e){console.error("Error in handleSave:",e),this.isLoading=!1,this.dispatchEvent(new CustomEvent("save",{detail:{success:!1,error:e.message}}))}}handleSubmitClick(){this.showSubmitConfirmModal=!0}handleSubmitCancel(){this.showSubmitConfirmModal=!1}async handleSubmit(){this.showSubmitConfirmModal=!1,this.isLoading=!0,this.calculateAssessmentStatistics();const e=this.responseData.filter(d=>!d.Id);if(e.length>0){console.error("Found unsaved responses:",e.length),this.errorMessage="Please save your responses first before submitting the assessment.",this.showErrorModal=!0,setTimeout(()=>{this.showErrorModal=!1},2e3),this.dispatchEvent(new CustomEvent("submit",{detail:{success:!1,message:this.errorMessage}})),this.isLoading=!1;return}const s=this.validateRequiredResponses();if(s.length>0){console.error("Missing responses for required questions:",s),this.errorMessage=`Please fill the required questions and save the responses. Missing ${s.length} required response(s).`,this.showErrorModal=!0,setTimeout(()=>{this.showErrorModal=!1},5e3),this.dispatchEvent(new CustomEvent("submit",{detail:{success:!1,missingRequiredResponses:s,message:this.errorMessage}})),this.isLoading=!1;return}const t=this.validateRequiredFileUploads();if(t.length>0){console.error("Missing required file uploads:",t),this.errorMessage=`Please upload the required files. Missing ${t.length} required file(s).`,this.showErrorModal=!0,setTimeout(()=>{this.showErrorModal=!1},5e3),this.dispatchEvent(new CustomEvent("submit",{detail:{success:!1,missingRequiredFileUploads:t,message:this.errorMessage}})),this.isLoading=!1;return}const o=this.questionCount>0?Math.floor(Number(this.responseCount/this.questionCount)*100):0,i=this.nonPreferredCount||0,a=this.totalPreferredCount||0,r=Math.round(i/a),l=new Date().toISOString(),c={Id:this.accountAssessmentData[0].Id,Rhythm__Status__c:"Submitted",Rhythm__Response_Percentage__c:o,Rhythm__Score__c:this.totalScore||0,Rhythm__Number_of_Questions__c:this.questionCount||0,Rhythm__countAttributes__c:this.attributeCount||0,Rhythm__maxPossibleScore__c:this.maxPossibleScore||0,Rhythm__NonPrefferedCount__c:r,Rhythm__Submission_Date__c:l};try{const d=await oe("Rhythm__AccountAssessmentRelation__c",c);d&&d.success!==!1?(this.accountAssessmentData=[{...this.accountAssessmentData[0],Rhythm__Status__c:"Submitted"}],console.log("Assessment status updated successfully to Submitted"),this.dispatchEvent(new CustomEvent("statuschange",{detail:{accountAssessmentData:this.accountAssessmentData},bubbles:!0,composed:!0})),this.setAllQuestionsNoEditable(),this.showSubmitSuccessModal=!0,setTimeout(()=>{this.showSubmitSuccessModal=!1},5e3),this.showButtons=!1,this.dispatchEvent(new CustomEvent("submit",{detail:{success:!0,responses:this.responses}}))):(console.error("Failed to update assessment status:",d),this.errorMessage="Failed to submit assessment. Please try again.",this.showErrorModal=!0,setTimeout(()=>{this.showErrorModal=!1},5e3))}catch(d){console.error("Error updating assessment status:",d),this.errorMessage="Failed to submit assessment. Please try again.",this.showErrorModal=!0,setTimeout(()=>{this.showErrorModal=!1},5e3)}this.isLoading=!1}validateRequiredResponses(){const e=[];return this.requiredQuestions.forEach(s=>{this.responseData.some(o=>o.Rhythm__Question__c===s&&o.Rhythm__Response__c!==null&&o.Rhythm__Response__c!==void 0&&o.Rhythm__Response__c!=="")||e.push(s)}),e}validateRequiredFileUploads(){const e=[];return this.requiredFileUploads.forEach(s=>{this.responseData.some(o=>o.Rhythm__Question__c===s&&o.Rhythm__Files__c!==null&&o.Rhythm__Files__c!==void 0&&o.Rhythm__Files__c!==""&&o.Rhythm__Files__c>0)||e.push(s)}),e}searchInQuestions(e,s,t){if(!(!e||!Array.isArray(e)||t.foundQuestion))for(let o=0;o<e.length;o++){const i=e[o];if(i.id===s){t.foundQuestion=i;return}if(i.children&&i.children.length>0&&(this.searchInQuestions(i.children,s,t),t.foundQuestion))return}}findQuestionById(e){const s={foundQuestion:null};for(let t=0;t<this.questionsAndAnswers.length;t++){const o=this.questionsAndAnswers[t];if(this.searchInQuestions(o.questions,e,s),s.foundQuestion)break}return s.foundQuestion}setAllQuestionsNoEditable(){this.questionsAndAnswers.forEach(e=>{this.setQuestionsNoEditable(e.questions)})}setQuestionsNoEditable(e){!e||!Array.isArray(e)||e.forEach(s=>{s.isNoEditable=!0,s.children&&s.children.length>0&&this.setQuestionsNoEditable(s.children)})}handleOptionsMove(e){try{const{questionId:s,optionsToMove:t,moveDirection:o}=e.detail,i=this.findQuestionById(s);if(!i){console.error("Question not found:",s);return}i.availableOptions||(i.availableOptions=[]),i.selectedOptions||(i.selectedOptions=[]),o==="toSelected"?(i.availableOptions=i.availableOptions.filter(r=>!t.includes(r)),t.forEach(r=>{i.selectedOptions.includes(r)||i.selectedOptions.push(r)})):o==="toAvailable"&&(i.selectedOptions=i.selectedOptions.filter(r=>!t.includes(r)),t.forEach(r=>{i.availableOptions.includes(r)||i.availableOptions.push(r)}));const a=i.selectedOptions.join(",");i.response=a,this.responses[s]=a,this.updateResponseDataForMultiPickList(s,a)}catch(s){console.error("Error in handleOptionsMove:",s)}}updateResponseDataForMultiPickList(e,s){const t=this.responseData.findIndex(a=>a.Rhythm__Question__c===e);let o=0,i=null;if(this.responseAttributes&&Array.isArray(this.responseAttributes)&&(i=this.responseAttributes.find(a=>a.Rhythm__QuestionId__c===e),i&&(o=i.Rhythm__Score__c*i.Rhythm__Weight__c)),t>=0)this.responseData[t].Rhythm__Response__c=s,this.responseData[t].Rhythm__Score__c=this.responseData[t].Rhythm__Score__c+o,this.responseData[t].isUpdated=!0,this.responseData[t].isCreated=!1,this.responseData=[...this.responseData];else{const a={Rhythm__Question__c:e,Rhythm__Response__c:s,Rhythm__AccountAssessmentRelation__c:this.recordId,Rhythm__Is_Latest_Response__c:!0,Rhythm__Score__c:o,isUpdated:!1,isCreated:!0};this.responseData=[...this.responseData,a]}i&&i.Rhythm__Upload_Required__c&&this.updateFileUploadRequirements(e,s,i)}updateFileUploadRequirements(e,s,t){const o=this.findQuestionById(e);if(!!o){if(o.isMultiPicklist&&o.selectedOptions&&o.selectedOptions.length>0){let i=0,a=0;o.selectedOptions.forEach(r=>{const l=this.responseAttributes&&Array.isArray(this.responseAttributes)?this.responseAttributes.find(c=>c.Rhythm__QuestionId__c===e&&c.Rhythm__Option_Value__c===r):null;l&&l?.Rhythm__Upload_Required__c&&(l?.Rhythm__Upload_Required__c==="Yes"?i++:l?.Rhythm__Upload_Required__c==="Optional"&&a++)}),i>0?(o.isFileRequired=!0,o.isOptionalFileUpload=!1,this.requiredFileUploads.includes(e)||this.requiredFileUploads.push(e)):a>0?(o.isFileRequired=!1,o.isOptionalFileUpload=!0,this.requiredFileUploads=this.requiredFileUploads.filter(r=>r!==e)):(o.isFileRequired=!1,o.isOptionalFileUpload=!1,this.requiredFileUploads=this.requiredFileUploads.filter(r=>r!==e))}else if(t&&t.Rhythm__Upload_Required__c){const i=t.Rhythm__Upload_Required__c;i==="Yes"?(o.isFileRequired=!0,o.isOptionalFileUpload=!1,this.requiredFileUploads.includes(e)||this.requiredFileUploads.push(e)):i==="Optional"?(o.isFileRequired=!1,o.isOptionalFileUpload=!0,this.requiredFileUploads=this.requiredFileUploads.filter(a=>a!==e)):i==="No"&&(o.isFileRequired=!1,o.isOptionalFileUpload=!1,this.requiredFileUploads=this.requiredFileUploads.filter(a=>a!==e))}}}filterQuestions(e){if(this.currentFilter=e,e==="All")this.filteredQuestionsAndAnswers=[...this.questionsAndAnswers];else{const s=JSON.parse(JSON.stringify(this.questionsAndAnswers));s.forEach(t=>{t.questions=this.filterQuestionsByType(t.questions,e)}),this.filteredQuestionsAndAnswers=s}}filterQuestionsByType(e,s){return!e||!Array.isArray(e)?[]:e.filter(t=>{const o=this.questionMatchesFilter(t,s);return t.children&&t.children.length>0&&(t.children=this.filterQuestionsByType(t.children,s)),o||t.children&&t.children.length>0})}questionMatchesFilter(e,s){switch(s){case"Flagged":return e.isFlagged===!0;case"Approved":return e.rejectedStatus==="Approved";case"Rejected":return e.rejectedStatus==="Rejected";default:return!0}}handleCloseModal(){this.showSaveSuccessModal=!1,this.showSubmitSuccessModal=!1,this.showErrorModal=!1}}Y(pi,{publicProps:{recordId:{config:0},objectApiName:{config:0},accountAssessmentData:{config:0}},publicMethods:["toggleSections","updateQuestionFileCount","updateQuestionConversationIndicator","updateQuestionConversationHistory","updateSectionFindingsCount","updateSectionTasksCount","filterQuestions"],track:{isLoading:1,questionsAndAnswers:1,responses:1,visibleChildQuestions:1,responseData:1,responseAttributes:1,requiredQuestions:1,requiredFileUploads:1,assessmentFinding:1,tasks:1,showButtons:1,filteredQuestionsAndAnswers:1,currentFilter:1,showSaveSuccessModal:1,showSubmitConfirmModal:1,showSubmitSuccessModal:1,showErrorModal:1,errorMessage:1,questionCount:1,responseCount:1,totalScore:1,attributeCount:1,maxPossibleScore:1,nonPreferredCount:1,totalPreferredCount:1}});const _0=z(pi,{tmpl:g0,sel:"c-questionnaire",apiVersion:63});function b0(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".attachments-container",t," {display: flex;flex-direction: column;gap: 16px;}.upload-section",t," {margin-bottom: 16px;}.upload-area",t," {border: 2px dashed #e1e1e1;border-radius: 4px;padding: 20px;display: flex;justify-content: center;align-items: center;background-color: #f9f9f9;}.upload-button-container",t," {position: relative;display: flex;flex-direction: column;align-items: center;gap: 8px;}.upload-button",t," {display: flex;align-items: center;gap: 8px;padding: 8px 16px;background-color: #6a4feb;color: white;border: none;border-radius: 4px;cursor: pointer;font-weight: 500;}.upload-button:hover",t," {background-color: #5a3fd0;}.upload-icon",t," {margin-right: 4px;}.or-text",t," {color: #706e6b;font-size: 14px;}.file-input",t," {position: absolute;width: 0;height: 0;opacity: 0;}.files-table",t," {width: 100%;max-height: 300px;overflow-y: auto;border-radius: 4px;border: 1px solid #e1e1e1;}table",t," {width: 100%;border-collapse: collapse;}th",t," {text-align: left;padding: 8px;background-color: #f3f3f3;color: #444;font-weight: 600;font-size: 14px;border-bottom: 1px solid #e1e1e1;}.file-column",t," {width: 40%;}.size-column",t," {width: 15%;}.uploaded-column",t," {width: 25%;}.actions-column",t," {width: 20%;text-align: center;}td",t," {padding: 8px;border-bottom: 1px solid #f3f3f3;font-size: 14px;}.file-row:hover",t," {background-color: #f9f9f9;}.file-cell",t," {max-width: 200px;}.file-info",t," {display: flex;align-items: center;gap: 8px;}.file-icon",t," {color: #00a1df;}.file-name",t," {word-break: break-all;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;max-width: 180px;}.actions-cell",t," {text-align: center;}.action-buttons",t," {display: flex;justify-content: center;gap: 8px;}.action-button",t," {background: none;border: none;cursor: pointer;padding: 4px;color: #706e6b;}.view-button:hover",t," {color: #00a1df;}.download-button:hover",t," {color: #04844b;}.delete-button:hover",t," {color: #c23934;}.no-files",t," {padding: 16px 0;text-align: center;color: #706e6b;}.actions",t," {display: flex;justify-content: flex-end;gap: 8px;margin-top: 16px;padding-top: 16px;border-top: 1px solid #e1e1e1;}.btn",t," {padding: 8px 16px;border-radius: 4px;font-weight: 500;cursor: pointer;}.btn-neutral",t," {background-color: white;border: 1px solid #dddbda;color: #0070d2;}.btn-brand",t," {background-color: #0070d2;border: 1px solid #0070d2;color: white;}.no-response-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 32px 16px;}.no-response-message",t," {text-align: center;display: flex;flex-direction: column;align-items: center;gap: 16px;}.no-response-message",t," h3",t," {margin: 0;font-size: 20px;color: #2a2a2a;}.no-response-message",t," p",t," {margin: 0;font-size: 16px;color: #706e6b;max-width: 300px;}.no-response-message",t," button",t," {margin-top: 16px;}.spinner",t," {width: 20px;height: 20px;border: 2px solid #f3f3f3;border-top: 2px solid #0070d2;border-radius: 50%;animation: spin",o," 1s linear infinite;display: inline-block;}.spinner-small",t," {width: 16px;height: 16px;border: 2px solid #f3f3f3;border-top: 2px solid #0070d2;border-radius: 50%;animation: spin",o," 1s linear infinite;display: inline-block;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 32px 16px;gap: 16px;}.loading-container",t," p",t," {margin: 0;color: #706e6b;font-size: 14px;}.upload-button:disabled",t,",.action-button:disabled",t," {opacity: 0.6;cursor: not-allowed;pointer-events: none;}.upload-button:disabled:hover",t,",.action-button:disabled:hover",t," {background-color: #6a4feb;color: white;}"].join("")}var fi=[b0];function y0(n,e,s){var t=n?"["+n+"]":"";return".popup-overlay"+t+" {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(0, 0, 0, 0.5);z-index: 9999;display: flex;justify-content: center;align-items: center;}.popup-container"+t+" {background-color: white;border-radius: 4px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);width: 90%;max-width: 600px;max-height: 80vh;display: flex;flex-direction: column;}.popup-header"+t+" {display: flex;justify-content: space-between;align-items: center;padding: 12px 16px;border-bottom: 1px solid #e1e1e1;}.popup-header"+t+" h2"+t+" {font-size: 18px;font-weight: 600;margin: 0;}.close-button"+t+" {background: none;border: none;cursor: pointer;color: #706e6b;}.close-button:hover"+t+" {color: #1b2d4f;}.popup-content"+t+" {padding: 16px;overflow-y: auto;flex: 1;}"}var mi=[y0];const v0=p`<div class="popup-header${0}"${2}><h2${3}>${"t2"}</h2><button class="close-button${0}"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M9.41 8l3.29-3.29c.19-.18.3-.43.3-.71a1.003 1.003 0 00-1.71-.71L8 6.59l-3.29-3.3a1.003 1.003 0 00-1.42 1.42L6.59 8 3.3 11.29c-.19.18-.3.43-.3.71a1.003 1.003 0 001.71.71L8 9.41l3.29 3.29c.18.19.43.3.71.3a1.003 1.003 0 00.71-1.71L9.41 8z"${3}/></svg></button></div>`,w0={classMap:{"popup-overlay":!0},key:0},x0={classMap:{"popup-container":!0},key:1},k0={classMap:{"popup-content":!0},key:4},$0={key:5},C0=[];function Le(n,e,s,t){const{d:o,b:i,sp:a,st:r,s:l,h:c}=n,{_m0:d}=t;return[e.isOpen?c("div",w0,[c("div",x0,[r(v0,3,[a(2,null,o(e.title)),a(3,{on:d||(t._m0={click:i(e.handleClose)})},null)]),c("div",k0,[l("",$0,C0,s)])])]):null]}var S0=J(Le);Le.slots=[""],Le.stylesheets=[],Le.stylesheetToken="lwc-1mgilerh7ei",Le.legacyStylesheetToken="c-popupModal_popupModal",mi&&Le.stylesheets.push.apply(Le.stylesheets,mi),Q(Le);class gi extends K{constructor(...e){super(...e);this.title="",this.isOpen=!1}open(){this.isOpen=!0}close(){this.isOpen=!1}handleClose(){this.close(),this.dispatchEvent(new CustomEvent("close"))}}Y(gi,{publicProps:{title:{config:0},isOpen:{config:0}},publicMethods:["open","close"]});const Fs=z(gi,{tmpl:S0,sel:"c-popup-modal",apiVersion:63}),E0=p`<div class="spinner-small${0}"${2}></div>`,R0=p`<button class="upload-button${0}"${"a0:disabled"}${2}><svg class="upload-icon${0}" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${2}><path d="M8.71 5.29a1 1 0 00-1.42 0l-3 3a1 1 0 001.42 1.42L7 8.41V15a1 1 0 002 0V8.41l1.29 1.3a1 1 0 001.42-1.42l-3-3z"${3}/></svg>Upload Files</button>`,A0=p`<button class="action-button${0}" title="Capture Image"${"a0:disabled"}${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M9 2l1.5 2H14l2 2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2h3l2-2zM12 9a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 9zm0 2a3 3 0 1 1-.001 6.001A3 3 0 0 1 12 11z"${3}/></svg>Capture Image</button>`,I0=p`<div class="loading-container${0}"${2}><div class="spinner${0}"${2}></div><p${3}>Loading files...</p></div>`,F0=p`<thead${3}><tr${3}><th class="file-column${0}"${2}>File</th><th class="actions-column${0}"${2}>Actions</th></tr></thead>`,D0=p`<tr class="file-row${0}"${2}><td class="file-cell${0}"${2}><div class="file-info${0}"${2}><span class="file-icon${0}"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="#00a1df"${3}><path d="M9.5 1.5a1 1 0 00-1-1h-5a1 1 0 00-1 1v13a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-.29-.71l-4-4A1 1 0 009.5 1.5zm-5-1h4v4h4v10h-8v-14z"${3}/></svg></span><span class="file-name${0}"${2}>${"t7"}</span></div></td><td class="actions-cell${0}"${2}><div class="action-buttons${0}"${2}><button class="action-button view-button${0}" title="View"${"a10:data-key"}${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M8 3C4.4 3 1.3 5.2 0 8c1.3 2.8 4.4 5 8 5s6.7-2.2 8-5c-1.3-2.8-4.4-5-8-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5S6.1 4.5 8 4.5s3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5zm0-5.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"${3}/></svg></button><button class="action-button delete-button${0}" title="Delete"${"a13:data-key"}${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M14.5 3h-4V1.5c0-.83-.67-1.5-1.5-1.5h-2c-.83 0-1.5.67-1.5 1.5V3h-4a.5.5 0 00-.5.5v1a.5.5 0 00.5.5H2v10c0 .83.67 1.5 1.5 1.5h9c.83 0 1.5-.67 1.5-1.5V5h.5a.5.5 0 00.5-.5v-1a.5.5 0 00-.5-.5zM7 1.5c0-.28.22-.5.5-.5h1c.28 0 .5.22.5.5V3H7V1.5zM4 15V5h8v10H4z"${3}/></svg></button></div></td></tr>`,T0=p`<div class="no-files${0}"${2}><p${3}>No files uploaded yet.</p></div>`,O0=p`<div class="actions${0}"${2}><button class="btn btn-neutral${0}"${2}>Cancel</button><button class="btn btn-brand${0}"${2}>Save</button></div>`,L0=p`<div class="no-response-container${0}"${2}><div class="no-response-message${0}"${2}><svg width="48" height="48" viewBox="0 0 24 24" fill="#f8bb86"${3}><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"${3}/></svg><h3${3}>Please Save Response First</h3><p${3}>You need to fill and save the response before you can upload attachments.</p><button class="btn btn-brand${0}"${2}>OK</button></div></div>`,N0={classMap:{"attachments-container":!0},key:1},M0={classMap:{"upload-section":!0},key:2},P0={classMap:{"upload-area":!0},key:3},j0={classMap:{"upload-button-container":!0},key:4},U0={classMap:{"files-table":!0},key:11},V0={key:14},q0={key:17};function nt(n,e,s,t){const{b:o,st:i,sp:a,h:r,k:l,d:c,i:d,c:h}=n,{_m0:u,_m1:f,_m2:g,_m3:_,_m4:m,_m5:x,_m6:k,_m7:$,_m8:S,_m9:O}=t;return[h("c-popup-modal",Fs,{props:{title:"Attachments",isOpen:e.isOpen},key:0,on:u||(t._m0={close:o(e.handleClose)})},[e.hasResponseId?r("div",N0,[r("div",M0,[r("div",P0,[r("div",j0,[e.isUploading?i(E0,6):null,e.isUploading?null:i(R0,8,[a(0,{on:g||(t._m2={click:o(e.handleUploadClick)}),attrs:{disabled:e.isUploading?"":null}},null)]),e.isUploading?null:i(A0,10,[a(0,{on:m||(t._m4={click:o(e.handleCameraCapture)}),attrs:{disabled:e.isUploading?"":null}},null)])])])]),r("div",U0,[e.isInitialLoading?i(I0,13):null,e.isInitialLoading?null:r("table",V0,[i(F0,16),r("tbody",q0,d(e.files,function(F){return i(D0,l(19,F.key),[a(7,null,c(F.value)),a(10,{on:x||(t._m5={click:o(e.filePreview)}),attrs:{"data-key":F.key}},null),a(13,{on:k||(t._m6={click:o(e.handleDeleteFile)}),attrs:{"data-key":F.key}},null)])}))]),e.isInitialLoading||e.hasFiles?null:i(T0,21)]),i(O0,23,[a(1,{on:$||(t._m7={click:o(e.handleClose)})},null),a(3,{on:S||(t._m8={click:o(e.handleSave)})},null)])]):null,e.hasResponseId?null:i(L0,25,[a(8,{on:O||(t._m9={click:o(e.handleClose)})},null)])])]}var z0=J(nt);nt.stylesheets=[],nt.stylesheetToken="lwc-1dh8iahpn8c",nt.legacyStylesheetToken="c-attachmentsPopup_attachmentsPopup",fi&&nt.stylesheets.push.apply(nt.stylesheets,fi),Q(nt);class _i extends K{constructor(...e){super(...e);this.recordId=void 0,this.type=void 0,this.isRequired=!1,this.objectApiName=void 0,this.questionId=void 0,this.questionData=void 0,this.responseData=void 0,this.isOpen=!1,this.files=[],this.uploadedFiles=[],this.showSpinner=!1,this.showDeleteModal=!1,this.showFrame=!1,this.previewUrl="",this.selectedFileKey="",this.isOffline=!1,this.offlineFiles=[],this.errorMessage="",this.s3ConfigType=null,this.isUploading=!1,this.isInitialLoading=!1,this.acceptedFormats=".png, .jpg, .jpeg, .pdf, .doc, .docx, .xls, .xlsx, .csv"}get hasFiles(){return this.files&&this.files.length>0}get hasResponseId(){return!!(this.responseData&&this.responseData.Id)}async connectedCallback(){this.isOffline=!V(),ho(this.handleConnectivityChange.bind(this)),this.offlineFiles=[];try{const e=await Mt();this.s3ConfigType=e?.Rhythm__customValue__c||null,console.log("\u{1F50D} S3 Configuration type:",this.s3ConfigType),this.s3ConfigType!==null&&this.getFiles("list")}catch(e){console.error("Error getting S3 configuration:",e)}this.ensureFileUploadSyncAvailable()}disconnectedCallback(){uo(this.handleConnectivityChange.bind(this));try{window.fileUploadSync&&window.fileUploadSync.removeEventListener?(window.fileUploadSync.removeEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Removed sync completion event listener")):G&&G.removeEventListener&&(G.removeEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Removed sync completion event listener from import"))}catch(e){console.error("\u274C Error removing sync event listener:",e)}}handleConnectivityChange(e){this.isOffline=!e,e&&(this.syncOfflineFiles(),this.s3ConfigType!==null&&this.getFiles("list"))}async syncOfflineFiles(){console.log("\u{1F504} Checking for offline files to sync...");try{window.fileUploadSync?(console.log("\u{1F504} Triggering file upload sync from window..."),await window.fileUploadSync.triggerManualSync()):G?(console.log("\u{1F504} Triggering file upload sync from import..."),await G.triggerManualSync()):console.warn("\u26A0\uFE0F File upload sync service not available"),this.loadOfflineFiles()}catch(e){console.error("\u274C Error syncing offline files:",e)}}ensureFileUploadSyncAvailable(){try{typeof window!="undefined"&&!window.fileUploadSync&&(window.fileUploadSync=G,console.log("\u{1F4C1} File upload sync service made available from attachmentsPopup")),window.fileUploadSync&&window.fileUploadSync.addEventListener?(window.fileUploadSync.addEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Registered for sync completion events")):G&&G.addEventListener&&(G.addEventListener("syncComplete",this.handleSyncComplete.bind(this)),console.log("\u{1F504} Registered for sync completion events from import"))}catch(e){console.error("\u274C Error ensuring file upload sync availability:",e)}}handleSyncComplete(e){console.log("\u2705 Sync completed event received:",e),this.loadOfflineFiles(),V()&&this.s3ConfigType!==null&&this.getFiles("upload")}async loadOfflineFiles(){try{if(this.recordId){const e=await U.getFileUploadsByRecord(this.objectApiName,this.recordId);console.log("files",JSON.stringify(e)),this.offlineFiles=e.filter(s=>s.upload_status==="pending"),console.log(`\u{1F4F1} Loaded ${this.offlineFiles.length} offline files for record ${this.recordId}`),this.addOfflineFilesToFilesList()}else this.offlineFiles=[],console.log("No recordId available to load offline files")}catch(e){console.error("\u274C Error loading offline files:",e),this.offlineFiles=[]}}addOfflineFilesToFilesList(){this.files=this.files.filter(s=>!s.isOfflineFile);const e=this.offlineFiles.map(s=>{const t=this.formatDate(new Date(s.created_date));return{id:s.id,name:s.file_name,size:s.file_size||0,formattedSize:this.formatFileSize(s.file_size||0),type:s.mime_type,uploadDate:t,isOfflineFile:!0,offlineData:s}});e.length>0&&(this.files=[...e,...this.files])}async getLocalS3Files(){try{const e=`aws_s3_list_${this.objectApiName}`,t=(await de(Z.AWS_S3_LIST)).find(o=>o.id===e);return t&&t.records?(console.log(`\u{1F4F1} Retrieved ${t.records.length} cached records for ${this.objectApiName}`),console.log("cachedData records",t.records),t.records):(console.log(`\u{1F4F1} No cached records found for ${this.objectApiName}`),[])}catch(e){return console.error(`Error getting local records for ${this.objectApiName}:`,e),[]}}async getFiles(e){this.isInitialLoading=!0;try{let s=[];if((await X.getStatus())?.connected)if(this.files=[],this.s3ConfigType==="salesforce"){console.log("\u{1F4C1} Using Salesforce standard files");const o=await rs(this.responseData.Id);console.log("salesforceFiles",JSON.stringify(o)),this.type&&this.type.trim()!==""?(console.log("Filtering files by type:",this.type),this.files=o.filter(i=>(i.description||i.originalTitle||i.value||"").toLowerCase().includes(this.type.toLowerCase())),console.log("Filtered files:",JSON.stringify(this.files))):this.files=o,(e==="upload"||e==="delete")&&this.updateResponseFilesCount(),this.isInitialLoading=!1}else{let o="";const i=await At(this.objectApiName,this.recordId);i&&i.supplierName&&i.supplierName.includes("_Personal_Files")&&(o=`${i.customerName}/${i.objectLabel}/${i.supplierName}`),s=await Ae(o,"list");let a=s;try{a=a.replace(/\\"/g,'"');const h=/"ETag":"\\+"([a-f0-9]+)\\+"/g;a=a.replace(h,(u,f)=>`"ETag":"${f}`)}catch(h){console.error("Error cleaning JSON:",h)}const r=JSON.parse(a);let l=r.ListBucketResult.Contents;const c=r.ListBucketResult.KeyCount;let d=[];this.files=[],Array.isArray(l)||(l=[l]),c>0&&l&&l.forEach(h=>{let u=h.Key.split("/");if(console.log("checkFile",JSON.stringify(u)),u[u.length-1]!=null&&u[u.length-1]!==""){const f=h.Key;let g=f.substring(f.lastIndexOf("/")+1);if(g.split("_")[0]===this.recordId){let m=g.substring(g.lastIndexOf(".")+1),x=g.split("_").slice(2).join("_"),k=m==="doc"||m==="docx"||m==="xls"||m==="xlsx"?"preview: false":"preview: true";d.push({type:m,preview:k,key:f,url:`${this.endpoint}/${f}`,value:x})}}}),this.files=d.reverse(),this.files&&this.files.length>0&&this.files.forEach(h=>{h.icon=h.type==="png"?"doctype:image":h.type==="pdf"?"doctype:pdf":h.type==="jpg"||h.type==="jpeg"?"doctype:image":h.type==="xlsx"||h.type==="xls"?"doctype:excel":h.type==="txt"?"doctype:txt":h.type==="doc"||h.type==="docx"?"doctype:word":"doctype:flash"}),(e==="upload"||e==="delete")&&this.updateResponseFilesCount(),this.isInitialLoading=!1}else{console.error("Device is offline");const o=await this.getLocalS3Files();console.log("localFiles",JSON.stringify(o)),s=o}}catch(s){console.error("Error getting files:",s),this.files=[]}finally{this.isInitialLoading=!1}}async updateResponseFilesCount(){const e=this.files.length,s={Id:this.responseData.Id,Rhythm__Files__c:e},t=await oe("Rhythm__Response__c",s);console.log("updateResponseFilesCount result",JSON.stringify(t)),this.dispatchEvent(new CustomEvent("updateresponsefilescount",{detail:{questionId:this.questionId,count:e},bubbles:!0,composed:!0})),console.log("updateResponseFilesCount",t)}open(e){this.responseData=e?.response,this.isOpen=!0,this.isInitialLoading=!1,this.isUploading=!1,this.responseData?.Id?(this.questionId=e?.questionId,this.questionData=e?.question,this.objectApiName="Rhythm__Response__c",this.s3ConfigType!==null&&this.getFiles("list")):(console.log("No response data found"),this.files=[],this.uploadedFiles=[])}handleClose(){this.isOpen=!1,this.dispatchEvent(new CustomEvent("close",{detail:{type:"attachments"},bubbles:!0,composed:!0}))}handleSave(){this.isOpen=!1,this.dispatchEvent(new CustomEvent("close",{detail:{type:"attachments"},bubbles:!0,composed:!0}))}async handleFilePick(){console.log("\u{1F4C1} File picker button clicked");try{console.log("\u{1F680} Calling FilePicker.pickFiles...");const e=await St.pickFiles({multiple:!0,readData:!1});console.log("\u{1F4C4} FilePicker result:",e),e&&e.files&&e.files.length>0?(async t=>{const o=[...t],i=async()=>{if(o.length===0)return;const a=o.shift();console.log("\u{1F4CE} Processing selected file:",a),await this.processSelectedFile(a),await i()};await i()})(e.files):console.log("\u2139\uFE0F No files selected")}catch(e){console.error("\u274C Error picking file:",e)}}handleUploadClick(){this.handleFilePick()}async handleDeleteFile(e){let s;e.target.dataset&&e.target.dataset.key?s=e.target.dataset.key:e.target.parentElement&&e.target.parentElement.dataset&&e.target.parentElement.dataset.key&&(s=e.target.parentElement.dataset.key),this.showSpinner=!0,this.showDeleteModal=!1;try{if(!(await X.getStatus())?.connected){console.error("Device is offline"),this.showSpinner=!1;return}const o=this.files.find(a=>a.key===s||a.id===s);console.log("selectedFile",JSON.stringify(o));let i=!1;if(o&&o.isSalesforceFile)console.log("Deleting Salesforce file:",s),i=await so(o.key);else{console.log("Deleting S3 file:",s);const a=await Ae(s,"delete");console.log("S3 delete response:",a),i=!0}i?(this.files=this.files.filter(a=>a.key!==s&&a.id!==s),this.uploadedFiles=this.uploadedFiles.filter(a=>a.key!==s&&a.id!==s),this.getFiles("delete")):this.errorMessage="Failed to delete file. Please try again.",this.selectedFileKey=s}catch(t){console.error("Error deleting file:",t),this.errorMessage="Error deleting file: "+(t.message||"Unknown error")}finally{this.showSpinner=!1}}async handleCameraCapture(){console.log("\u{1F4F7} Camera capture button clicked");try{console.log("\u{1F680} Launching camera...");const e=await Vt.getPhoto({quality:90,resultType:$t.Uri,source:we.Camera,saveToGallery:!0,allowEditing:!1});if(!e?.webPath){console.error("\u274C Camera did not return webPath:",e);return}console.log("\u{1F4F7} Photo captured successfully:",{webPath:e.webPath,path:e.path,format:e.format});let s="";if(e.webPath){const i=e.webPath.split("/"),a=i[i.length-1],r=a.split("_");if(r.length>1){const l=r[0],c=new Date().toISOString().replace(/[:.]/g,"-");s=`${l}_${c}.jpg`}else s=a}else s=`JPEG_${new Date().toISOString().replace(/[:.]/g,"-")}.jpg`;console.log("\u{1F4F7} Extracted filename:",s);const t={name:s,webPath:e.webPath,path:e.path,mimeType:"image/jpeg",type:"image/jpeg",size:0,uri:e.webPath};await this.processSelectedFile(t,!0),console.log("\u2705 Camera photo processed and queued for upload");const o=this.formatDate(new Date);this.files.unshift({id:this.generateUniqueId(),name:s,size:0,formattedSize:"0 KB",type:"image/jpeg",uploadDate:o})}catch(e){console.error("\u274C Error capturing photo:",e),e.message&&e.message.includes("cancelled")?console.log("Photo capture was cancelled"):console.error("Failed to capture photo:",e.message)}}handleDownloadFile(e){const s=e.currentTarget.dataset.id,t=this.files.find(o=>o.id===s);if(t&&t.file){const o=URL.createObjectURL(t.file),i=document.createElement("a");i.href=o,i.download=t.name,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}else t&&t.url&&window.open(t.url,"_blank")}async awsCall(e,s){const t={filePath:e,type:s};try{const i=await(await fetch("https://i3keec7y9j.execute-api.ap-south-1.amazonaws.com/default/preSignedUrl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("data from AWS call:",JSON.stringify(i)),i}catch(o){return console.error("Error calling AWS API:",o),null}}async filePreview(e){let s;if(e.target.dataset&&e.target.dataset.key?s=e.target.dataset.key:e.target.parentElement&&e.target.parentElement.dataset&&e.target.parentElement.dataset.key&&(s=e.target.parentElement.dataset.key),console.log("key",s),s){this.showSpinner=!0;try{const t=this.files.find(o=>o.key===s||o.id===s);if(t&&t.isOfflineFile)console.log("Previewing offline file:",t),t.webPath?["jpg","jpeg","png","gif"].includes(t.name.split(".").pop().toLowerCase())?(this.previewUrl=t.webPath,this.showFrame=!0,document.body&&document.body.classList.add("modal-open")):this.errorMessage="This file type cannot be previewed while offline.":this.errorMessage="Preview not available for this offline file.";else if(t&&t.isSalesforceFile){console.log("Getting ContentDistribution for Salesforce file:",JSON.stringify(t));const o=await Ae(t.key,"salesforce");console.log("contentDistributionData raw:",JSON.stringify(o));let i="";try{if(o.contentDistribution&&o.contentDistribution.DistributionPublicUrl)i=o.contentDistribution.DistributionPublicUrl;else{const a=o.replace(/\\\\/g,"\\").replace(/\\"/g,'"'),r=JSON.parse(a);r.contentDistribution&&r.contentDistribution.DistributionPublicUrl&&(i=r.contentDistribution.DistributionPublicUrl)}}catch(a){console.error("Error parsing contentDistributionData:",a)}window.open(i,"_blank"),this.previewUrl=i,this.showFrame=!0,this.showSpinner=!1}else{const o=await this.awsCall(s,"preview");console.log("data in preview",o),o&&(this.previewUrl=o,window.open(o,"_blank"),this.showFrame=!0)}}catch(t){console.error("Error loading preview:",t),this.errorMessage="Failed to load preview. Please try again."}finally{this.showSpinner=!1}}else console.error("Preview key is undefined")}handleClosePreview(){this.showFrame=!1,this.previewUrl="",document.body&&document.body.classList.remove("modal-open")}formatFileSize(e){if(e===0)return"0 Bytes";const s=1024,t=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(2))+" "+t[o]}formatDate(e){const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate(),i=e.getFullYear();let a=e.getHours();const r=e.getMinutes().toString().padStart(2,"0"),l=a>=12?"PM":"AM";return a=a%12,a=a||12,`${t} ${o}, ${i}, ${a}:${r} ${l}`}generateUniqueId(){return"file_"+Math.random().toString(36).substr(2,9)}async processSelectedFile(e,s=!1){console.log("\u{1F4CE} Processing selected file:",e),console.log("\u{1F4CA} File properties:",{name:e.name,path:e.path,size:e.size,mimeType:e.mimeType,webPath:e.webPath,uri:e.uri,url:e.url}),this.isUploading=!0,this.errorMessage="";try{const t=e.size||0;let o="post-inspection";const i={id:Pt(),name:e.name,type:e.mimeType||e.type||(s?"image/jpeg":"application/octet-stream"),size:t,webPath:e.webPath||e.path||e.uri||e.url||"",recordId:this.responseData.Id,formType:this.objectApiName,uploaded:!1,createdDate:new Date().toISOString(),lastModifiedDate:new Date().toISOString(),description:o};if(console.log("\u{1F4BE} Created file record:",JSON.stringify(i)),(await X.getStatus())?.connected){const l=await It(i);if(l.success){const c=this.formatDate(new Date),d={id:i.id,name:i.name,size:i.size,formattedSize:this.formatFileSize(i.size),type:i.type,uploadDate:c};this.files=[d,...this.files],this.uploadedFiles.push(d),this.getFiles("upload")}else console.error("Error uploading file:",l.error),this.errorMessage=`Failed to upload file: ${l.error||"Unknown error"}`}else await this.saveFileRecord(i),await this.loadOfflineFiles()}catch(t){console.error("Error processing file:",t),this.errorMessage=`Error processing file: ${t.message||"Unknown error"}`}finally{this.isUploading=!1}}async saveFileRecord(e){try{await U.saveFileWithPath(e),await Ft({id:e.id,type:"UPLOAD_FILE",timestamp:Date.now(),data:e}),console.log("\u{1F4F1} File saved to SQLite queue for later upload:",e)}catch(s){throw console.error("\u274C Error saving file for offline sync:",s),s}}}Y(_i,{publicProps:{recordId:{config:0}},publicMethods:["open"],track:{type:1,isRequired:1,objectApiName:1,questionId:1,questionData:1,responseData:1,isOpen:1,files:1,uploadedFiles:1,showSpinner:1,showDeleteModal:1,showFrame:1,previewUrl:1,selectedFileKey:1,isOffline:1,offlineFiles:1,errorMessage:1,s3ConfigType:1,isUploading:1,isInitialLoading:1},fields:["acceptedFormats"]});const W0=z(_i,{tmpl:z0,sel:"c-attachments-popup",apiVersion:63});function B0(n,e,s){var t=n?"["+n+"]":"";return".comments-container"+t+" {display: flex;flex-direction: column;gap: 16px;}.chat-container"+t+" {height: 350px;overflow-y: auto;padding: 10px;background-color: #f5f5f5;border-radius: 8px;}.chat-messages"+t+" {display: flex;flex-direction: column;gap: 16px;}.message-outgoing"+t+" {align-self: flex-end;max-width: 80%;}.message-incoming"+t+" {align-self: flex-start;max-width: 80%;}.message-header"+t+" {margin-bottom: 4px;}.user-name"+t+" {font-weight: 600;font-size: 12px;}.message-incoming"+t+" .user-name"+t+" {color: #1b2d4f;}.message-outgoing"+t+" .message-header"+t+" {text-align: right;}.message-outgoing"+t+" .user-name"+t+" {color: #0070d2;text-align: right;}.message-bubble"+t+" {padding: 10px 12px;border-radius: 16px;position: relative;}.message-incoming"+t+" .message-bubble"+t+" {background-color: white;border: 1px solid #e1e1e1;border-top-left-radius: 4px;}.message-outgoing"+t+" .message-bubble"+t+" {background-color: #0070d2;color: white;border-top-right-radius: 4px;}.message-text"+t+" {white-space: pre-wrap;word-break: break-word;margin-bottom: 4px;}.message-time"+t+" {font-size: 10px;text-align: right;opacity: 0.8;}.message-incoming"+t+" .message-time"+t+" {color: #706e6b;}.message-outgoing"+t+" .message-time"+t+" {color: rgba(255, 255, 255, 0.9);}.no-comments"+t+" {padding: 16px 0;text-align: center;color: #706e6b;}.no-response-container"+t+" {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 32px 16px;}.no-response-message"+t+" {text-align: center;display: flex;flex-direction: column;align-items: center;gap: 16px;}.no-response-message"+t+" h3"+t+" {margin: 0;font-size: 20px;color: #2a2a2a;}.no-response-message"+t+" p"+t+" {margin: 0;font-size: 16px;color: #706e6b;max-width: 300px;}.no-response-message"+t+" button"+t+" {margin-top: 16px;}.add-comment"+t+" {margin-top: 16px;position: relative;}.comment-textarea"+t+" {width: 98%;min-height: 80px;padding: 12px 0px 12px 12px;border: 1px solid #dddbda;border-radius: 18px;resize: vertical;font-family: inherit;font-size: 14px;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);}.actions"+t+" {display: flex;justify-content: flex-end;gap: 8px;margin-top: 16px;padding-top: 16px;border-top: 1px solid #e1e1e1;}.btn"+t+" {padding: 8px 16px;border-radius: 4px;font-weight: 500;cursor: pointer;}.btn-neutral"+t+" {background-color: white;border: 1px solid #dddbda;color: #0070d2;}.btn-brand"+t+" {background-color: #0070d2;border: 1px solid #0070d2;color: white;}.btn:disabled"+t+" {opacity: 0.5;cursor: not-allowed;}"}var bi=[B0];const H0=p`<div${"c0"}${2}><div class="message-header${0}"${2}><span class="user-name${0}"${2}>${"t3"}</span></div><div class="message-bubble${0}"${2}><div class="message-text${0}"${2}>${"t6"}</div><div class="message-time${0}"${2}>${"t8"}</div></div></div>`,J0=p`<div class="no-comments${0}"${2}><p${3}>No follow-up messages yet.</p></div>`,Q0=p`<div class="add-comment${0}"${2}><textarea class="comment-textarea${0}" placeholder="Type your message here..."${2}>${"t2"}</textarea></div>`,Y0=p`<div class="actions${0}"${2}><button class="btn btn-neutral${0}"${2}>Cancel</button><button class="btn btn-brand${0}"${"a3:disabled"}${2}>Send</button></div>`,K0=p`<div class="no-response-container${0}"${2}><div class="no-response-message${0}"${2}><svg width="48" height="48" viewBox="0 0 24 24" fill="#f8bb86"${3}><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"${3}/></svg><h3${3}>Please Save Response First</h3><p${3}>You need to fill and save the response before you can add follow-up messages.</p><button class="btn btn-brand${0}"${2}>OK</button></div></div>`,G0={classMap:{"comments-container":!0},key:1},X0={classMap:{"chat-container":!0},key:2},Z0={classMap:{"chat-messages":!0},key:3};function rt(n,e,s,t){const{b:o,ncls:i,k:a,d:r,sp:l,st:c,i:d,h,c:u}=n,{_m0:f,_m1:g,_m2:_,_m3:m,_m4:x}=t;return[u("c-popup-modal",Fs,{props:{title:"Follow-Ups",isOpen:e.isOpen},key:0,on:f||(t._m0={close:o(e.handleClose)})},[e.hasResponseId?h("div",G0,[e.hasComments?h("div",X0,[h("div",Z0,d(e.comments,function(k){return c(H0,a(5,k.id),[l(0,{className:i(k.messageClass)},null),l(3,null,r(k.userName)),l(6,null,r(k.text)),l(8,null,r(k.dateFormatted))])}))]):null,e.hasComments?null:c(J0,7),c(Q0,9,[l(1,{on:g||(t._m1={keyup:o(e.handleCommentChange)})},null),l(2,null,r(e.newComment))]),c(Y0,11,[l(1,{on:_||(t._m2={click:o(e.handleClose)})},null),l(3,{on:m||(t._m3={click:o(e.handleSave)}),attrs:{disabled:e.isCommentEmpty?"":null}},null)])]):null,e.hasResponseId?null:c(K0,13,[l(8,{on:x||(t._m4={click:o(e.handleClose)})},null)])])]}var ev=J(rt);rt.stylesheets=[],rt.stylesheetToken="lwc-6gvpbishdqv",rt.legacyStylesheetToken="c-commentsPopup_commentsPopup",bi&&rt.stylesheets.push.apply(rt.stylesheets,bi),Q(rt);class yi extends K{constructor(...e){super(...e);this.recordId=void 0,this.questionId=void 0,this.isOpen=!1,this.comments=[],this.newComment="",this.responseData=void 0,this.currentUser=""}get hasComments(){return this.comments&&this.comments.length>0}get isCommentEmpty(){return!this.newComment||this.newComment.trim()===""}get hasResponseId(){return!!(this.responseData&&this.responseData.Id)}open(e){this.responseData=e?.response,this.questionId=e?.questionId,this.isOpen=!0,this.responseData?.Id&&this.loadComments()}handleClose(){this.isOpen=!1,this.newComment="",this.dispatchEvent(new CustomEvent("close",{detail:{type:"comments"},bubbles:!0,composed:!0}))}handleCommentChange(e){this.newComment=e.target.value}async handleSave(){if(this.isCommentEmpty)return;const e=new Date,s=e.toUTCString(),t={id:this.generateUniqueId(),text:this.newComment,userName:this.currentUser,date:e,dateFormatted:this.formatTime(e),isCurrentUser:!0,messageClass:"message-outgoing"};this.comments=[...this.comments,t],this.scrollToBottom();const o={recipientType:"cad-cd-customer",accountType:"customer",Name:this.currentUser,Text:this.newComment,createdTime:s};let i=[];if(this.responseData?.Rhythm__Conversation_History__c)try{i=JSON.parse(this.responseData.Rhythm__Conversation_History__c),Array.isArray(i)||(i=[])}catch(r){console.error("Error parsing existing conversation history:",r)}i.push(o);const a=await oe("Rhythm__Response__c",{Id:this.responseData.Id,Rhythm__Conversation_History__c:JSON.stringify(i)});console.log("result in handleSave",JSON.stringify(a)),this.dispatchEvent(new CustomEvent("save",{detail:{Id:this.responseData.Id,questionId:this.questionId,Rhythm__Conversation_History__c:JSON.stringify(i)}})),this.newComment=""}async loadComments(){console.log("Loading comments for question:",this.questionId);let e=localStorage.getItem("sf_user_name");if(console.log("log in line 131",e),e)this.currentUser=e;else{let s=sessionStorage.getItem("sf_user_id");s||(s=localStorage.getItem("sf_user_id"));let t=`SELECT Id, Name FROM User WHERE Id = '${s}' LIMIT 1`;const o=await le(t);console.log("userData in handleSave",JSON.stringify(o)),localStorage.setItem("sf_user_name",o[0].Name),this.currentUser=o[0].Name}try{if(this.responseData?.Rhythm__Conversation_History__c){let s;try{s=JSON.parse(this.responseData.Rhythm__Conversation_History__c)}catch(t){console.error("Error parsing conversation history:",t),s=[]}if(Array.isArray(s)&&s.length>0){this.comments=s.map(t=>{const o=new Date(t.createdTime),i=t.Name===this.currentUser;return{id:this.generateUniqueId(),text:t.Text,userName:t.Name,date:o,dateFormatted:this.formatTime(o),isCurrentUser:i,messageClass:i?"message-outgoing":"message-incoming"}}),this.comments.sort((t,o)=>t.date-o.date),this.scrollToBottom();return}}this.comments=[]}catch(s){console.error("Error loading comments:",s),this.comments=[]}}scrollToBottom(){setTimeout(()=>{const e=this.template.querySelector(".chat-container");e&&(e.scrollTop=e.scrollHeight)},100)}formatDate(e){if(!e)return"";const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate(),i=e.getFullYear();let a=e.getHours();const r=e.getMinutes().toString().padStart(2,"0"),l=a>=12?"PM":"AM";return a=a%12,a=a||12,`${t}-${o}-${i} ${a}:${r} ${l}`}formatTime(e){if(!e)return"";let s=e.getHours();const t=e.getMinutes().toString().padStart(2,"0"),o=s>=12?"PM":"AM";return s=s%12,s=s||12,`${s}:${t} ${o}`}generateUniqueId(){return"comment_"+Math.random().toString(36).substr(2,9)}}Y(yi,{publicProps:{recordId:{config:0}},publicMethods:["open"],track:{questionId:1,isOpen:1,comments:1,newComment:1,responseData:1,currentUser:1}});const tv=z(yi,{tmpl:ev,sel:"c-comments-popup",apiVersion:63});function sv(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".action-items-container",t," {display: flex;flex-direction: column;gap: 20px;max-height: 70vh;overflow-y: auto;padding: 4px 2px;}.initial-view",t," {display: flex;justify-content: center;padding: 50px 0;background-color: #f9f9fb;border-radius: 8px;border: 1px solid #e7e7e9;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);}.finding-view",t," {display: flex;flex-direction: column;gap: 24px;}h3",t," {font-size: 17px;font-weight: 600;margin-bottom: 10px;color: #1b2d4f;}.finding-header",t," {display: flex;justify-content: space-between;align-items: flex-start;padding: 20px;background-color: #f8f9fd;border-radius: 10px;border: 1px solid #e5e8f0;box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);transition: box-shadow 0.2s ease;}.finding-header:hover",t," {box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);}.finding-details",t," {flex: 1;}.detail-row",t," {display: flex;margin-bottom: 6px;}.detail-label",t," {font-weight: 600;width: 130px;color: #5a6372;font-size: 14px;}.detail-value",t," {flex: 1;font-size: 14px;color: #16325c;}.edit-button",t," {background: none;border: none;cursor: pointer;padding: 6px;color: #706e6b;border-radius: 50%;transition: all 0.2s ease;}.edit-button:hover",t," {color: #0070d2;background-color: rgba(0, 112, 210, 0.1);}.task-section",t," {display: flex;flex-direction: column;gap: 16px;background-color: #f8f9fd;border-radius: 10px;padding: 20px;border: 1px solid #e5e8f0;box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);}.section-header",t," {border-bottom: 1px solid #e5e8f0;padding-bottom: 10px;margin-bottom: 14px;}.create-task-button-container",t," {display: flex;justify-content: center;}.task-list",t," {display: flex;flex-direction: column;gap: 12px;}.task-item",t,` {background-color: white;border: 1px solid #e5e8f0;border-radius: 8px;padding: 16px;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);transition:\r
 transform 0.15s ease,\r
 box-shadow 0.15s ease;}.task-item:hover`,t," {transform: translateY(-2px);box-shadow: 0 3px 6px rgba(0, 0, 0, 0.06);}.task-header",t," {display: flex;justify-content: space-between;margin-bottom: 8px;}.task-title-status",t," {display: flex;align-items: center;gap: 8px;}.task-title",t," {font-weight: 600;color: #1b2d4f;}.task-status",t," {background-color: #54698d;color: white;padding: 3px 8px;border-radius: 12px;font-size: 12px;font-weight: 500;letter-spacing: 0.2px;}.task-details",t," {font-size: 14px;}.action-items-list",t," {max-height: 300px;overflow-y: auto;}.action-items",t," {list-style: none;padding: 0;margin: 0;}.action-item",t," {padding: 12px;border: 1px solid #e1e1e1;border-radius: 4px;margin-bottom: 8px;background-color: #f9f9f9;}.action-item-header",t," {display: flex;justify-content: space-between;margin-bottom: 8px;}.action-title-status",t," {display: flex;align-items: center;gap: 8px;}.action-title",t," {font-weight: 600;color: #1b2d4f;}.status-new",t," {background-color: #54698d;color: white;padding: 2px 6px;border-radius: 10px;font-size: 12px;}.status-in-progress",t," {background-color: #0070d2;color: white;padding: 2px 6px;border-radius: 10px;font-size: 12px;}.status-completed",t," {background-color: #4bca81;color: white;padding: 2px 6px;border-radius: 10px;font-size: 12px;}.action-dates",t," {font-size: 12px;color: #706e6b;}.action-item-body",t," {margin-bottom: 8px;}.action-item-body",t," p",t," {margin: 0;white-space: pre-wrap;word-break: break-word;}.action-item-footer",t," {display: flex;justify-content: space-between;align-items: center;font-size: 12px;color: #706e6b;}.btn-icon",t," {background: none;border: none;color: #706e6b;cursor: pointer;padding: 4px;}.btn-icon:hover",t," {color: #c23934;}.no-action-items",t," {padding: 16px 0;text-align: center;color: #706e6b;}.add-action-item",t," {margin-top: 16px;}.form-group",t," {margin-bottom: 20px;padding: 0;}.finding-form",t,",\r.task-form",t," {background-color: white;border-radius: 10px;padding: 24px 32px;border: 1px solid #e5e8f0;margin-top: 8px;box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);}.form-row",t," {display: flex;gap: 16px;}.form-group.half",t," {flex: 1;}label",t," {display: block;margin-bottom: 6px;font-weight: 500;color: #16325c;font-size: 14px;}label.required",t,"::after {content: ' *';color: #c23934;}.select-container",t," {position: relative;width: 100%;}.select-container",t," select",t," {-webkit-appearance: none;-moz-appearance: none;appearance: none;}.select-container",t,"::after {content: '\u25BC';position: absolute;right: 16px;top: 50%;transform: translateY(-50%);color: #706e6b;pointer-events: none;font-size: 12px;}.form-control",t,` {width: 100%;padding: 10px 16px;border: 1px solid #d8dde6;border-radius: 6px;font-size: 14px;transition:\r
 border-color 0.2s ease,\r
 box-shadow 0.2s ease;box-sizing: border-box;}.form-control:focus`,t," {outline: none;border-color: #0070d2;box-shadow: 0 0 0 1px #0070d2;}.form-control:disabled",t," {background-color: #f3f3f3;cursor: not-allowed;}.file-upload-container",t," {border: 2px dashed #d8dde6;border-radius: 8px;padding: 20px;text-align: center;background-color: #f9fafc;transition: all 0.2s ease;}.file-upload-container:hover",t," {border-color: #0070d2;background-color: #f4f6fa;}.upload-button-container",t," {display: flex;flex-direction: column;align-items: center;gap: 8px;}.action-button",t," {display: flex;align-items: center;gap: 8px;background-color: #0070d2;color: white;border: none;border-radius: 4px;padding: 10px 16px;font-size: 14px;font-weight: 500;cursor: pointer;transition: background-color 0.2s ease;}.action-button:hover",t," {background-color: #005fb2;}.action-button",t," .icon",t," {flex-shrink: 0;}.selected-files",t," {margin-top: 12px;text-align: left;}.selected-file",t," {display: flex;justify-content: space-between;align-items: center;padding: 8px 12px;background-color: #f2f6fc;border-radius: 6px;margin-bottom: 6px;border: 1px solid #e5e8f0;transition: background-color 0.2s ease;}.selected-file:hover",t," {background-color: #edf2fa;}.file-name",t," {font-size: 13px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;max-width: 200px;}.remove-file",t," {background: none;border: none;color: #706e6b;cursor: pointer;padding: 4px;}.remove-file:hover",t," {color: #c23934;}textarea.form-control",t," {min-height: 100px;resize: vertical;padding: 12px 16px;}.search-container",t," {position: relative;}.search-results",t," {position: absolute;top: 100%;left: 0;right: 0;max-height: 200px;overflow-y: auto;background-color: white;border: 1px solid #d8dde6;border-radius: 0 0 6px 6px;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);z-index: 10;}.search-item",t," {padding: 10px 16px;cursor: pointer;transition: background-color 0.2s ease;}.search-item:hover",t," {background-color: #f2f6fc;}.search-item.loading",t," {color: #706e6b;font-style: italic;}.search-item.no-results",t," {color: #706e6b;font-style: italic;cursor: default;}.selected-owner",t," {display: flex;align-items: center;justify-content: space-between;margin-top: 8px;padding: 6px 10px;background-color: #f2f6fc;border: 1px solid #d8dde6;border-radius: 4px;}.clear-owner",t," {background: none;border: none;color: #706e6b;font-size: 16px;cursor: pointer;padding: 0 4px;}.clear-owner:hover",t," {color: #c23934;}.actions",t," {display: flex;justify-content: flex-end;gap: 8px;margin-top: 16px;padding-top: 16px;border-top: 1px solid #e1e1e1;}.btn",t," {padding: 10px 18px;border-radius: 6px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;font-size: 14px;letter-spacing: 0.2px;}.btn-neutral",t," {background-color: white;border: 1px solid #d8dde6;color: #0070d2;}.btn-neutral:hover",t," {background-color: #f4f6f9;border-color: #0070d2;}.btn-brand",t," {background-color: #0070d2;border: 1px solid #0070d2;color: white;box-shadow: 0 2px 4px rgba(0, 112, 210, 0.1);}.btn-brand:hover",t," {background-color: #005fb2;border-color: #005fb2;box-shadow: 0 4px 8px rgba(0, 112, 210, 0.2);}.btn-purple",t," {background-color: #6a4feb;border: 1px solid #6a4feb;color: white;padding: 10px 18px;border-radius: 6px;font-weight: 500;cursor: pointer;box-shadow: 0 2px 4px rgba(106, 79, 235, 0.2);transition: all 0.2s ease;}.btn-purple:hover",t," {background-color: #5a3fd0;box-shadow: 0 4px 8px rgba(106, 79, 235, 0.3);transform: translateY(-1px);}.btn-outline",t," {background-color: white;border: 1px solid #0070d2;color: #0070d2;padding: 10px 18px;border-radius: 6px;font-weight: 500;cursor: pointer;transition: all 0.2s ease;}.btn-outline:hover",t," {background-color: #f4f6f9;box-shadow: 0 2px 4px rgba(0, 112, 210, 0.1);}.no-response-container",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 40px 20px;background-color: #f9fafc;border-radius: 10px;border: 1px solid #e5e8f0;}.no-response-message",t," {text-align: center;display: flex;flex-direction: column;align-items: center;gap: 16px;}.no-response-message",t," h3",t," {margin: 0;font-size: 22px;color: #16325c;font-weight: 600;}.no-response-message",t," p",t," {margin: 0;font-size: 16px;color: #54698d;max-width: 340px;line-height: 1.5;}.no-response-message",t," button",t," {margin-top: 16px;}.btn:disabled",t," {opacity: 0.5;cursor: not-allowed;}.spinner-container",t," {position: absolute;top: 0;left: 0;right: 0;bottom: 0;display: flex;align-items: center;justify-content: center;background-color: rgba(255, 255, 255, 0.8);z-index: 10;border-radius: 0.25rem;}.spinner",t," {height: 2rem;width: 2rem;border: 0.25rem solid #d8dde6;border-radius: 50%;border-top-color: #0176d3;animation: spin",o," 1s linear infinite;}.sr-only",t," {position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0, 0, 0, 0);border: 0;}@keyframes spin",o," {to {transform: rotate(360deg);}}"].join("")}var vi=[sv];const ov=p`<div class="spinner-container${0}"${2}><div class="spinner${0}" role="status"${2}><span class="sr-only${0}"${2}>Loading...</span></div></div>`,iv=p`<div class="no-response-container${0}"${2}><div class="no-response-message${0}"${2}><svg width="48" height="48" viewBox="0 0 24 24" fill="#f8bb86"${3}><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"${3}/></svg><h3${3}>Please Save Response First</h3><p${3}>You need to fill and save the response before you can add assessment findings.</p><button class="btn btn-brand${0}"${2}>OK</button></div></div>`,av=p`<div class="initial-view${0}"${2}><button class="btn btn-purple${0}"${2}>Create New Finding</button></div>`,nv=p`<div class="finding-header${0}"${2}><div class="finding-details${0}"${2}><div class="detail-row${0}"${2}><div class="detail-label${0}"${2}>Finding Name:</div><div class="detail-value${0}"${2}>${"t6"}</div></div><div class="detail-row${0}"${2}><div class="detail-label${0}"${2}>Finding Type:</div><div class="detail-value${0}"${2}>${"t11"}</div></div><div class="detail-row${0}"${2}><div class="detail-label${0}"${2}>Status:</div><div class="detail-value${0}"${2}>${"t16"}</div></div></div><button class="edit-button${0}"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M15.5 3.5l-3-3c-.5-.5-1.3-.5-1.8 0l-1.2 1.2 3.8 3.8 1.2-1.2c.5-.5.5-1.3 0-1.8zM1.7 11.7L0 16l4.3-1.7L14.6 4 10.8.2 1.7 11.7z"${3}/></svg></button></div>`,rv=p`<div class="section-header${0}"${2}><h3${3}>Task Details</h3></div>`,lv=p`<button class="btn btn-purple${0}"${2}>Create New</button>`,cv=p`<div class="task-item${0}"${2}><div class="task-header${0}"${2}><div class="task-title-status${0}"${2}><span class="task-title${0}"${2}>${"t4"}</span><span class="task-status${0}"${2}>${"t6"}</span></div><button class="edit-button${0}"${"a7:data-id"}${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M15.5 3.5l-3-3c-.5-.5-1.3-.5-1.8 0l-1.2 1.2 3.8 3.8 1.2-1.2c.5-.5.5-1.3 0-1.8zM1.7 11.7L0 16l4.3-1.7L14.6 4 10.8.2 1.7 11.7z"${3}/></svg></button></div><div class="task-details${0}"${2}><div class="detail-row${0}"${2}><div class="detail-label${0}"${2}>Due Date:</div><div class="detail-value${0}"${2}>${"t15"}</div></div><div class="detail-row${0}"${2}><div class="detail-label${0}"${2}>Priority:</div><div class="detail-value${0}"${2}>${"t20"}</div></div></div></div>`,dv=p`<label${"a0:for"} class="required${0}"${2}>Assessment Findings Name</label>`,hv=p`<label${"a0:for"}${3}>Finding Type</label>`,uv=p`<option value${3}>--None--</option>`,pv=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,fv=p`<div class="form-group${0}"${2}><label${"a1:for"} class="required${0}"${2}>Finding Description</label><textarea${"a3:id"} class="form-control${0}" placeholder="Enter description" data-field="Rhythm__Finding_Description__c" required${2}>${"t4"}</textarea></div>`,mv=p`<label${"a0:for"}${3}>Root Cause</label>`,gv=p`<option value${3}>--None--</option>`,_v=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,bv=p`<label${"a0:for"}${3}>Repeat Finding</label>`,yv=p`<option value${3}>--None--</option>`,vv=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,wv=p`<label${"a0:for"}${3}>Resolution Time Frame</label>`,xv=p`<option value${3}>--None--</option>`,kv=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,$v=p`<label${"a0:for"} class="required${0}"${2}>Assessment Area</label>`,Cv=p`<label${"a0:for"}${3}>Status</label>`,Sv=p`<option value${3}>--None--</option>`,Ev=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,Rv=p`<label${3}>Attachments</label>`,Av=p`<div class="upload-button-container${0}"${2}><button class="action-button${0}" title="Upload Files"${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm0 2.5L18.5 9H14zM8 13h8v2H8zm0 4h8v2H8zm0-8h4v2H8z"${3}/></svg>Upload Files</button></div>`,Iv=p`<div class="selected-file${0}"${2}><span class="file-name${0}"${2}>${"t2"}</span><button class="remove-file${0}"${"a3:data-name"}${2}><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"${3}><path d="M7.4 6l4.3-4.3c0.4-0.4 0.4-1 0-1.4s-1-0.4-1.4 0L6 4.6 1.7 0.3c-0.4-0.4-1-0.4-1.4 0s-0.4 1 0 1.4L4.6 6 0.3 10.3c-0.4 0.4-0.4 1 0 1.4 0.2 0.2 0.4 0.3 0.7 0.3s0.5-0.1 0.7-0.3L6 7.4l4.3 4.3c0.2 0.2 0.5 0.3 0.7 0.3s0.5-0.1 0.7-0.3c0.4-0.4 0.4-1 0-1.4L7.4 6z"${3}/></svg></button></div>`,Fv=p`<div class="selected-file${0}"${2}><span class="file-name${0}"${2}>${"t2"}</span></div>`,Dv=p`<div class="section-header${0}"${2}><h3${3}>Task Details</h3></div>`,Tv=p`<label${"a0:for"} class="required${0}"${2}>Subject</label>`,Ov=p`<div class="form-group${0}"${2}><label${"a1:for"}${3}>Comments</label><textarea${"a3:id"} class="form-control${0}" placeholder="Enter description" data-field="Description"${2}>${"t4"}</textarea></div>`,Lv=p`<label${"a0:for"} class="required${0}"${2}>Due Date</label>`,Nv=p`<label${"a0:for"} class="required${0}"${2}>Priority</label>`,Mv=p`<option value${3}>--NONE--</option>`,Pv=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,jv=p`<label${"a0:for"} class="required${0}"${2}>Status</label>`,Uv=p`<option value${3}>NONE</option>`,Vv=p`<option${"a0:value"}${"a0:selected"}${3}>${"t1"}</option>`,qv=p`<label${"a0:for"} class="required${0}"${2}>Assigned To</label>`,zv=p`<div class="search-item loading${0}"${2}>Searching...</div>`,Wv=p`<div class="search-item${0}"${"a0:data-id"}${"a0:data-name"}${2}>${"t1"}</div>`,Bv=p`<div class="search-item no-results${0}"${2}>No users found</div>`,Hv=p`<div class="selected-owner${0}"${2}><span${3}>${"t2"}</span><button type="button" class="clear-owner${0}"${2}>×</button></div>`,Jv=p`<label${3}>Attachments</label>`,Qv=p`<div class="upload-button-container${0}"${2}><button class="action-button${0}" title="Upload Files"${2}><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="icon${0}"${2}><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm0 2.5L18.5 9H14zM8 13h8v2H8zm0 4h8v2H8zm0-8h4v2H8z"${3}/></svg>Upload Files</button></div>`,Yv=p`<div class="selected-file${0}"${2}><span class="file-name${0}"${2}>${"t2"}</span><button class="remove-file${0}"${"a3:data-name"}${2}><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"${3}><path d="M7.4 6l4.3-4.3c0.4-0.4 0.4-1 0-1.4s-1-0.4-1.4 0L6 4.6 1.7 0.3c-0.4-0.4-1-0.4-1.4 0s-0.4 1 0 1.4L4.6 6 0.3 10.3c-0.4 0.4-0.4 1 0 1.4 0.2 0.2 0.4 0.3 0.7 0.3s0.5-0.1 0.7-0.3L6 7.4l4.3 4.3c0.2 0.2 0.5 0.3 0.7 0.3s0.5-0.1 0.7-0.3c0.4-0.4 0.4-1 0-1.4L7.4 6z"${3}/></svg></button></div>`,Kv=p`<div class="selected-file${0}"${2}><span class="file-name${0}"${2}>${"t2"}</span></div>`,Gv=p`<button class="btn btn-neutral${0}"${2}>Cancel</button>`,Xv=p`<button class="btn btn-brand${0}"${"a0:disabled"}${2}>Save</button>`,Zv=p`<button class="btn btn-neutral${0}"${2}>Close</button>`,ew={classMap:{"action-items-container":!0},key:1},tw={classMap:{"finding-view":!0},key:8},sw={classMap:{"task-section":!0},key:11},ow={classMap:{"create-task-button-container":!0},key:14},iw={classMap:{"task-list":!0},key:17},aw={classMap:{"finding-form":!0},key:20},nw={classMap:{"form-group":!0},key:21},ue={"form-control":!0},rw={classMap:{"form-group":!0},key:25},lw={classMap:{"select-container":!0},key:28},cw={classMap:{"form-group":!0},key:36},dw={classMap:{"select-container":!0},key:39},hw={classMap:{"form-group":!0},key:45},uw={classMap:{"select-container":!0},key:48},pw={classMap:{"form-group":!0},key:54},fw={classMap:{"select-container":!0},key:57},mw={classMap:{"form-group":!0},key:63},gw={classMap:{"form-group":!0},key:67},_w={classMap:{"select-container":!0},key:70},bw={classMap:{"form-group":!0},key:76},yw={classMap:{"file-upload-container":!0},key:79},vw={classMap:{"selected-files":!0},key:82},ww={classMap:{"selected-files":!0},key:85},xw={classMap:{"task-form":!0},key:88},kw={classMap:{"form-group":!0},key:91},$w={classMap:{"form-group":!0},key:97},Cw={classMap:{"form-group":!0},key:101},Sw={classMap:{"select-container":!0},key:104},Ew={classMap:{"form-group":!0},key:110},Rw={classMap:{"select-container":!0},key:113},Aw={classMap:{"form-group":!0},key:119},Iw={classMap:{"search-container":!0},key:122},Fw={classMap:{"search-results":!0},key:124},wi=[],Dw={classMap:{"form-group":!0},key:133},Tw={classMap:{"file-upload-container":!0},key:136},Ow={classMap:{"selected-files":!0},key:139},Lw={classMap:{"selected-files":!0},key:142},Nw={classMap:{actions:!0},key:145};function lt(n,e,s,t){const{b:o,st:i,sp:a,d:r,h:l,k:c,i:d,gid:h,f:u,c:f}=n,{_m0:g,_m1:_,_m2:m,_m3:x,_m4:k,_m5:$,_m6:S,_m7:O,_m8:F,_m9:D,_m10:v,_m11:A,_m12:w,_m13:y,_m14:C,_m15:I,_m16:L,_m17:N,_m18:T,_m19:q,_m20:te,_m21:pe,_m22:Ne,_m23:fe,_m24:Ce,_m25:_e,_m26:Se,_m27:xe,_m28:Ee,_m29:be,_m30:Re,_m31:ye,_m32:ke}=t;return[f("c-popup-modal",Fs,{props:{title:"Assessment Findings",isOpen:e.isOpen},key:0,on:g||(t._m0={close:o(e.handleClose)})},[l("div",ew,[e.isLoading?i(ov,3):null,e.hasResponseId?null:i(iv,5,[a(8,{on:_||(t._m1={click:o(e.handleClose)})},null)]),e.showInitialView?i(av,7,[a(1,{on:m||(t._m2={click:o(e.handleCreateFinding)})},null)]):null,e.showFindingViewAndNoForms?l("div",tw,[e.hasFinding?i(nv,10,[a(6,null,r(e.currentFinding.Name)),a(11,null,r(e.currentFinding.Rhythm__Finding_Type__c)),a(16,null,r(e.currentFinding.Rhythm__Status__c)),a(17,{on:x||(t._m3={click:o(e.handleEditFinding)})},null)]):null,e.hasFinding?l("div",sw,[i(rv,13),e.showTaskForm?null:l("div",ow,[e.hasTasks?null:i(lv,16,[a(0,{on:$||(t._m5={click:o(e.handleCreateTask)})},null)])]),e.hasTasks?l("div",iw,d(e.tasks,function(M){return i(cv,c(19,M.Id),[a(4,null,r(M.Subject)),a(6,null,r(M.Status)),a(7,{on:S||(t._m6={click:o(e.handleEditTask)}),attrs:{"data-id":M.Id}},null),a(15,null,r(M.ActivityDate)),a(20,null,r(M.Priority))])})):null]):null]):null,e.showFindingForm?l("div",aw,[l("div",nw,[i(dv,23,[a(0,{attrs:{for:h("finding-name")}},null)]),l("input",{classMap:ue,attrs:{type:"text",id:h("finding-name"),placeholder:"Enter name","data-field":"Name",required:""},props:{value:e.findingFields.Name},key:24,on:O||(t._m7={change:o(e.handleFindingFieldChange)})})]),l("div",rw,[i(hv,27,[a(0,{attrs:{for:h("finding-type")}},null)]),l("div",lw,[l("select",{classMap:ue,attrs:{id:h("finding-type"),"data-field":"Rhythm__Finding_Type__c"},key:29,on:F||(t._m8={change:o(e.handleFindingFieldChange)})},u([i(uv,31),d(e.findingTypeOptions,function(M){return i(pv,c(33,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),i(fv,35,[a(1,{attrs:{for:h("finding-description")}},null),a(3,{on:D||(t._m9={change:o(e.handleFindingFieldChange)}),attrs:{id:h("finding-description")}},null),a(4,null,r(e.findingFields.Rhythm__Finding_Description__c))]),l("div",cw,[i(mv,38,[a(0,{attrs:{for:h("root-cause")}},null)]),l("div",dw,[l("select",{classMap:ue,attrs:{id:h("root-cause"),"data-field":"Rhythm__Root_Cause__c"},key:40,on:v||(t._m10={change:o(e.handleFindingFieldChange)})},u([i(gv,42),d(e.rootCauseOptions,function(M){return i(_v,c(44,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),l("div",hw,[i(bv,47,[a(0,{attrs:{for:h("repeat-finding")}},null)]),l("div",uw,[l("select",{classMap:ue,attrs:{id:h("repeat-finding"),"data-field":"Rhythm__Repeat_Finding__c"},key:49,on:A||(t._m11={change:o(e.handleFindingFieldChange)})},u([i(yv,51),d(e.repeatFindingOptions,function(M){return i(vv,c(53,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),l("div",pw,[i(wv,56,[a(0,{attrs:{for:h("resolution-time-frame")}},null)]),l("div",fw,[l("select",{classMap:ue,attrs:{id:h("resolution-time-frame"),"data-field":"Rhythm__Resolution_Time_Frame__c"},key:58,on:w||(t._m12={change:o(e.handleFindingFieldChange)})},u([i(xv,60),d(e.timeFrameOptions,function(M){return i(kv,c(62,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),l("div",mw,[i($v,65,[a(0,{attrs:{for:h("assessment-area")}},null)]),l("input",{classMap:ue,attrs:{type:"text",id:h("assessment-area"),disabled:""},props:{value:e.findingFields.Rhythm__Assessment_Area__c},key:66})]),l("div",gw,[i(Cv,69,[a(0,{attrs:{for:h("finding-status")}},null)]),l("div",_w,[l("select",{classMap:ue,attrs:{id:h("finding-status"),"data-field":"Rhythm__Status__c"},key:71,on:y||(t._m13={change:o(e.handleFindingFieldChange)})},u([i(Sv,73),d(e.statusOptions,function(M){return i(Ev,c(75,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),l("div",bw,[i(Rv,78),l("div",yw,[i(Av,81,[a(1,{on:C||(t._m14={click:o(e.handleFindingFilePick)})},null)]),e.hasFindingFiles?l("div",vw,d(e.findingFiles,function(M){return i(Iv,c(84,M.name),[a(2,null,r(M.name)),a(3,{on:I||(t._m15={click:o(e.handleRemoveFindingFile)}),attrs:{"data-name":M.name}},null)])})):null,l("div",ww,d(e.keyList,function(M,ve){return i(Fv,c(87,M.key),[a(2,null,r(M.value))])}))])])]):null,e.showTaskForm?l("div",xw,[i(Dv,90),l("div",kw,[i(Tv,93,[a(0,{attrs:{for:h("task-subject")}},null)]),l("input",{classMap:ue,attrs:{type:"text",id:h("task-subject"),placeholder:"Enter subject","data-field":"Subject",required:"",disabled:e.isEditingTask?"":null},props:{value:e.taskFields.Subject},key:94,on:L||(t._m16={change:o(e.handleTaskFieldChange)})})]),i(Ov,96,[a(1,{attrs:{for:h("task-description")}},null),a(3,{on:N||(t._m17={change:o(e.handleTaskFieldChange)}),attrs:{id:h("task-description")}},null),a(4,null,r(e.taskFields.Description))]),l("div",$w,[i(Lv,99,[a(0,{attrs:{for:h("task-due-date")}},null)]),l("input",{classMap:ue,attrs:{type:"date",id:h("task-due-date"),"data-field":"ActivityDate",required:"",disabled:e.isEditingTask?"":null},props:{value:e.taskFields.ActivityDate},key:100,on:T||(t._m18={change:o(e.handleTaskFieldChange)})})]),l("div",Cw,[i(Nv,103,[a(0,{attrs:{for:h("task-priority")}},null)]),l("div",Sw,[l("select",{classMap:ue,attrs:{id:h("task-priority"),"data-field":"Priority",required:"",disabled:e.isEditingTask?"":null},key:105,on:q||(t._m19={change:o(e.handleTaskFieldChange)})},u([i(Mv,107),d(e.priorityOptions,function(M){return i(Pv,c(109,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),l("div",Ew,[i(jv,112,[a(0,{attrs:{for:h("task-status")}},null)]),l("div",Rw,[l("select",{classMap:ue,attrs:{id:h("task-status"),"data-field":"Status",required:""},key:114,on:te||(t._m20={change:o(e.handleTaskFieldChange)})},u([i(Uv,116),d(e.taskStatusOptions,function(M){return i(Vv,c(118,M.value),[a(0,{attrs:{value:M.value,selected:M.selected?"":null}},null),a(1,null,r(M.label))])})]))])]),l("div",Aw,[i(qv,121,[a(0,{attrs:{for:h("task-owner")}},null)]),l("div",Iw,[l("input",{classMap:ue,attrs:{type:"text",id:h("task-owner-search"),placeholder:"Search for user"},props:{value:e.ownerSearchTerm},key:123,on:pe||(t._m21={keyup:o(e.handleOwnerSearch)})}),e.showOwnerSearchResults?l("div",Fw,u([e.isSearching?i(zv,126):null,e.isSearching?wi:u([e.hasOwnerSearchResults?d(e.ownerSearchResults,function(M){return i(Wv,c(128,M.Id),[a(0,{on:fe||(t._m23={click:o(e.handleUserSelect)}),attrs:{"data-id":M.Id,"data-name":M.Name}},null),a(1,null,r(M.Name))])}):wi,e.hasOwnerSearchResults?null:i(Bv,130)])])):null]),e.selectedOwner?i(Hv,132,[a(2,null,r(e.selectedOwner.Name)),a(3,{on:Ce||(t._m24={click:o(e.clearSelectedOwner)})},null)]):null]),l("div",Dw,[i(Jv,135),l("div",Tw,[i(Qv,138,[a(1,{on:_e||(t._m25={click:o(e.handleTaskFilePick)})},null)]),e.hasTaskFiles?l("div",Ow,d(e.taskFiles,function(M){return i(Yv,c(141,M.name),[a(2,null,r(M.name)),a(3,{on:Se||(t._m26={click:o(e.handleRemoveTaskFile)}),attrs:{"data-name":M.name}},null)])})):null,l("div",Lw,d(e.keyList,function(M,ve){return i(Kv,c(144,M.key),[a(2,null,r(M.value))])}))])])]):null,l("div",Nw,[e.showSaveButton?i(Gv,147,[a(0,{on:Ee||(t._m28={click:o(e.handleCancelForm)})},null)]):null,e.showSaveButton?i(Xv,149,[a(0,{on:Re||(t._m30={click:o(e.handleSave)}),attrs:{disabled:e.isSaveDisabled?"":null}},null)]):null,e.showSaveButton?null:i(Zv,151,[a(0,{on:ke||(t._m32={click:o(e.handleClose)})},null)])])])])]}var Mw=J(lt);lt.stylesheets=[],lt.stylesheetToken="lwc-3oar88e3533",lt.legacyStylesheetToken="c-actionItemsPopup_actionItemsPopup",vi&&lt.stylesheets.push.apply(lt.stylesheets,vi),Q(lt);class xi extends K{constructor(...e){super(...e);this.recordId=void 0,this.sectionName=void 0,this.questionId=void 0,this.isOpen=!1,this.tasks=[],this.responseData=void 0,this.keyList=[],this.showInitialView=!1,this.showFindingView=!1,this.showFindingForm=!1,this.showTaskForm=!1,this.isEditingFinding=!1,this.isEditingTask=!1,this.currentFinding=null,this.currentTaskId=null,this.isSaving=!1,this.isLoading=!1,this.s3ConfigType=null,this.findingFields={Id:null,Name:"",Rhythm__Finding_Type__c:"",Rhythm__Finding_Description__c:"",Rhythm__Root_Cause__c:"",Rhythm__Repeat_Finding__c:"",Rhythm__Resolution_Time_Frame__c:"",Rhythm__Assessment_Area__c:"",Rhythm__Status__c:"",Rhythm__Supplier_Response__c:"",Rhythm__Assessment__c:"",Rhythm__AccountAssessmentRelation__c:"",Rhythm__Assessment_Question__c:""},this.taskFields={Id:null,Subject:"",Description:"",ActivityDate:"",Priority:"",Status:"",OwnerId:""},this.findingFiles=[],this.taskFiles=[],this.findingTypeOptions=[],this.rootCauseOptions=[],this.repeatFindingOptions=[],this.timeFrameOptions=[],this.statusOptions=[],this.priorityOptions=[],this.taskStatusOptions=[],this.ownerSearchTerm="",this.ownerSearchResults=[],this.allUsers=[],this.showOwnerSearchResults=!1,this.isSearching=!1,this.selectedOwner=null,this.accountAssessmentData=void 0}get hasResponseId(){return!!(this.responseData&&this.responseData.Id)}get hasFinding(){return this.currentFinding!==null}get hasTasks(){return this.tasks&&this.tasks.length>0}get hasFindingFiles(){return this.findingFiles&&this.findingFiles.length>0}get hasTaskFiles(){return this.taskFiles&&this.taskFiles.length>0}get hasOwnerSearchResults(){return this.ownerSearchResults&&this.ownerSearchResults.length>0}get showSaveButton(){return this.showFindingForm||this.showTaskForm}get showAnyForm(){return this.showFindingForm||this.showTaskForm}get showFindingViewAndNoForms(){return this.showFindingView&&!this.showAnyForm}get isSaveDisabled(){return this.isSaving?!0:this.showFindingForm?!this.findingFields.Name||!this.findingFields.Rhythm__Finding_Description__c:this.showTaskForm?!this.taskFields.Subject||!this.taskFields.ActivityDate||!this.taskFields.Priority||!this.taskFields.Status||!this.taskFields.OwnerId:!1}async open(e){this.isLoading=!0,this.questionId=e?.questionId,this.responseData=e?.response,this.accountAssessmentData=e?.accountAssessmentData,this.isOpen=!0,console.log("data",JSON.stringify(e)),console.log("this.responseData",JSON.stringify(this.responseData)),console.log("data?.question?.sectionName",e?.question?.sectionName);try{const s=await Mt();this.s3ConfigType=s?.Rhythm__customValue__c||null,console.log("\u{1F50D} S3 Configuration type:",this.s3ConfigType)}catch(s){console.error("Error getting S3 configuration:",s)}try{this.responseData?.Id?(await this.loadPicklistValues(),e?.question?.sectionName&&(this.findingFields.Rhythm__Assessment_Area__c=e?.question?.sectionName),this.accountAssessmentData[0]?.Rhythm__Assessment__c&&(this.findingFields.Rhythm__Assessment__c=this.accountAssessmentData[0].Rhythm__Assessment__c),this.accountAssessmentData[0]?.Id&&(this.findingFields.Rhythm__AccountAssessmentRelation__c=this.accountAssessmentData[0].Id),this.responseData?.Rhythm__Question__c&&(this.findingFields.Rhythm__Assessment_Question__c=this.responseData.Rhythm__Question__c),await this.checkExistingFinding(e)):(console.log("No response data found - showing message to save response first"),this.showInitialView=!1,this.showFindingView=!1,this.showFindingForm=!1,this.showTaskForm=!1)}catch(s){console.error("Error loading data:",s)}finally{this.isLoading=!1}}resetState(){this.showInitialView=!1,this.showFindingView=!1,this.showFindingForm=!1,this.showTaskForm=!1,this.isEditingFinding=!1,this.isEditingTask=!1,this.currentFinding=null,this.currentTaskId=null,this.isSaving=!1,this.resetFindingForm(),this.resetTaskForm(),this.findingFiles=[],this.taskFiles=[],this.tasks=[]}resetFindingForm(){this.findingFields={Id:null,Name:"",Rhythm__Finding_Type__c:"",Rhythm__Finding_Description__c:"",Rhythm__Root_Cause__c:"",Rhythm__Repeat_Finding__c:"",Rhythm__Resolution_Time_Frame__c:"",Rhythm__Assessment_Area__c:this.sectionName||"",Rhythm__Status__c:"",Rhythm__Supplier_Response__c:this.responseData.Id,Rhythm__Assessment__c:this.accountAssessmentData[0].Rhythm__Assessment__c,Rhythm__AccountAssessmentRelation__c:this.accountAssessmentData[0].Id,Rhythm__Assessment_Question__c:this.responseData.Rhythm__Question__c}}resetTaskForm(){this.taskFields={Id:null,Subject:"",Description:"",ActivityDate:"",Priority:"",Status:"",OwnerId:""},this.ownerSearchTerm="",this.ownerSearchResults=[],this.showOwnerSearchResults=!1,this.selectedOwner=null}handleClose(){this.isOpen=!1,this.resetState(),this.dispatchEvent(new CustomEvent("close",{detail:{type:"actionItems"},bubbles:!0,composed:!0}))}handleCancelForm(){this.showFindingForm=!1,this.showTaskForm=!1,this.isEditingFinding=!1,this.isEditingTask=!1,this.currentFinding?this.showFindingView=!0:(this.showInitialView=!0,this.showFindingView=!1),this.findingFiles=[],this.taskFiles=[]}async loadPicklistValues(){this.isLoading=!0;try{const e=await vt("Rhythm__Assessment_Finding__c"),s=e.fields.find(d=>d.name==="Rhythm__Finding_Type__c");s&&s.picklistValues&&(this.findingTypeOptions=s.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value})));const t=e.fields.find(d=>d.name==="Rhythm__Root_Cause__c");t&&t.picklistValues&&(this.rootCauseOptions=t.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value})));const o=e.fields.find(d=>d.name==="Rhythm__Repeat_Finding__c");o&&o.picklistValues&&(this.repeatFindingOptions=o.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value})));const i=e.fields.find(d=>d.name==="Rhythm__Resolution_Time_Frame__c");i&&i.picklistValues&&(this.timeFrameOptions=i.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value})));const a=e.fields.find(d=>d.name==="Rhythm__Status__c");a&&a.picklistValues&&(this.statusOptions=a.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value})));const r=await vt("Task"),l=r.fields.find(d=>d.name==="Priority");l&&l.picklistValues&&(this.priorityOptions=l.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value})));const c=r.fields.find(d=>d.name==="Status");c&&c.picklistValues&&(this.taskStatusOptions=c.picklistValues.filter(d=>d.active).map(d=>({label:d.label,value:d.value}))),await this.loadAllUsers()}catch(e){console.error("Error loading picklist values:",e)}finally{this.isLoading=!1}}async checkExistingFinding(e){this.isLoading=!0;try{e?.assessmentFinding?(this.currentFinding=e?.assessmentFinding,this.showInitialView=!1,this.showFindingView=!0,this.showFindingForm=!1,this.isEditingFinding=!0,this.findingFields={...e?.assessmentFinding},console.log("this.findingFields",JSON.stringify(this.findingFields)),this.updateSelectedOptions(),e.relatedTasks&&e.relatedTasks.length>0?this.tasks=e.relatedTasks:this.tasks=[]):this.showInitialView=!0}catch(s){console.error("Error checking for existing finding:",s)}finally{this.isLoading=!1}}async getFiles(e){let s=[];if(this.keyList=[],this.s3ConfigType==="salesforce"){console.log("\u{1F4C1} Using Salesforce standard files");const d=await rs(e);console.log("salesforceFiles",JSON.stringify(d)),this.type&&this.type.trim()!==""?(console.log("Filtering files by type:",this.type),this.keyList=d.filter(h=>(h.description||h.originalTitle||h.value||"").toLowerCase().includes(this.type.toLowerCase())),console.log("Filtered files:",JSON.stringify(this.keyList))):this.keyList=d,this.showSpinner=!1;return}let t="";const o=await At(this.objectApiName,this.recordId);o&&o.supplierName&&o.supplierName.includes("_Personal_Files")&&(t=`${o.customerName}/${o.objectLabel}/${o.supplierName}`),s=await Ae(t,"list");let i=s;try{i=i.replace(/\\"/g,'"');const d=/"ETag":"\\+"([a-f0-9]+)\\+"/g;i=i.replace(d,(h,u)=>`"ETag":"${u}`)}catch(d){console.error("Error cleaning JSON:",d)}const a=JSON.parse(i);let r=a.ListBucketResult.Contents;const l=a.ListBucketResult.KeyCount;let c=[];this.keyList=[],Array.isArray(r)||(r=[r]),l>0&&r&&r.forEach(d=>{let h=d.Key.split("/");if(console.log("checkFile",JSON.stringify(h)),h[h.length-1]!=null&&h[h.length-1]!==""){const u=d.Key;let f=u.substring(u.lastIndexOf("/")+1);if(f.split("_")[0]===this.recordId){let _=f.substring(f.lastIndexOf(".")+1),m=f.split("_").slice(2).join("_"),x=_==="doc"||_==="docx"||_==="xls"||_==="xlsx"?"preview: false":"preview: true";c.push({type:_,preview:x,key:u,url:`${this.endpoint}/${u}`,value:m})}}}),this.keyList=c.reverse(),this.keyList&&this.keyList.length>0&&this.keyList.forEach(d=>{d.icon=d.type==="png"?"doctype:image":d.type==="pdf"?"doctype:pdf":d.type==="jpg"||d.type==="jpeg"?"doctype:image":d.type==="xlsx"||d.type==="xls"?"doctype:excel":d.type==="txt"?"doctype:txt":d.type==="doc"||d.type==="docx"?"doctype:word":"doctype:flash"})}handleFindingFieldChange(e){const s=e.target.dataset.field,t=e.target.value;s&&(this.findingFields[s]=t)}handleTaskFieldChange(e){const s=e.target.dataset.field,t=e.target.value;s&&(this.taskFields[s]=t)}handleCreateFinding(){this.showInitialView=!1,this.showFindingView=!1,this.showFindingForm=!0,this.isEditingFinding=!1,this.showTaskForm=!1,this.findingFields.Rhythm__Supplier_Response__c=this.responseData.Id,this.findingFields.Rhythm__Assessment__c=this.accountAssessmentData[0].Rhythm__Assessment__c,this.findingFields.Rhythm__AccountAssessmentRelation__c=this.accountAssessmentData[0].Id,this.findingFields.Rhythm__Assessment_Question__c=this.responseData.Rhythm__Question__c,this.keyList=[],console.log("Form visibility state after handleCreateFinding:",{showInitialView:this.showInitialView,showFindingView:this.showFindingView,showFindingForm:this.showFindingForm,showTaskForm:this.showTaskForm,showFindingViewAndNoForms:this.showFindingView&&!this.showFindingForm&&!this.showTaskForm})}handleEditFinding(){this.currentFinding&&(this.findingFields={...this.currentFinding},this.updateSelectedOptions(),this.getFiles(this.currentFinding.Id)),this.showFindingForm=!0,this.isEditingFinding=!0,this.showTaskForm=!1,this.showFindingView=!1}handleCreateTask(){this.showTaskForm=!0,this.isEditingTask=!1,this.keyList=[],this.resetTaskForm(),this.showFindingView=!1,this.showFindingForm=!1}handleEditTask(e){const s=e.currentTarget.dataset.id;this.currentTaskId=s;const t=this.tasks.find(o=>o.Id===s);if(t){if(this.taskFields={...t},t.OwnerId){const o=this.allUsers.find(i=>i.Id===t.OwnerId);this.selectedOwner={Id:t.OwnerId,Name:o?.Name||t.Owner?.Name||"Unknown User"}}else this.selectedOwner=null;this.updateTaskSelectedOptions(),this.getFiles(this.currentTaskId)}this.showTaskForm=!0,this.isEditingTask=!0,this.showFindingView=!1,this.showFindingForm=!1}async handleFindingFilePick(){console.log("\u{1F4C1} Finding file picker button clicked");try{console.log("\u{1F680} Calling FilePicker.pickFiles for finding...");const e=await St.pickFiles({multiple:!0,readData:!1});console.log("\u{1F4C4} FilePicker result for finding:",e),e&&e.files&&e.files.length>0?(async t=>{const o=[...t],i=async()=>{if(o.length===0)return;const a=o.shift();console.log("\u{1F4CE} Processing selected finding file:",a),this.findingFiles=[...this.findingFiles,a],await i()};await i()})(e.files):console.log("\u2139\uFE0F No finding files selected")}catch(e){console.error("\u274C Error picking finding file:",e)}}async processSelectedFile(e,s){console.log("\u{1F4CB} Processing finding file:",e),console.log("\u{1F4CA} File properties:",{name:e.name,path:e.path,size:e.size,mimeType:e.mimeType,webPath:e.webPath,uri:e.uri,url:e.url}),this.isLoading=!0;let t="",o="";s==="Rhythm__Assessment_Finding__c"?o=this.currentFinding?.Id:s==="Task"&&(o=this.currentTaskId);try{const i=e.size||0,a="File uploaded from Assessment Finding",r={id:Pt(),name:e.name,type:e.mimeType||e.type||"application/octet-stream",size:i,webPath:e.webPath||e.path||e.uri||e.url||"",recordId:o,formType:s,uploaded:!1,createdDate:new Date().toISOString(),lastModifiedDate:new Date().toISOString(),description:a};if(console.log("\u{1F4BE} Created file record:",JSON.stringify(r)),(await X.getStatus())?.connected){const d=await It(r);d.success?(console.log("Finding file upload result:",JSON.stringify(d)),e.uploadResult=d):(console.error("Error uploading file:",d.error),t=`Failed to upload file: ${d.error||"Unknown error"}`)}else await this.saveFileRecord(r)}catch(i){console.error("Error processing file:",i),t=`Error processing file: ${i.message||"Unknown error"}`}finally{this.isLoading=!1,t&&console.error(t)}}async saveFileRecord(e){try{await U.saveFileWithPath(e),await Ft({id:e.id,type:"UPLOAD_FILE",timestamp:Date.now(),data:e}),console.log("\u{1F4F1} Finding file saved to SQLite queue for later upload:",e)}catch(s){throw console.error("\u274C Error saving finding file for offline sync:",s),s}}handleRemoveFindingFile(e){const s=e.currentTarget.dataset.name;s&&(this.findingFiles=this.findingFiles.filter(t=>t.name!==s))}async handleTaskFilePick(){console.log("\u{1F4C1} Task file picker button clicked");try{console.log("\u{1F680} Calling FilePicker.pickFiles for task...");const e=await St.pickFiles({multiple:!0,readData:!1});console.log("\u{1F4C4} FilePicker result for task:",e),e&&e.files&&e.files.length>0?(async t=>{const o=[...t],i=async()=>{if(o.length===0)return;const a=o.shift();console.log("\u{1F4CE} Processing selected task file:",a),this.taskFiles=[...this.taskFiles,a],await i()};await i()})(e.files):console.log("\u2139\uFE0F No task files selected")}catch(e){console.error("\u274C Error picking task file:",e)}}handleRemoveTaskFile(e){const s=e.currentTarget.dataset.name;s&&(this.taskFiles=this.taskFiles.filter(t=>t.name!==s))}handleOwnerSearch(e){if(this.ownerSearchTerm=e.target.value,this.ownerSearchTerm.trim().length<2){this.showOwnerSearchResults=!1;return}this.showOwnerSearchResults=!0,this.isSearching=!0,this.searchUsers()}async loadAllUsers(){this.isLoading=!0;try{const s=await le("SELECT Id, Name, Email FROM User WHERE IsActive = true ORDER BY Name");this.allUsers=s||[],console.log(`Loaded ${this.allUsers.length} users`)}catch(e){console.error("Error loading users:",e),this.allUsers=[]}finally{}}searchUsers(){try{const e=this.ownerSearchTerm.trim().toLowerCase();this.ownerSearchResults=this.allUsers.filter(s=>s.Name&&s.Name.toLowerCase().includes(e)||s.Email&&s.Email.toLowerCase().includes(e)).slice(0,10),this.isSearching=!1,console.log("User search results:",this.ownerSearchResults.length)}catch(e){console.error("Error filtering users:",e),this.ownerSearchResults=[],this.isSearching=!1}}handleUserSelect(e){const s=e.currentTarget.dataset.id,t=e.currentTarget.dataset.name;s&&(this.selectedOwner={Id:s,Name:t},this.taskFields.OwnerId=s,this.showOwnerSearchResults=!1,this.ownerSearchTerm="")}clearSelectedOwner(){this.selectedOwner=null,this.taskFields.OwnerId=""}async loadTasks(){if(!!this.currentFinding?.Id){this.isLoading=!0;try{const s=await ls("Task","Id,Subject,Description,ActivityDate,Priority,Status,OwnerId, Owner.Name, WhatId",this.currentFinding.Id,"WhatId");let t=s;try{t=t.replace(/\\"/g,'"')}catch(i){console.error("Error cleaning JSON:",i)}const o=JSON.parse(t);console.log("tasks",JSON.stringify(o)),s.length>0?this.tasks=o.records:this.tasks=[]}catch(e){console.error("Error loading tasks:",e),this.tasks=[]}finally{this.isLoading=!1}}}async handleSave(){if(!this.isSaveDisabled){this.isSaving=!0,this.isLoading=!0;try{this.showFindingForm?await this.saveFinding():this.showTaskForm&&await this.saveTask()}catch(e){console.error("Error saving:",e)}finally{this.isSaving=!1,this.isLoading=!1}}}async saveFinding(){try{let e;const s={...this.findingFields};console.log("findingRecord",JSON.stringify(s)),this.isEditingFinding&&s.Id?(delete s.Rhythm__Assessment__c,delete s.Rhythm__AccountAssessmentRelation__c,delete s.Rhythm__Assessment_Question__c,delete s.Rhythm__Supplier_Response__c,e=await oe("Rhythm__Assessment_Finding__c",s)):(console.log("findingRecord",JSON.stringify(s)),delete s.Id,e=await $e("Rhythm__Assessment_Finding__c",s)),e&&e.id&&(this.currentFinding={...s,Id:e.id},this.findingFiles.length>0&&(this.isLoading=!0,console.log("Uploading files for finding:",this.findingFiles),await(async o=>{const i=[...o],a=async()=>{if(i.length===0)return;const r=i.shift();(r.path||r.webPath||r.uri)&&!r.uploadResult&&await this.processSelectedFile(r,"Rhythm__Assessment_Finding__c"),await a()};return a()})(this.findingFiles),this.isLoading=!1),this.showFindingForm=!1,this.findingFiles=[],this.showFindingView=!0,this.dispatchEvent(new CustomEvent("save",{detail:{questionId:this.questionId,type:"finding"}})))}catch(e){throw console.error("Error saving finding:",e),e}}async saveTask(){try{let e;const s={...this.taskFields};this.isEditingTask&&s.Id?e=await oe("Task",s):(s.WhatId=this.currentFinding.Id,delete s.Id,e=await $e("Task",s)),e&&e.id&&(this.currentTaskId=e.id,this.taskFiles.length>0&&(this.isLoading=!0,console.log("Uploading files for task:",this.taskFiles),await(async o=>{const i=[...o],a=async()=>{if(i.length===0)return;const r=i.shift();(r.path||r.webPath||r.uri)&&!r.uploadResult&&await this.processSelectedFile(r,"Task"),await a()};return a()})(this.taskFiles),this.isLoading=!1),this.showTaskForm=!1,this.taskFiles=[],this.showFindingView=!0,await this.loadTasks(),this.dispatchEvent(new CustomEvent("save",{detail:{questionId:this.questionId,type:"task"}})))}catch(e){throw console.error("Error saving task:",e),e}}formatDate(e){if(!e)return"";const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate(),i=e.getFullYear();return`${t}-${o}-${i}`}updateSelectedOptions(){this.findingTypeOptions=this.findingTypeOptions.map(e=>({...e,selected:e.value===this.findingFields.Rhythm__Finding_Type__c})),this.rootCauseOptions=this.rootCauseOptions.map(e=>({...e,selected:e.value===this.findingFields.Rhythm__Root_Cause__c})),this.repeatFindingOptions=this.repeatFindingOptions.map(e=>({...e,selected:e.value===this.findingFields.Rhythm__Repeat_Finding__c})),this.timeFrameOptions=this.timeFrameOptions.map(e=>({...e,selected:e.value===this.findingFields.Rhythm__Resolution_Time_Frame__c})),this.statusOptions=this.statusOptions.map(e=>({...e,selected:e.value===this.findingFields.Rhythm__Status__c}))}updateTaskSelectedOptions(){this.priorityOptions=this.priorityOptions.map(e=>({...e,selected:e.value===this.taskFields.Priority})),this.taskStatusOptions=this.taskStatusOptions.map(e=>({...e,selected:e.value===this.taskFields.Status}))}generateUniqueId(){return"action_"+Math.random().toString(36).substr(2,9)}}Y(xi,{publicProps:{recordId:{config:0},sectionName:{config:0}},publicMethods:["open"],track:{questionId:1,isOpen:1,tasks:1,responseData:1,keyList:1,showInitialView:1,showFindingView:1,showFindingForm:1,showTaskForm:1,isEditingFinding:1,isEditingTask:1,currentFinding:1,currentTaskId:1,isSaving:1,isLoading:1,s3ConfigType:1,findingFields:1,taskFields:1,findingFiles:1,taskFiles:1,findingTypeOptions:1,rootCauseOptions:1,repeatFindingOptions:1,timeFrameOptions:1,statusOptions:1,priorityOptions:1,taskStatusOptions:1,ownerSearchTerm:1,ownerSearchResults:1,allUsers:1,showOwnerSearchResults:1,isSearching:1,selectedOwner:1,accountAssessmentData:1}});const Pw=z(xi,{tmpl:Mw,sel:"c-action-items-popup",apiVersion:63}),jw=p`<div class="cad-sec_header cad-timeline_header${0}"${2}><div class="timeline-header-content${0}"${2}><button class="blink-icon${0}" title="Show/Hide Timeline Panel"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 15.2c-4 0-7.2-3.2-7.2-7.2S4 .8 8 .8 15.2 4 15.2 8 12 15.2 8 15.2zM6.2 4.8l3 3.2-3 3.2h1.7l3-3.2-3-3.2H6.2z"${3}/></svg></button><span class="timeline-title${0}"${2}><b${3}>Time Line</b></span></div></div>`,Uw=p`<div class="cad-timeline_progressline${0}"${2}></div>`,Vw=p`<div${"c0"}${2}><div class="cad-timeline_dot${0}"${2}></div><div class="cad-timeline_datetime${0}"${2}>${"t3"}</div><div class="cad-timeline_content${0}"${2}><h2 class="cad-timeline_title${0}"${2}>${"t6"}</h2><span${3}>${"t8"}</span></div></div>`,qw=p`<div class="cad-header_title${0}"${2}><button class="blink-icon${0}" title="Show/Hide Timeline Panel"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 15.2c-4 0-7.2-3.2-7.2-7.2S4 .8 8 .8 15.2 4 15.2 8 12 15.2 8 15.2zM8.2 4.8L5.2 8l3 3.2h-1.7L3.5 8l3-3.2h1.7z"${3}/></svg></button><p${3}><b${3}>${"t6"}</b></p></div>`,zw=p`<button class="btn btn-icon btn-first${0}" title="Expand" data-id="[ + ]"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M12 7H9V4c0-.6-.4-1-1-1s-1 .4-1 1v3H4c-.6 0-1 .4-1 1s.4 1 1 1h3v3c0 .6.4 1 1 1s1-.4 1-1V9h3c.6 0 1-.4 1-1s-.4-1-1-1z"${3}/></svg></button>`,Ww=p`<button class="btn btn-icon btn-first${0}" title="Collapse" data-id="[ - ]"${2}><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"${3}><path d="M12 7H4c-.6 0-1 .4-1 1s.4 1 1 1h8c.6 0 1-.4 1-1s-.4-1-1-1z"${3}/></svg></button>`,Bw=p`<button class="btn btn-icon btn-middle${0}" title="Filter"${2}><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="16" width="16"${3}><path d="M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"${3}/></svg></button>`,Hw=p`<div class="filter-dropdown-content${0}"${2}><div${"c1"} data-filter="All"${"a1:data-active"}${2}>All</div><div${"c3"} data-filter="Flagged"${"a3:data-active"}${2}>Flagged</div><div${"c5"} data-filter="Approved"${"a5:data-active"}${2}>Approved</div><div${"c7"} data-filter="Rejected"${"a7:data-active"}${2}>Rejected</div></div>`,Jw=p`<div class="slds-is-relative${0}"${2}><div class="spinner-container${0}"${2}><div class="spinner${0}"${2}></div><span class="sr-only${0}"${2}>Loading</span></div></div>`,Qw=p`<div class="slds-text-color_error slds-p-around_small${0}"${2}>${"t1"}</div>`,Yw={classMap:{"cad-cardbase":!0,"slds-p-around_small":!0},key:0},Kw={classMap:{"cad-tbl":!0},key:1},Gw={classMap:{"cad-row":!0},key:2},Xw={classMap:{"cad-cel":!0,"cad-w230":!0,"cad-type":!0,"cad-pr8":!0},attrs:{"data-id":"cadtype"},key:3},Zw={classMap:{"cad-sec_container":!0},key:4},e1={classMap:{"assessment-timeline-container":!0},key:7},t1={classMap:{"cad-sec_vcontainer2_1":!0},key:10},s1=[],o1={classMap:{"cad-cel":!0,"cad-auto":!0,"cad-list":!0},key:13},i1={classMap:{"cad-sec_container":!0},key:14},a1={classMap:{"cad-sec_header":!0,"cad-header-titlebutton_more":!0},key:15},n1={classMap:{"button-group":!0},key:18},r1={classMap:{"cad-sec_header-icons":!0},key:19},l1={classMap:{"expand-collapse":!0},key:20},c1={classMap:{"filter-dropdown":!0},key:25},d1={classMap:{"cad-sec_bodyfull1":!0,"cad-titlebutton_more":!0},key:30},h1={classMap:{"cad-sec_vcontainer2_2":!0},key:31},u1={classMap:{"scrollable-y":!0},key:32},p1={classMap:{"content-container":!0},key:33};function ct(n,e,s,t){const{b:o,sp:i,st:a,ncls:r,k:l,d:c,i:d,h,c:u}=n,{_m0:f,_m1:g,_m2:_,_m3:m,_m4:x,_m5:k,_m6:$,_m7:S,_m8:O,_m9:F,_m10:D,_m11:v,_m12:A,_m13:w,_m14:y,_m15:C}=t;return[e.isLoading?null:e.accountAssessmentData?h("div",Yw,[h("div",Kw,[h("div",Gw,[h("div",Xw,[h("div",Zw,[a(jw,6,[i(2,{on:f||(t._m0={click:o(e.handleTimelineCollapseClick)})},null)]),h("div",e1,[a(Uw,9),h("div",t1,e.timelineData?d(e.timelineData,function(I){return a(Vw,l(12,I.date),[i(0,{className:r(I.combinedClasses)},null),i(3,null,c(I.date)),i(6,null,c(I.status)),i(8,null,"- "+c(I.name))])}):s1)])])]),h("div",o1,[h("div",i1,[h("div",a1,[a(qw,17,[i(1,{on:g||(t._m1={click:o(e.handleTimelineShowClick)})},null),i(6,null,"Details : "+c(e.assessmentName))]),h("div",n1,[h("div",r1,[h("div",l1,[e.showExpand?a(zw,22,[i(0,{on:m||(t._m3={click:o(e.handleAccordian)})},null)]):null,e.showExpand?null:a(Ww,24,[i(0,{on:k||(t._m5={click:o(e.handleAccordian)})},null)])]),h("div",c1,[a(Bw,27,[i(0,{on:S||(t._m7={click:o(e.toggleFilterDropdown)})},null)]),e.showFilterDropdown?a(Hw,29,[i(1,{on:O||(t._m8={click:o(e.handleFilterChange)}),className:r(e.getFilterOptionClass),attrs:{"data-active":e.isAllActive}},null),i(3,{on:F||(t._m9={click:o(e.handleFilterChange)}),className:r(e.getFilterOptionClass),attrs:{"data-active":e.isFlaggedActive}},null),i(5,{on:D||(t._m10={click:o(e.handleFilterChange)}),className:r(e.getFilterOptionClass),attrs:{"data-active":e.isApprovedActive}},null),i(7,{on:v||(t._m11={click:o(e.handleFilterChange)}),className:r(e.getFilterOptionClass),attrs:{"data-active":e.isRejectedActive}},null)]):null])])])]),h("div",d1,[h("div",h1,[h("div",u1,[h("div",p1,[e.accountAssessmentData?u("c-questionnaire",_0,{props:{recordId:e.recordId,objectApiName:e.objectApiName,assessmentData:e.accountAssessmentData,accountAssessmentData:e.accountAssessmentData},key:34,on:A||(t._m12={openattachments:o(e.handleOpenAttachments),opencomments:o(e.handleOpenComments),openactionitems:o(e.handleOpenActionItems),save:o(e.handleQuestionnaireSave),submit:o(e.handleQuestionnaireSubmit),statuschange:o(e.handleStatusChange)})}):null])])])])])])])])]):null,e.isLoading?a(Jw,36):null,e.error?a(Qw,38,[i(1,null,c(e.error))]):null,e.showAttachments?u("c-attachments-popup",W0,{props:{recordId:e.recordId},key:39,on:w||(t._m13={save:o(e.handleAttachmentsSave),updateresponsefilescount:o(e.handleUpdateResponseFilesCount),close:o(e.handleClose)})}):null,e.showComments?u("c-comments-popup",tv,{props:{recordId:e.recordId},key:40,on:y||(t._m14={save:o(e.handleCommentsSave),close:o(e.handleClose)})}):null,e.showActionItems?u("c-action-items-popup",Pw,{props:{recordId:e.recordId},key:41,on:C||(t._m15={save:o(e.handleActionItemsSave),close:o(e.handleClose)})}):null]}var f1=J(ct);ct.stylesheets=[],ct.stylesheetToken="lwc-iovg3q2rec",ct.legacyStylesheetToken="c-assessmentDetail_assessmentDetail",li&&ct.stylesheets.push.apply(ct.stylesheets,li),Q(ct);class ki extends K{constructor(...e){super(...e);this.currentQuestionId=void 0,this.currentQuestionData=void 0,this.currentPopupType=void 0,this.recordId=void 0,this.objectApiName=void 0,this.accountAssessmentData=void 0,this.isLoading=!1,this.error=null,this.timelineData=[],this.showExpand=!0,this.showFollowUps=!1,this.assessmentName="",this.timelineCollapsed=!1,this.showFilterDropdown=!1,this.currentFilter="All",this.showAttachments=!1,this.showComments=!1,this.showActionItems=!1,this._clickListener=null}get getFilterOptionClass(){return"filter-option"}get isAllActive(){return this.currentFilter==="All"}get isFlaggedActive(){return this.currentFilter==="Flagged"}get isApprovedActive(){return this.currentFilter==="Approved"}get isRejectedActive(){return this.currentFilter==="Rejected"}connectedCallback(){this.recordId&&this.loadAssessmentData(),this.currentFilter="All"}disconnectedCallback(){}async loadAssessmentData(){try{this.isLoading=!0;const e=await on(this.recordId);if(console.log("record data:",JSON.stringify(e)),e&&e.length>0){this.accountAssessmentData=e;const s=e[0];s.Rhythm__Assessment__r&&s.Rhythm__Assessment__r.Name&&(this.assessmentName=s.Rhythm__Assessment__r.Name);const t=await oo(this.recordId);if(console.log("timeline status:",JSON.stringify(t)),t&&t.length>0){const o=[...t].sort((a,r)=>new Date(r.CreatedDate)-new Date(a.CreatedDate));if(this.timelineData=o.map(a=>{const r=new Date(a.CreatedDate),l=this.formatDate(r);let c="";const d=a.Rhythm__Object_Field_Value__c;switch(d){case"In Progress":c="cad-timeline-item-inprogress";break;case"Submitted":c="cad-timeline-item-submitted";break;case"In Review":c="cad-timeline-item-in-review";break;case"Need More Information":c="cad-timeline-item-need-more-information";break;case"Review Completed":c="cad-timeline-item-review-completed";break;case"New":c="cad-timeline-item-pending";break;default:c="cad-timeline-item-completed"}return{date:l,status:d,name:a.Rhythm__Activity_User__c||"",classlist:c,combinedClasses:`cad-timeline-item ${c}`}}),!this.timelineData.some(a=>a.status==="Start Date")&&e[0].Rhythm__Assessment__r&&e[0].Rhythm__Assessment__r.CreatedDate){const a=new Date(e[0].Rhythm__Assessment__r.CreatedDate),r=this.formatDate(a);this.timelineData.push({date:r,status:"Start Date",name:e[0].Rhythm__Assessment__r.Rhythm__CreatedUser__c||"User User",classlist:"cad-timeline-item-start-date",combinedClasses:"cad-timeline-item cad-timeline-item-start-date"})}}else if(s.Rhythm__Assessment__r.Rhythm__Status__c==="New"){const o=new Date(e[0].Rhythm__Assessment__r.CreatedDate),i=this.formatDate(o);this.timelineData.push({date:i,status:"Start Date",name:e[0].Rhythm__Assessment__r.Rhythm__CreatedUser__c||"User User",classlist:"cad-timeline-item-start-date",combinedClasses:"cad-timeline-item cad-timeline-item-start-date"})}}this.isLoading=!1}catch(e){this.error=e.message||"Error loading assessment data",this.isLoading=!1}}formatDate(e){if(!e)return"";const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate(),i=e.getFullYear();let a=e.getHours();const r=e.getMinutes().toString().padStart(2,"0"),l=e.getSeconds().toString().padStart(2,"0"),c=a>=12?"PM":"AM";return a=a%12,a=a||12,`${t}-${o}-${i} ${a}:${r}:${l} ${c}`}handleTimelineCollapseClick(){this.timelineCollapsed=!this.timelineCollapsed,console.log("timelineCollapsed:",this.timelineCollapsed);const e=this.template.querySelector('[data-id="cadtype"]');console.log("cadtype:",e),e?.classList?.contains("cad-cel")?(e?.classList?.remove("cad-cel"),e?.classList?.add("hide-timeline")):(e?.classList?.remove("hide-timeline"),e?.classList?.add("cad-cel"))}handleTimelineShowClick(){this.timelineCollapsed=!this.timelineCollapsed,console.log("timelineCollapsed:",this.timelineCollapsed);const e=this.template.querySelector('[data-id="cadtype"]');console.log("cadtype:",e),e?.classList?.contains("hide-timeline")?(e?.classList?.remove("hide-timeline"),e?.classList?.add("cad-cel")):(e?.classList?.remove("cad-cel"),e?.classList?.add("hide-timeline"))}handleAccordian(e){const s=e.currentTarget.dataset.id;this.showExpand=s==="[ - ]";const t=this.template.querySelector("c-questionnaire");t&&t.toggleSections(!this.showExpand)}toggleFilterDropdown(e){e.stopPropagation(),this.showFilterDropdown=!this.showFilterDropdown,this.showFilterDropdown?(this._clickListener=this.handleClickOutside.bind(this),window.addEventListener("click",this._clickListener)):this._clickListener&&(window.removeEventListener("click",this._clickListener),this._clickListener=null)}handleFilterChange(e){e.stopPropagation();const s=e.currentTarget.dataset.filter;this.currentFilter=s,this.showFilterDropdown=!1,this._clickListener&&(window.removeEventListener("click",this._clickListener),this._clickListener=null);const t=this.template.querySelector("c-questionnaire");t&&t.filterQuestions(s)}handleClickOutside(e){const s=this.template.querySelector(".filter-dropdown");s&&!s.contains(e.target)&&(this.showFilterDropdown=!1,window.removeEventListener("click",this._clickListener),this._clickListener=null)}handleOpenAttachments(e){console.log("Open attachments event received:",e.detail),this.currentQuestionId=e.detail.questionId,this.currentQuestionData=e.detail.question,this.currentPopupType="attachments";const s=e.detail;console.log("data:",JSON.stringify(s)),this.showComments=!1,this.showActionItems=!1,this.showAttachments=!0,setTimeout(()=>{const t=this.template.querySelector("c-attachments-popup");t&&t.open(s)},100)}handleUpdateResponseFilesCount(e){console.log("Update response files count event received:",e.detail);const{questionId:s,count:t}=e.detail;this.updateQuestionFileCount(s,t)}handleOpenComments(e){console.log("Open comments event received:",e.detail),this.currentQuestionId=e.detail.questionId,this.currentQuestionData=e.detail.question,this.currentPopupType="comments";const s=e.detail;this.showAttachments=!1,this.showActionItems=!1,this.showComments=!0,setTimeout(()=>{const t=this.template.querySelector("c-comments-popup");t&&t.open(s)},100)}handleOpenActionItems(e){console.log("Open action items event received:",e.detail),this.currentQuestionId=e.detail.questionId,this.currentQuestionData=e.detail.question,this.currentPopupType="actionItems";let s=e.detail;s.accountAssessmentData=this.accountAssessmentData,this.showAttachments=!1,this.showComments=!1,this.showActionItems=!0,setTimeout(()=>{const t=this.template.querySelector("c-action-items-popup");t&&t.open(s)},100)}handleClose(e){console.log("Close event received:",e.detail),e.detail.type==="attachments"?this.showAttachments=!1:e.detail.type==="comments"?this.showComments=!1:e.detail.type==="actionItems"&&(this.showActionItems=!1)}handleAttachmentsSave(e){const{questionId:s,files:t}=e.detail;console.log("Attachments saved:",e.detail),this.updateQuestionFileCount(s,t.length)}handleCommentsSave(e){const{questionId:s,Rhythm__Conversation_History__c:t}=e.detail;console.log("Comment saved:",e.detail),this.updateQuestionConversationIndicator(s,!0),this.updateQuestionConversationHistory(s,t)}handleActionItemsSave(e){console.log("Action item saved:",e.detail);const{questionId:s,type:t}=e.detail;t==="finding"?this.updateSectionFindingsCount(s):t==="task"&&this.updateSectionTasksCount(s)}updateSectionFindingsCount(e){const s=this.template.querySelector("c-questionnaire");s&&s.updateSectionFindingsCount&&s.updateSectionFindingsCount(e)}updateSectionTasksCount(e){const s=this.template.querySelector("c-questionnaire");s&&s.updateSectionTasksCount&&s.updateSectionTasksCount(e)}updateQuestionFileCount(e,s){const t=this.template.querySelector("c-questionnaire");t&&t.updateQuestionFileCount&&t.updateQuestionFileCount(e,s)}updateQuestionConversationIndicator(e,s){const t=this.template.querySelector("c-questionnaire");t&&t.updateQuestionConversationIndicator&&t.updateQuestionConversationIndicator(e,s)}updateQuestionConversationHistory(e,s){const t=this.template.querySelector("c-questionnaire");t&&typeof t.updateQuestionConversationHistory=="function"?t.updateQuestionConversationHistory(e,s):console.warn("Could not find questionnaire component or updateQuestionConversationHistory method")}handleQuestionnaireSave(e){console.log("Questionnaire save event received:",e.detail),e.detail.success&&this.refreshTimelineData()}handleQuestionnaireSubmit(e){console.log("Questionnaire submit event received:",e.detail),e.detail.success&&this.refreshTimelineData()}handleStatusChange(e){console.log("Status change event received:",e.detail);const{accountAssessmentData:s}=e.detail;this.accountAssessmentData=s,this.refreshTimelineData()}async refreshTimelineData(){try{console.log("Refreshing timeline data...");const e=await oo(this.recordId);if(console.log("Updated timeline status:",JSON.stringify(e)),e&&e.length>0){const s=[...e].sort((o,i)=>new Date(i.CreatedDate)-new Date(o.CreatedDate));if(this.timelineData=s.map(o=>{const i=new Date(o.CreatedDate),a=this.formatDate(i);let r="";const l=o.Rhythm__Object_Field_Value__c;switch(l){case"In Progress":r="cad-timeline-item-inprogress";break;case"Submitted":r="cad-timeline-item-submitted";break;case"In Review":r="cad-timeline-item-in-review";break;case"Need More Information":r="cad-timeline-item-need-more-information";break;case"Review Completed":r="cad-timeline-item-review-completed";break;case"New":r="cad-timeline-item-pending";break;default:r="cad-timeline-item-completed"}return{date:a,status:l,name:o.Rhythm__Activity_User__c||"",classlist:r,combinedClasses:`cad-timeline-item ${r}`}}),!this.timelineData.some(o=>o.status==="Start Date")&&this.accountAssessmentData&&this.accountAssessmentData[0]&&this.accountAssessmentData[0].Rhythm__Assessment__r&&this.accountAssessmentData[0].Rhythm__Assessment__r.CreatedDate){const o=new Date(this.accountAssessmentData[0].Rhythm__Assessment__r.CreatedDate),i=this.formatDate(o);this.timelineData.push({date:i,status:"Start Date",name:this.accountAssessmentData[0].Rhythm__Assessment__r.Rhythm__CreatedUser__c||"User User",classlist:"cad-timeline-item-start-date",combinedClasses:"cad-timeline-item cad-timeline-item-start-date"})}}console.log("Timeline data refreshed successfully")}catch(e){console.error("Error refreshing timeline data:",e)}}}Y(ki,{publicProps:{recordId:{config:0},objectApiName:{config:0}},publicMethods:["loadAssessmentData"],track:{currentQuestionId:1,currentQuestionData:1,currentPopupType:1,accountAssessmentData:1,isLoading:1,error:1,timelineData:1,showExpand:1,showFollowUps:1,assessmentName:1,timelineCollapsed:1,showFilterDropdown:1,currentFilter:1,showAttachments:1,showComments:1,showActionItems:1},fields:["_clickListener"]});const $i=z(ki,{tmpl:f1,sel:"c-assessment-detail",apiVersion:63}),m1=p`<div class="loading-container${0}" role="status" aria-live="polite"${2}><div class="loading-spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading component...</div></div>`,g1=p`<div class="error-container${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-message${0}"${2}>${"t4"}</div><button class="retry-button${0}" aria-label="Retry loading component"${2}>Retry</button></div>`,_1={classMap:{"dynamic-host":!0},key:0};function dt(n,e,s,t){const{st:o,d:i,b:a,sp:r,c:l,h:c}=n,{_m0:d}=t;return[c("div",_1,[e.isLoading?o(m1,2):null,e.hasError?o(g1,4,[r(4,null,i(e.errorMessage)),r(5,{on:d||(t._m0={click:a(e.handleRetry)})},null)]):null,e.isLoadingOrError?null:e.showCpDetailPage?l("c-cp-detail-page",Uo,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId,isAttachment:e.isAttachment,activeTab:e.props.tabLabel},key:5}):null,e.isLoadingOrError?null:e.showGenericListView?l("c-generic-list-view",ms,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:6}):null,e.isLoadingOrError?null:e.showCpExpListView?l("c-cp-exp-list-view",Ss,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId,componentDetail:e.componentDetail},key:7}):null,e.isLoadingOrError?null:e.showAwsS3Files?l("c-aws-s3-files",zt,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:8}):null,e.isLoadingOrError?null:e.showStatus?l("c-status",Bo,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:9}):null,e.isLoadingOrError?null:e.showTrainingAttendanceForm?l("c-training-attendance-form",Ko,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:10}):null,e.isLoadingOrError?null:e.showTabInvestigation?l("c-tab-investigation",ii,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:11}):null,e.isLoadingOrError?null:e.showMockDrillReport?l("c-mock-drill-report",ri,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:12}):null,e.isLoadingOrError?null:e.showAssessmentDetail?l("c-assessment-detail",$i,{props:{objectApiName:e.props.objectApiName,recordId:e.props.recordId},key:13}):null])]}var b1=J(dt);dt.stylesheets=[],dt.stylesheetToken="lwc-60lo7niheq4",dt.legacyStylesheetToken="c-dynamicHost_dynamicHost",Ao&&dt.stylesheets.push.apply(dt.stylesheets,Ao),Q(dt);function y1(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".incident-container",t,` {font-family:\r
 'Inter',\r
 -apple-system,\r
 BlinkMacSystemFont,\r
 'Segoe UI',\r
 Roboto,\r
 Arial,\r
 sans-serif;color: #1f2937;width: 100%;padding: 0;}.incident-name-link`,t," {text-decoration: none;color: #667eea;font-weight: 600;transition: color 0.2s ease;}.incident-name-link:hover",t," {color: #5a67d8;}.desktop-view",t," {display: block;}.incident-table",t," {width: 100%;border-collapse: collapse;background: #ffffff;border-radius: 16px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);overflow: hidden;border: 1px solid rgba(0, 0, 0, 0.06);}.incident-table",t," thead",t," {background: #f8fafc;}.incident-table",t," th",t," {padding: 20px 24px;text-align: left;font-weight: 600;font-size: 14px;color: #374151;border-bottom: 1px solid #e5e7eb;letter-spacing: 0.025em;}.incident-table",t," td",t," {padding: 20px 24px;font-size: 14px;border-bottom: 1px solid #f3f4f6;vertical-align: middle;color: #6b7280;}.incident-table",t," tr:last-child",t," td",t," {border-bottom: none;}.incident-table",t," tr:hover",t," {background: #f9fafb;}.mobile-view",t," {display: none;}.incident-card",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);margin-bottom: 16px;overflow: hidden;padding: 20px;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.incident-card:hover",t," {box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.card-content",t," {display: flex;align-items: flex-start;margin-bottom: 16px;}.card-icon",t," {background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);border-radius: 12px;width: 48px;height: 48px;display: flex;align-items: center;justify-content: center;margin-right: 16px;flex-shrink: 0;}.incident-icon",t," {width: 24px;height: 24px;fill: #3b82f6;}.card-details",t," {flex: 1;}.card-title",t," {margin: 0 0 8px 0;font-size: 18px;font-weight: 600;color: #111827;line-height: 1.3;}.card-metadata",t," {display: flex;flex-direction: column;gap: 8px;}.card-description",t," {font-size: 14px;color: #6b7280;line-height: 1.5;}.card-date",t," {font-size: 13px;color: #9ca3af;font-weight: 500;}.card-footer",t," {display: flex;justify-content: space-between;align-items: center;margin-top: 16px;padding-top: 16px;border-top: 1px solid #f3f4f6;}.card-menu",t," {display: flex;align-items: center;position: relative;}.dropdown",t," {position: relative;display: inline-block;}.three-dots",t," {font-size: 20px;color: #9ca3af;cursor: pointer;padding: 8px;user-select: none;display: inline-flex;align-items: center;justify-content: center;border-radius: 8px;transition: all 0.2s ease;}.three-dots:hover",t," {color: #6b7280;background: #f3f4f6;}.dropdown-content",t," {display: none;position: absolute;right: 0;top: 100%;min-width: 140px;background: #ffffff;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);border-radius: 12px;z-index: 100;overflow: hidden;margin-top: 8px;border: 1px solid rgba(0, 0, 0, 0.06);}.dropdown-content.show",t," {display: block;}.dropdown-item",t," {padding: 12px 16px;font-size: 14px;color: #374151;cursor: pointer;transition: background-color 0.2s ease;font-weight: 500;}.dropdown-item:not(:last-child)",t," {border-bottom: 1px solid #f3f4f6;}.dropdown-item:hover",t," {background: #f9fafb;color: #111827;}.status-completed",t,",\r.status-done",t,",\r.status-finished",t,",\r.status-active",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);color: #065f46;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-in-progress",t,",\r.status-ongoing",t,",\r.status-started",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);color: #92400e;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-pending",t,",\r.status-not-started",t,",\r.status-todo",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);color: #3730a3;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-blocked",t,",\r.status-stopped",t,",\r.status-halted",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);color: #991b1b;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-default",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);color: #6b7280;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.loading-spinner",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 60px 40px;color: #6b7280;}.spinner",t," {width: 48px;height: 48px;border: 4px solid #f3f4f6;border-top: 4px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 20px;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;}.error-message",t," {display: flex;align-items: center;padding: 20px 24px;background: #fef2f2;border: 1px solid #fecaca;border-radius: 16px;margin: 20px 0;color: #dc2626;}.error-icon",t," {margin-right: 16px;font-size: 20px;}.error-text",t," {font-size: 14px;font-weight: 500;line-height: 1.5;}.no-data",t," {padding: 40px 24px;text-align: center;color: #9ca3af;background: #f9fafb;border-radius: 16px;font-size: 16px;margin-top: 20px;font-weight: 500;}@media screen and (max-width: 768px) {.desktop-view",t," {display: none;}.mobile-view",t," {display: block;}.incident-card",t," {margin-bottom: 12px;padding: 16px;}.card-icon",t," {width: 40px;height: 40px;margin-right: 12px;}.card-title",t," {font-size: 16px;}.card-metadata",t," {gap: 6px;}.mobile-view",t," .status-completed",t,",\r .mobile-view",t," .status-done",t,",\r .mobile-view",t," .status-finished",t,",\r .mobile-view",t," .status-active",t,",\r .mobile-view",t," .status-in-progress",t,",\r .mobile-view",t," .status-ongoing",t,",\r .mobile-view",t," .status-started",t,",\r .mobile-view",t," .status-pending",t,",\r .mobile-view",t," .status-not-started",t,",\r .mobile-view",t," .status-todo",t,",\r .mobile-view",t," .status-blocked",t,",\r .mobile-view",t," .status-stopped",t,",\r .mobile-view",t," .status-halted",t,",\r .mobile-view",t," .status-default",t," {font-size: 11px;padding: 4px 10px;}}.view-more-container",t," {display: flex;justify-content: center;margin: 24px 0;}.view-more-button",t," {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: #ffffff;border: none;border-radius: 12px;padding: 12px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);}.view-more-button:hover",t," {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);}"].join("")}var Ci=[y1];const v1=p`<div class="loading-spinner${0}"${2}><div class="spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading incidents...</div></div>`,w1=p`<div class="error-message${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-text${0}"${2}>${"t4"}</div></div>`,x1=p`<thead${3}><tr${3}><th${3}>Name</th><th${3}>Title</th><th${3}>Description</th><th${3}>Date of Incident</th><th${3}>Date Reported</th><th${3}>Status</th></tr></thead>`,k1=p`<td${3}><a href="javascript:void(0)"${"a1:data-id"} class="incident-name-link${0}"${2}>${"t2"}</a></td>`,$1=p`<td${3}>${"t1"}</td>`,C1=p`<td${3}>${"t1"}</td>`,S1=p`<td${3}><span${"c1"}${2}>${"t2"}</span></td>`,E1=p`<div class="no-data${0}"${2}>No incident items found.</div>`,R1=p`<div class="incident-card${0}"${2}><div class="card-content${0}"${2}><div class="card-icon${0}"${2}><svg viewBox="0 0 24 24" class="incident-icon${0}"${2}><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"${3}/></svg></div><div class="card-details${0}"${2}><h3 class="card-title${0}"${2}><a href="javascript:void(0)"${"a7:data-id"} class="incident-name-link${0}"${2}>${"t8"}</a></h3><div class="card-metadata${0}"${2}><div class="card-description${0}"${2}>${"t11"}</div><div class="card-date${0}"${2}>${"t13"}</div><div class="card-date${0}"${2}>${"t15"}</div></div></div></div><div class="card-footer${0}"${2}><span${"c17"}${2}>${"t18"}</span><div class="card-menu${0}"${2}><div class="dropdown${0}"${2}><span class="three-dots${0}"${"a21:data-id"}${2}>…</span><div class="dropdown-content${0}"${"a23:data-id"}${2}><div class="dropdown-item${0}"${"a24:data-id"}${2}>Edit</div><div class="dropdown-item${0}"${"a26:data-id"}${2}>Delete</div></div></div></div></div></div>`,A1=p`<div class="view-more-container${0}"${2}><button class="view-more-button${0}"${2}>View More</button></div>`,I1=p`<div class="no-data${0}"${2}>No incident items found.</div>`,F1={classMap:{"incident-container":!0},key:0},D1={classMap:{"desktop-view":!0},key:5},T1={classMap:{"incident-table":!0},key:6},O1={key:9},L1={key:17},N1={key:18},Si=[],M1={classMap:{"mobile-view":!0},key:23};function ht(n,e,s,t){const{st:o,d:i,sp:a,k:r,b:l,t:c,h:d,ncls:h,i:u,f}=n,{_m0:g,_m1:_,_m2:m,_m3:x,_m4:k,_m5:$}=t;return[d("div",F1,[e.isLoading?o(v1,2):null,e.error?o(w1,4,[a(4,null,i(e.error))]):null,d("div",D1,[d("table",T1,[o(x1,8),d("tbody",O1,e.hasItems?u(e.incidents,function(S){return d("tr",{key:r(10,S.id)},[o(k1,12,[a(1,{on:g||(t._m0={click:l(e.handleIncidentClick)}),attrs:{"data-id":S.id}},null),a(2,null,i(S.name))]),o($1,14,[a(1,null,i(S.title))]),o(C1,16,[a(1,null,i(S.description))]),d("td",L1,[S.dateOfIncident?c(i(S.formattedDateOfIncident)):null]),d("td",N1,[S.dateReported?c(i(S.formattedDateReported)):null]),o(S1,20,[a(1,{className:h(S.statusClass)},null),a(2,null,i(S.status))])])}):Si)]),e.noData?o(E1,22):null]),d("div",M1,f([e.hasItems?f([u(e.visibleItems,function(S){return o(R1,r(25,S.id),[a(7,{on:_||(t._m1={click:l(e.handleIncidentClick)}),attrs:{"data-id":S.id}},null),a(8,null,i(S.title)),a(11,null,i(S.description)),a(13,null,"Incident: "+i(S.formattedDateOfIncident)),a(15,null,"Reported: "+i(S.formattedDateReported)),a(17,{className:h(S.statusClass)},null),a(18,null,i(S.status)),a(21,{on:m||(t._m2={click:l(e.handleToggleMenu)}),attrs:{"data-id":S.id}},null),a(23,{attrs:{"data-id":S.id}},null),a(24,{on:x||(t._m3={click:l(e.handleEdit)}),attrs:{"data-id":S.id}},null),a(26,{on:k||(t._m4={click:l(e.handleDelete)}),attrs:{"data-id":S.id}},null)])}),e.showViewMoreButton?o(A1,27,[a(1,{on:$||(t._m5={click:l(e.handleViewMore)})},null)]):null]):Si,e.noData?o(I1,29):null]))])]}var P1=J(ht);ht.stylesheets=[],ht.stylesheetToken="lwc-7rmgp16rrk1",ht.legacyStylesheetToken="c-incident_incident",Ci&&ht.stylesheets.push.apply(ht.stylesheets,Ci),Q(ht);class Ei extends K{constructor(...e){super(...e);this.objectApiName="Rhythm__Incident__c",this.incidents=[],this.isLoading=!0,this.error=null,this.visibleItemCount=2,this.activeDropdown=null}connectedCallback(){console.log("Incident component - Object API Name:",this.objectApiName),this.fetchIncidentsFromSalesforce(),this.documentClickListener=this.handleDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener)}get visibleItems(){return this.incidents.slice(0,this.visibleItemCount)}get hasItems(){return this.incidents.length>0}get noData(){return!this.hasItems&&!this.isLoading}get showViewMoreButton(){return this.incidents.length>this.visibleItemCount}handleViewMore(){this.visibleItemCount=this.incidents.length}handleIncidentClick(e){const s=e.currentTarget.dataset.id,t=this.incidents.find(o=>o.id===s);t&&(console.log("Incident item clicked:",t),this.dispatchEvent(new CustomEvent("view",{detail:{itemId:s,item:t}})))}handleToggleMenu(e){const s=e.currentTarget.dataset.id;this.template.querySelectorAll(".dropdown-content").forEach(i=>{(i.dataset.id!==s||i.dataset.id===s&&i.classList.contains("show"))&&i.classList.remove("show")});const o=this.template.querySelector(`.dropdown-content[data-id="${s}"]`);o&&(o.classList.contains("show")?this.activeDropdown=null:(o.classList.add("show"),this.activeDropdown=s)),e.stopPropagation()}handleEdit(e){const s=e.currentTarget.dataset.id,t=this.incidents.find(o=>o.id===s);t&&this.dispatchEvent(new CustomEvent("edit",{detail:{itemId:s,item:t}})),this.closeDropdown(s)}handleDelete(e){const s=e.currentTarget.dataset.id;this.dispatchEvent(new CustomEvent("delete",{detail:{itemId:s}})),this.closeDropdown(s)}closeDropdown(e){const s=this.template.querySelector(`.dropdown-content[data-id="${e}"]`);s&&(s.classList.remove("show"),this.activeDropdown=null)}async fetchIncidentsFromSalesforce(){if(V()){console.log("\u{1F310} Online: Fetching incidents from Salesforce"),console.log("Using Object API Name:",this.objectApiName),this.isLoading=!0,this.error=null;try{const e=window.jsforce;if(!e)throw new Error("JSForce library not loaded");const s=sessionStorage.getItem("sf_access_token"),t=sessionStorage.getItem("sf_instance_url");if(!s||!t)throw new Error("Not authenticated. Please login first.");const o=new e.Connection({accessToken:s,instanceUrl:t}),i=`SELECT Id,Name,Rhythm__Brief_Description__c,Rhythm__Incident_Title__c,Rhythm__Date_Of_Incident__c,Rhythm__Date_Reported__c FROM ${this.objectApiName}`;console.log("Executing query:",i);const a=await o.query(i);console.log("\u2705 Fetched incidents:",a),this.incidents=this.transformIncidentData(a.records),this.dispatchEvent(new CustomEvent("dataloaded",{detail:{items:this.incidents}}))}catch(e){console.error("\u274C Error fetching incidents:",e),this.error=e.message,this.loadFallbackData()}finally{this.isLoading=!1}}else console.log("\u{1F4F4} Offline: Using cached or sample data"),this.error="You are currently offline. Showing cached data.",this.loadFallbackData()}transformIncidentData(e){return e.map(s=>({id:s.Id,name:s.Name,title:s.Rhythm__Incident_Title__c||s.Name,description:s.Rhythm__Brief_Description__c||"No description available",dateOfIncident:s.Rhythm__Date_Of_Incident__c,dateReported:s.Rhythm__Date_Reported__c,formattedDateOfIncident:this.formatDate(s.Rhythm__Date_Of_Incident__c),formattedDateReported:this.formatDate(s.Rhythm__Date_Reported__c),status:"Active",statusClass:"status-completed"}))}loadFallbackData(){const e=new Date,s=new Date(e);s.setDate(s.getDate()-1);const t=[{id:"incident1",name:"Workplace Injury",title:"Slip and Fall Incident",description:"Employee slipped on wet floor in cafeteria area",dateOfIncident:s.toISOString(),dateReported:e.toISOString(),formattedDateOfIncident:this.formatDate(s.toISOString()),formattedDateReported:this.formatDate(e.toISOString()),status:"Active",statusClass:"status-completed"},{id:"incident2",name:"Equipment Failure",title:"Machine Malfunction",description:"Production line machine stopped working unexpectedly",dateOfIncident:e.toISOString(),dateReported:e.toISOString(),formattedDateOfIncident:this.formatDate(e.toISOString()),formattedDateReported:this.formatDate(e.toISOString()),status:"Active",statusClass:"status-completed"}];this.incidents=t,this.isLoading=!1}formatDate(e){try{const s=new Date(e);return isNaN(s.getTime())?"":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}catch(s){return console.error("Error formatting date:",s),""}}disconnectedCallback(){document.removeEventListener("click",this.documentClickListener)}handleDocumentClick(){const e=this.template.querySelectorAll(".dropdown-content.show");e.length>0&&(e.forEach(s=>{s.classList.remove("show")}),this.activeDropdown=null)}}Y(Ei,{publicProps:{objectApiName:{config:0}},track:{incidents:1,isLoading:1,error:1,visibleItemCount:1,activeDropdown:1}});const j1=z(Ei,{tmpl:P1,sel:"c-incident",apiVersion:63});function U1(n,e,s){var t=n?"["+n+"]":"",o=n?"-"+n:"";return[".hazard-container",t,` {font-family:\r
 'Inter',\r
 -apple-system,\r
 BlinkMacSystemFont,\r
 'Segoe UI',\r
 Roboto,\r
 Arial,\r
 sans-serif;color: #1f2937;width: 100%;padding: 0;}.hazard-name-link`,t," {text-decoration: none;color: #667eea;font-weight: 600;transition: color 0.2s ease;}.hazard-name-link:hover",t," {color: #5a67d8;}.desktop-view",t," {display: block;}.hazard-table",t," {width: 100%;border-collapse: collapse;background: #ffffff;border-radius: 16px;box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);overflow: hidden;border: 1px solid rgba(0, 0, 0, 0.06);}.hazard-table",t," thead",t," {background: #f8fafc;}.hazard-table",t," th",t," {padding: 20px 24px;text-align: left;font-weight: 600;font-size: 14px;color: #374151;border-bottom: 1px solid #e5e7eb;letter-spacing: 0.025em;}.hazard-table",t," td",t," {padding: 20px 24px;font-size: 14px;border-bottom: 1px solid #f3f4f6;vertical-align: middle;color: #6b7280;}.hazard-table",t," tr:last-child",t," td",t," {border-bottom: none;}.hazard-table",t," tr:hover",t," {background: #f9fafb;}.mobile-view",t," {display: none;}.hazard-card",t," {background: #ffffff;border-radius: 16px;border: 1px solid rgba(0, 0, 0, 0.06);box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);margin: 12px 2px;overflow: hidden;padding: 16px;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}.hazard-card:hover",t," {box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);transform: translateY(-2px);}.card-content",t," {display: flex;align-items: flex-start;margin-bottom: 16px;}.card-icon",t," {background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);border-radius: 12px;width: 48px;height: 48px;display: flex;align-items: center;justify-content: center;margin-right: 16px;flex-shrink: 0;}.hazard-icon",t," {width: 24px;height: 24px;fill: #d97706;}.card-details",t," {flex: 1;}.card-title",t," {margin: 0 0 8px 0;font-size: 18px;font-weight: 600;color: #111827;line-height: 1.3;}.card-metadata",t," {display: flex;flex-direction: column;gap: 8px;}.card-description",t," {font-size: 14px;color: #6b7280;line-height: 1.5;}.card-date",t," {font-size: 13px;color: #9ca3af;font-weight: 500;}.card-footer",t," {display: flex;justify-content: space-between;align-items: center;margin-top: 16px;padding-top: 16px;border-top: 1px solid #f3f4f6;}.card-menu",t," {display: flex;align-items: center;position: relative;}.dropdown",t," {position: relative;display: inline-block;}.three-dots",t," {font-size: 20px;color: #9ca3af;cursor: pointer;padding: 8px;user-select: none;display: inline-flex;align-items: center;justify-content: center;border-radius: 8px;transition: all 0.2s ease;}.three-dots:hover",t," {color: #6b7280;background: #f3f4f6;}.dropdown-content",t," {display: none;position: absolute;right: 0;top: 100%;min-width: 140px;background: #ffffff;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);border-radius: 12px;z-index: 100;overflow: hidden;margin-top: 8px;border: 1px solid rgba(0, 0, 0, 0.06);}.dropdown-content.show",t," {display: block;}.dropdown-item",t," {padding: 12px 16px;font-size: 14px;color: #374151;cursor: pointer;transition: background-color 0.2s ease;font-weight: 500;}.dropdown-item:not(:last-child)",t," {border-bottom: 1px solid #f3f4f6;}.dropdown-item:hover",t," {background: #f9fafb;color: #111827;}.status-completed",t,",\r.status-done",t,",\r.status-finished",t,",\r.status-active",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(16, 185, 129, 0.15);color: #065f46;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-in-progress",t,",\r.status-ongoing",t,",\r.status-started",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(234, 179, 8, 0.15);color: #92400e;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-pending",t,",\r.status-not-started",t,",\r.status-todo",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(124, 58, 237, 0.15);color: #4c1d95;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-blocked",t,",\r.status-stopped",t,",\r.status-halted",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: rgba(239, 68, 68, 0.15);color: #991b1b;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.status-default",t," {display: inline-flex;align-items: center;padding: 6px 12px;border-radius: 20px;background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);color: #6b7280;font-size: 12px;font-weight: 600;letter-spacing: 0.025em;}.loading-spinner",t," {display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 60px 40px;color: #6b7280;}.spinner",t," {width: 48px;height: 48px;border: 4px solid #f3f4f6;border-top: 4px solid #667eea;border-radius: 50%;animation: spin",o," 1s linear infinite;margin-bottom: 20px;}@keyframes spin",o," {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}.loading-text",t," {font-size: 16px;color: #6b7280;font-weight: 500;}.error-message",t," {display: flex;align-items: center;padding: 20px 24px;background: #fef2f2;border: 1px solid #fecaca;border-radius: 16px;margin: 20px 0;color: #dc2626;}.error-icon",t," {margin-right: 16px;font-size: 20px;}.error-text",t," {font-size: 14px;font-weight: 500;line-height: 1.5;}.no-data",t," {padding: 40px 24px;text-align: center;color: #9ca3af;background: #f9fafb;border-radius: 16px;font-size: 16px;margin-top: 20px;font-weight: 500;}@media screen and (max-width: 768px) {.desktop-view",t," {display: none;}.mobile-view",t," {display: block;}.hazard-card",t," {margin-bottom: 12px;padding: 16px;}.card-icon",t," {width: 40px;height: 40px;margin-right: 12px;}.card-title",t," {font-size: 16px;}.card-metadata",t," {gap: 6px;}.mobile-view",t," .status-completed",t,",\r .mobile-view",t," .status-done",t,",\r .mobile-view",t," .status-finished",t,",\r .mobile-view",t," .status-active",t,",\r .mobile-view",t," .status-in-progress",t,",\r .mobile-view",t," .status-ongoing",t,",\r .mobile-view",t," .status-started",t,",\r .mobile-view",t," .status-pending",t,",\r .mobile-view",t," .status-not-started",t,",\r .mobile-view",t," .status-todo",t,",\r .mobile-view",t," .status-blocked",t,",\r .mobile-view",t," .status-stopped",t,",\r .mobile-view",t," .status-halted",t,",\r .mobile-view",t," .status-default",t," {font-size: 11px;padding: 4px 10px;}}.view-more-container",t," {display: flex;justify-content: center;margin: 24px 0;}.view-more-button",t," {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: #ffffff;border: none;border-radius: 12px;padding: 12px 24px;font-size: 14px;font-weight: 600;cursor: pointer;transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);}.view-more-button:hover",t," {transform: translateY(-2px);box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);}"].join("")}var Ri=[U1];const V1=p`<div class="loading-spinner${0}"${2}><div class="spinner${0}"${2}></div><div class="loading-text${0}"${2}>Loading hazards...</div></div>`,q1=p`<div class="error-message${0}"${2}><div class="error-icon${0}"${2}>⚠️</div><div class="error-text${0}"${2}>${"t4"}</div></div>`,z1=p`<thead${3}><tr${3}><th${3}>Name</th><th${3}>Title</th><th${3}>Description</th><th${3}>Date Reported</th><th${3}>Status</th></tr></thead>`,W1=p`<td${3}><a href="javascript:void(0)"${"a1:data-id"} class="hazard-name-link${0}"${2}>${"t2"}</a></td>`,B1=p`<td${3}>${"t1"}</td>`,H1=p`<td${3}>${"t1"}</td>`,J1=p`<td${3}><span${"c1"}${2}>${"t2"}</span></td>`,Q1=p`<div class="no-data${0}"${2}>No hazard items found.</div>`,Y1=p`<div class="hazard-card${0}"${2}><div class="card-content${0}"${2}><div class="card-icon${0}"${2}><svg viewBox="0 0 24 24" class="hazard-icon${0}"${2}><path d="M13 14h-2v-4H9v2H7v2h2v2h2v-4h2v4h2v-2h-2V9h-2v5zm-1-5c0-1.1.9-2 2-2s2 .9 2 2-2 2-2-2z"${3}/></svg></div><div class="card-details${0}"${2}><h3 class="card-title${0}"${2}><a href="javascript:void(0)"${"a7:data-id"} class="hazard-name-link${0}"${2}>${"t8"}</a></h3><div class="card-metadata${0}"${2}><div class="card-description${0}"${2}>${"t11"}</div><div class="card-date${0}"${2}>${"t13"}</div></div></div></div><div class="card-footer${0}"${2}><span${"c15"}${2}>${"t16"}</span><div class="card-menu${0}"${2}><div class="dropdown${0}"${2}><span class="three-dots${0}"${"a19:data-id"}${2}>…</span><div class="dropdown-content${0}"${"a21:data-id"}${2}><div class="dropdown-item${0}"${"a22:data-id"}${2}>Edit</div><div class="dropdown-item${0}"${"a24:data-id"}${2}>Delete</div></div></div></div></div></div>`,K1=p`<div class="view-more-container${0}"${2}><button class="view-more-button${0}"${2}>View More</button></div>`,G1=p`<div class="no-data${0}"${2}>No hazard items found.</div>`,X1={classMap:{"hazard-container":!0},key:0},Z1={classMap:{"desktop-view":!0},key:5},ex={classMap:{"hazard-table":!0},key:6},tx={key:9},sx={key:17},Ai=[],ox={classMap:{"mobile-view":!0},key:22};function ut(n,e,s,t){const{st:o,d:i,sp:a,k:r,b:l,t:c,h:d,ncls:h,i:u,f}=n,{_m0:g,_m1:_,_m2:m,_m3:x,_m4:k,_m5:$}=t;return[d("div",X1,[e.isLoading?o(V1,2):null,e.error?o(q1,4,[a(4,null,i(e.error))]):null,d("div",Z1,[d("table",ex,[o(z1,8),d("tbody",tx,e.hasItems?u(e.hazards,function(S){return d("tr",{key:r(10,S.id)},[o(W1,12,[a(1,{on:g||(t._m0={click:l(e.handleHazardClick)}),attrs:{"data-id":S.id}},null),a(2,null,i(S.name))]),o(B1,14,[a(1,null,i(S.title))]),o(H1,16,[a(1,null,i(S.description))]),d("td",sx,[S.dateReported?c(i(S.formattedDateReported)):null]),o(J1,19,[a(1,{className:h(S.statusClass)},null),a(2,null,i(S.status))])])}):Ai)]),e.noData?o(Q1,21):null]),d("div",ox,f([e.hasItems?f([u(e.visibleItems,function(S){return o(Y1,r(24,S.id),[a(7,{on:_||(t._m1={click:l(e.handleHazardClick)}),attrs:{"data-id":S.id}},null),a(8,null,i(S.title)),a(11,null,i(S.description)),a(13,null,i(S.formattedDateReported)),a(15,{className:h(S.statusClass)},null),a(16,null,i(S.status)),a(19,{on:m||(t._m2={click:l(e.handleToggleMenu)}),attrs:{"data-id":S.id}},null),a(21,{attrs:{"data-id":S.id}},null),a(22,{on:x||(t._m3={click:l(e.handleEdit)}),attrs:{"data-id":S.id}},null),a(24,{on:k||(t._m4={click:l(e.handleDelete)}),attrs:{"data-id":S.id}},null)])}),e.showViewMoreButton?o(K1,26,[a(1,{on:$||(t._m5={click:l(e.handleViewMore)})},null)]):null]):Ai,e.noData?o(G1,28):null]))])]}var ix=J(ut);ut.stylesheets=[],ut.stylesheetToken="lwc-5ctpkthcpj9",ut.legacyStylesheetToken="c-hazard_hazard",Ri&&ut.stylesheets.push.apply(ut.stylesheets,Ri),Q(ut);class Ii extends K{constructor(...e){super(...e);this.objectApiName="Rhythm__Hazard__c",this.hazards=[],this.isLoading=!0,this.error=null,this.visibleItemCount=2,this.activeDropdown=null}connectedCallback(){console.log("Hazard component - Object API Name:",this.objectApiName),this.fetchHazardsFromSalesforce(),this.documentClickListener=this.handleDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener)}get visibleItems(){return this.hazards.slice(0,this.visibleItemCount)}get hasItems(){return this.hazards.length>0}get noData(){return!this.hasItems&&!this.isLoading}get showViewMoreButton(){return this.hazards.length>this.visibleItemCount}handleViewMore(){this.visibleItemCount=this.hazards.length}handleHazardClick(e){const s=e.currentTarget.dataset.id,t=this.hazards.find(o=>o.id===s);t&&(console.log("Hazard item clicked:",t),this.dispatchEvent(new CustomEvent("view",{detail:{itemId:s,item:t}})))}handleToggleMenu(e){const s=e.currentTarget.dataset.id;this.template.querySelectorAll(".dropdown-content").forEach(i=>{(i.dataset.id!==s||i.dataset.id===s&&i.classList.contains("show"))&&i.classList.remove("show")});const o=this.template.querySelector(`.dropdown-content[data-id="${s}"]`);o&&(o.classList.contains("show")?this.activeDropdown=null:(o.classList.add("show"),this.activeDropdown=s)),e.stopPropagation()}handleEdit(e){const s=e.currentTarget.dataset.id,t=this.hazards.find(o=>o.id===s);t&&this.dispatchEvent(new CustomEvent("edit",{detail:{itemId:s,item:t}})),this.closeDropdown(s)}handleDelete(e){const s=e.currentTarget.dataset.id;this.dispatchEvent(new CustomEvent("delete",{detail:{itemId:s}})),this.closeDropdown(s)}closeDropdown(e){const s=this.template.querySelector(`.dropdown-content[data-id="${e}"]`);s&&(s.classList.remove("show"),this.activeDropdown=null)}async fetchHazardsFromSalesforce(){if(V()){console.log("\u{1F310} Online: Fetching hazards from Salesforce"),console.log("Using Object API Name:",this.objectApiName),this.isLoading=!0,this.error=null;try{const e=window.jsforce;if(!e)throw new Error("JSForce library not loaded");const s=sessionStorage.getItem("sf_access_token"),t=sessionStorage.getItem("sf_instance_url");if(!s||!t)throw new Error("Not authenticated. Please login first.");const o=new e.Connection({accessToken:s,instanceUrl:t}),i=`SELECT Id,Name,Rhythm__Title__c,Rhythm__Description__c,Rhythm__Date_Reported__c FROM ${this.objectApiName}`;console.log("Executing query:",i);const a=await o.query(i);console.log("\u2705 Fetched hazards:",a),this.hazards=this.transformHazardData(a.records),this.dispatchEvent(new CustomEvent("dataloaded",{detail:{items:this.hazards}}))}catch(e){console.error("\u274C Error fetching hazards:",e),this.error=e.message,this.loadFallbackData()}finally{this.isLoading=!1}}else console.log("\u{1F4F4} Offline: Using cached or sample data"),this.error="You are currently offline. Showing cached data.",this.loadFallbackData()}transformHazardData(e){return e.map(s=>({id:s.Id,name:s.Name,title:s.Rhythm__Title__c||s.Name,description:s.Rhythm__Description__c||"No description available",dateReported:s.Rhythm__Date_Reported__c,formattedDateReported:this.formatDate(s.Rhythm__Date_Reported__c),status:"Active",statusClass:"status-completed"}))}loadFallbackData(){const e=new Date,s=new Date(e);s.setDate(s.getDate()-1);const t=[{id:"hazard1",name:"Electrical Hazard",title:"Exposed Wiring in Production Area",description:"Electrical wiring exposed in the main production floor",dateReported:s.toISOString(),formattedDateReported:this.formatDate(s.toISOString()),status:"Active",statusClass:"status-completed"},{id:"hazard2",name:"Chemical Spill Risk",title:"Chemical Storage Safety Issue",description:"Improper storage of hazardous chemicals in warehouse",dateReported:e.toISOString(),formattedDateReported:this.formatDate(e.toISOString()),status:"Active",statusClass:"status-completed"}];this.hazards=t,this.isLoading=!1}formatDate(e){try{const s=new Date(e);return isNaN(s.getTime())?"":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}catch(s){return console.error("Error formatting date:",s),""}}disconnectedCallback(){document.removeEventListener("click",this.documentClickListener)}handleDocumentClick(){const e=this.template.querySelectorAll(".dropdown-content.show");e.length>0&&(e.forEach(s=>{s.classList.remove("show")}),this.activeDropdown=null)}}Y(Ii,{publicProps:{objectApiName:{config:0}},track:{hazards:1,isLoading:1,error:1,visibleItemCount:1,activeDropdown:1}});const ax=z(Ii,{tmpl:ix,sel:"c-hazard",apiVersion:63});class Bt extends K{constructor(...e){super(...e);this.component=void 0,this.props={},this.componentDetail=void 0,this.isLoading=!1,this.hasError=!1,this.errorMessage="",this.loadedComponent=null,this.isAttachment=!1}connectedCallback(){console.log("componentDetail in line 35",JSON.stringify(this.componentDetail)),this.componentDetail&&(this.isAttachment=this.componentDetail.isAttachment),this.loadComponent(),this.refreshListener=this.handleDynamicHostRefresh.bind(this),this.addEventListener("dynamichostrefreshassessment",this.refreshListener)}disconnectedCallback(){this.refreshListener&&this.removeEventListener("dynamichostrefreshassessment",this.refreshListener)}handleDynamicHostRefresh(e){if(console.log("\u{1F504} DynamicHost received refresh event:",e.detail),this.showAssessmentDetail){console.log("\u{1F504} DynamicHost propagating refresh to assessment detail");const s=this.template.querySelector("c-assessment-detail");if(s&&typeof s.loadAssessmentData=="function")console.log("\u{1F504} DynamicHost calling loadAssessmentData on assessment detail"),s.loadAssessmentData();else{console.log("\u26A0\uFE0F Assessment detail component not found or method not available");const t=new CustomEvent("assessmentdetailrefresh",{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),source:"dynamicHost",originalSource:e.detail.source}});this.dispatchEvent(t)}}else console.log("\u{1F504} DynamicHost is not showing assessment detail, skipping refresh")}refresh(){this.loadComponent()}get isLoadingOrError(){return this.isLoading||this.hasError}get resolvedProps(){return this.props||{}}get componentTitle(){const e=this.loadedComponent;return e?this.props&&this.props.recordName?this.props.recordName:this.props&&this.props.recordId?`${this.formatComponentName(e)} - ${this.props.recordId}`:this.formatComponentName(e):"Component"}formatComponentName(e){return e?e.replace(/([A-Z])/g," $1").replace(/^cp /i,"").replace(/\b\w/g,s=>s.toUpperCase()).trim():""}handleBack(){this.dispatchEvent(new CustomEvent("navigate",{detail:{type:"back"}}))}get showCpDetailPage(){return this.loadedComponent==="cpDetailPage"}get showIncident(){return this.loadedComponent==="incident"}get showHazard(){return this.loadedComponent==="hazard"}get showSafetyEventForm(){return this.loadedComponent==="safetyEventForm"}get showGenericListView(){return this.loadedComponent==="genericListView"}get showCpExpListView(){return this.loadedComponent==="cpExpListView"}get showAwsS3Files(){return this.loadedComponent==="awsS3Files"}get showStatus(){return this.loadedComponent==="status"}get showTrainingAttendanceForm(){return this.loadedComponent==="trainingAttendanceForm"}get showTabInvestigation(){return this.loadedComponent==="tabInvestigation"}get showMockDrillReport(){return this.loadedComponent==="mockDrillReport"}get showAssessmentDetail(){return this.loadedComponent==="assessmentDetail"}normalizeComponentName(e){if(!e||typeof e!="string")return null;const s=e.trim();return this.constructor.nameOnlyRegex.test(s)?s:null}async loadComponent(){if(this.hasError=!1,this.errorMessage="",this.loadedComponent=null,!this.component){this.setError("No component specified");return}console.log("component",this.component),console.log("props",JSON.stringify(this.props)),console.log("showCpExpListView",JSON.stringify(this.showCpExpListView));const e=this.normalizeComponentName(this.component);if(!e){this.setError(`Invalid component name: "${this.component}"`);return}this.isLoading=!0;try{if(console.log(`\u{1F504} Loading component: ${e}`),!this.constructor.componentRegistry[e]){const t=Object.keys(this.constructor.componentRegistry).join(", ");throw new Error(`Component not registered: ${e}. Available components: ${t}`)}this.loadedComponent=e,this.dispatchEvent(new CustomEvent("loaded",{detail:{component:e,name:this.component}})),console.log(`\u2705 Component ${e} loaded successfully`)}catch(s){this.setError(`Failed to load "${e}": ${s?.message||s}`)}finally{this.isLoading=!1}}setError(e){this.hasError=!0,this.errorMessage=String(e||"Unknown error"),this.loadedComponent=null,this.dispatchEvent(new CustomEvent("error",{detail:{message:this.errorMessage,component:this.component}}))}handleRetry(){this.loadComponent()}}Bt.nameOnlyRegex=/^[a-zA-Z0-9_-]+$/,Bt.componentRegistry={cpDetailPage:Uo,incident:j1,hazard:ax,safetyEventForm:$s,genericListView:ms,cpExpListView:Ss,awsS3Files:zt,status:Bo,trainingAttendanceForm:Ko,tabInvestigation:ii,mockDrillReport:ri,assessmentDetail:$i},Y(Bt,{publicProps:{component:{config:0},props:{config:0},componentDetail:{config:0}},publicMethods:["refresh"],track:{isLoading:1,hasError:1,errorMessage:1,loadedComponent:1,isAttachment:1}});const nx=z(Bt,{tmpl:b1,sel:"c-dynamic-host",apiVersion:63});function rx(n,e,s){var t=n?"["+n+"]":"";return".qr-scanner-container"+t+" {display: flex;flex-direction: column;align-items: center;padding: 1rem;}.scan-button"+t+" {display: flex;align-items: center;justify-content: center;background-color: #667eea;color: white;border: none;border-radius: 8px;padding: 0.75rem 1.5rem;font-size: 1rem;font-weight: 500;cursor: pointer;transition: background-color 0.2s ease;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);}.scan-button:hover"+t+" {background-color: #5a6fd6;}.scan-button:disabled"+t+" {background-color: #a0aec0;cursor: not-allowed;}.qr-icon"+t+" {width: 1.5rem;height: 1.5rem;margin-right: 0.5rem;}.error-message"+t+" {color: #e53e3e;margin-bottom: 1rem;padding: 0.75rem;background-color: #fff5f5;border-radius: 4px;border-left: 4px solid #e53e3e;width: 100%;max-width: 400px;}"}var Fi=[rx];const lx=p`<div class="error-message${0}"${2}>${"t1"}</div>`,cx=p`<svg class="qr-icon${0}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${2}><path d="M3 3h7v7H3z"${3}/><path d="M14 3h7v7h-7z"${3}/><path d="M14 14h7v7h-7z"${3}/><path d="M3 14h7v7H3z"${3}/></svg>`,dx=p`<span${3}>Scanning...</span>`,hx=p`<span${3}>Scan QR Code</span>`,ux={classMap:{"qr-scanner-container":!0},key:0},px={"scan-button":!0};function pt(n,e,s,t){const{d:o,sp:i,st:a,b:r,h:l}=n,{_m0:c}=t;return[l("div",ux,[e.errorMessage?a(lx,2,[i(1,null,o(e.errorMessage))]):null,l("button",{classMap:px,attrs:{disabled:e.isScanning?"":null},key:3,on:c||(t._m0={click:r(e.handleScanClick)})},[a(cx,5),e.isScanning?a(dx,7):null,e.isScanning?null:a(hx,9)])])]}var fx=J(pt);pt.stylesheets=[],pt.stylesheetToken="lwc-2e57117jjpb",pt.legacyStylesheetToken="c-qrScanner_qrScanner",Fi&&pt.stylesheets.push.apply(pt.stylesheets,Fi),Q(pt);var Di=Object.defineProperty,mx=n=>Di(n,"__esModule",{value:!0}),gx=(n,e)=>()=>(e||(e={exports:{}},n(e.exports,e)),e.exports),_x=(n,e)=>{for(var s in e)Di(n,s,{get:e[s],enumerable:!0})},bx=gx(n=>{mx(n),_x(n,{BarcodeScannerWeb:()=>e});var e=class extends Os{constructor(){super(...arguments);this._isSupported="BarcodeDetector"in window,this.errorVideoElementMissing="videoElement must be provided.",this.eventBarcodesScanned="barcodesScanned"}async startScan(s){if(!this._isSupported)throw this.createUnavailableException();if(!(s==null?void 0:s.videoElement))throw new Error(this.errorVideoElementMissing);this.videoElement=s.videoElement,this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:(s==null?void 0:s.lensFacing)===Ns.Front?"user":"environment"}},audio:!1}),s.videoElement.srcObject=this.stream,await s.videoElement.play();const t=new BarcodeDetector;this.intervalId=window.setInterval(async()=>{if(!s.videoElement)return;const o=await t.detect(s.videoElement);o.length!==0&&this.handleScannedBarcodes(o)},500)}async stopScan(){if(!this._isSupported)throw this.createUnavailableException();this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0),this.stream&&(this.stream.getTracks().forEach(s=>s.stop()),this.stream=void 0),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement=void 0)}async readBarcodesFromImage(s){throw this.createUnavailableException()}async scan(){throw this.createUnavailableException()}async isSupported(){return{supported:this._isSupported}}async enableTorch(){throw this.createUnavailableException()}async disableTorch(){throw this.createUnavailableException()}async toggleTorch(){throw this.createUnavailableException()}async isTorchEnabled(){throw this.createUnavailableException}async isTorchAvailable(){throw this.createUnavailableException()}async setZoomRatio(s){throw this.createUnavailableException()}async getZoomRatio(){throw this.createUnavailableException()}async getMinZoomRatio(){throw this.createUnavailableException()}async getMaxZoomRatio(){throw this.createUnavailableException()}async openSettings(){throw this.createUnavailableException()}async isGoogleBarcodeScannerModuleAvailable(){throw this.createUnavailableException()}async installGoogleBarcodeScannerModule(){throw this.createUnavailableException()}async checkPermissions(){try{return{camera:(await navigator.permissions.query({name:"camera"})).state}}catch(s){return{camera:"prompt"}}}async requestPermissions(){try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(t=>t.stop()),{camera:"granted"}}catch(s){return{camera:"denied"}}}createUnavailableException(){return new Ht("This plugin method is not available on this platform.",ft.Unavailable)}handleScannedBarcodes(s){const t={barcodes:s.map(o=>({cornerPoints:[[o.cornerPoints[0].x,o.cornerPoints[0].y],[o.cornerPoints[1].x,o.cornerPoints[1].y],[o.cornerPoints[2].x,o.cornerPoints[2].y],[o.cornerPoints[3].x,o.cornerPoints[3].y]],displayValue:o.rawValue,rawValue:o.rawValue,format:o.format.toUpperCase(),valueType:Ls.Unknown}))};this.notifyListeners(this.eventBarcodesScanned,t)}}});/*! Capacitor: https://capacitorjs.com/ - MIT License */var ft;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(ft||(ft={}));var Ht=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},yx=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},vx=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:yx(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new Ht(`"${h}" plugin is not implemented on ${g}`,ft.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new Ht(`"${h}.${v}()" is not implemented on ${g}`,ft.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=Ht,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},wx=n=>n.Capacitor=vx(n),Ds=wx(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),Ts=Ds.registerPlugin,Os=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new Ds.Exception(n,ft.Unimplemented)}unavailable(n="not available"){return new Ds.Exception(n,ft.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},Ti=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Oi=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),xx=class extends Os{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=Oi(t).trim(),o=Oi(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=Ti(n.key),s=Ti(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};Ts("CapacitorCookies",{web:()=>new xx});var kx=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),$x=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},Cx=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,Sx=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=$x(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},Ex=class extends Os{async request(n){const e=Sx(n,n.webFetchExtra),s=Cx(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await kx(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};Ts("CapacitorHttp",{web:()=>new Ex});var Li;(function(n){n.Aztec="AZTEC",n.Codabar="CODABAR",n.Code39="CODE_39",n.Code93="CODE_93",n.Code128="CODE_128",n.DataMatrix="DATA_MATRIX",n.Ean8="EAN_8",n.Ean13="EAN_13",n.Itf="ITF",n.Pdf417="PDF_417",n.QrCode="QR_CODE",n.UpcA="UPC_A",n.UpcE="UPC_E"})(Li||(Li={}));var Ls;(function(n){n.CalendarEvent="CALENDAR_EVENT",n.ContactInfo="CONTACT_INFO",n.DriversLicense="DRIVERS_LICENSE",n.Email="EMAIL",n.Geo="GEO",n.Isbn="ISBN",n.Phone="PHONE",n.Product="PRODUCT",n.Sms="SMS",n.Text="TEXT",n.Url="URL",n.Wifi="WIFI",n.Unknown="UNKNOWN"})(Ls||(Ls={}));var Ni;(function(n){n[n["640x480"]=0]="640x480",n[n["1280x720"]=1]="1280x720",n[n["1920x1080"]=2]="1920x1080",n[n["3840x2160"]=3]="3840x2160"})(Ni||(Ni={}));var Ns;(function(n){n.Front="FRONT",n.Back="BACK"})(Ns||(Ns={}));var Mi;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.PENDING=1]="PENDING",n[n.DOWNLOADING=2]="DOWNLOADING",n[n.CANCELED=3]="CANCELED",n[n.COMPLETED=4]="COMPLETED",n[n.FAILED=5]="FAILED",n[n.INSTALLING=6]="INSTALLING",n[n.DOWNLOAD_PAUSED=7]="DOWNLOAD_PAUSED"})(Mi||(Mi={}));var Pi;(function(n){n[n.HOME=0]="HOME",n[n.UNKNOWN=1]="UNKNOWN",n[n.WORK=2]="WORK"})(Pi||(Pi={}));var ji;(function(n){n[n.HOME=0]="HOME",n[n.UNKNOWN=1]="UNKNOWN",n[n.WORK=2]="WORK"})(ji||(ji={}));var Ui;(function(n){n[n.FAX=0]="FAX",n[n.HOME=1]="HOME",n[n.MOBILE=2]="MOBILE",n[n.UNKNOWN=3]="UNKNOWN",n[n.WORK=4]="WORK"})(Ui||(Ui={}));var Vi;(function(n){n[n.OPEN=1]="OPEN",n[n.WEP=2]="WEP",n[n.WPA=3]="WPA"})(Vi||(Vi={}));var Nt=Ts("BarcodeScanner",{web:()=>Promise.resolve().then(()=>bx()).then(n=>new n.BarcodeScannerWeb)});class qi extends K{constructor(...e){super(...e);this.isSupported=!1,this.isPermissionGranted=!1,this.errorMessage="",this.isScanning=!1}async connectedCallback(){try{const{supported:e}=await Nt.isSupported();if(this.isSupported=e,this.isSupported){const s=await Nt.checkPermissions();this.isPermissionGranted=s.camera==="granted"}}catch(e){console.error("Error initializing QR scanner:",e),this.errorMessage="Failed to initialize QR scanner: "+e.message}}async requestPermissions(){try{const e=await Nt.requestPermissions();this.isPermissionGranted=e.camera==="granted",this.isPermissionGranted?this.startScan():this.errorMessage="Camera permission is required to scan QR codes."}catch(e){console.error("Error requesting camera permission:",e),this.errorMessage="Failed to request camera permission: "+e.message}}async startScan(){try{if(this.errorMessage="",this.isScanning=!0,(await Nt.checkPermissions()).camera!=="granted"){this.errorMessage="Camera permission is required to scan QR codes.";return}const s=await Nt.scan();if(s&&s.barcodes&&s.barcodes.length>0){const t=s.barcodes[0];console.log("Scanned barcode:",t),await this.handleScannedContent(t.rawValue)}else this.errorMessage="No QR code detected. Please try again."}catch(e){console.error("Error during QR scan:",e),e.message.includes("permission")?(this.errorMessage="Camera permission denied. Please grant camera access in device settings.",this.isPermissionGranted=!1):e.message.includes("not supported")?(this.errorMessage="QR code scanning is not supported on this device.",this.isSupported=!1):this.errorMessage="Failed to scan QR code: "+e.message}finally{this.isScanning=!1}}async handleScannedContent(e){try{if(console.log("\u{1F4F1} Processing scanned content:",e),!this.isValidUrl(e)){this.errorMessage="Scanned content is not a valid URL";return}const s=await this.validateScannedUrl(e);if(!s.isValid){this.errorMessage=s.error;return}await this.routeToForm(s.parsedUrl)}catch(s){console.error("Error handling scanned content:",s),this.errorMessage="Failed to process QR code content: "+s.message,this.dispatchEvent(new CustomEvent("scanerror",{detail:{error:s.message}}))}}async validateScannedUrl(e){try{const s=new URL(e);if(!(sessionStorage.getItem("sf_instance_url")||localStorage.getItem("sf_instance_url")||window.SF_LOGIN_URL))return{isValid:!1,error:"No Salesforce login URL configured. Please login first."};const o=s.pathname;let i=null,a=null;if(o.includes("incident-form"))i="incident",a="Rhythm__Incident_Injury__c";else if(o.includes("hazard-form"))i="hazard",a="Rhythm__Hazard__c";else return{isValid:!1,error:"Unknown form type in URL. Expected: incident-form or hazard-form"};const r=s.searchParams,l=r.get("locationId"),c=r.get("workAreaId");return l?c?{isValid:!0,parsedUrl:{formType:i,objectApiName:a,locationId:l,workAreaId:c,originalUrl:e}}:{isValid:!1,error:"Missing required parameter: workAreaId"}:{isValid:!1,error:"Missing required parameter: locationId"}}catch(s){return{isValid:!1,error:"Invalid URL format: "+s.message}}}async routeToForm(e){try{console.log("\u{1F680} Routing to form:",e),this.dispatchEvent(new CustomEvent("scansuccess",{detail:{formRoute:!0,formType:e.formType,objectApiName:e.objectApiName,locationId:e.locationId,workAreaId:e.workAreaId,originalUrl:e.originalUrl}})),this.errorMessage="",console.log(`\u2705 Successfully routed to ${e.formType} form`)}catch(s){console.error("Error routing to form:",s),this.errorMessage="Failed to route to form: "+s.message}}isValidUrl(e){try{return new URL(e),!0}catch(s){return!1}}handleScanClick(){this.isSupported?this.isPermissionGranted?this.startScan():this.requestPermissions():this.errorMessage="QR code scanning is not supported on this device."}}Y(qi,{track:{isSupported:1,isPermissionGranted:1,errorMessage:1,isScanning:1}});const Rx=z(qi,{tmpl:fx,sel:"c-qr-scanner",apiVersion:63}),Ax=p`<div class="header-title${0}"${2}><div${3}><h1${3}>${"t3"}</h1></div></div>`,Ix=p`<svg class="search-icon${0}" fill="none" stroke="currentColor" viewBox="0 0 24 24"${2}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"${3}/></svg>`,Fx=p`<div class="qr-button-container${0}"${2}><button class="qr-button${0}"${2}><svg class="qr-icon${0}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${2}><path d="M3 3h7v7H3z"${3}/><path d="M14 3h7v7h-7z"${3}/><path d="M14 14h7v7h-7z"${3}/><path d="M3 14h7v7H3z"${3}/></svg></button></div>`,Dx=p`<div class="page-header${0}"${2}><button class="back-button${0}" aria-label="Back to tabs"${2}><svg class="back-icon${0}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${2}><path d="M19 12H5"${3}/><path d="M12 19l-7-7 7-7"${3}/></svg></button><h1 class="page-title${0}"${2}>${"t6"}</h1></div>`,Tx=p`<button class="fab${0}" title="Add New"${2}><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"${3}><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"${3}/></svg></button>`,Ox=p`<div class="modal-header${0}"${2}><h2${3}>Scan QR Code</h2><button class="close-button${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M6 18L18 6M6 6l12 12"${3}/></svg></button></div>`,Lx=p`<div class="modal-header notification-header${0}"${2}><h2${3}>${"t2"}</h2><button class="close-button${0}"${2}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"${3}><path d="M6 18L18 6M6 6l12 12"${3}/></svg></button></div>`,Nx=Rt`<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"${3}/>`,Mx=Rt`<path d="M22 4L12 14.01l-3-3"${3}/>`,Px=Rt`<circle cx="12" cy="12" r="10"${3}/>`,jx=Rt`<path d="M12 8v4"${3}/>`,Ux=Rt`<path d="M12 16h.01"${3}/>`,Vx=p`<p class="notification-message${0}"${2}>${"t1"}</p>`,qx=p`<div class="modal-footer notification-footer${0}"${2}><button class="button notification-button${0}"${2}>OK</button></div>`,zx={classMap:{"app-container":!0},key:0},Wx={key:2},Bx={classMap:{"main-layout":!0},key:3},Hx={classMap:{"view-container":!0},key:6},Jx={classMap:{"view-header":!0},key:7},Qx={classMap:{"header-content":!0},key:8},Yx={classMap:{"search-container":!0},key:11},Kx={classMap:{"search-wrapper":!0},key:12},Gx={"search-input":!0},Xx={type:"text",placeholder:"Search this list..."},Zx={classMap:{"content-scroll":!0},key:18},e2={classMap:{"form-page":!0},key:21},t2={classMap:{"component-page":!0},key:23},s2={classMap:{"component-content":!0},key:26},o2={"modal-overlay":!0},i2={"modal-content":!0},a2={classMap:{"modal-body":!0},key:34},n2={"modal-overlay":!0,"notification-overlay":!0},r2={"modal-content":!0,"notification-modal":!0},l2={classMap:{"modal-body":!0,"notification-body":!0},key:40},c2={attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},key:42,svg:!0};function mt(n,e,s,t){const{b:o,c:i,ncls:a,d:r,sp:l,st:c,h:d}=n,{_m0:h,_m1:u,_m2:f,_m3:g,_m4:_,_m5:m,_m6:x,_m7:k,_m8:$,_m9:S,_m10:O,_m11:F,_m12:D,_m13:v,_m14:A,_m15:w,_m16:y,_m17:C}=t;return[d("div",zx,[e.showLogin?i("c-login",da,{key:1,on:h||(t._m0={login:o(e.handleLoginSuccess)})}):null,e.isLoggedIn?i("c-scroll-metadata-refresh",On,Wx):null,e.isLoggedIn?d("div",Bx,[i("c-left-menu",Hn,{props:{hideToggle:e.hideMenuToggle},key:4,on:u||(t._m1={menuchange:o(e.handleMenuChange),logout:o(e.handleLogout)})}),d("div",{className:a(e.contentAreaClass),key:5},[e.showListView?d("div",Hx,[d("div",Jx,[d("div",Qx,[c(Ax,10,[l(3,null,r(e.currentViewTitle))]),d("div",Yx,[d("div",Kx,[c(Ix,14),d("input",{classMap:Gx,attrs:Xx,props:{value:e.searchTerm},key:15,on:f||(t._m2={input:o(e.handleSearch)})})]),c(Fx,17,[l(1,{on:g||(t._m3={click:o(e.handleQrScanClick)})},null)])])])]),d("div",Zx,[i("c-generic-list-view",ms,{props:{objectApiName:e.currentObjectApiName},key:19,on:_||(t._m4={navigate:o(e.handleNavigate)})})])]):null,e.showTabsPage?i("c-tabs-shell",Rr,{props:{objectApiName:e.currentObjectApiName,recordId:e.recordId},key:20,on:m||(t._m5={navigate:o(e.handleNavigate)})}):null,e.showForm?d("div",e2,[i("c-safety-event-form",$s,{props:{objectApiName:e.currentObjectApiName,isVisible:e.showForm,qrData:e.qrData},key:22,on:x||(t._m6={cancel:o(e.handleFormCancel),success:o(e.handleFormSuccess),error:o(e.handleFormError)})})]):null,e.showComponentPage?d("div",t2,[c(Dx,25,[l(1,{on:k||(t._m7={click:o(e.handleBackToTabs)})},null),l(6,null,r(e.selectedTabLabel))]),d("div",s2,[i("c-dynamic-host",nx,{props:{component:e.selectedComponent,props:e.selectedComponentProps,componentDetail:e.componentDetail},key:27})])]):null,e.showFab?c(Tx,29,[l(0,{on:S||(t._m9={click:o(e.handleFabClick)})},null)]):null,e.showQrScanner?d("div",{classMap:o2,key:30,on:O||(t._m10={click:o(e.handleCloseQrScanner)})},[d("div",{classMap:i2,key:31,on:F||(t._m11={click:o(e.handleModalContentClick)})},[c(Ox,33,[l(3,{on:D||(t._m12={click:o(e.handleCloseQrScanner)})},null)]),d("div",a2,[i("c-qr-scanner",Rx,{key:35,on:v||(t._m13={scansuccess:o(e.handleQrScanSuccess),scanerror:o(e.handleQrScanError)})})])])]):null,e.showNotificationModal?d("div",{classMap:n2,key:36,on:A||(t._m14={click:o(e.handleCloseNotification)})},[d("div",{classMap:r2,key:37,on:w||(t._m15={click:o(e.handleModalContentClick)})},[c(Lx,39,[l(2,null,r(e.notificationTitle)),l(3,{on:y||(t._m16={click:o(e.handleCloseNotification)})},null)]),d("div",l2,[d("div",{className:a(e.notificationIconClass),key:41},[d("svg",c2,[e.isSuccessNotification?c(Nx,44):null,e.isSuccessNotification?c(Mx,46):null,e.isSuccessNotification?null:c(Px,48),e.isSuccessNotification?null:c(jx,50),e.isSuccessNotification?null:c(Ux,52)])]),c(Vx,54,[l(1,null,r(e.notificationMessage))])]),c(qx,56,[l(1,{on:C||(t._m17={click:o(e.handleCloseNotification)})},null)])])]):null])]):null])]}var d2=J(mt);mt.stylesheets=[],mt.stylesheetToken="lwc-2rjvebuuto3",mt.legacyStylesheetToken="c-app_app",qs&&mt.stylesheets.push.apply(mt.stylesheets,qs),Q(mt);var zi=Object.defineProperty,h2=n=>zi(n,"__esModule",{value:!0}),u2=(n,e)=>()=>(e||(e={exports:{}},n(e.exports,e)),e.exports),p2=(n,e)=>{for(var s in e)zi(n,s,{get:e[s],enumerable:!0})},f2=u2(n=>{h2(n),p2(n,{Browser:()=>s,BrowserWeb:()=>e});var e=class extends Us{constructor(){super();this._lastWindow=null}async open(t){this._lastWindow=window.open(t.url,t.windowName||"_blank")}async close(){return new Promise((t,o)=>{this._lastWindow!=null?(this._lastWindow.close(),this._lastWindow=null,t()):o("No active window to close!")})}},s=new e});/*! Capacitor: https://capacitorjs.com/ - MIT License */var Et;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Et||(Et={}));var Ms=class extends Error{constructor(n,e,s){super(n);this.message=n,this.code=e,this.data=s}},m2=n=>{var e,s;return(n==null?void 0:n.androidBridge)?"android":((s=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0?void 0:s.bridge)?"ios":"web"},g2=n=>{const e=n.CapacitorCustomPlatform||null,s=n.Capacitor||{},t=s.Plugins=s.Plugins||{},o=()=>e!==null?e.name:m2(n),i=()=>o()!=="web",a=h=>{const u=c.get(h);return!!((u==null?void 0:u.platforms.has(o()))||r(h))},r=h=>{var u;return(u=s.PluginHeaders)===null||u===void 0?void 0:u.find(f=>f.name===h)},l=h=>n.console.error(h),c=new Map,d=(h,u={})=>{const f=c.get(h);if(f)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),f.proxy;const g=o(),_=r(h);let m;const x=async()=>(!m&&g in u?m=typeof u[g]=="function"?m=await u[g]():m=u[g]:e!==null&&!m&&"web"in u&&(m=typeof u.web=="function"?m=await u.web():m=u.web),m),k=(v,A)=>{var w,y;if(_){const C=_==null?void 0:_.methods.find(I=>A===I.name);if(C)return C.rtype==="promise"?I=>s.nativePromise(h,A.toString(),I):(I,L)=>s.nativeCallback(h,A.toString(),I,L);if(v)return(w=v[A])===null||w===void 0?void 0:w.bind(v)}else{if(v)return(y=v[A])===null||y===void 0?void 0:y.bind(v);throw new Ms(`"${h}" plugin is not implemented on ${g}`,Et.Unimplemented)}},$=v=>{let A;const w=(...y)=>{const C=x().then(I=>{const L=k(I,v);if(L){const N=L(...y);return A=N==null?void 0:N.remove,N}else throw new Ms(`"${h}.${v}()" is not implemented on ${g}`,Et.Unimplemented)});return v==="addListener"&&(C.remove=async()=>A()),C};return w.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:v,writable:!1,configurable:!1}),w},S=$("addListener"),O=$("removeListener"),F=(v,A)=>{const w=S({eventName:v},A),y=async()=>{const I=await w;O({eventName:v,callbackId:I},A)},C=new Promise(I=>w.then(()=>I({remove:y})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await y()},C},D=new Proxy({},{get(v,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?F:S;case"removeListener":return O;default:return $(A)}}});return t[h]=D,c.set(h,{name:h,proxy:D,platforms:new Set([...Object.keys(u),..._?[g]:[]])}),D};return s.convertFileSrc||(s.convertFileSrc=h=>h),s.getPlatform=o,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=a,s.registerPlugin=d,s.Exception=Ms,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},_2=n=>n.Capacitor=g2(n),Ps=_2(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:{}),js=Ps.registerPlugin,Us=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let s=!1;this.listeners[n]||(this.listeners[n]=[],s=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(n);const i=async()=>this.removeListener(n,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,s){const t=this.listeners[n];if(!t){if(s){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}t.forEach(o=>o(e))}hasListeners(n){var e;return!!((e=this.listeners[n])===null||e===void 0?void 0:e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(n="not implemented"){return new Ps.Exception(n,Et.Unimplemented)}unavailable(n="not available"){return new Ps.Exception(n,Et.Unavailable)}async removeListener(n,e){const s=this.listeners[n];if(!s)return;const t=s.indexOf(e);this.listeners[n].splice(t,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){!n||(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];!e||(delete this.retainedEventArguments[n],e.forEach(s=>{this.notifyListeners(n,s)}))}},Wi=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Bi=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),b2=class extends Us{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(s=>{if(s.length<=0)return;let[t,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");t=Bi(t).trim(),o=Bi(o).trim(),e[t]=o}),e}async setCookie(n){try{const e=Wi(n.key),s=Wi(n.value),t=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),i=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${s||""}${t}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}};js("CapacitorCookies",{web:()=>new b2});var y2=async n=>new Promise((e,s)=>{const t=new FileReader;t.onload=()=>{const o=t.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},t.onerror=o=>s(o),t.readAsDataURL(n)}),v2=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,i,a)=>(o[i]=n[e[a]],o),{})},w2=(n,e=!0)=>n?Object.entries(n).reduce((t,o)=>{const[i,a]=o;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${i}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${i}=${r}`),`${t}&${l}`},"").substr(1):null,x2=(n,e={})=>{const s=Object.assign({method:n.method||"GET",headers:n.headers},e),o=v2(n.headers)["content-type"]||"";if(typeof n.data=="string")s.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[a,r]of Object.entries(n.data||{}))i.set(a,r);s.body=i.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,l)=>{i.append(l,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);s.body=i;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(o.includes("application/json")||typeof n.data=="object")&&(s.body=JSON.stringify(n.data));return s},k2=class extends Us{async request(n){const e=x2(n,n.webFetchExtra),s=w2(n.params,n.shouldEncodeUrlParams),t=s?`${n.url}?${s}`:n.url,o=await fetch(t,e),i=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?n:{};i.includes("application/json")&&(a="json");let r,l;switch(a){case"arraybuffer":case"blob":l=await o.blob(),r=await y2(l);break;case"json":r=await o.json();break;case"document":case"text":default:r=await o.text()}const c={};return o.headers.forEach((d,h)=>{c[h]=d}),{data:r,headers:c,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}};js("CapacitorHttp",{web:()=>new k2});var $2=js("Browser",{web:()=>Promise.resolve().then(()=>f2()).then(n=>new n.BrowserWeb)});class Hi extends K{constructor(...e){super(...e);this.currentView="Hazard",this.isLoading=!1,this.isLoggedIn=!1,this.currentObjectApiName="",this.searchTerm="",this.showForm=!1,this.recordId=null,this.viewMode="list",this.currentViewTitle="Hazard",this.placeholderText="Search hazard",this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="",this.showQrScanner=!1,this.qrData=null,this.selectedIsAttachment=!1,this.componentDetail={},this.navigationStack=[],this.showNotificationModal=!1,this.notificationTitle="",this.notificationMessage="",this.notificationType="success"}connectedCallback(){this.checkLoginStatus(),this.initializeRouting(),this.initializeFileUploadSync(),window.addEventListener("popstate",this.handleUrlChange.bind(this)),document.addEventListener("auth-logout",this.handleAuthLogout.bind(this)),this.navigationListener=this.handleNavigate.bind(this),document.addEventListener("navigate",this.navigationListener),this.assessmentRefreshListener=this.handleAssessmentRefresh.bind(this),document.addEventListener("apprefreshassessmentdetail",this.assessmentRefreshListener),X.addListener("networkStatusChange",async()=>{V()})}renderedCallback(){X.addListener("networkStatusChange",async()=>{V()})}initializeFileUploadSync(){try{typeof window!="undefined"&&(window.fileUploadSync=G,console.log("\u{1F4C1} File upload sync service initialized and made globally available"))}catch(e){console.error("\u274C Error initializing file upload sync service:",e)}}disconnectedCallback(){window.removeEventListener("popstate",this.handleUrlChange.bind(this)),document.removeEventListener("auth-logout",this.handleAuthLogout.bind(this)),this.navigationListener&&document.removeEventListener("navigate",this.navigationListener),this.assessmentRefreshListener&&document.removeEventListener("apprefreshassessmentdetail",this.assessmentRefreshListener)}handleQrScanClick(){this.showQrScanner=!0}handleCloseQrScanner(){this.showQrScanner=!1}handleModalContentClick(e){e.stopPropagation()}async handleQrScanSuccess(e){this.showQrScanner=!1;const s=e.detail;if(console.log("QR Scan Success event detail:",s),s.formRoute)console.log("\u{1F680} Handling form route from QR code:",s),this.currentObjectApiName=s.objectApiName,this.showForm=!0,s.formType==="incident"?(this.currentView="incident",this.currentViewTitle="Incident"):s.formType==="hazard"&&(this.currentView="hazard",this.currentViewTitle="Hazard"),this.qrData={locationId:s.locationId,workAreaId:s.workAreaId,objectApiName:s.objectApiName},console.log(`\u2705 Opening ${s.formType} form with QR data:`,JSON.stringify(this.qrData));else{const{url:t,content:o}=s;if(t)try{await $2.open({url:t,windowName:"_blank",toolbarColor:"#667eea",presentationStyle:"fullscreen"}),console.log("URL opened in in-app browser:",t)}catch(i){console.error("Error opening URL in in-app browser:",i),window.open(t,"_blank")}else o&&console.log("QR code content (not a URL):",o)}}handleQrScanError(e){console.error("QR scan error:",e.detail.error),this.showQrScanner=!1}initializeRouting(){this.handleUrlChange()}handleUrlChange(){const e=new URLSearchParams(window.location.search),s=e.get("navigate"),t=e.get("recordId");s?(this.currentObjectApiName=s,t?(this.recordId=t,this.viewMode="detail",console.log(`URL has record ID: ${t}, setting view mode to detail`)):(this.recordId=null,this.viewMode="list",console.log("URL has no record ID, setting view mode to list")),this.queryListViewData(s)):this.setDefaultRoute(),console.log("Current object API name:",this.currentObjectApiName),console.log("Current view:",this.currentView),console.log("Current view mode:",this.viewMode)}queryListViewData(e){tn(e).then(s=>{console.log("Menu items response:",s),s&&s.length>0&&(this.currentViewTitle=s[0].Rhythm__Header__c,this.placeholderText=`Search ${this.currentViewTitle}`)}).catch(s=>{console.error("Error fetching menu items:",s)})}setDefaultRoute(){this.currentView="hazard",this.currentViewTitle="Hazard",this.placeholderText="Search hazard",this.currentObjectApiName="Rhythm__Hazard__c",this.updateUrl("hazard","Rhythm__Hazard__c"),this.queryListViewData("Rhythm__Hazard__c")}updateUrl(e,s){const t=`${window.location.origin}${window.location.pathname}?navigate=${s}`;console.log("newUrl",t),window.history.pushState({view:e,object:s},"",t)}checkLoginStatus(){this.isLoggedIn=se.hasAnyTokens(),console.log("\u{1F510} App: Login status checked:",this.isLoggedIn)}handleLoginSuccess(){this.isLoggedIn=!0,Fe.init().catch(e=>{console.error("Error initializing tabs service:",e)}),this.currentObjectApiName||this.setDefaultRoute()}async handleAuthLogout(e){console.log("\u{1F510} App: Auth logout event received:",e.detail);try{await Fe.clearAllMetadata(),console.log("\u2705 Tabs metadata cleared during auth logout")}catch(s){console.error("\u274C Error clearing tabs metadata:",s)}this.isLoggedIn=!1,this.showForm=!1,se.clearConnectionCache(),console.log("\u{1F510} App: User logged out due to authentication failure")}handleMenuChange(e){const s=e.detail.selectedId,t=e.detail.selectedItem,o=e.detail.objectApiName;console.log("selectedId",s),console.log("selectedItem",JSON.stringify(t)),console.log("objectApiName",o),this.currentView=t,this.currentObjectApiName=o,t&&t.Rhythm__Header__c&&(this.currentViewTitle=t.Rhythm__Header__c),this.searchTerm="",this.updateUrlWithObject(o),console.log("Menu changed to:",t,"Object:",o)}updateUrlWithObject(e){const s=new URL(window.location);s.searchParams.set("navigate",e),window.history.pushState({},"",s)}handleSearch(e){this.searchTerm=e.target.value,console.log("Search term:",this.searchTerm);const s=new CustomEvent("search",{detail:{searchTerm:this.searchTerm,objectType:this.currentView}}),t=this.template.querySelector("c-generic-list-view");t?(console.log("Dispatching search event to generic-list-view"),t.dispatchEvent(s)):console.error("Could not find generic-list-view component")}handleFabClick(){console.log("FAB clicked for:",this.currentView),this.showForm=!0;const e=this.currentView==="incident"?"Create New Incident":"Create New Hazard";console.log("FAB Action:",e)}handleFormCancel(){this.showForm=!1,this.qrData=null}handleFormSuccess(e){this.showForm=!1,this.qrData=null,this.notificationType="success",this.notificationTitle="Success",this.notificationMessage=e.detail.message||"Form submitted successfully",this.showNotificationModal=!0,this.refreshCurrentView()}handleFormError(e){this.notificationType="error",this.notificationTitle="Error",this.notificationMessage=e.detail.message||"An error occurred while submitting the form",this.showNotificationModal=!0}handleCloseNotification(){this.showNotificationModal=!1}get isSuccessNotification(){return this.notificationType==="success"}get notificationIconClass(){return`notification-icon ${this.notificationType}-icon`}refreshCurrentView(){const e=this.template.querySelector("c-generic-list-view");if(e){const s=new CustomEvent("refresh");e.dispatchEvent(s),e.refresh()}}handleAssessmentRefresh(e){console.log("\u{1F4CA} App received assessment refresh event:",e.detail);const s=this.template.querySelectorAll("c-dynamic-host");if(s&&s.length>0)console.log(`\u{1F504} App found ${s.length} dynamic host component(s)`),s.forEach((t,o)=>{try{console.log(`\u{1F504} Dispatching refresh event to dynamic host #${o+1}`);const i=new CustomEvent("dynamichostrefreshassessment",{bubbles:!1,composed:!1,detail:{timestamp:Date.now(),source:"app",originalSource:e.detail.source}});t.dispatchEvent(i)}catch(i){console.error(`Error dispatching to dynamic host #${o+1}:`,i)}});else{console.log("\u2139\uFE0F App found no dynamic host components to refresh");const t=this.template.querySelectorAll("c-assessment-detail");t&&t.length>0?(console.log(`\u{1F504} App found ${t.length} direct assessment detail component(s)`),t.forEach((o,i)=>{o&&typeof o.loadAssessmentData=="function"&&(console.log(`\u{1F504} Refreshing assessment detail #${i+1}`),o.loadAssessmentData())})):console.log("\u2139\uFE0F App found no assessment detail components to refresh")}}async handleLogout(){try{await Fe.clearAllMetadata(),console.log("\u2705 Tabs metadata cleared during logout")}catch(e){console.error("\u274C Error clearing tabs metadata:",e)}sessionStorage.removeItem("sf_access_token"),sessionStorage.removeItem("sf_instance_url"),sessionStorage.removeItem("sf_user_id"),localStorage.removeItem("sf_refresh_token"),localStorage.removeItem("sf_instance_url"),localStorage.removeItem("sf_user_id"),sessionStorage.removeItem("app_metadata"),this.isLoggedIn=!1,this.currentView="incident",this.currentObjectApiName="",this.searchTerm="",this.showForm=!1,window.history.pushState({},"",window.location.pathname)}get showLogin(){return!this.isLoggedIn}get showIncident(){return this.isLoggedIn&&this.currentView==="incident"}get showHazard(){return this.isLoggedIn&&this.currentView==="hazard"}get objectApiName(){return this.currentObjectApiName}get showTabsPage(){return this.viewMode==="detail"&&this.recordId}get showComponentPage(){return this.viewMode==="component"&&this.selectedComponent}get showListView(){return this.viewMode==="list"}get showFab(){const e=["Rhythm__AccountAssessmentRelation__c","Rhythm__Alert_Relation__c"];return this.showListView&&this.currentObjectApiName&&!e.includes(this.currentObjectApiName)}get contentAreaClass(){return this.showForm?"content-area form-mode":"content-area"}get hideMenuToggle(){return this.showTabsPage||this.showComponentPage}handleNavigate(e){console.log("Navigation event received:",e.detail);const{type:s,objectApiName:t,recordId:o,component:i,props:a,tabLabel:r,isAttachment:l,listViewObject:c,sourceContext:d}=e.detail;if(console.log("listViewObject in line 370",c),console.log("event.detail in line 371",JSON.stringify(e.detail)),s==="detail"){this.pushToNavigationStack(d),this.viewMode="detail",this.recordId=o,this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="",t&&(this.currentObjectApiName=t);const h=new URL(window.location);h.searchParams.set("navigate",this.currentObjectApiName),h.searchParams.set("recordId",o),window.history.pushState({},"",h),console.log(`Navigating to ${this.currentObjectApiName} record: ${o}, viewMode=${this.viewMode}, stack depth: ${this.navigationStack.length}`)}else if(s==="component")this.pushToNavigationStack(),this.viewMode="component",this.selectedComponent=i,this.selectedComponentProps=a||{},this.selectedTabLabel=r||i,this.selectedComponentProps.tabLabel=this.selectedTabLabel,console.log("listViewObject in line 400",c),this.componentDetail={objectApiName:t,recordId:o,isAttachment:l,listViewObject:c},console.log(`Navigating to component: ${i}, viewMode=${this.viewMode}, stack depth: ${this.navigationStack.length}`);else if(s==="list"){this.viewMode="list",this.recordId=null,this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="",t&&(this.currentObjectApiName=t);const h=new URL(window.location);h.searchParams.set("navigate",this.currentObjectApiName),h.searchParams.delete("recordId"),window.history.pushState({},"",h),console.log(`Navigating to ${this.currentObjectApiName} list view, viewMode=${this.viewMode}`)}else if(s==="back"){console.log("\u{1F504} Back navigation requested");const h=this.popFromNavigationStack();if(h){if(console.log("\u{1F504} Found previous state in navigation stack:",JSON.stringify(h)),h.sourceContext&&h.sourceContext.type==="cpExpListView"){console.log("\u{1F504} Back navigation to cpExpListView for record:",h.sourceContext.sourceRecordId),console.log("\u{1F504} Previous state sourceContext:",JSON.stringify(h.sourceContext)),this.viewMode=null,this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="",Promise.resolve().then(()=>{console.log("\u{1F504} Setting up cpExpListView navigation state from back button"),this.currentObjectApiName=h.sourceContext.sourceObjectApiName,this.recordId=h.sourceContext.sourceRecordId,this.selectedComponent="cpExpListView",this.selectedComponentProps={objectApiName:h.sourceContext.sourceObjectApiName,recordId:h.sourceContext.sourceRecordId,tabLabel:this.selectedTabLabel},this.selectedTabLabel="Related Tasks",this.componentDetail=h.componentDetail||{objectApiName:h.sourceContext.sourceObjectApiName,recordId:h.sourceContext.sourceRecordId,isAttachment:!1,listViewObject:h.sourceContext.listViewObject||"Task"},console.log("\u{1F504} Restored componentDetail from navigation stack:",this.componentDetail),console.log("\u{1F504} listViewObject restored as:",this.componentDetail.listViewObject),this.viewMode="component",console.log("\u{1F504} Back navigation state after cpExpListView setup:"),console.log("   viewMode:",this.viewMode),console.log("   currentObjectApiName:",this.currentObjectApiName),console.log("   recordId:",this.recordId),console.log("   selectedComponent:",this.selectedComponent),console.log("   showComponentPage getter:",this.showComponentPage);const f=new URL(window.location);f.searchParams.set("navigate",this.currentObjectApiName),f.searchParams.set("recordId",this.recordId),window.history.pushState({},"",f)});return}console.log("\u{1F504} Normal back navigation, restoring state:",h),this.viewMode=h.viewMode,this.currentObjectApiName=h.objectApiName,this.recordId=h.recordId,this.selectedComponent=h.selectedComponent,this.selectedComponentProps=h.selectedComponentProps,this.selectedTabLabel=h.selectedTabLabel;const u=new URL(window.location);h.viewMode==="detail"&&h.recordId?(u.searchParams.set("navigate",h.objectApiName),u.searchParams.set("recordId",h.recordId)):h.viewMode==="list"?(u.searchParams.set("navigate",h.objectApiName),u.searchParams.delete("recordId")):(u.searchParams.delete("navigate"),u.searchParams.delete("recordId")),window.history.pushState({},"",u)}else console.log("\u{1F504} No navigation stack, falling back to list view"),this.viewMode="list",this.recordId=null,this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel=""}}pushToNavigationStack(e=null){const s={viewMode:this.viewMode,objectApiName:this.currentObjectApiName,recordId:this.recordId,selectedComponent:this.selectedComponent,selectedComponentProps:{...this.selectedComponentProps},selectedTabLabel:this.selectedTabLabel,componentDetail:this.componentDetail,sourceContext:e,timestamp:Date.now()};if(this.navigationStack.push(s),console.log("\u{1F4DA} Pushed to navigation stack:",s),console.log("\u{1F4DA} Navigation stack depth:",this.navigationStack.length),this.navigationStack.length>10){const t=this.navigationStack.shift();console.log("\u{1F4DA} Removed oldest navigation state:",t)}}popFromNavigationStack(){if(this.navigationStack.length>0){const e=this.navigationStack.pop();return console.log("\u{1F4DA} Popped from navigation stack:",JSON.stringify(e)),console.log("\u{1F4DA} Remaining navigation stack depth:",JSON.stringify(this.navigationStack)),console.log("\u{1F4DA} Remaining navigation stack depth:",this.navigationStack.length),e}return console.log("\u{1F4DA} Navigation stack is empty, cannot pop"),null}handleBackToTabs(){console.log("\u{1F504} Navigating back to tabs from component page");const e=this.popFromNavigationStack();if(e){if(console.log("\u{1F504} Found previous state in navigation stack:",e),e.sourceContext&&e.sourceContext.type==="cpExpListView"){console.log("\u{1F504} Navigating back to cpExpListView for record:",e.sourceContext.sourceRecordId),console.log("\u{1F504} Previous state sourceContext:",JSON.stringify(e.sourceContext)),this.viewMode=null,this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="",Promise.resolve().then(()=>{console.log("\u{1F504} Setting up cpExpListView navigation state"),this.currentObjectApiName=e.sourceContext.sourceObjectApiName,this.recordId=e.sourceContext.sourceRecordId,this.selectedComponent="cpExpListView",this.selectedComponentProps={objectApiName:e.sourceContext.sourceObjectApiName,recordId:e.sourceContext.sourceRecordId,tabLabel:this.selectedTabLabel},this.selectedTabLabel="Related Tasks",this.componentDetail=e.componentDetail||{objectApiName:e.sourceContext.sourceObjectApiName,recordId:e.sourceContext.sourceRecordId,isAttachment:!1,listViewObject:e.sourceContext.listViewObject||"Task"},console.log("\u{1F504} Restored componentDetail from navigation stack (tabShell back):",this.componentDetail),console.log("\u{1F504} listViewObject restored as:",this.componentDetail.listViewObject),this.viewMode="component",console.log("\u{1F504} Navigation state after cpExpListView setup:"),console.log("   viewMode:",this.viewMode),console.log("   currentObjectApiName:",this.currentObjectApiName),console.log("   recordId:",this.recordId),console.log("   selectedComponent:",this.selectedComponent),console.log("   selectedComponentProps:",JSON.stringify(this.selectedComponentProps)),console.log("   showComponentPage getter:",this.showComponentPage);const s=new URL(window.location);s.searchParams.set("navigate",this.currentObjectApiName),s.searchParams.set("recordId",this.recordId),window.history.pushState({},"",s)});return}if(e.viewMode==="detail"){console.log("\u{1F504} Restoring from navigation stack to tabs view:",e),this.viewMode=e.viewMode,this.currentObjectApiName=e.objectApiName,this.recordId=e.recordId,this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="";const s=new URL(window.location);s.searchParams.set("navigate",this.currentObjectApiName),s.searchParams.set("recordId",this.recordId),window.history.pushState({},"",s);return}}if(console.log("\u{1F504} No valid navigation stack, using fallback with current context"),this.viewMode="detail",this.selectedComponent=null,this.selectedComponentProps={},this.selectedTabLabel="",this.componentDetail&&this.componentDetail.recordId&&(this.recordId=this.componentDetail.recordId,this.currentObjectApiName=this.componentDetail.objectApiName||this.currentObjectApiName),this.recordId&&this.currentObjectApiName){const s=new URL(window.location);s.searchParams.set("navigate",this.currentObjectApiName),s.searchParams.set("recordId",this.recordId),window.history.pushState({},"",s)}console.log(`\u{1F504} Back navigation completed: viewMode=${this.viewMode}, recordId=${this.recordId}, objectApi=${this.currentObjectApiName}`)}}Y(Hi,{track:{currentView:1,isLoading:1,isLoggedIn:1,currentObjectApiName:1,searchTerm:1,showForm:1,recordId:1,viewMode:1,currentViewTitle:1,placeholderText:1,selectedComponent:1,selectedComponentProps:1,selectedTabLabel:1,showQrScanner:1,qrData:1,selectedIsAttachment:1,componentDetail:1,navigationStack:1,showNotificationModal:1,notificationTitle:1,notificationMessage:1,notificationType:1}});const C2=z(Hi,{tmpl:d2,sel:"c-app",apiVersion:63}),S2={key:0};function gt(n,e,s,t){const{c:o}=n;return[o("c-app",C2,S2)]}var E2=J(gt);gt.stylesheets=[],gt.stylesheetToken="lwc-1uh17g0ai6h",gt.legacyStylesheetToken="ui-app_app",Vs&&gt.stylesheets.push.apply(gt.stylesheets,Vs),Q(gt);const R2={hello:{title:"Hello",value:"hello",visible:!1},composition:{title:"Composition",value:"composition",visible:!1},child:{title:"Child-to-Parent",value:"child",visible:!1},parent:{title:"Parent-to-Child",value:"parent",visible:!1},misc:{title:"Misc",value:"misc",visible:!1},party:{title:"3rd Party Libs",value:"party",visible:!1},lightDom:{title:"Light DOM",value:"lightDom",visible:!1},externalWc:{title:"3rd Party Web Components",value:"externalWc",visible:!1}},A2=["hello","composition","child","parent","misc","party","lightDom","externalWc"];class Ji extends K{constructor(...e){super(...e);this.currentNavigationItem="hello",this.navigationItems=R2,this.nextNavigationItem=void 0,this.previousNavigationItem=void 0,this.navigationElements=A2,this._isWindowHistoryUpdate=!1}connectedCallback(){let e=this;if(window.onpopstate=function(s){s.state&&s.state.page&&(e._isWindowHistoryUpdate=!0,e.navigationItems[e.currentNavigationItem].visible=!1,e.currentNavigationItem=s.state.page,e.hideCurrentNavigationItemFromNav(),e.handleCategoryChange())},window.location.hash){const s=window.location.hash.substring(1,window.location.hash.length);this.navigationElements.indexOf(s)>-1&&(this.currentNavigationItem=s,window.history.replaceState({page:s},null,""))}else window.history.replaceState({page:this.currentNavigationItem},null,"");this.navigationItems[this.currentNavigationItem].visible=!0,this.calculateNavFooterElements()}handleCategoryChange(e){if(e)if(this.currentNavigationItem!==e.detail)this.navigationItems[this.currentNavigationItem].visible=!1,this.currentNavigationItem=e.detail;else return;this.updateGoogleAnalyticsForSPA(this.currentNavigationItem),this.scrollAndLocation(),this.calculateNavFooterElements(),this.navigationItems[this.currentNavigationItem].visible=!0}handleNavigateNext(){this.hideCurrentNavigationItemFromNav(),this.currentNavigationItem=this.navigationItems[this.navigationElements[this.navigationElements.indexOf(this.currentNavigationItem)+1]].value,this.handleCategoryChange()}handleNavigatePrevious(){this.hideCurrentNavigationItemFromNav(),this.currentNavigationItem=this.navigationItems[this.navigationElements[this.navigationElements.indexOf(this.currentNavigationItem)-1]].value,this.handleCategoryChange()}calculateNavFooterElements(){this.nextNavigationItem=this.navigationItems[this.navigationElements[this.navigationElements.indexOf(this.currentNavigationItem)+1]],this.previousNavigationItem=this.navigationItems[this.navigationElements[this.navigationElements.indexOf(this.currentNavigationItem)-1]]}hideCurrentNavigationItemFromNav(){this.navigationItems[this.navigationElements[this.navigationElements.indexOf(this.currentNavigationItem)]].visible=!1}scrollAndLocation(){this._isWindowHistoryUpdate||window.history.pushState({page:this.currentNavigationItem},null,"#".concat(this.currentNavigationItem)),this._isWindowHistoryUpdate=!1,document.body.scrollTop=document.documentElement.scrollTop=0}updateGoogleAnalyticsForSPA(e){window.dataLayer=window.dataLayer||[];function s(){window.dataLayer.push(arguments)}s("config","UA-45076517-19",{page_path:"#".concat(e)})}}Y(Ji,{fields:["currentNavigationItem","navigationItems","nextNavigationItem","previousNavigationItem","navigationElements","_isWindowHistoryUpdate"]});const I2=z(Ji,{tmpl:E2,sel:"ui-app",apiVersion:63});export{I2 as default};
